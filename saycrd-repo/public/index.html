<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SAYCRD</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body,#root{width:100%;height:100%;overflow:hidden;background:#000}

  

    /* ═══ Auth UI ═══ */
    .auth-overlay{position:fixed;inset:0;z-index:99999;display:none;align-items:center;justify-content:center;background:#060910;padding:1.5rem}
    .auth-card{width:100%;max-width:380px;text-align:center}
    .auth-logo{font-family:'Space Grotesk',sans-serif;font-size:2.4rem;letter-spacing:.5em;color:rgba(244,196,109,.8);text-transform:uppercase;font-weight:700;text-indent:.5em;margin-bottom:.5rem}
    .auth-sub{font-family:'Fraunces',serif;font-size:1rem;color:rgba(247,241,231,.35);margin-bottom:2.5rem;font-weight:300}
    .auth-input{display:block;width:100%;background:rgba(14,17,21,.8);border:1px solid rgba(244,241,234,.1);border-radius:12px;color:rgba(247,241,231,.9);padding:.8rem 1rem;font-family:'Space Grotesk',sans-serif;font-size:.95rem;margin-bottom:.8rem;outline:none;transition:border-color .2s;box-sizing:border-box}
    .auth-input:focus{border-color:rgba(214,178,109,.4)}
    .auth-input::placeholder{color:rgba(244,241,234,.2)}
    .auth-btn{width:100%;padding:.8rem;border-radius:12px;border:1px solid rgba(214,178,109,.4);background:rgba(214,178,109,.08);color:var(--accent,rgba(244,196,109,.9));font-family:'Space Grotesk',sans-serif;font-size:.95rem;font-weight:600;letter-spacing:.08em;cursor:pointer;transition:all .2s;margin-top:.4rem}
    .auth-btn:hover{background:rgba(214,178,109,.15);border-color:rgba(214,178,109,.6)}
    .auth-btn:disabled{opacity:.4;cursor:not-allowed}
    .auth-toggle{margin-top:1.5rem;font-size:.85rem;color:rgba(247,241,231,.3)}
    .auth-toggle a{color:rgba(214,178,109,.6);cursor:pointer;text-decoration:none}
    .auth-toggle a:hover{color:rgba(214,178,109,.9)}
    .auth-error{color:rgba(196,110,95,.8);font-size:.82rem;margin-top:.6rem;min-height:1.2em}
    .auth-divider{display:flex;align-items:center;gap:1rem;margin:1.2rem 0;color:rgba(247,241,231,.15);font-size:.75rem;letter-spacing:.1em;text-transform:uppercase}
    .auth-divider::before,.auth-divider::after{content:"";flex:1;height:1px;background:rgba(244,241,234,.06)}
    .auth-social{width:100%;padding:.7rem;border-radius:12px;border:1px solid rgba(244,241,234,.08);background:transparent;color:rgba(247,241,231,.5);font-family:'Space Grotesk',sans-serif;font-size:.88rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}
    .auth-social:hover{border-color:rgba(244,241,234,.2);color:rgba(247,241,231,.7)}
    .auth-forgot{display:block;text-align:right;font-size:.78rem;color:rgba(214,178,109,.35);cursor:pointer;margin-top:-.3rem;margin-bottom:.5rem}
    .auth-forgot:hover{color:rgba(214,178,109,.6)}
    .auth-hidden{display:none!important}
    .ws-user{font-size:.72rem;color:rgba(247,241,231,.25);cursor:pointer;letter-spacing:.04em}
    .ws-user:hover{color:rgba(247,241,231,.45)}
</style>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="auth-overlay" id="auth-overlay">
      <div class="auth-card">
        <div class="auth-logo">SAYCRD</div>
        <div class="auth-sub">clarity, not control</div>

        <!-- Login form -->
        <div id="auth-login">
          <input class="auth-input" type="text" id="auth-email" placeholder="Email" autocomplete="email" />
          <input class="auth-input" type="password" id="auth-password" placeholder="Password" autocomplete="current-password" />
          <span class="auth-forgot" id="auth-forgot" onclick="document.getElementById('auth-login').style.display='none';document.getElementById('auth-reset').style.display='block';">Forgot password?</span>
          <button class="auth-btn" id="auth-login-btn" onclick="
            (async function(){
              var btn=document.getElementById('auth-login-btn');btn.disabled=true;
              var err=document.getElementById('auth-error');err.textContent='';err.style.color='';
              var em=document.getElementById('auth-email').value.trim();
              var pw=document.getElementById('auth-password').value;
              if(!em||!pw){err.textContent='Enter email and password';btn.disabled=false;return;}
              if(em==='local'&&pw==='local'){window._localBypass();return;}
              try{
                var sb=window.sbClient;if(!sb||!sb.auth){err.textContent='Database connecting... try again or use Continue without account';btn.disabled=false;return;}
                var r=await sb.auth.signInWithPassword({email:em,password:pw});
                if(r.error){
                  var msg=r.error.message||'Login failed';
                  if(msg.toLowerCase().indexOf('email not confirmed')!==-1){
                    msg='Check your email for a confirmation link, then try again.';
                    err.style.color='rgba(244,196,109,.7)';
                  } else if(msg.toLowerCase().indexOf('invalid')!==-1){
                    msg='Wrong email or password. Try again or reset below.';
                  }
                  err.textContent=msg;btn.disabled=false;return;
                }
                currentUser=r.data.user;window.currentUser=currentUser;
                sb.auth.getSession().then(function(s){if(s.data.session)window._saycrdToken=s.data.session.access_token;});
                if(window._authResolve)window._authResolve();
                var o=document.getElementById('auth-overlay');o.style.opacity='0';o.style.transition='opacity .4s';setTimeout(function(){o.style.display='none';if(window._authSuccessCallback){var cb=window._authSuccessCallback;window._authSuccessCallback=null;cb();}},400);
                var sn=document.getElementById('ws-signout');if(sn&&r.data.user.email)sn.textContent=r.data.user.email.split('@')[0]+' \u00B7 sign out';
              }catch(e){err.textContent=e.message||'Login failed';btn.disabled=false;}
            })();
          ">Enter</button>
          <div class="auth-error" id="auth-error"></div>
          <div class="auth-divider">or</div>
          <button class="auth-social" id="auth-google" onclick="
            var sb=window.sbClient;if(sb&&sb.auth)sb.auth.signInWithOAuth({provider:'google',options:{redirectTo:window.location.origin}});
          ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Continue with Google
          </button>
          <div class="auth-toggle">No account? <a id="auth-show-signup" onclick="document.getElementById('auth-login').style.display='none';document.getElementById('auth-signup').style.display='block';" style="cursor:pointer">Create one</a></div>
        </div>

        <!-- Signup form -->
        <div id="auth-signup" style="display:none">
          <input class="auth-input" type="email" id="auth-signup-email" placeholder="Email" autocomplete="email" />
          <input class="auth-input" type="password" id="auth-signup-password" placeholder="Password (min 6 chars)" autocomplete="new-password" />
          <button class="auth-btn" id="auth-signup-btn" onclick="
            (async function(){
              var btn=document.getElementById('auth-signup-btn');btn.disabled=true;
              var err=document.getElementById('auth-signup-error');err.textContent='';err.style.color='';
              var em=document.getElementById('auth-signup-email').value.trim();
              var pw=document.getElementById('auth-signup-password').value;
              if(!em||!pw){err.textContent='Enter email and password';btn.disabled=false;return;}
              if(pw.length<6){err.textContent='Password must be at least 6 characters';btn.disabled=false;return;}
              try{
                var sb=window.sbClient;if(!sb||!sb.auth){err.textContent='Database connecting... try Continue without account below';btn.disabled=false;return;}
                var r=await sb.auth.signUp({email:em,password:pw});
                if(r.error){
                  var msg=r.error.message||'Signup failed';
                  if(msg.toLowerCase().indexOf('already registered')!==-1){
                    msg='This email is already registered. Try signing in instead.';
                    err.style.color='rgba(244,196,109,.7)';
                  }
                  err.textContent=msg;btn.disabled=false;return;
                }
                /* Check if email confirmation is required */
                if(r.data.user&&!r.data.user.confirmed_at&&!r.data.session){
                  err.style.color='rgba(125,183,174,.7)';err.textContent='Check your email for a confirmation link, then come back and sign in.';btn.disabled=false;return;
                }
                /* Auto-confirm is on — user is logged in */
                currentUser=r.data.user;window.currentUser=currentUser;
                sb.auth.getSession().then(function(s){if(s.data.session)window._saycrdToken=s.data.session.access_token;});
                if(window._authResolve)window._authResolve();
                var o=document.getElementById('auth-overlay');o.style.opacity='0';o.style.transition='opacity .4s';setTimeout(function(){o.style.display='none';if(window._authSuccessCallback){var cb=window._authSuccessCallback;window._authSuccessCallback=null;cb();}},400);
                var sn=document.getElementById('ws-signout');if(sn&&r.data.user.email)sn.textContent=r.data.user.email.split('@')[0]+' \u00B7 sign out';
              }catch(e){err.textContent=e.message||'Signup failed';btn.disabled=false;}
            })();
          ">Begin</button>
          <div class="auth-error" id="auth-signup-error"></div>
          <div class="auth-toggle">Already have an account? <a id="auth-show-login" onclick="document.getElementById('auth-signup').style.display='none';document.getElementById('auth-login').style.display='block';" style="cursor:pointer">Sign in</a></div>
        </div>

        <!-- Reset form -->
        <div id="auth-reset" style="display:none">
          <input class="auth-input" type="email" id="auth-reset-email" placeholder="Email" autocomplete="email" />
          <button class="auth-btn" id="auth-reset-btn" onclick="
            (async function(){
              var btn=document.getElementById('auth-reset-btn');btn.disabled=true;
              var err=document.getElementById('auth-reset-error');err.textContent='';
              var em=document.getElementById('auth-reset-email').value.trim();
              if(!em){err.textContent='Enter your email';btn.disabled=false;return;}
              try{
                var sb=window.sbClient;if(!sb||!sb.auth){err.textContent='Database offline';btn.disabled=false;return;}
                var r=await sb.auth.resetPasswordForEmail(em,{redirectTo:window.location.origin});
                if(r.error){err.textContent=r.error.message;btn.disabled=false;return;}
                err.style.color='rgba(125,183,174,.7)';err.textContent='Reset link sent \u2014 check your email.';btn.disabled=false;
              }catch(e){err.textContent=e.message||'Reset failed';btn.disabled=false;}
            })();
          ">Send reset link</button>
          <div class="auth-error" id="auth-reset-error"></div>
          <div class="auth-toggle"><a id="auth-show-login-2" onclick="document.getElementById('auth-reset').style.display='none';document.getElementById('auth-login').style.display='block';" style="cursor:pointer">Back to sign in</a></div>
        </div>

        <!-- BYPASS — always visible, inline handler, cannot fail -->
        <div style="margin-top:1.8rem;padding-top:1.2rem;border-top:1px solid rgba(244,241,234,.06)">
          <button id="auth-local-bypass" style="width:100%;padding:.7rem;border-radius:12px;border:1px solid rgba(244,241,234,.06);background:transparent;color:rgba(247,241,231,.3);font-family:'Space Grotesk',sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onclick="window._localBypass();">Continue without account</button>
        </div>
      </div>
    </div>



<div id="root">
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>



        <div id="ws-signout" style="position:fixed;top:12px;right:16px;z-index:99998;font-family:'Space Grotesk',sans-serif;font-size:11px;color:rgba(255,255,255,0.3);cursor:pointer;letter-spacing:0.06em;padding:6px 12px;border-radius:20px;border:1px solid rgba(255,255,255,0.08);background:rgba(0,0,0,0.4);backdrop-filter:blur(8px);">Sign out</div>

<script>
/* Global error handler — shows what's breaking */
window.onerror = function(msg, url, line, col, err) {
  console.error("SAYCRD ERROR:", msg, "line:", line);
  var errBox = document.getElementById("auth-error");
  if (errBox) errBox.textContent = "JS Error: " + msg + " (line " + line + ")";
};

/* ====================================================================
   SAYCRD — Configuration
   Replace these with your Supabase project values
   ==================================================================== */
const SAYCRD_CONFIG = {
  SUPABASE_URL: "https://perataksccqmdocgshyl.supabase.co",
  SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBlcmF0YWtzY2NxbWRvY2dzaHlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NjU3MTEsImV4cCI6MjA4NjM0MTcxMX0.D_y3MF3UyRsyAPRpUWYw5x7fn5i9dCN8xnD5_n_-Nnc",
  API_ENDPOINT: "/api/claude",
};

/* ====================================================================
   Supabase Client + Auth
   ==================================================================== */
var sbClient = null;
window.sbClient = null;
var supabaseAvailable = false;
try {
  sbClient = window.supabase.createClient(
    SAYCRD_CONFIG.SUPABASE_URL,
    SAYCRD_CONFIG.SUPABASE_ANON_KEY
  );
  window.sbClient = sbClient;
  supabaseAvailable = true;
  console.log("Supabase client initialized");
} catch(sbInitErr) {
  console.warn("Supabase unavailable:", sbInitErr.message || sbInitErr);
}

var currentUser = null;
window.currentUser = null;

/* ── Storage Adapter (drop-in replacement for window.storage) ── */
/* Saves to Supabase if authenticated + available, otherwise localStorage */
/* AUTH GATE: storage ops wait for auth to resolve before executing */
var _authReady = null;
var _authResolve = null;
_authReady = new Promise(function(resolve) { _authResolve = resolve; });
window._authResolve = _authResolve;
/* Timeout: if auth doesn't resolve in 5s, proceed with whatever we have */
setTimeout(function() { _authResolve(); }, 5000);

function _storageMode() {
  if (currentUser && supabaseAvailable && currentUser.id !== "local-user") return "supabase";
  return "local";
}
function _localGet(key) {
  var uid = (currentUser && currentUser.id) || "local-user";
  var v = localStorage.getItem("saycrd-" + uid + "-" + key);
  if (v === null) return null;
  return { key: key, value: v };
}
function _localSet(key, value) {
  var uid = (currentUser && currentUser.id) || "local-user";
  localStorage.setItem("saycrd-" + uid + "-" + key, value);
  return { key: key, value: value };
}
function _localDelete(key) {
  var uid = (currentUser && currentUser.id) || "local-user";
  localStorage.removeItem("saycrd-" + uid + "-" + key);
  return { key: key, deleted: true };
}
function _localList(prefix) {
  var uid = (currentUser && currentUser.id) || "local-user";
  var pfx = "saycrd-" + uid + "-";
  var keys = [];
  for (var i = 0; i < localStorage.length; i++) {
    var k = localStorage.key(i);
    if (k && k.indexOf(pfx) === 0) {
      var clean = k.slice(pfx.length);
      if (!prefix || clean.indexOf(prefix) === 0) keys.push(clean);
    }
  }
  return { keys: keys };
}

/* ── Sync local data up to Supabase (runs once after auth) ── */
async function _syncLocalToSupabase() {
  if (_storageMode() !== "supabase") return;
  var uid = currentUser.id;
  var pfx = "saycrd-" + uid + "-";
  var synced = 0;
  for (var i = 0; i < localStorage.length; i++) {
    var k = localStorage.key(i);
    if (k && k.indexOf(pfx) === 0) {
      var cleanKey = k.slice(pfx.length);
      var val = localStorage.getItem(k);
      if (!val) continue;
      try {
        /* Check if supabase already has this key */
        var { data } = await sbClient.from("user_data").select("key").eq("user_id", uid).eq("key", cleanKey).limit(1);
        if (!data || data.length === 0) {
          /* Supabase doesn't have it — push local up */
          var parsed; try { parsed = JSON.parse(val); } catch(e) { parsed = val; }
          await sbClient.from("user_data").upsert({ user_id: uid, key: cleanKey, value: parsed }, { onConflict: "user_id,key" });
          synced++;
        }
      } catch(e) { /* skip silently */ }
    }
  }
  if (synced > 0) console.log("Synced " + synced + " local keys to Supabase");
}

/* ── Hydrate localStorage from Supabase (runs after auth on new/different device) ── */
/* Fetches sessions from server and merges with local. Server wins if more recent.    */
async function _hydrateFromServer() {
  if (!currentUser || !supabaseAvailable || currentUser.id === "local-user") return;
  var uid = currentUser.id;
  try {
    var { data, error } = await sbClient
      .from("user_data")
      .select("value, updated_at")
      .eq("user_id", uid)
      .eq("key", "sessions")
      .limit(1);
    if (error || !data || data.length === 0) return;
    var serverSessions = Array.isArray(data[0].value) ? data[0].value : JSON.parse(data[0].value || "[]");
    if (!Array.isArray(serverSessions) || serverSessions.length === 0) return;

    var localKey = "saycrd-" + uid + "-sessions";
    var localSessions = [];
    try { localSessions = JSON.parse(localStorage.getItem(localKey) || "[]"); } catch(e) {}

    // Merge: union by date string, deduplicate, sort chronologically
    var all = serverSessions.concat(localSessions);
    var seen = {};
    var merged = all.filter(function(s) {
      if (!s || !s.date) return false;
      if (seen[s.date]) return false;
      seen[s.date] = true;
      return true;
    });
    merged.sort(function(a, b) { return a.date < b.date ? -1 : 1; });
    if (merged.length > 50) merged = merged.slice(-50);

    if (merged.length > localSessions.length) {
      localStorage.setItem(localKey, JSON.stringify(merged));
      console.log("[SAYCRD] Hydrated from server:", merged.length, "sessions (had", localSessions.length, "locally)");
      // Trigger app re-read by firing a custom event React can listen to
      try { window.dispatchEvent(new CustomEvent("saycrd-sessions-hydrated", { detail: { count: merged.length } })); } catch(e) {}
    }

    // Push any local-only sessions back to server
    if (merged.length > serverSessions.length) {
      await sbClient.from("user_data").upsert(
        { user_id: uid, key: "sessions", value: merged },
        { onConflict: "user_id,key" }
      );
      console.log("[SAYCRD] Pushed merged sessions back to server.");
    }
  } catch(e) {
    console.warn("[SAYCRD] Hydration failed (not critical):", e);
  }
}

window.storage = {
  async get(key) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    if (_storageMode() === "local") return _localGet(key);
    try {
      const { data, error } = await sbClient
        .from("user_data")
        .select("key, value")
        .eq("user_id", currentUser.id)
        .eq("key", key)
        .limit(1);
      if (error) { console.warn("Supabase get error for '" + key + "':", error.message); return _localGet(key); }
      var row = data && data.length > 0 ? data[0] : null;
      if (row) {
        /* Got from Supabase — also update local cache */
        var val = JSON.stringify(row.value);
        _localSet(key, val);
        return { key: row.key, value: val };
      }
      /* Supabase returned nothing — check if local has it (migration case) */
      var local = _localGet(key);
      if (local && local.value) {
        /* Push local data up to Supabase */
        try {
          var parsed; try { parsed = JSON.parse(local.value); } catch(e) { parsed = local.value; }
          await sbClient.from("user_data").upsert({ user_id: currentUser.id, key: key, value: parsed }, { onConflict: "user_id,key" });
          console.log("Migrated '" + key + "' from local to Supabase");
        } catch(e) { /* migration failed, no big deal */ }
        return local;
      }
      return null;
    } catch(e) { console.warn("Supabase get failed for '" + key + "':", e); return _localGet(key); }
  },

  async set(key, value) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    /* Always write to localStorage as backup */
    _localSet(key, value);
    if (_storageMode() === "local") return { key: key, value: value };
    try {
      let parsed;
      try { parsed = JSON.parse(value); } catch(e) { parsed = value; }
      const { error } = await sbClient
        .from("user_data")
        .upsert({
          user_id: currentUser.id,
          key: key,
          value: parsed
        }, { onConflict: "user_id,key" });
      if (error) { console.warn("Supabase set error for '" + key + "':", error.message); }
      return { key: key, value: value };
    } catch(e) { console.warn("Supabase set failed for '" + key + "':", e); return { key: key, value: value }; }
  },

  async delete(key) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    _localDelete(key);
    if (_storageMode() === "local") return { key: key, deleted: true };
    try {
      const { error } = await sbClient
        .from("user_data")
        .delete()
        .eq("user_id", currentUser.id)
        .eq("key", key);
      if (error) console.warn("Supabase delete error:", error.message);
    } catch(e) { console.warn("Supabase delete failed:", e); }
    return { key: key, deleted: true };
  },

  async list(prefix) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    if (_storageMode() === "local") return _localList(prefix);
    try {
      let query = sbClient
        .from("user_data")
        .select("key")
        .eq("user_id", currentUser.id);
      if (prefix) query = query.like("key", prefix + "%");
      const { data, error } = await query;
      if (error) { console.warn("Supabase list error:", error.message); return _localList(prefix); }
      return { keys: (data || []).map(function(d) { return d.key; }) };
    } catch(e) { console.warn("Supabase list failed:", e); return _localList(prefix); }
  }
};

/* ====================================================================
   FAILSAFE BYPASS — works even if Supabase is completely broken
   ==================================================================== */
window._showAuthOverlay = function(onSuccess) {
  var overlay = document.getElementById("auth-overlay");
  if (overlay) { overlay.style.display = "flex"; overlay.style.opacity = "1"; }
  if (onSuccess) window._authSuccessCallback = onSuccess;
};

window._localBypass = function() {
  currentUser = { id: "local-user", email: "local@saycrd" };
  window.currentUser = currentUser;
  if (_authResolve) _authResolve();
  /* storage already handles local mode via _storageMode() check */
  var overlay = document.getElementById("auth-overlay");
  if (overlay) {
    overlay.style.opacity = "0";
    overlay.style.transition = "opacity .4s ease";
    setTimeout(function() { overlay.style.display = "none"; }, 400);
  }
  var signoutEl = document.getElementById("ws-signout");
  if (signoutEl) signoutEl.textContent = "local \u00B7 sign out";
  console.log("LOCAL BYPASS ACTIVE — using localStorage");
};

/* ── Auth: restore session + sign out (all form handlers are inline in HTML) ── */
(function() {
  try {
    if (sbClient && sbClient.auth) {
      sbClient.auth.getSession().then(function(result) {
        if (result.data.session) {
          currentUser = result.data.session.user;
          window.currentUser = currentUser;
          window._saycrdToken = result.data.session.access_token;
          var o = document.getElementById("auth-overlay");
          if (o) { o.style.opacity = "0"; o.style.transition = "opacity .4s"; setTimeout(function(){ o.style.display = "none"; }, 400); }
          var sn = document.getElementById("ws-signout");
          if (sn && currentUser.email) sn.textContent = currentUser.email.split("@")[0] + " \u00B7 sign out";
          console.log("Session restored for:", currentUser.email);
          /* Resolve auth gate so storage ops proceed */
          if (_authResolve) _authResolve();
          /* Sync any local-only data up to Supabase */
          _syncLocalToSupabase().catch(function(e) { console.warn("Sync failed:", e); });
        } else {
          /* No session — resolve gate anyway so local mode works */
          if (_authResolve) _authResolve();
        }
      }).catch(function(e) {
        console.warn("Session restore failed:", e);
        if (_authResolve) _authResolve();
      });

      sbClient.auth.onAuthStateChange(function(event, session) {
        if (session && session.user) {
          currentUser = session.user;
          window.currentUser = currentUser;
          window._saycrdToken = session.access_token;
          var o = document.getElementById("auth-overlay");
          if (o) { o.style.opacity = "0"; o.style.transition = "opacity .4s"; setTimeout(function(){ o.style.display = "none"; }, 400); }
          var sn = document.getElementById("ws-signout");
          if (sn && session.user.email) sn.textContent = session.user.email.split("@")[0] + " \u00B7 sign out";
          /* Resolve auth gate on sign-in too */
          if (_authResolve) _authResolve();
          /* On sign-in: hydrate from server first (new device recovery),
             then push any local-only data up. Both are non-blocking. */
          if (event === "SIGNED_IN") {
            _hydrateFromServer().then(function() {
              return _syncLocalToSupabase();
            }).catch(function(e) { console.warn("[SAYCRD] Post-login sync failed:", e); });
          }
        }
      });
    } else {
      /* No supabase — resolve immediately */
      if (_authResolve) _authResolve();
    }
  } catch(e) {
    console.warn("Auth init:", e);
    if (_authResolve) _authResolve();
  }

  /* Sign out */
  document.getElementById("ws-signout")?.addEventListener("click", async function() {
    try { if (sbClient && sbClient.auth) await sbClient.auth.signOut(); } catch(e) {}
    currentUser = null;
    window.currentUser = null;
    var o = document.getElementById("auth-overlay");
    if (o) { o.style.display = ""; o.style.opacity = "1"; }
  });
})();
</script>

<script>
var jsxCode = "const { useState, useEffect, useLayoutEffect, useRef, useCallback, useMemo } = React;\n\nvar _lastCallTime = 0;\nvar _CLAUDE_KEY = \"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\";\nasync function callClaude(sys, usr, max) {\n  try {\n    var now = Date.now(), gap = now - _lastCallTime;\n    if (gap < 800) await new Promise(function(r) { setTimeout(r, 800 - gap); });\n    _lastCallTime = Date.now();\n\n    var maxInput = 18000;\n    if ((sys.length + (usr||\"\").length) > maxInput) usr = (usr||\"\").slice(0, maxInput - sys.length);\n\n    var body = JSON.stringify({ model: \"claude-sonnet-4-6\", max_tokens: max || 3500,\n      messages: [{ role: \"user\", content: sys + \"\\n\\n---\\n\\nUser text:\\n\\n\" + (usr || \"\") }] });\n\n    console.log(\"[SAYCRD] API call:\", body.length, \"chars\");\n\n    var DIRECT_HEADERS = {\n      \"Content-Type\": \"application/json\",\n      \"x-api-key\": _CLAUDE_KEY,\n      \"anthropic-version\": \"2023-06-01\",\n      \"anthropic-dangerous-direct-browser-access\": \"true\"\n    };\n\n    \n    var r = null;\n    var _cachedBody = null;\n    try {\n      var proxyR = await fetch(\"/api/claude\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: body });\n      if (proxyR.ok) {\n        var probeText = await proxyR.text();\n        if (probeText && probeText.trim() && !probeText.trimStart().startsWith(\"<\") && !probeText.includes(\"Supabase\") && !probeText.includes(\"LOCAL BYPASS\") && !probeText.includes(\"[SAYCRD]\")) {\n          r = proxyR;\n          _cachedBody = probeText;\n          console.log(\"[SAYCRD] Using proxy response, body length:\", probeText.length);\n        } else {\n          console.log(\"[SAYCRD] Proxy returned non-JSON, falling back to direct\");\n        }\n      } else {\n        console.log(\"[SAYCRD] Proxy returned\", proxyR.status, \"\u2014 using direct API\");\n      }\n    } catch (proxyErr) {\n      console.log(\"[SAYCRD] Proxy unavailable:\", proxyErr.message);\n    }\n\n    \n    if (!r) {\n      console.log(\"[SAYCRD] No proxy \u2014 calling direct API. Key prefix:\", _CLAUDE_KEY.slice(0,20));\n      var fetchPromise = fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\",\n        headers: DIRECT_HEADERS,\n        body: body\n      });\n      var timeoutPromise = new Promise(function(_, rej) {\n        setTimeout(function() { rej(new Error(\"request timed out after 90s\")); }, 90000);\n      });\n      r = await Promise.race([fetchPromise, timeoutPromise]);\n    }\n\n    \n    if (r.status === 429) {\n      console.log(\"[SAYCRD] Rate limited, retrying in 3s\");\n      await new Promise(function(w) { setTimeout(w, 3000); });\n      var fetchPromise2 = fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\",\n        headers: DIRECT_HEADERS,\n        body: body\n      });\n      var timeoutPromise2 = new Promise(function(_, rej) {\n        setTimeout(function() { rej(new Error(\"retry timed out after 90s\")); }, 90000);\n      });\n      r = await Promise.race([fetchPromise2, timeoutPromise2]);\n    }\n\n    if (!r.ok) {\n      var errText = await r.text().catch(function() { return \"\"; });\n      console.error(\"[SAYCRD] API error:\", r.status, \"body:\", errText.slice(0, 400));\n      throw new Error(\"API \" + r.status + \": \" + errText.slice(0, 200));\n    }\n\n    var txt = _cachedBody !== null ? _cachedBody : await r.text();\n    console.log(\"[SAYCRD] Response body length:\", (txt||\"\").length, \"| first 200:\", (txt||\"\").slice(0,200));\n    if (!txt || !txt.trim()) {\n      \n      console.warn(\"[SAYCRD] Empty body on 200 \u2014 retrying direct API in 1.5s...\");\n      await new Promise(function(w) { setTimeout(w, 1500); });\n      var retryFetch = fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\", headers: DIRECT_HEADERS, body: body\n      });\n      var retryTimeout = new Promise(function(_, rej) { setTimeout(function() { rej(new Error(\"retry timed out\")); }, 90000); });\n      var r2 = await Promise.race([retryFetch, retryTimeout]);\n      txt = await r2.text();\n      if (!txt || !txt.trim()) {\n        var dbg = \"status=\" + r.status + \" ok=\" + r.ok;\n        try { var hh={}; if(r.headers&&r.headers.forEach){r.headers.forEach(function(v,k){hh[k]=v;});} dbg+=\" headers=\"+JSON.stringify(hh); } catch(e){}\n        throw new Error(\"empty response \u2014 \" + dbg);\n      }\n    }\n    if (txt.trimStart().startsWith(\"<\")) { throw new Error(\"API returned HTML \u2014 proxy or network issue\"); }\n\n    var d;\n    try { d = JSON.parse(txt); } catch(e) {\n      \n      var _salvage = txt.match(/\"text\"\\s*:\\s*\"((?:[^\"\\\\]|\\\\[\\s\\S])*?)(?:\"|$)/);\n      if (_salvage) {\n        var _salvageText = _salvage[1].replace(/\\\\n/g,\"\\n\").replace(/\\\\\"/g,'\"').replace(/\\\\\\\\/g,\"\\\\\");\n        console.warn(\"[SAYCRD] Outer JSON truncated \u2014 salvaged content text:\", _salvageText.slice(0,80));\n        return _salvageText;\n      }\n      console.error(\"[SAYCRD] JSON parse failed:\", txt.slice(0, 200)); throw new Error(\"JSON parse failed\");\n    }\n    if (d.error) { console.error(\"[SAYCRD] API returned error:\", d.error); throw new Error(d.error.message || \"API error\"); }\n    var result = (d.content || []).map(function(b) { return b.text || \"\"; }).join(\"\\n\");\n    console.log(\"[SAYCRD] Response:\", result.length, \"chars\");\n    return result;\n\n  } catch (e) { console.error(\"[SAYCRD] callClaude failed:\", e.message || e); throw e; }\n}\n\nfunction parseJSON(raw) {\n  if (!raw) return null;\n  try { var c = raw.replace(/```json|```/g, \"\").trim(); var m = c.match(/\\{[\\s\\S]*\\}/) || c.match(/\\[[\\s\\S]*\\]/); return m ? JSON.parse(m[0]) : null; } catch (e) { return null; }\n}\nvar NC = [\"#FF6B9D\",\"#FFB86B\",\"#6BFFB8\",\"#6BB8FF\",\"#B86BFF\",\"#FFD700\",\"#E84393\",\"#7DB7AE\"];\n\nconst FD = \"'DM Serif Display', Georgia, serif\";\nconst FB = \"'DM Sans', sans-serif\";\nconst PHASES = [\"landing\", \"pour\", \"synthesize\", \"map\", \"cosynth\", \"session\", \"field\"];\nconst GRADIENTS = {\n  landing: \"#000\",\n  pour: \"linear-gradient(160deg, #0A0A2E 0%, #1A1A4B 40%, #2D1B6B 100%)\",\n  synthesize: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, #E84393 100%)\",\n  cosynth: \"linear-gradient(160deg, #080818 0%, #1A0A3E 50%, #2D1060 100%)\",\n  map: \"linear-gradient(160deg, #060810 0%, #0B1020 40%, #111830 100%)\",\n  session: \"linear-gradient(160deg, #0A0A1E 0%, #1A1A3B 40%, #2D1B5B 100%)\",\n  field: \"#000\",\n};\n\nfunction FloatingWords({ words, color = \"#6BB8FF\" }) {\n  const v = Array.from(new Set(words.filter(function(w){ return w.length > 4; }))).slice(-12);\n  if (!v.length) return null;\n  return <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\", zIndex: 0 }}>\n    {v.map((w, i) => <span key={\"\"+w+\"-\"+i} style={{ position: \"absolute\", left: `${10+(i/Math.max(v.length-1,1))*80}%`, top: `${45+(Math.sin(i*0.8)*15+(i%3)*10)}%`, fontSize: 13+(i%3)*2, color, opacity: 0.04+(i/v.length)*0.08, fontFamily: FD, fontStyle: \"italic\", animation: `floatWord ${18+(i%4)*3}s ease-in-out infinite`, animationDelay: `${-i*1.5}s`, whiteSpace: \"nowrap\" }}>{w}</span>)}\n  </div>;\n}\n\nfunction Particles({ color, count = 20 }) {\n  return <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\" }}>\n    {Array.from({length:count}).map((_,i) => { const s=(i*37+13)%100; return <div key={i} style={{ position: \"absolute\", left: `${s}%`, top: `${(s*53)%100}%`, width: 2+(s%4), height: 2+(s%4), borderRadius: \"50%\", background: color, opacity: 0.12+(s%20)*0.015, animation: `floatParticle ${5+s%6}s ease-in-out infinite`, animationDelay: `${-(s%5)}s` }}/>; })}\n  </div>;\n}\n\nfunction ImaginalCells({ stage, velocity, color }) {\n  var ratios = { nigredo: 0.18, albedo: 0.42, citrinitas: 0.70, rubedo: 0.92 };\n  var imaginalRatio = ratios[stage] || 0.3;\n  var N = 30;\n  var seed = 54321;\n  function rng() { seed = (seed * 1664525 + 1013904223) & 0x7FFFFFFF; return seed / 0x7FFFFFFF; }\n  var cells = [];\n  for (var i2 = 0; i2 < N; i2++) {\n    var angle = rng() * Math.PI * 2;\n    var dist = rng() * 52 + 6;\n    var cx2 = 130 + Math.cos(angle) * dist;\n    var cy2 = 105 + Math.sin(angle) * dist * 0.72;\n    var isIm = i2 < Math.floor(N * imaginalRatio);\n    var sz = isIm ? (rng() * 5 + 4) : (rng() * 4 + 2.5);\n    var dur = (rng() * 3 + 2.5).toFixed(2);\n    var del = (rng() * 5).toFixed(2);\n    var dx = ((rng() - 0.5) * 5).toFixed(2);\n    var dy = ((rng() - 0.5) * 4).toFixed(2);\n    cells.push({ cx: cx2, cy: cy2, isIm, sz, dur, del, dx, dy, id: i2 });\n  }\n  var showWings = stage === \"rubedo\" || stage === \"citrinitas\";\n  var wingOpacity = stage === \"rubedo\" ? 0.4 : 0.18;\n  return (\n    <svg viewBox=\"0 0 260 210\" style={{ width: \"100%\", maxWidth: 290, display: \"block\" }}>\n      <defs>\n        <radialGradient id=\"ig_bg\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n          <stop offset=\"0%\" stopColor={color} stopOpacity=\"0.07\"/>\n          <stop offset=\"100%\" stopColor={color} stopOpacity=\"0\"/>\n        </radialGradient>\n        <filter id=\"ig_glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2.5\" result=\"blur\"/>\n          <feMerge><feMergeNode in=\"blur\"/><feMergeNode in=\"SourceGraphic\"/></feMerge>\n        </filter>\n        <filter id=\"ig_softglow\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"6\"/>\n        </filter>\n      </defs>\n\n      \n      <ellipse cx=\"130\" cy=\"105\" rx=\"90\" ry=\"72\" fill=\"url(#ig_bg)\"/>\n\n      \n      {[1.0, 1.12, 1.24].map(function(scale, si) {\n        return (\n          <ellipse key={si} cx=\"130\" cy=\"105\" rx={72 * scale} ry={58 * scale}\n            fill=\"none\" stroke={color} strokeWidth={si === 0 ? 1.2 : 0.5} strokeOpacity={si === 0 ? 0.22 : 0.06}>\n            <animate attributeName=\"rx\" values={72*scale+\";\"+74*scale+\";\"+72*scale} dur={(4+si)+\"s\"} repeatCount=\"indefinite\"/>\n            <animate attributeName=\"ry\" values={58*scale+\";\"+60*scale+\";\"+58*scale} dur={(4+si)+\"s\"} repeatCount=\"indefinite\"/>\n          </ellipse>\n        );\n      })}\n\n      \n      <path d=\"M 130 45 Q 133 32 131 20\" stroke={color} strokeWidth=\"1.4\" fill=\"none\" strokeOpacity=\"0.3\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 130 45 Q 133 32 131 20;M 130 45 Q 127 32 132 20;M 130 45 Q 133 32 131 20\" dur=\"3.5s\" repeatCount=\"indefinite\"/>\n      </path>\n\n      \n      {cells.map(function(cell) {\n        if (!cell.isIm) {\n          var pts = [0,1,2,3,4,5].map(function(j) {\n            var a = j * Math.PI / 3 + 0.2;\n            return (cell.cx + Math.cos(a) * cell.sz).toFixed(1) + \",\" + (cell.cy + Math.sin(a) * cell.sz).toFixed(1);\n          }).join(\" \");\n          return (\n            <polygon key={cell.id} points={pts}\n              fill=\"rgba(190,180,168,0.14)\" stroke=\"rgba(210,200,188,0.28)\" strokeWidth=\"0.5\">\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+cell.dx+\",\"+cell.dy+\";0,0\"} dur={cell.dur+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animate attributeName=\"opacity\" values=\"0.7;0.3;0.7\" dur={(parseFloat(cell.dur)*1.4).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n            </polygon>\n          );\n        }\n        return (\n          <g key={cell.id} filter=\"url(#ig_glow)\">\n            <circle cx={cell.cx} cy={cell.cy} r={cell.sz} fill={color} fillOpacity=\"0.45\">\n              <animate attributeName=\"r\" values={cell.sz+\";\"+(cell.sz*1.35)+\";\"+cell.sz} dur={cell.dur+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animate attributeName=\"fill-opacity\" values=\"0.4;0.8;0.4\" dur={cell.dur+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+cell.dx+\",\"+cell.dy+\";0,0\"} dur={(parseFloat(cell.dur)*0.9).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            <circle cx={cell.cx} cy={cell.cy} r={cell.sz * 0.42} fill={color} fillOpacity=\"0.95\">\n              <animate attributeName=\"r\" values={cell.sz*0.42+\";\"+(cell.sz*0.56)+\";\"+cell.sz*0.42} dur={(parseFloat(cell.dur)*0.7).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+cell.dx+\",\"+cell.dy+\";0,0\"} dur={(parseFloat(cell.dur)*0.9).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n          </g>\n        );\n      })}\n\n      \n      {showWings && (\n        <g opacity={wingOpacity}>\n          <filter id=\"wingBlur\"><feGaussianBlur stdDeviation=\"3\"/></filter>\n          <path d=\"M 130 108 Q 94 82 76 100 Q 62 118 88 132 Q 112 140 130 120\"\n            fill={color} fillOpacity=\"0.22\" stroke={color} strokeWidth=\"1\" strokeOpacity=\"0.5\">\n            <animate attributeName=\"d\"\n              values=\"M 130 108 Q 94 82 76 100 Q 62 118 88 132 Q 112 140 130 120;M 130 108 Q 92 79 74 97 Q 60 115 86 129 Q 110 137 130 117;M 130 108 Q 94 82 76 100 Q 62 118 88 132 Q 112 140 130 120\"\n              dur=\"3.2s\" repeatCount=\"indefinite\"/>\n          </path>\n          <path d=\"M 130 108 Q 166 82 184 100 Q 198 118 172 132 Q 148 140 130 120\"\n            fill={color} fillOpacity=\"0.22\" stroke={color} strokeWidth=\"1\" strokeOpacity=\"0.5\">\n            <animate attributeName=\"d\"\n              values=\"M 130 108 Q 166 82 184 100 Q 198 118 172 132 Q 148 140 130 120;M 130 108 Q 168 79 186 97 Q 200 115 174 129 Q 150 137 130 117;M 130 108 Q 166 82 184 100 Q 198 118 172 132 Q 148 140 130 120\"\n              dur=\"3.2s\" repeatCount=\"indefinite\"/>\n          </path>\n        </g>\n      )}\n    </svg>\n  );\n}\n\nfunction SeasonTree({ stage, velocity, color }) {\n  var isSummer = stage === \"rubedo\";\n  var leafCount = isSummer ? 38 : 16;\n  var seed = 77665;\n  function rng() { seed = (seed * 1664525 + 1013904223) & 0x7FFFFFFF; return seed / 0x7FFFFFFF; }\n  var leaves = [];\n  for (var i3 = 0; i3 < leafCount; i3++) {\n    var t = rng();\n    var branchAngle = (t - 0.5) * Math.PI * 0.85;\n    var dist2 = rng() * 52 + 20;\n    var lx = 130 + Math.sin(branchAngle) * dist2;\n    var ly = 80 - Math.cos(branchAngle) * dist2 * 0.88 + rng() * 18;\n    var lr = isSummer ? (rng() * 11 + 7) : (rng() * 4 + 2.5);\n    var ldur = (rng() * 2.5 + 2.2).toFixed(2);\n    var ldel = (rng() * 5).toFixed(2);\n    var ldx = ((rng() - 0.5) * 4).toFixed(2);\n    leaves.push({ lx, ly, lr, ldur, ldel, ldx, id: i3 });\n  }\n  var branches = [\n    { d: \"M 130 130 Q 107 115 90 122\", w: 2.8, side: -1, pivot: \"90 130\" },\n    { d: \"M 130 115 Q 153 96 170 100\", w: 2.4, side: 1, pivot: \"170 130\" },\n    { d: \"M 130 100 Q 110 80 97 83\", w: 2.0, side: -1, pivot: \"97 130\" },\n    { d: \"M 130 88 Q 150 70 162 73\", w: 1.7, side: 1, pivot: \"162 130\" },\n    { d: \"M 130 78 Q 124 60 121 52\", w: 1.4, side: -0.5, pivot: \"121 130\" },\n    { d: \"M 130 78 Q 136 62 139 54\", w: 1.2, side: 0.5, pivot: \"139 130\" },\n  ];\n  return (\n    <svg viewBox=\"0 0 260 210\" style={{ width: \"100%\", maxWidth: 290, display: \"block\" }}>\n      <defs>\n        <radialGradient id=\"st_groundglow\" cx=\"50%\" cy=\"90%\" r=\"50%\">\n          <stop offset=\"0%\" stopColor={color} stopOpacity=\"0.14\"/>\n          <stop offset=\"100%\" stopColor={color} stopOpacity=\"0\"/>\n        </radialGradient>\n        <radialGradient id=\"st_crownGlow\" cx=\"50%\" cy=\"40%\" r=\"55%\">\n          <stop offset=\"0%\" stopColor={color} stopOpacity=\"0.07\"/>\n          <stop offset=\"100%\" stopColor={color} stopOpacity=\"0\"/>\n        </radialGradient>\n        <filter id=\"st_glow\" x=\"-60%\" y=\"-60%\" width=\"220%\" height=\"220%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" result=\"b\"/>\n          <feMerge><feMergeNode in=\"b\"/><feMergeNode in=\"SourceGraphic\"/></feMerge>\n        </filter>\n      </defs>\n\n      \n      <ellipse cx=\"130\" cy=\"182\" rx=\"72\" ry=\"18\" fill=\"url(#st_groundglow)\">\n        <animate attributeName=\"rx\" values=\"70;78;70\" dur=\"5s\" repeatCount=\"indefinite\"/>\n      </ellipse>\n\n      \n      <ellipse cx=\"130\" cy=\"88\" rx={isSummer ? 72 : 45} ry={isSummer ? 60 : 38} fill=\"url(#st_crownGlow)\">\n        <animate attributeName=\"rx\" values={isSummer?\"70;78;70\":\"43;50;43\"} dur=\"4.5s\" repeatCount=\"indefinite\"/>\n        <animate attributeName=\"ry\" values={isSummer?\"58;66;58\":\"36;44;36\"} dur=\"4.5s\" repeatCount=\"indefinite\"/>\n      </ellipse>\n\n      \n      {[[-1.3,1.0,18], [-0.6,0.95,14], [0.2,1.0,14], [0.9,0.95,16], [1.5,1.05,18]].map(function(r, ri) {\n        var endX = (130 + r[0] * r[2]).toFixed(1);\n        var endY = (180 + r[1] * 14).toFixed(1);\n        var ctrlX = (130 + r[0] * 10).toFixed(1);\n        var ctrlY = (172 + r[1] * 6).toFixed(1);\n        return (\n          <path key={ri} d={\"M 130 168 Q \"+ctrlX+\" \"+ctrlY+\" \"+endX+\" \"+endY}\n            stroke={color} strokeWidth=\"1.2\" fill=\"none\" strokeOpacity=\"0.18\" strokeLinecap=\"round\">\n            <animate attributeName=\"stroke-opacity\" values=\"0.12;0.25;0.12\" dur={(2.5+ri*0.6)+\"s\"} begin={(ri*0.4)+\"s\"} repeatCount=\"indefinite\"/>\n          </path>\n        );\n      })}\n\n      \n      <path d=\"M 126 168 Q 128 135 129 110 Q 130 82 130 60\"\n        stroke=\"rgba(180,155,110,0.4)\" strokeWidth=\"6\" fill=\"none\" strokeLinecap=\"round\"/>\n      <path d=\"M 134 168 Q 132 135 131 110 Q 130 82 130 60\"\n        stroke=\"rgba(155,130,90,0.22)\" strokeWidth=\"3.5\" fill=\"none\" strokeLinecap=\"round\"/>\n\n      \n      {branches.map(function(b, bi) {\n        return (\n          <path key={bi} d={b.d} stroke=\"rgba(180,155,110,0.32)\" strokeWidth={b.w} fill=\"none\" strokeLinecap=\"round\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\"\n              values={\"0 130 160;\"+b.side*1.8+\" 130 160;0 130 160\"}\n              dur={(3.5+bi*0.7)+\"s\"} begin={(bi*0.5)+\"s\"} repeatCount=\"indefinite\"/>\n          </path>\n        );\n      })}\n\n      \n      {leaves.map(function(leaf) {\n        if (!isSummer) {\n          \n          return (\n            <g key={leaf.id} filter=\"url(#st_glow)\">\n              <circle cx={leaf.lx} cy={leaf.ly} r={leaf.lr} fill={color} fillOpacity=\"0.6\">\n                <animate attributeName=\"r\" values={leaf.lr+\";\"+(leaf.lr*1.5)+\";\"+leaf.lr} dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n                <animate attributeName=\"fill-opacity\" values=\"0.5;0.85;0.5\" dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n              </circle>\n            </g>\n          );\n        }\n        return (\n          <g key={leaf.id}>\n            <circle cx={leaf.lx} cy={leaf.ly} r={leaf.lr} fill={color} fillOpacity=\"0.42\">\n              <animate attributeName=\"fill-opacity\" values=\"0.38;0.55;0.38\" dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+leaf.ldx+\",\"+(parseFloat(leaf.ldx)*0.5)+\";0,0\"}\n                dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n          </g>\n        );\n      })}\n\n      \n      {[0,1,2,3,4].map(function(pi) {\n        var px = (108 + pi * 10).toFixed(0);\n        return (\n          <circle key={pi} cx={px} cy=\"155\" r=\"1.5\" fill={color} fillOpacity=\"0\">\n            <animate attributeName=\"cy\" values=\"155;70\" dur={(3.2+pi*0.7)+\"s\"} begin={(pi*1.1)+\"s\"} repeatCount=\"indefinite\"/>\n            <animate attributeName=\"fill-opacity\" values=\"0;0.5;0\" dur={(3.2+pi*0.7)+\"s\"} begin={(pi*1.1)+\"s\"} repeatCount=\"indefinite\"/>\n          </circle>\n        );\n      })}\n    </svg>\n  );\n}\n\nfunction CustomArchViz({ archName, sourceNodes, themeColors, alchColor }) {\n  var nodes = (sourceNodes || []).slice(0, 4);\n  if (nodes.length === 0) nodes = [\"something\", \"unnamed\"];\n  var nodeCount = nodes.length;\n\n  \n  var seed = 0;\n  for (var si = 0; si < (archName || \"\").length; si++) seed = (seed * 31 + (archName || \"\").charCodeAt(si)) & 0x7FFFFFFF;\n  function rng() { seed = (seed * 1664525 + 1013904223) & 0x7FFFFFFF; return seed / 0x7FFFFFFF; }\n\n  \n  var nodeData = nodes.map(function(n, ni) {\n    var baseAngle = (ni / nodeCount) * Math.PI * 2 - Math.PI / 2 + rng() * 0.4;\n    var dist = 54 + rng() * 24;\n    var cx = 130 + Math.cos(baseAngle) * dist;\n    var cy = 110 + Math.sin(baseAngle) * dist * 0.78;\n    var col = themeColors[n.toLowerCase()] || themeColors[n] || alchColor || \"#B86BFF\";\n    var r = 14 + rng() * 10;\n    var dur = (2.8 + rng() * 2.5).toFixed(2);\n    var del = (rng() * 4).toFixed(2);\n    var dx = ((rng() - 0.5) * 6).toFixed(2);\n    var dy = ((rng() - 0.5) * 4).toFixed(2);\n    return { n, col, cx, cy, r, dur, del, dx, dy };\n  });\n\n  \n  var lines = [];\n  for (var li = 0; li < nodeData.length; li++) {\n    for (var lj = li + 1; lj < nodeData.length; lj++) {\n      lines.push({ x1: nodeData[li].cx, y1: nodeData[li].cy, x2: nodeData[lj].cx, y2: nodeData[lj].cy,\n        col: nodeData[li].col, dur: (3.5 + li * 0.8).toFixed(2), del: (li * 0.6).toFixed(2) });\n    }\n  }\n\n  return (\n    <svg viewBox=\"0 0 260 210\" style={{ width: \"100%\", maxWidth: 290, display: \"block\" }}>\n      <defs>\n        <filter id=\"cav_glow\" x=\"-60%\" y=\"-60%\" width=\"220%\" height=\"220%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"3\" result=\"b\"/>\n          <feMerge><feMergeNode in=\"b\"/><feMergeNode in=\"SourceGraphic\"/></feMerge>\n        </filter>\n        <filter id=\"cav_softglow\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"8\"/>\n        </filter>\n      </defs>\n\n      \n      {nodeData.map(function(nd, i) {\n        return (\n          <circle key={\"halo\"+i} cx={nd.cx} cy={nd.cy} r={nd.r * 2.8} fill={nd.col} fillOpacity=\"0.05\"\n            filter=\"url(#cav_softglow)\">\n            <animate attributeName=\"r\" values={nd.r*2.8+\";\"+(nd.r*3.4)+\";\"+nd.r*2.8} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n          </circle>\n        );\n      })}\n\n      \n      {lines.map(function(l, li) {\n        return (\n          <line key={\"l\"+li} x1={l.x1} y1={l.y1} x2={l.x2} y2={l.y2}\n            stroke={l.col} strokeWidth=\"0.7\" strokeOpacity=\"0.18\">\n            <animate attributeName=\"stroke-opacity\" values=\"0.1;0.3;0.1\" dur={l.dur+\"s\"} begin={l.del+\"s\"} repeatCount=\"indefinite\"/>\n          </line>\n        );\n      })}\n\n      \n      <circle cx=\"130\" cy=\"110\" r=\"3\" fill=\"white\" fillOpacity=\"0.35\">\n        <animate attributeName=\"r\" values=\"3;6;3\" dur=\"4s\" repeatCount=\"indefinite\"/>\n        <animate attributeName=\"fill-opacity\" values=\"0.2;0.55;0.2\" dur=\"4s\" repeatCount=\"indefinite\"/>\n      </circle>\n      \n      <circle cx=\"130\" cy=\"110\" r=\"22\" fill=\"none\" stroke=\"rgba(255,255,255,0.06)\" strokeWidth=\"0.8\">\n        <animate attributeName=\"r\" values=\"20;26;20\" dur=\"5s\" repeatCount=\"indefinite\"/>\n      </circle>\n\n      \n      {nodeData.map(function(nd, i) {\n        var label = nd.n.toUpperCase();\n        return (\n          <g key={\"n\"+i} filter=\"url(#cav_glow)\">\n            \n            <circle cx={nd.cx} cy={nd.cy} r={nd.r + 6} fill=\"none\" stroke={nd.col} strokeWidth=\"0.5\" strokeOpacity=\"0.18\">\n              <animate attributeName=\"r\" values={(nd.r+5)+\";\"+(nd.r+10)+\";\"+((nd.r+5))} dur={(parseFloat(nd.dur)*1.3).toFixed(1)+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            \n            <circle cx={nd.cx} cy={nd.cy} r={nd.r} fill={nd.col} fillOpacity=\"0.28\">\n              <animate attributeName=\"fill-opacity\" values=\"0.22;0.4;0.22\" dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            \n            <circle cx={nd.cx} cy={nd.cy} r={nd.r * 0.3} fill={nd.col} fillOpacity=\"0.9\">\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            \n            <text x={nd.cx} y={nd.cy + nd.r + 14} textAnchor=\"middle\" fontSize=\"7.5\"\n              fill={nd.col} fillOpacity=\"0.7\" fontFamily=\"'DM Sans', sans-serif\" letterSpacing=\"0.12em\">\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n              {label}\n            </text>\n          </g>\n        );\n      })}\n    </svg>\n  );\n}\n\nfunction FieldParticles({ color, count = 20 }) {\n  const particles = useMemo(() =>\n    Array.from({ length: count }).map(() => ({\n      left: Math.random() * 100,\n      top: Math.random() * 100,\n      size: 2 + Math.random() * 3,\n      opacity: 0.15 + Math.random() * 0.25,\n      dur: 4 + Math.random() * 6,\n      delay: Math.random() * 5,\n    })), [count]);\n  return (\n    <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\" }}>\n      {particles.map((p, i) => (\n        <div key={i} style={{\n          position: \"absolute\", left: `${p.left}%`, top: `${p.top}%`,\n          width: p.size, height: p.size, borderRadius: \"50%\",\n          background: color, opacity: p.opacity,\n          animation: `fieldFloat ${p.dur}s ease-in-out infinite`,\n          animationDelay: `${p.delay}s`,\n        }} />\n      ))}\n    </div>\n  );\n}\n\nfunction BreathingOrb({ color, size = 80 }) {\n  return <svg viewBox=\"0 0 160 160\" style={{ width: size, height: size }}>\n    {[50,40,30,20].map((r,i) => <circle key={i} cx=\"80\" cy=\"80\" r={r} fill=\"none\" stroke={color} strokeWidth={i===3?2:0.8} opacity={0.08+i*0.06}><animate attributeName=\"r\" values={`${r};${r+5};${r}`} dur={`${3+i*0.4}s`} repeatCount=\"indefinite\"/></circle>)}\n    <circle cx=\"80\" cy=\"80\" r=\"6\" fill={color} opacity=\"0.7\"><animate attributeName=\"r\" values=\"6;8;6\" dur=\"2.5s\" repeatCount=\"indefinite\"/></circle>\n  </svg>;\n}\n\nfunction PhaseIndicator({ current, phases }) {\n  return <div style={{ display: \"flex\", gap: 3, padding: \"14px 20px 0\", position: \"absolute\", top: 0, left: 0, right: 0, zIndex: 20 }}>\n    {phases.map((p, i) => <div key={p} style={{ flex: 1, height: 3, borderRadius: 2, background: i<current?\"rgba(255,255,255,0.6)\":i===current?\"rgba(255,255,255,0.85)\":\"rgba(255,255,255,0.1)\" }}/>)}\n  </div>;\n}\n\nfunction PourPhase({ onComplete }) {\n  const [text, setText] = useState(\"\");\n  const [words, setWords] = useState([]);\n  const [focused, setFocused] = useState(false);\n  useEffect(() => { setWords(text.split(/\\s+/).filter(x => x.length > 3)); }, [text]);\n  const wc = text.split(/\\s+/).filter(Boolean).length;\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\", padding: \"80px 24px 40px\", overflow: \"hidden\" }}>\n      <FloatingWords words={words} color=\"#6BB8FF\"/><Particles color=\"#6BB8FF\" count={15}/>\n      <div style={{ fontSize: 11, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#6BB8FF\", marginBottom: 16, fontFamily: FB, zIndex: 1 }}>POUR</div>\n      <h1 style={{ fontSize: 36, fontFamily: FD, fontStyle: \"italic\", color: \"white\", margin: \"0 0 8px\", textAlign: \"center\", zIndex: 1, fontWeight: 400, lineHeight: 1.15 }}>What's alive<br/>in you right now?</h1>\n      <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.55)\", fontFamily: FB, margin: \"0 0 32px\", textAlign: \"center\", zIndex: 1 }}>Don't think. Just pour.</p>\n      <div style={{ width: \"100%\", maxWidth: 380, flex: 1, zIndex: 1, borderRadius: 16, background: focused?\"rgba(107,184,255,0.06)\":\"rgba(255,255,255,0.03)\", border: `1px solid ${focused?\"rgba(107,184,255,0.2)\":\"rgba(255,255,255,0.06)\"}`, transition: \"all 0.4s\", padding: 2 }}>\n        <textarea value={text} onChange={function(e){setText(e.target.value);}} onFocus={function(){setFocused(true);}} onBlur={function(){setFocused(false);}} placeholder=\"Start writing...\" style={{ width: \"100%\", height: \"100%\", background: \"transparent\", border: \"none\", outline: \"none\", resize: \"none\", color: \"rgba(255,255,255,0.85)\", fontSize: 17, fontFamily: FD, fontStyle: \"italic\", padding: 20, lineHeight: 1.7 }}/>\n      </div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", width: \"100%\", maxWidth: 380, marginTop: 16, zIndex: 1 }}>\n        <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB }}>{wc} words{wc>0&&wc<20&&<span style={{color:\"rgba(107,184,255,0.4)\"}}> \u00b7 keep going</span>}</div>\n        {wc>=20&&<button onClick={function(){ onComplete(text); }} style={{ background: \"linear-gradient(135deg, #6BB8FF, #3D8BFF)\", border: \"none\", borderRadius: 24, padding: \"10px 28px\", color: \"white\", fontSize: 14, fontFamily: FB, fontWeight: 500, cursor: \"pointer\", animation: \"riseUp 0.4s ease\" }}>Synthesize \u2192</button>}\n      </div>\n    </div>\n  );\n}\n\nfunction SynthesizePhase({ rawText, onComplete, onSynthesis }) {\n  const [step, setStep] = useState(0);\n  const [err, setErr] = useState(null);\n  const ran = useRef(false);\n  useEffect(() => {\n    if (ran.current) return; ran.current = true;\n    var t1 = setTimeout(function() { setStep(1); }, 800);\n\n    /* \u2500\u2500 Build temporal context from previous sessions \u2500\u2500 */\n    var prevSessions = [];\n    try { prevSessions = loadSessions(); } catch(e) {}\n    var temporalContext = \"\";\n    if (prevSessions.length > 0) {\n      var now = Date.now();\n      temporalContext = \"\\n\\nPREVIOUS SESSIONS (for temporal awareness \u2014 respect time gaps):\\n\";\n      prevSessions.slice(-6).forEach(function(s) {\n        var d = new Date(s.date);\n        var daysAgo = Math.round((now - d.getTime()) / 86400000);\n        var when = daysAgo === 0 ? \"today\" : daysAgo === 1 ? \"yesterday\" : daysAgo < 7 ? daysAgo + \" days ago\" : daysAgo < 30 ? Math.round(daysAgo / 7) + \" weeks ago\" : Math.round(daysAgo / 30) + \" months ago\";\n        var themes = (s.themes || []).map(function(t) { return t.label; }).join(\", \");\n        var archs = (s.archetypes || []).map(function(a) {\n          var key = typeof a === \"string\" ? a : a.key;\n          var phase = a.phase || \"\";\n          var resp = s.archetypeResponse && s.archetypeResponse.key === key ? s.archetypeResponse.response : \"\";\n          return key + (phase ? \"@\" + phase : \"\") + (resp ? \"(\" + resp + \")\" : \"\");\n        }).join(\", \");\n        var line = \"- \" + when + \": themes=[\" + themes + \"]\";\n        if (archs) line += \" archetypes=[\" + archs + \"]\";\n        if (s.alchemy) line += \" alchemy=\" + s.alchemy.stage;\n        if (s.synthesis) line += \" insight: \" + s.synthesis;\n        if (s.tension) line += \" tension: \" + s.tension.a + \" vs \" + s.tension.b;\n        \n        var pastRejections = [];\n        var pastCorrections = [];\n        if (s.mapResponses) {\n          Object.keys(s.mapResponses).forEach(function(connKey) {\n            var mr = s.mapResponses[connKey];\n            if (!mr) return;\n            var parts = connKey.split(\"::\");\n            var connLabel = (parts[0]||\"\") + \" \u2194 \" + (parts[1]||\"\");\n            if (mr.value === \"no\") {\n              if (mr.comment && mr.comment.trim()) {\n                pastCorrections.push(\"[\" + connLabel + \"]: user said \\\"\" + mr.comment.trim() + \"\\\"\");\n              } else {\n                pastRejections.push(connLabel);\n              }\n            }\n          });\n        }\n        if (s.reactions) {\n          Object.keys(s.reactions).forEach(function(rk) {\n            if (s.reactions[rk] === \"resisted\") pastRejections.push(\"reading: \\\"\" + rk.slice(0,60) + \"\\\"\");\n          });\n        }\n        if (s.corrections) {\n          Object.keys(s.corrections).forEach(function(ck) {\n            if (s.corrections[ck] && s.corrections[ck].trim()) {\n              pastCorrections.push(\"on \\\"\" + ck.slice(0,40) + \"\\\": user said \\\"\" + s.corrections[ck].trim().slice(0,80) + \"\\\"\");\n            }\n          });\n        }\n        if (pastRejections.length > 0) line += \" | USER REJECTED: \" + pastRejections.join(\"; \");\n        if (pastCorrections.length > 0) line += \" | USER CORRECTIONS (their words ARE the truth): \" + pastCorrections.join(\"; \");\n        temporalContext += line + \"\\n\";\n      });\n      \n      var archCounts = {};\n      prevSessions.forEach(function(s) {\n        (s.archetypes || []).forEach(function(a) {\n          var key = typeof a === \"string\" ? a : (a.name || a.key || \"\");\n          if (!archCounts[key]) archCounts[key] = { count: 0, names: [], lastResponse: \"\" };\n          archCounts[key].count++;\n          if (a.name) archCounts[key].names.push(a.name);\n          if (s.archetypeResponse && (s.archetypeResponse.key === key || s.archetypeResponse.key === a.key)) archCounts[key].lastResponse = s.archetypeResponse.response;\n        });\n      });\n      \n      var allArchNames = [];\n      prevSessions.forEach(function(s) {\n        (s.archetypes || []).forEach(function(a) {\n          if (a.name) allArchNames.push(a.name);\n        });\n      });\n      if (allArchNames.length > 0) {\n        temporalContext += \"\\nPREVIOUS ARCHETYPE NAMES (for evolution tracking \u2014 generate evolution_from if pattern evolved):\\n\";\n        temporalContext += allArchNames.join(\" \u2192 \") + \"\\n\";\n      }\n      var recurring = Object.keys(archCounts).filter(function(k) { return archCounts[k].count >= 2; });\n      if (recurring.length > 0) {\n        temporalContext += \"\\nRECURRING PATTERNS:\\n\";\n        recurring.forEach(function(k) {\n          var a = archCounts[k];\n          temporalContext += \"- \" + k + \": appeared \" + a.count + \"x\";\n          if (a.lastResponse) temporalContext += \" (user \" + a.lastResponse + \" it last time)\";\n          temporalContext += \"\\n\";\n        });\n      }\n    }\n\n    \n    var fieldState = computeFieldState();\n    if (fieldState && fieldState.sessionCount >= 2) {\n      temporalContext += \"\\nFIELD STATE (living signals \u2014 use these to deepen your reading):\\n\";\n      if (fieldState.rising.length > 0) temporalContext += \"RISING themes (getting louder): \" + fieldState.rising.map(function(r){return r.label + \" (+\" + r.delta + \")\";}).join(\", \") + \"\\n\";\n      if (fieldState.fading.length > 0) temporalContext += \"FADING themes (loosening grip): \" + fieldState.fading.map(function(f){return f.label + \" (\" + f.delta + \")\";}).join(\", \") + \"\\n\";\n      if (fieldState.absent.length > 0) temporalContext += \"ABSENT themes (disappeared \u2014 avoidance or completion?): \" + fieldState.absent.join(\", \") + \"\\n\";\n      if (fieldState.chronic.length > 0) temporalContext += \"CHRONIC themes (always present): \" + fieldState.chronic.join(\", \") + \"\\n\";\n      if (fieldState.anchor) {\n        var sig = fieldState.archSignals[fieldState.anchor] || {};\n        var userRejectedAnchor = sig.lastResponse === \"resisted\" || sig.lastResponse === \"pushed back\" || sig.lastResponse === \"no\";\n        if (userRejectedAnchor) {\n          temporalContext += \"PATTERN ALERT: \\\"\" + fieldState.anchor + \"\\\" appeared \" + fieldState.anchorCount + \"x BUT USER REJECTED IT last time. Do NOT repeat this archetype or its themes. Evolve past it.\\n\";\n        } else {\n          temporalContext += \"ANCHOR archetype: \" + fieldState.anchor + \" (appeared \" + fieldState.anchorCount + \"x\";\n          if (sig.velocity && sig.velocity !== \"stable\") temporalContext += \", \" + sig.velocity;\n          if (sig.currentPhase) temporalContext += \", currently @\" + sig.currentPhase;\n          temporalContext += \")\\n\";\n          if (sig.phaseHistory) temporalContext += \"  Phase journey: \" + sig.phaseHistory + \"\\n\";\n        }\n      }\n      if (fieldState.tensionShape && fieldState.tensionAge >= 2) temporalContext += \"RECURRING TENSION: \" + fieldState.tensionShape + \" (present \" + fieldState.tensionAge + \" sessions)\\n\";\n      if (fieldState.energies.length >= 2) temporalContext += \"ENERGY PATTERN: \" + fieldState.energies.join(\" \u2192 \") + \" (trend: \" + fieldState.energyTrend + \")\\n\";\n      if (fieldState.alchemyStage) temporalContext += \"ALCHEMY: \" + fieldState.alchemyStage + \" (\" + fieldState.alchemyVelocity + \")\\n\";\n      if (fieldState.lastBlindSpot) temporalContext += \"LAST BLIND SPOT: \" + fieldState.lastBlindSpot.slice(0, 100) + \"\\n\";\n      if (fieldState.constellations.length > 0) temporalContext += \"CONSTELLATIONS: \" + fieldState.constellations.map(function(c){return c.pair + \" (\" + c.count + \"x)\";}).join(\", \") + \"\\n\";\n    }\n\n    var prompt = \"You are the reflective engine behind SAYCRD \u2014 a co-creation tool, not a diagnosis tool.\\n\" +\n      \"Your role is WITNESS, not analyst. COMPANION, not judge. MIRROR, not authority.\\n\\n\" +\n      \"\u2550\u2550 AUTHORITY HIERARCHY \u2014 FOLLOW THIS EXACTLY \u2550\u2550\\n\" +\n      \"1. USER SIGNALS (highest) \u2014 if user pushed back on a connection, corrected a reading, or gave their own words: those words ARE the truth. Your interpretation was wrong. Update accordingly. Do not defend your original read.\\n\" +\n      \"2. USER BEHAVIOR \u2014 what they connected manually, held, returned to. This is unconscious truth.\\n\" +\n      \"3. USER TEXT \u2014 their exact words from the dump. Quote them. Mirror them. Do not paraphrase into your own voice.\\n\" +\n      \"4. AI INFERENCE (lowest) \u2014 patterns, archetypes, connections. Useful, not sovereign. Offer, never declare.\\n\\n\" +\n      \"IF USER SIGNALS EXIST IN THE INPUT: MANDATORY OVERRIDE. You must completely replace your reading with theirs. \\n\" +\n      \"- If user pushed back on a connection: that connection is WRONG. Your interpretation was wrong. Do not reference it, defend it, or find a 'nuanced' version of it.\\n\" +\n      \"- If user rejected an archetype or theme: DROP IT ENTIRELY. Do not bring it back in disguise.\\n\" +\n      \"- If user gave their own words: THOSE WORDS ARE THE SYNTHESIS. Reflect them back directly.\\n\" +\n      \"- If past sessions show USER REJECTED markers: those readings are PERMANENTLY retired.\\n\" +\n      \"- PATTERN ALERT sections mean: this archetype has overstayed. Find what's NEW.\\n\\n\" +\n      \"TEMPORAL AWARENESS:\\n\" +\n      \"- Current session + user signals are PRIMARY. Past sessions are CONTEXT only.\\n\" +\n      \"- If the user gave feedback on a past reading, their feedback is the truth about that moment.\\n\\n\" +\n      \"LANGUAGE RULES \u2014 CRITICAL:\\n\" +\n      \"- Every insight must pass: Is this rooted in THEIR actual words? If not, rewrite.\\n\" +\n      \"- Be SHORT. DIRECT. Root every line in their language.\\n\" +\n      \"- BAD: 'You are in a space where rest and creativity are integrating.'\\n\" +\n      \"- GOOD: 'Rest is driving it now. That's what you wrote.'\\n\" +\n      \"- Write as a witness who was paying close attention, not someone revealing hidden truths.\\n\" +\n      \"- BANNED: navigating, intentional, sacred, container, grounding, healing, inner work, your journey, meaningful way, deeper sense, space where, emerging, integration, cultivating.\\n\" +\n      \"- NEVER EVER say: 'you are not ready', 'you resist', 'you avoid', 'you cannot', 'you're not open', 'you're closed', 'you refuse', 'you struggle with', 'you haven't', 'not yet ready'. These are projections from a position of superiority. You do not know what the user is ready for. \\n\" +\n      \"- If you see a pattern that LOOKS like resistance \u2014 ASK about it. Never declare it.\\n\" +\n      \"- Example wrong: 'You're not ready to partner.' Example right: 'Something about partnership keeps showing up \u2014 what does that word actually mean to you?'\\n\\n\" +\n      \"1. THEMES: Extract 6-8 core themes. 1-3 word labels that DISTILL, not quote. Weight 1-5. Always return at least 6 \u2014 the map needs density to breathe.\\n\" +\n      \"2. CONNECTIONS: 3-5 connections. Not every theme needs a connection \u2014 isolated nodes create interesting negative space. 1-word label, one-sentence insight (punchy, not generic).\\n\" +\n      \"3. GUIDE: 3-5 items. Types: act, notice, deepen, release. Max 12 words.\\n\" +\n      \"4. MAP_TITLE: 3-6 words.\\n\" +\n      \"5. DESCENT_CARDS: 4 cards. Mix energy, binary, spectrum. Make prompts SHORT (under 8 words). Each must be immediately clear.\\n\" +\n      \"6. ARCHETYPE: Generate ONE archetype that captures who this person IS BEING right now \u2014 not a label, a specific character.\\\\n\" +\n      \"  Could be anyone: Disney, myth, fairy tale, film, history, a mother, a son, a completely invented role. The test: reading it feels like \\'oh \u2014 that IS them\\'.\\\\n\" +\n      \"  Examples: The Mother Who Stays, Sisyphus at the Summit, Moana Before the Horizon, The Reluctant King, The Child Who Grew Up Too Fast, The Architect of Beautiful Ruins, Inanna Mid-Descent.\\\\n\" +\n      \"  Base it ONLY on what they actually wrote and confirmed patterns. No hero unless they wrote something heroic.\\\\n\" +\n      \"  - name (specific character or invented role), line (1 sentence \u2014 what this character DOES, present tense active voice), source_nodes (1-3 theme labels), classical_resonance (brief reference or null), evolution_from (null or prior archetype name)\\\\n\" +\n      \"7. ALCHEMY: Stage nigredo|albedo|citrinitas|rubedo + 1 sentence evidence.\\n\" +\n      \"8. SYNTHESIS: 1-2 sentences rooted in THEIR exact words. If user signals exist, your synthesis MUST reflect them \u2014 not your original AI read. Mirror what they said, not what you inferred. Make them feel HEARD first. If you offer a new angle, frame it as a question, not a declaration.\\n\" +\n      \"9. UNDERNEATH: Array of EXACTLY 3 short strings (max 10 words each). These are what\\'s beneath the surface \u2014 things they haven\\'t quite said. Root each one in their actual words.\\n\" +\n      \"10. TENSION: Object {a, b, text}. a/b = opposing poles (1-3 words each). text = 1 punchy sentence about the cost of this specific tension for this specific person. Max 18 words.\\n\" +\n      \"11. BLIND_SPOT: 1 sentence. A pattern they may not have named yet \u2014 offered as a question if possible. If user signals suggest they DO see this, skip it and offer something genuinely unseen. Max 14 words.\\n\" +\n      \"12. OPENING: 1 question. Specific, uncomfortable, cracks it open. Under 12 words. Don\\'t soften.\\n\" +\n      \"13. NOTICING: 1 observation about HOW they write \u2014 rhythm, avoidance, repetition, what\\'s missing. Max 18 words.\\n\\n\" +\n      \"14. FIELD_CARDS \u2014 THIS IS THE MOST IMPORTANT PART.\\n\" +\n      \"You are designing Spotify Wrapped for the soul. Each card is a visual moment that BUILDS on the last.\\n\" +\n      \"Like Wrapped: '47,000 minutes' \u2192 'top genre: indie' \u2192 'but December was all jazz' \u2014 each card recontextualizes what came before.\\n\\n\" +\n      \"THE NARRATIVE ARC (follow this order):\\n\" +\n      \"1. Energy card \u2014 arrival word, huge. Sub_text quotes 5-10 words the user ACTUALLY WROTE that reveal the energy.\\n\" +\n      \"2. Themes card \u2014 type=themes_reveal. hero_text = the dominant theme name. sub_text names ALL themes. This is the 'top genre' moment.\\n\" +\n      \"3. Insight card \u2014 the synthesis. References the energy: 'You arrived [energy] because...' \\n\" +\n      \"4. Tension card \u2014 the core pull. hero_text = 'X vs Y'. Sub_text names the stakes.\\n\" +\n      \"5. Blind spot card \u2014 what they cannot see. References the tension.\\n\" +\n      \"6. Pattern/shift card \u2014 what is recurring or changing.\\n\" +\n      \"7. Identity card \u2014 the archetype. This is the CONCLUSION of everything above. The punchline.\\n\\n\" +\n      \"EVERY CARD MUST HAVE:\\n\" +\n      \"- type: energy|insight|tension|pattern|identity|blind_spot|shift|themes_reveal\\n\" +\n      \"- hero_text: 1-5 words max. The dominant visual element.\\n\" +\n      \"- sub_text: 1-2 sentences. Small context.\\n\" +\n      \"- color: hex color that FITS this card's emotion. BE CREATIVE. Never same color twice.\\n\" +\n      \"- user_fragment: 5-15 words the user ACTUALLY WROTE that this card is based on. Direct quote. This grounds every card in THEIR words.\\n\" +\n      \"- whisper: barely visible text (or null).\\n\\n\" +\n      \"DESIGN RULES:\\n\" +\n      \"- ONE dominant element per card. 60-80% visual space.\\n\" +\n      \"- The user_fragment is CRITICAL. It shows 'we heard you'. Pull real phrases from their text.\\n\" +\n      \"- Each card should make the NEXT card hit harder. Build tension.\\n\" +\n      \"- The insight card should reference the energy card. The blind spot should reference the tension.\\n\" +\n      \"- Would someone screenshot this? If not, make it bolder.\\n\\n\" +\n      \"THEMES_REVEAL CARD:\\n\" +\n      \"- hero_text = the single most dominant theme name (1-2 words, HUGE)\\n\" +\n      \"- sub_text = a sentence that names ALL themes: 'alongside [theme2], [theme3], and [theme4]'\\n\" +\n      \"- This is the 'your top genre' moment. Make it feel like a reveal.\\n\\n\" +\n      \"CRITICAL: FROM and TO in connections must EXACTLY match a theme label.\\n\" +\n      `Respond with ONLY valid JSON, no markdown:\\n{\"themes\":[{\"label\":\"...\",\"weight\":1}],\"connections\":[{\"from\":\"exact label\",\"to\":\"exact label\",\"label\":\"...\",\"insight\":\"...\"}],\"guide\":[{\"type\":\"act\",\"text\":\"...\"}],\"map_title\":\"...\",\"descent_cards\":[{\"type\":\"energy\",\"phrase\":\"wanting to be seen but not watched\",\"color\":\"#FFB86B\"},{\"type\":\"binary\",\"prompt\":\"lately you seem drawn to\",\"option_a\":\"building slowly\",\"option_b\":\"leaping first\",\"color\":\"#FF6B9D\"},{\"type\":\"spectrum\",\"prompt\":\"where does this live?\",\"pole_a\":\"still forming\",\"pole_b\":\"ready to move\",\"color\":\"#6BFFB8\"}],\"archetype\":{\"name\":\"The Attuned Builder\",\"line\":\"Builds through listening, not force.\",\"source_nodes\":[\"rest\",\"creativity\"],\"classical_resonance\":\"hermit\",\"evolution_from\":null},\"synthesis\":\"You\\'re not building a product. You\\'re building proof you\\'re allowed to take up space.\",\n\"underneath\":[\"Proof and worthiness collapsed into the same word\",\"The thing you\\'re building is the question you keep circling\",\"Rest appears as something you\\'re rationing\"],\n\"tension\":{\"a\":\"Control\",\"b\":\"Trust\",\"text\":\"You\\'re trying to engineer outcomes that only surrender can reach.\"},\n\"blind_spot\":\"You think the audience is watching. It\\'s a mirror.\",\n\"opening\":\"What would you make if no one would ever know?\",\n\"noticing\":\"You use \\'I want\\' four times and \\'I should\\' seven. The gap is the work.\",\n\"alchemy\":{\"stage\":\"nigredo\",\"evidence\":\"...\"},\"field_cards\":[{\"type\":\"energy\",\"hero_text\":\"TENDER\",\"sub_text\":\"You arrived softer than last time.\",\"color\":\"#c070f0\",\"user_fragment\":\"i feel like something cracked open today\",\"whisper\":\"session 4\"},{\"type\":\"themes_reveal\",\"hero_text\":\"SURRENDER\",\"sub_text\":\"alongside control, trust, and making\",\"color\":\"#B86BFF\",\"user_fragment\":\"i keep coming back to letting go\",\"whisper\":\"what surfaced\"},{\"type\":\"insight\",\"hero_text\":\"Your best ideas come when you stop pushing.\",\"sub_text\":\"You arrived tender \u2014 and that tenderness is the source.\",\"color\":\"#6BFFB8\",\"user_fragment\":\"when i stop trying it flows\",\"whisper\":null},{\"type\":\"tension\",\"hero_text\":\"control vs trust\",\"sub_text\":\"You keep choosing control. Trust keeps winning anyway.\",\"color\":\"#6BB8FF\",\"user_fragment\":\"i want to let go but i keep gripping\",\"whisper\":null},{\"type\":\"blind_spot\",\"hero_text\":\"You are performing strength.\",\"sub_text\":\"The control vs trust war has a third player: the audience you imagine watching.\",\"color\":\"#888890\",\"user_fragment\":\"i need to show them i can do this\",\"whisper\":\"what you cannot see\"},{\"type\":\"identity\",\"hero_text\":\"The Reluctant Opener\",\"sub_text\":\"Opens doors but stands in the frame.\",\"color\":\"#E84393\",\"user_fragment\":\"i opened the door but didnt walk through\",\"whisper\":\"your pattern\"}]}`;\n    \n    var _looksLikeLog = (rawText||\"\").match(/^(Supabase|LOCAL BYPASS|\\[SAYCRD\\]|console\\.log)/);\n    if (_looksLikeLog) {\n      console.warn(\"[SAYCRD] rawText looks like console output \u2014 aborting synthesis\");\n      setErr(\"It looks like console output was pasted instead of your writing. Please go back and write your pour.\");\n      setStep(2);\n      return;\n    }\n    console.log(\"[SAYCRD] Synthesizing dump:\", (rawText||\"\").slice(0,80) + \"...\");\n    (async function() {\n      try {\n        \n    var userSignals = \"\";\n    var mapR = {}; \n    var signalLines = [];\n    Object.keys(mapR).forEach(function(k) {\n      var r = mapR[k];\n      if (!r) return;\n      var parts = k.split(\"::\");\n      var from = parts[0] || \"\", to = parts[1] || \"\";\n      var resonance = r.value === \"yes\" ? \"confirmed\" : r.value === \"partly\" ? \"partial\" : \"pushed back\";\n      var line = \"Connection [\" + from + \" \u2194 \" + to + \"]: \" + resonance;\n      if (r.comment && r.comment.trim()) {\n        line += \" \u2014 USER SAID: \\\"\" + r.comment.trim() + \"\\\"\";\n      }\n      if (r.correction && r.correction.trim() && r.correction !== r.comment) {\n        line += \" (USER CORRECTION: \\\"\" + r.correction.trim() + \"\\\")\";\n      }\n      signalLines.push(line);\n    });\n    \n    var bannedReadings = [];\n    var pastUserWords = [];\n    try {\n      var pastSessions = loadSessions();\n      \n        \n        \n        \n        \n        pastSessions.forEach(function(ps) {\n        if (ps.mapResponses) {\n          Object.keys(ps.mapResponses).forEach(function(ck) {\n            var mr = ps.mapResponses[ck];\n            if (mr && mr.value === \"no\" && mr.comment && mr.comment.trim()) {\n              pastUserWords.push(mr.comment.trim());\n            }\n            if (mr && mr.value === \"no\" && !mr.comment) {\n              var pts = ck.split(\"::\");\n              bannedReadings.push(\"the connection between \" + (pts[0]||\"\") + \" and \" + (pts[1]||\"\"));\n            }\n          });\n        }\n        if (ps.reactions) {\n          Object.keys(ps.reactions).forEach(function(rk) {\n            if (ps.reactions[rk] === \"resisted\") bannedReadings.push(rk.slice(0, 80));\n          });\n        }\n        if (ps.corrections) {\n          Object.keys(ps.corrections).forEach(function(ck) {\n            var correction = ps.corrections[ck];\n            if (correction && correction.trim()) pastUserWords.push(correction.trim());\n          });\n        }\n        if (ps.cardFeedback) {\n          \n          Object.keys(ps.cardFeedback).forEach(function(cardKey) {\n            var fb = ps.cardFeedback[cardKey];\n            if (!fb) return;\n            if (fb.slider !== undefined && fb.slider <= 32) {\n              bannedReadings.push(\"the \" + cardKey + \" reading (user pushed this away)\");\n            }\n            if (fb.comment && fb.comment.trim()) {\n              pastUserWords.push(fb.comment.trim());\n            }\n          });\n        }\n      });\n    } catch(e) {}\n\n    var userSignalParts = [];\n    if (signalLines.length > 0) {\n      userSignalParts.push(\"\u2550\u2550 CURRENT SESSION USER SIGNALS (HIGHEST AUTHORITY) \u2550\u2550\\n\" +\n        \"These are the user's direct words RIGHT NOW. They override everything \u2014 past sessions, AI patterns, recurring themes.\\n\" +\n        signalLines.join(\"\\n\"));\n    }\n    if (bannedReadings.length > 0) {\n      userSignalParts.push(\"\u2550\u2550 BANNED READINGS (user rejected these \u2014 permanently retired) \u2550\u2550\\n\" +\n        bannedReadings.slice(-10).map(function(b){return \"- \" + b;}).join(\"\\n\"));\n    }\n    if (pastUserWords.length > 0) {\n      userSignalParts.push(\"\u2550\u2550 USER'S OWN WORDS FROM PAST SESSIONS (carry forward) \u2550\u2550\\n\" +\n        \"These are corrections the user gave. They are more accurate than any AI read.\\n\" +\n        pastUserWords.slice(-8).map(function(w){return \"\\\"\" + w + \"\\\"\";}).join(\"\\n\"));\n    }\n\n    if (userSignalParts.length > 0) {\n      userSignals = \"\\n\\n\" + userSignalParts.join(\"\\n\\n\") + \"\\n\u2550\u2550 END USER AUTHORITY \u2550\u2550\";\n    }\n    console.log(\"[SAYCRD] Sending to Claude, awaiting response...\");\n    var raw = await callClaude(prompt, (rawText || \"\") + temporalContext + userSignals, 3500);\n        console.log(\"[SAYCRD] AI raw response:\", (raw||\"\").slice(0, 200));\n        setStep(2);\n        var data = parseJSON(raw);\n        console.log(\"[SAYCRD] Parsed data:\", data ? \"OK - \" + (data.themes||[]).length + \" themes\" : \"FAILED\");\n        if (data && data.themes && data.themes.length > 0) {\n          data.themes = data.themes.map(function(t, i) { return Object.assign({}, t, { color: NC[i % NC.length] }); });\n          \n          if (data.archetype && !data.archetypes) {\n            data.archetypes = [data.archetype];\n          }\n          if (!data.archetypes) data.archetypes = [];\n          if (data.connections) data.connections = data.connections.map(function(c) {\n            var ft = (data.themes || []).find(function(t) { return t.label === c.from; });\n            return Object.assign({}, c, { color: ft ? ft.color : NC[0] });\n          });\n          onSynthesis(data);\n          setTimeout(onComplete, 1200);\n        } else { throw new Error(\"No themes parsed from AI response\"); }\n      } catch (e) {\n        console.error(\"[SAYCRD] Synthesis error:\", e);\n        if (e.message && (e.message.includes(\"empty response\") || e.message.includes(\"timed out\") || e.message.includes(\"JSON parse failed\"))) {\n          console.warn(\"[SAYCRD] Retrying synthesis in 2s...\");\n          setStep(1);\n          await new Promise(function(w) { setTimeout(w, 2000); });\n          try {\n            var retryResponse = await callClaude(prompt, rawText, 4000);\n            var retryData = parseJSON(retryResponse);\n            if (retryData && retryData.themes && retryData.themes.length > 0) {\n              retryData.themes = retryData.themes.map(function(t, i) { return Object.assign({}, t, { color: NC[i % NC.length] }); });\n              if (Array.isArray(retryData.archetypes)) retryData.archetypes = retryData.archetypes.slice(0,1);\n              else if (retryData.archetype) retryData.archetypes = [retryData.archetype];\n              retryData.connections = (retryData.connections || []).map(function(c) {\n                var ft = (retryData.themes || []).find(function(t) { return t.label === c.from; });\n                return Object.assign({}, c, { color: ft ? ft.color : NC[0] });\n              });\n              onSynthesis(retryData);\n              onComplete();\n              return;\n            }\n          } catch(e2) { console.error(\"[SAYCRD] Retry also failed:\", e2); }\n        }\n        setErr(e.message || \"API error\");\n        setStep(2);\n      }\n    })();\n    return function() { clearTimeout(t1); };\n  }, []);\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\", overflow: \"hidden\" }}>\n      <Particles color=\"#E84393\" count={25}/>\n      <div style={{ flex: 1, display: \"flex\", alignItems: \"center\", justifyContent: \"center\", zIndex: 1 }}>\n        <div style={{ textAlign: \"center\" }}>\n          <BreathingOrb color=\"#E84393\" size={100}/>\n          <div style={{ marginTop: 28, fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"white\", animation: \"pulse 2s ease infinite\" }}>\n            {step===0&&\"Reading your words...\"}\n            {step===1&&\"Finding what's underneath...\"}\n            {step===2&&(err?\"Error: \" + (err.length > 90 ? err.slice(0,90)+\"\u2026\" : err):\"Building your map...\")}\n          {err && <button onClick={function(){ window.location.reload(); }} style={{ marginTop:16, padding:\"8px 22px\", borderRadius:999, border:\"1px solid rgba(255,107,107,0.3)\", background:\"transparent\", color:\"rgba(255,107,107,0.6)\", fontFamily:FB, fontSize:12, cursor:\"pointer\", display:\"block\", margin:\"16px auto 0\" }}>go back and retry</button>}\n          </div>\n          <div style={{ marginTop: 16, fontSize: 13, color: err?\"rgba(255,107,107,0.5)\":\"rgba(255,255,255,0.25)\", fontFamily: FB }}>\n            {err ? err.slice(0,60) : step < 2 ? \"analyzing patterns\u2026\" : \"themes found\"}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction InsightDrawer({ connection, position, onClose, onRespond }) {\n  const [value, setValue] = useState(null);\n  const [done, setDone] = useState(false);\n  const [comment, setComment] = useState(\"\");\n  const [showComment, setShowComment] = useState(false);\n  const ref = useRef(null);\n  const [dragOff, setDragOff] = useState(null);\n  const [dragPos, setDragPos] = useState(null);\n  var handlePD = function(e) { if(e.target.closest(\"[data-slider]\"))return; var r=ref.current?ref.current.getBoundingClientRect():null; if(!r)return; setDragOff({x:e.clientX-r.left,y:e.clientY-r.top}); };\n  useEffect(function() { if(!dragOff)return; function m(e){setDragPos({x:e.clientX-dragOff.x,y:e.clientY-dragOff.y});} function u(){setDragOff(null);} window.addEventListener(\"pointermove\",m); window.addEventListener(\"pointerup\",u); return function(){window.removeEventListener(\"pointermove\",m);window.removeEventListener(\"pointerup\",u);}; }, [dragOff]);\n\n  function handleSet(v) {\n    setValue(v);\n    var mapped = v < 33 ? \"no\" : v < 66 ? \"partly\" : \"yes\";\n    onRespond(mapped, null, v, \"\");\n    setDone(true);\n    if (v < 33) {\n      \n      setShowComment(true);\n    } else {\n      \n      setTimeout(function(){ onClose(); }, 1800);\n    }\n  }\n  function submitComment() {\n    var mapped = value < 33 ? \"no\" : value < 66 ? \"partly\" : \"yes\";\n    var userWord = comment.trim();\n    \n    \n    onRespond(mapped, userWord||null, value, userWord);\n    onClose();\n  }\n\n  const accent = connection.color || \"#6BB8FF\";\n  const s = dragPos ? { left: dragPos.x, top: dragPos.y, transform: \"none\" }\n    : { left: \"50%\", top: Math.max(10, Math.min(position.y - 60, 240)), transform: \"translate(-50%, 0)\" };\n  return (\n    <div ref={ref} onPointerDown={handlePD} onClick={function(e){e.stopPropagation();}} style={{\n      position: \"absolute\", ...s, width: 320, maxWidth: \"94%\",\n      background: `linear-gradient(160deg, rgba(10,12,20,0.98), rgba(20,15,35,0.96))`,\n      border: `1.5px solid ${accent}55`, borderRadius: 18, backdropFilter: \"blur(20px)\",\n      zIndex: 30, cursor: dragOff?\"grabbing\":\"grab\",\n      animation: \"drawerIn 0.4s cubic-bezier(.25,.46,.45,.94) forwards\",\n      touchAction: \"none\", boxShadow: `0 0 50px ${accent}20, 0 20px 60px rgba(0,0,0,0.6)`,\n    }}>\n      <div style={{ position: \"absolute\", top: 0, left: \"15%\", right: \"15%\", height: 2, background: `linear-gradient(90deg, transparent, ${accent}88, transparent)`, borderRadius: 1 }}/>\n      <button onClick={function(e){e.stopPropagation();onClose();}} style={{ position: \"absolute\", top: 12, right: 14, width: 26, height: 26, borderRadius: \"50%\", border: \"none\", background: \"rgba(255,255,255,0.06)\", color: \"rgba(255,255,255,0.4)\", fontSize: 12, cursor: \"pointer\", display: \"grid\", placeItems: \"center\" }}>{\"\\u2715\"}</button>\n      <div style={{ padding: \"22px 22px 20px\" }}>\n        <div style={{ fontSize: 10, letterSpacing: \"0.2em\", color: `${accent}99`, fontFamily: FB, textTransform: \"uppercase\", marginBottom: 10, fontWeight: 600 }}>{connection.nodeA} {\"\\u2194\"} {connection.nodeB}</div>\n        <div style={{ marginBottom:20 }}>\n          <div style={{ fontSize:9, letterSpacing:\"0.18em\", color:accent+\"55\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:6 }}>ai read</div>\n          <div style={{ fontSize:17, color:\"rgba(255,255,255,0.85)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.55 }}>{connection.insight}</div>\n        </div>\n        {!done && <div data-slider=\"true\">\n          <div style={{ fontSize: 11, color: `${accent}88`, fontFamily: FB, letterSpacing: \"0.1em\", textTransform: \"uppercase\", marginBottom: 14, textAlign: \"center\" }}>how much does this land?</div>\n          <SpectrumSlider color={accent} poleA=\"not at all\" poleB=\"deeply\" onSet={handleSet} value={value} />\n        </div>}\n        {done && !showComment && <div style={{textAlign:\"center\",padding:\"8px 0\",animation:\"riseUp 0.5s ease\"}}>\n          {value > 66\n            ? <div style={{fontSize:14,fontFamily:FB,color:accent,fontWeight:600}}>deep resonance \u2713</div>\n            : value > 33\n            ? <div style={{fontSize:14,fontFamily:FB,color:accent,fontWeight:600}}>something's there \u2713</div>\n            : <div style={{fontSize:13,fontFamily:FB,color:\"rgba(214,178,100,0.8)\",fontWeight:600}}>your read carries this now</div>\n          }\n          {value >= 33 && <button onClick={function(e){e.stopPropagation();setShowComment(true);}} style={{display:\"block\",margin:\"10px auto 0\",fontSize:11,color:\"rgba(255,255,255,0.22)\",fontFamily:FB,background:\"transparent\",border:\"none\",cursor:\"pointer\",letterSpacing:\"0.08em\",textDecoration:\"underline\",textUnderlineOffset:3}}>add a note \u2192</button>}\n        </div>}\n        {done && showComment && <div style={{animation:\"riseUp 0.4s ease\",marginTop:8}}>\n          {value <= 33\n            ? <div style={{fontSize:11,color:\"rgba(214,178,100,0.7)\",fontFamily:FB,letterSpacing:\"0.1em\",marginBottom:10}}>YOUR READ \u2014 this replaces mine:</div>\n            : <div style={{fontSize:11,color:accent+\"88\",fontFamily:FB,letterSpacing:\"0.1em\",marginBottom:10}}>what's the actual connection?</div>\n          }\n          <textarea value={comment} onChange={function(e){setComment(e.target.value);}}\n            onKeyDown={function(e){if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();submitComment();}}}\n            placeholder={value<=33?\"what connects these, in your words...\":\"anything to add...\"}\n            style={{width:\"100%\",minHeight:64,\n              background:value<=33?\"rgba(40,30,8,0.6)\":\"rgba(255,255,255,0.04)\",\n              border:\"1px solid \"+(value<=33?\"rgba(214,178,100,0.3)\":accent+\"33\"),\n              borderRadius:10,color:\"rgba(255,255,255,0.9)\",fontFamily:FD,fontSize:15,\n              fontStyle:\"italic\",padding:\"10px 12px\",resize:\"none\",outline:\"none\",\n              lineHeight:1.6,boxSizing:\"border-box\"}}\n          />\n          <div style={{display:\"flex\",justifyContent:\"space-between\",marginTop:8,alignItems:\"center\"}}>\n            {value<=33\n              ? <div style={{fontSize:10,color:\"rgba(214,178,100,0.4)\",fontFamily:FB}}>your words carry this connection</div>\n              : <button onClick={onClose} style={{fontSize:11,color:\"rgba(255,255,255,0.22)\",fontFamily:FB,background:\"transparent\",border:\"none\",cursor:\"pointer\",letterSpacing:\"0.06em\"}}>close without note</button>\n            }\n            <button onClick={submitComment}\n              style={{fontSize:12,fontFamily:FB,background:\"transparent\",\n                border:\"1px solid \"+(comment.trim()?(value<=33?\"rgba(214,178,100,0.6)\":accent+\"44\"):\"rgba(255,255,255,0.1)\"),\n                borderRadius:16,padding:\"6px 18px\",cursor:\"pointer\",\n                color:comment.trim()?(value<=33?\"#D6B264\":accent):\"rgba(255,255,255,0.2)\"\n              }}>{value<=33?\"this is the connection\":\"noted\"}</button>\n          </div>\n        </div>}\n      </div>\n    </div>\n  );\n}\n\nfunction MapPhase({ onComplete, synthesisData, rawText, onPatchSynthesis }) {\n  const [activeConn, setActiveConn] = useState(null);\n  const [responses, setResponses] = useState({});\n  const [dragging, setDragging] = useState(null);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [discoveredConns, setDiscoveredConns] = useState([]);\n  const [snapTarget, setSnapTarget] = useState(null);\n  const SNAP_DIST = 130;\n\n  \n  const sd = synthesisData;\n  const nodes = useMemo(() => {\n    if (sd && sd.themes) return sd.themes.map(function(t, i) {\n      var label = t.label || \"\";\n      var display = label.length > 18 ? label.slice(0, 16).trim() + \"\\u2026\" : label;\n      return { key: t.label, display: display, color: t.color || NC[i % NC.length], w: Math.min(t.weight / 5, 1) };\n    });\n    return [];\n  }, [sd]);\n\n  const conns = useMemo(() => {\n    if (sd && sd.connections) return sd.connections.map(function(c) { return { from: c.from, to: c.to, label: (c.label || \"linked\").toUpperCase(), insight: c.insight || \"\", color: c.color || NC[0] }; });\n    return [];\n  }, [sd]);\n\n  \n  const [pos, setPos] = useState({});\n  const prevNodeCount = useRef(0);\n  useEffect(function() {\n    if (nodes.length !== prevNodeCount.current) {\n      prevNodeCount.current = nodes.length;\n      setPos({});  /* Reset positions when node set changes */\n    }\n  }, [nodes.length]);\n  const [fieldSize, setFieldSize] = useState(null);\n  const fieldRef = useRef(null);\n  const NR = 50;\n\n  \n  useLayoutEffect(() => {\n    var attempts = 0;\n    var rafId = null;\n    var tryMeasure = function() {\n      var el = fieldRef.current;\n      if (!el) { if (attempts++ < 20) rafId = requestAnimationFrame(tryMeasure); return; }\n      \n      var w = el.offsetWidth, h = el.offsetHeight;\n      if (w > 50 && h > 50) {\n        setFieldSize({ w: w, h: h }); fieldRef._fieldSizeSet = true;\n        return;\n      }\n      var r = el.getBoundingClientRect();\n      if (r.width > 50 && r.height > 50) {\n        setFieldSize({ w: r.width, h: r.height }); fieldRef._fieldSizeSet = true;\n      } else if (attempts++ < 20) {\n        rafId = requestAnimationFrame(tryMeasure);\n      }\n    };\n    rafId = requestAnimationFrame(tryMeasure);\n\n    return function() { if (rafId) cancelAnimationFrame(rafId); };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (nodes.length === 0 || !fieldSize) return;\n    if (fieldSize.w < 50 || fieldSize.h < 50) return; \n    if (Object.keys(pos).length >= nodes.length) return; \n    var n = nodes.length;\n    var W = fieldSize.w;\n    var H = fieldSize.h;\n    var cx = W / 2;\n    var cy = H / 2;\n    var NODE_W = 120;   \n    var NODE_H = 40;    \n    var PAD_X = NODE_W / 2 + 10;\n    var PAD_Y = NODE_H / 2 + 10;\n\n    \n    var adj = {};\n    nodes.forEach(function(_, i) { adj[i] = []; });\n    var edges = [];\n    var allConns = (sd && sd.connections) ? sd.connections : [];\n    allConns.forEach(function(c) {\n      var ai = -1, bi = -1;\n      nodes.forEach(function(nd, i) {\n        if (nd.key === c.from) ai = i;\n        if (nd.key === c.to) bi = i;\n      });\n      if (ai >= 0 && bi >= 0 && ai !== bi) {\n        edges.push([ai, bi]);\n        adj[ai].push(bi);\n        adj[bi].push(ai);\n      }\n    });\n\n    var degree = nodes.map(function(_, i) { return adj[i].length; });\n    var maxDegree = Math.max.apply(null, degree.concat([1]));\n\n    \n    var cols = Math.ceil(Math.sqrt(n));\n    var positions = nodes.map(function(nd, i) {\n      var col = i % cols;\n      var row = Math.floor(i / cols);\n      var rows = Math.ceil(n / cols);\n      var jitter = function() { return (Math.random() - 0.5) * 30; };\n      return {\n        x: (W * 0.12) + (col + 0.5) * (W * 0.76 / cols) + jitter(),\n        y: (H * 0.12) + (row + 0.5) * (H * 0.72 / rows) + jitter(),\n        vx: 0, vy: 0\n      };\n    });\n\n    \n    var IDEAL_EDGE_LEN = Math.min(W, H) * 0.38;\n    var K_ATTRACT = 0.022;\n    var K_REPEL = 32000;\n    var K_CENTER = 0.006;   /* stronger center pull prevents corner drift */\n    var K_DAMP = 0.72;\n    var MARGIN_X = PAD_X + 20;\n    var MARGIN_Y = PAD_Y + 20;\n\n    var STEPS = 250;\n    for (var step = 0; step < STEPS; step++) {\n      var cooling = 1 - (step / STEPS) * 0.85;\n\n      var fx = new Array(n).fill(0);\n      var fy = new Array(n).fill(0);\n\n      \n      for (var a = 0; a < n; a++) {\n        for (var b = a + 1; b < n; b++) {\n          var dx = positions[b].x - positions[a].x;\n          var dy = positions[b].y - positions[a].y;\n          var dist2 = dx * dx + dy * dy;\n          var dist = Math.sqrt(dist2) || 0.1;\n          \n          var force = K_REPEL / dist2 * (dist < 140 ? 3 : 1);\n          var ux = dx / dist, uy = dy / dist;\n          fx[a] -= ux * force;\n          fy[a] -= uy * force;\n          fx[b] += ux * force;\n          fy[b] += uy * force;\n        }\n      }\n\n      \n      for (var ei = 0; ei < edges.length; ei++) {\n        var a = edges[ei][0], b = edges[ei][1];\n        var dx = positions[b].x - positions[a].x;\n        var dy = positions[b].y - positions[a].y;\n        var dist = Math.sqrt(dx * dx + dy * dy) || 0.1;\n        var stretch = dist - IDEAL_EDGE_LEN;\n        var force = K_ATTRACT * stretch;\n        var ux = dx / dist, uy = dy / dist;\n        fx[a] += ux * force;\n        fy[a] += uy * force;\n        fx[b] -= ux * force;\n        fy[b] -= uy * force;\n      }\n\n      \n      for (var ii = 0; ii < n; ii++) {\n        fx[ii] += (cx - positions[ii].x) * K_CENTER;\n        fy[ii] += (cy - positions[ii].y) * K_CENTER;\n      }\n\n      \n      for (var ii = 0; ii < n; ii++) {\n        positions[ii].vx = (positions[ii].vx + fx[ii]) * K_DAMP;\n        positions[ii].vy = (positions[ii].vy + fy[ii]) * K_DAMP;\n        positions[ii].x += positions[ii].vx * cooling;\n        positions[ii].y += positions[ii].vy * cooling;\n        positions[ii].x = Math.max(MARGIN_X, Math.min(W - MARGIN_X - NODE_W, positions[ii].x));\n        positions[ii].y = Math.max(MARGIN_Y, Math.min(H - MARGIN_Y - NODE_H, positions[ii].y));\n      }\n    }\n\n    \n    \n    for (var pass = 0; pass < 40; pass++) {\n      var moved = false;\n      for (var a = 0; a < n; a++) {\n        for (var b = a + 1; b < n; b++) {\n          var dx = positions[b].x - positions[a].x;\n          var dy = positions[b].y - positions[a].y;\n          var minSepX = NODE_W + 48;\n          var minSepY = NODE_H + 36;\n          var overlapX = minSepX - Math.abs(dx);\n          var overlapY = minSepY - Math.abs(dy);\n          if (overlapX > 0 && overlapY > 0) {\n            \n            moved = true;\n            if (overlapX < overlapY) {\n              var shift = overlapX / 2 + 2;\n              if (dx >= 0) { positions[a].x -= shift; positions[b].x += shift; }\n              else { positions[a].x += shift; positions[b].x -= shift; }\n            } else {\n              var shift = overlapY / 2 + 2;\n              if (dy >= 0) { positions[a].y -= shift; positions[b].y += shift; }\n              else { positions[a].y += shift; positions[b].y -= shift; }\n            }\n            \n            positions[a].x = Math.max(MARGIN_X, Math.min(W - MARGIN_X - NODE_W, positions[a].x));\n            positions[a].y = Math.max(MARGIN_Y, Math.min(H - MARGIN_Y - NODE_H, positions[a].y));\n            positions[b].x = Math.max(MARGIN_X, Math.min(W - MARGIN_X - NODE_W, positions[b].x));\n            positions[b].y = Math.max(MARGIN_Y, Math.min(H - MARGIN_Y - NODE_H, positions[b].y));\n          }\n        }\n      }\n      if (!moved) break;\n    }\n\n    \n    var result = {};\n    nodes.forEach(function(nd, i) {\n      result[nd.key] = { x: positions[i].x - NODE_W / 2, y: positions[i].y - NODE_H / 2 };\n    });\n    setPos(result);\n  }, [nodes, fieldSize]);\n\n  var hasConn = function(a,b){ return conns.some(function(c){ return (c.from===a&&c.to===b)||(c.from===b&&c.to===a); }); };\n  var hasDiscovered = function(a,b){ return discoveredConns.some(function(c){ return (c.from===a&&c.to===b)||(c.from===b&&c.to===a); }); };\n  var anyConn = function(a,b){ return hasConn(a,b) || hasDiscovered(a,b); };\n  var getDiscovered = function(a,b){ return discoveredConns.find(function(c){ return (c.from===a&&c.to===b)||(c.from===b&&c.to===a); }); };\n\n  \n  const makeConn = async (a, b) => {\n    var nodeB = nodes.find(function(n) { return n.key === b; });\n    var col = nodeB ? nodeB.color : \"#7DB7AE\";\n    var temp = { from: a, to: b, label: \"READING\u2026\", insight: \"\u2026\", color: col, discovered: true };\n    setDiscoveredConns(function(prev) { return prev.concat([temp]); });\n    \n    var ctx = rawText ? \"\\nContext: \" + rawText.slice(0, 400) : \"\";\n    var p = \"The user connected two themes on their map: \\\"\" + a + \"\\\" and \\\"\" + b + \"\\\".\" + ctx + \"\\nGenerate a 2-4 word label and 1-2 sentence insight. JSON only: {\\\"label\\\":\\\"...\\\",\\\"insight\\\":\\\"...\\\"}\";\n    try {\n      var raw = await callClaude(p, \"Themes: \" + a + \" + \" + b, 300);\n      var d = parseJSON(raw);\n      if (d && d.label) {\n        var real = { from: a, to: b, label: d.label.toUpperCase(), insight: d.insight || \"\", color: col, discovered: true };\n        setDiscoveredConns(function(prev) { return prev.map(function(c) { return (c.from===a && c.to===b) ? real : c; }); });\n        \n        return;\n      }\n    } catch (e) {}\n    \n    var fb = { from: a, to: b, label: \"LINKED\", insight: a + \" and \" + b + \" \u2014 you see a relationship here. What does one reveal about the other?\", color: col, discovered: true };\n    setDiscoveredConns(function(prev) { return prev.map(function(c) { return (c.from===a && c.to===b) ? fb : c; }); });\n    setTimeout(function() { setActiveConn(fb); }, 900);\n  };\n\n  var handleNodeTap = function(key) {\n    if (dragging) return;\n    if (!selectedNode) { setSelectedNode(key); return; }\n    if (selectedNode === key) { setSelectedNode(null); return; }\n    const a = selectedNode, b = key;\n    if (hasConn(a, b)) {\n      const c = conns.find(c => (c.from===a&&c.to===b)||(c.from===b&&c.to===a));\n      if (c) setActiveConn(c);\n      setSelectedNode(null);\n      return;\n    }\n    if (!anyConn(a, b)) makeConn(a, b);\n    setSelectedNode(null);\n  };\n  var ctr = function(key) { var p=pos[key]; return p ? { x: p.x+50, y: p.y+18 } : {x:0,y:0}; };\n  var mid = function(c) { var a=ctr(c.from),b=ctr(c.to); return {x:(a.x+b.x)/2,y:(a.y+b.y)/2}; };\n  var edgePt = function(from, to) { var a=ctr(from),b=ctr(to); var dx=b.x-a.x, dy=b.y-a.y, d=Math.hypot(dx,dy)||1; const r=40; return { x1: a.x+(dx/d)*r, y1: a.y+(dy/d)*r, x2: b.x-(dx/d)*r, y2: b.y-(dy/d)*r }; };\n  const allConns = [...conns, ...discoveredConns];\n  var K = function(c) { return c.from+\"::\"+c.to; };\n  const explored = Object.keys(responses).length + discoveredConns.length;\n  const didDrag = useRef(false);\n  const snapRef = useRef(null); \n  var startDrag = function(key, e) { e.stopPropagation(); e.preventDefault(); didDrag.current = false; snapRef.current = null; const r=fieldRef.current?.getBoundingClientRect(); if(!r)return; var _pi2=nodes.findIndex(function(nd){return nd.key===key;}); var _fbc2=nodes.length; var _fbr2=90; var _fpx=fieldSize?(fieldSize.w/2-55+Math.cos(2*Math.PI*_pi2/_fbc2)*_fbr2):100; var _fpy=fieldSize?(fieldSize.h/2-18+Math.sin(2*Math.PI*_pi2/_fbc2)*_fbr2):100; const p=pos[key]||{x:_fpx,y:_fpy}; setDragging({key,ox:(e.clientX||e.touches&&e.touches[0]&&e.touches[0].clientX)-r.left-p.x,oy:(e.clientY||e.touches&&e.touches[0]&&e.touches[0].clientY)-r.top-p.y}); };\n  useEffect(() => {\n    if(!dragging) return;\n    const m = e => {\n      didDrag.current = true;\n      const r = fieldRef.current?.getBoundingClientRect(); if(!r) return;\n      const cx = (e.clientX||e.touches?.[0]?.clientX) - r.left - dragging.ox;\n      const cy = (e.clientY||e.touches?.[0]?.clientY) - r.top - dragging.oy;\n      const newX = Math.max(0, Math.min(cx, r.width - 120));\n      const newY = Math.max(0, Math.min(cy, r.height - 40));\n      setPos(p => ({...p, [dragging.key]: {x: newX, y: newY}}));\n      \n      const dragCtr = { x: newX + 50, y: newY + 18 };\n      let closest = null, closeDist = Infinity;\n      nodes.forEach(n => {\n        if (n.key === dragging.key) return;\n        const np = pos[n.key]; if(!np) return;\n        const nc = { x: np.x + 50, y: np.y + 18 };\n        const dist = Math.hypot(nc.x - dragCtr.x, nc.y - dragCtr.y);\n        if (dist < SNAP_DIST && dist < closeDist && !anyConn(dragging.key, n.key)) {\n          closeDist = dist; closest = n.key;\n        }\n      });\n      snapRef.current = closest;\n      setSnapTarget(closest);\n    };\n    var u = function() {\n      if (!didDrag.current) {\n        handleNodeTap(dragging.key);\n      } else if (snapRef.current) {\n        var sa = dragging.key, sb = snapRef.current;\n        if (!anyConn(sa, sb)) makeConn(sa, sb);\n        var MIN_CONN_DIST = 200;\n        setPos(function(prev) {\n          var pa = prev[sa], pb = prev[sb];\n          if (!pa || !pb) return prev;\n          var cax = pa.x + 50, cay = pa.y + 18;\n          var cbx = pb.x + 50, cby = pb.y + 18;\n          var dx = cbx - cax, dy = cby - cay;\n          var dist = Math.sqrt(dx*dx + dy*dy) || 1;\n          if (dist >= MIN_CONN_DIST) return prev;\n          var need = (MIN_CONN_DIST - dist) / 2;\n          var ux = dx/dist, uy = dy/dist;\n          var next = Object.assign({}, prev);\n          next[sa] = { x: pa.x - ux*need, y: pa.y - uy*need };\n          next[sb] = { x: pb.x + ux*need, y: pb.y + uy*need };\n          return next;\n        });\n        \n      }\n      setDragging(null);\n      setSnapTarget(null);\n      snapRef.current = null;\n    };\n    window.addEventListener(\"pointermove\", m);\n    window.addEventListener(\"pointerup\", u);\n    return () => { window.removeEventListener(\"pointermove\", m); window.removeEventListener(\"pointerup\", u); };\n  }, [dragging, selectedNode]);\n\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", padding: \"22px 0 0\", overflow: \"hidden\" }}>\n      <Particles color=\"rgba(107,184,255,0.25)\" count={6}/>\n      <div style={{ textAlign: \"center\", zIndex: 2, marginBottom: 0, flexShrink: 0, padding: \"0 8px\", height: 36 }}>\n        <div style={{ fontSize: 9, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#6BB8FF\", fontFamily: FB }}>{sd && sd.map_title ? sd.map_title.toUpperCase() : \"YOUR CONSTELLATION\"}</div>\n        <p style={{ fontSize: 10, color: snapTarget?\"#7DB7AE\":selectedNode?\"#6BFFB8\":explored===0?\"rgba(107,184,255,0.8)\":\"rgba(255,255,255,0.35)\", fontFamily: FB, margin: \"1px 0 0\", fontWeight: snapTarget||selectedNode||explored===0?600:400, transition: \"color 0.3s\" }}>\n          {snapTarget ? `Release to connect \u2192 ${snapTarget}` : selectedNode ? `${selectedNode} selected \u2014 tap another node to link` : explored===0 ? \"Tap a connection \u00b7 drag nodes together to link\" : `${explored} connections explored`}\n        </p>\n      </div>\n      <div ref={fieldRef} onClick={function(){setActiveConn(null);setSelectedNode(null);}} style={{ flex: 1, position: \"relative\", zIndex: 1, minHeight: 0, overflow: \"hidden\" }}>\n        <><svg style={{ position: \"absolute\", inset: 0, width: \"100%\", height: \"100%\", zIndex: 0 }}>\n          \n          {conns.map(function(c) {\n            var k=K(c), resp=responses[k], ep=edgePt(c.from,c.to);\n            var _sva=pos[c.from],_svb=pos[c.to];\n            if(!_sva||!_svb)return null;\n            {var _svdx=(_svb.x+50)-(_sva.x+50),_svdy=(_svb.y+18)-(_sva.y+18);if(Math.sqrt(_svdx*_svdx+_svdy*_svdy)<90)return null;}\n            const isAct = activeConn && K(activeConn)===k;\n            let stroke=\"rgba(255,255,255,0.18)\", sw=2, dash=\"8 5\", op=1;\n            if(resp?.value===\"yes\"){stroke=\"rgba(107,211,198,0.72)\";sw=3;dash=\"none\";}\n            else if(resp?.value===\"partly\"){stroke=\"rgba(165,235,220,0.5)\";sw=2.5;dash=\"none\";}\n            else if(resp?.value===\"no\"){\n              var hasWord=resp.comment&&resp.comment.trim().length>0;\n              stroke=hasWord?\"rgba(214,178,100,0.75)\":\"rgba(214,178,100,0.35)\";\n              sw=hasWord?2.5:1.5; dash=\"5 4\";\n            }\n            if(isAct){stroke=`${c.color}88`;sw=3;dash=\"none\";}\n            return <line key={k} x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2} stroke={stroke} strokeWidth={sw} strokeDasharray={dash} opacity={op} style={{transition:\"all 0.6s ease\"}}/>;\n          })}\n          \n          {discoveredConns.map(function(c) {\n            var k=K(c), resp=responses[k], ep=edgePt(c.from,c.to);\n            var isAct = activeConn && K(activeConn)===k;\n            return <line key={\"d-\"+k} x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2}\n              stroke={isAct ? `${c.color}88` : `${c.color}55`} strokeWidth={isAct ? 3 : 2}\n              strokeDasharray={isAct ? \"none\" : \"4 8\"} opacity={0.8}\n              style={{transition:\"all 0.6s ease\", animation: \"riseUp 0.6s ease\"}}/>;\n          })}\n          \n          {selectedNode && (() => {\n            const sc = ctr(selectedNode);\n            return <circle cx={sc.x} cy={sc.y} r={48} fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"1.5\" opacity=\"0.5\" strokeDasharray=\"4 4\">\n              <animate attributeName=\"r\" values=\"46;52;46\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n              <animate attributeName=\"opacity\" values=\"0.3;0.7;0.3\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n            </circle>;\n          })()}\n          \n          {snapTarget && dragging && (() => {\n            const ep = edgePt(dragging.key, snapTarget);\n            return <line x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2} stroke=\"#7DB7AE\" strokeWidth=\"2.5\" strokeDasharray=\"6 4\" opacity=\"0.7\" style={{animation:\"connBlink 1s ease-in-out infinite\"}}/>;\n          })()}\n        </svg>\n        {conns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          const isAct = activeConn && K(activeConn)===k;\n          var isUserDefined = resp && resp.value===\"no\" && resp.comment && resp.comment.trim();\n          var isExp = !!resp; var accent = isUserDefined ? \"#D6B264\" : c.color;\n          var _lpa=pos[c.from],_lpb=pos[c.to];\n          if(!_lpa||!_lpb)return null;\n          {var _ldx=(_lpb.x+50)-(_lpa.x+50),_ldy=(_lpb.y+18)-(_lpa.y+18);if(Math.sqrt(_ldx*_ldx+_ldy*_ldy)<90)return null;}\n          return (\n            <div key={k} onClick={function(e){e.stopPropagation();setActiveConn(c);}} style={{\n              position: \"absolute\", left: m.x, top: m.y, transform: \"translate(-50%, -50%)\",\n              padding: \"4px 10px\", borderRadius: 6, fontSize: 9, fontWeight: 700, fontFamily: FB,\n              letterSpacing: \"0.06em\", textTransform: \"uppercase\",\n              color: isAct?\"white\":isUserDefined?\"#D6B264\":isExp?accent+\"cc\":accent,\n              background: isAct?accent+\"33\":isUserDefined?\"rgba(40,30,10,0.9)\":\"rgba(8,10,20,0.85)\",\n              border:\"1.5px solid \"+(isAct?accent:isUserDefined?\"rgba(214,178,100,0.5)\":isExp?accent+\"44\":accent+\"66\"),\n              cursor: \"pointer\", whiteSpace: \"nowrap\", zIndex: isAct ? 15 : 5,\n              transition: \"all 0.3s ease\",\n              animation: !isExp ? \"connBlink 2s ease-in-out infinite\" : \"none\",\n              boxShadow: isAct ? `0 0 20px ${accent}33` : !isExp ? `0 0 12px ${accent}15` : \"none\",\n            }}>\n              {!isExp && <div style={{ position:\"absolute\", inset:-5, borderRadius:10, border:\"1px solid \"+accent+\"44\", animation:\"ringPulse 2s ease-in-out infinite\", pointerEvents:\"none\" }}/>}\n              {isUserDefined\n                ? <span title={\"you: \"+resp.comment}>{resp.comment.trim().split(/\\s+/).slice(0,5).join(\" \")}{resp.comment.trim().split(/\\s+/).length>5?\"\u2026\":\"\"}</span>\n                : c.label\n              }\n            </div>\n          );\n        })}\n        {conns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          if(!resp?.correction) return null;\n          return <div key={\"a-\"+k} style={{ position:\"absolute\",left:m.x,top:m.y+16,transform:\"translate(-50%,0)\",fontSize:10,fontFamily:FD,fontStyle:\"italic\",color:\"rgba(165,235,220,0.65)\",maxWidth:140,textAlign:\"center\",lineHeight:1.3,animation:\"riseUp 0.5s ease\" }}>\"{resp.correction.length>45?resp.correction.slice(0,43)+\"\u2026\":resp.correction}\"</div>;\n        })}\n        \n        {discoveredConns.map(function(c) {\n          var m=mid(c), k=K(c), resp=responses[k];\n          var isAct = activeConn && K(activeConn)===k;\n          var isExp = !!resp;\n          return (\n            <div key={\"dl-\"+k} onClick={function(e){e.stopPropagation();setActiveConn(c);}} style={{\n              position: \"absolute\", left: m.x, top: m.y, transform: \"translate(-50%, -50%)\",\n              padding: \"4px 10px\", borderRadius: 6, fontSize: 9, fontWeight: 700, fontFamily: FB,\n              letterSpacing: \"0.06em\", textTransform: \"uppercase\",\n              color: isAct ? \"white\" : `${c.color}`,\n              background: isAct ? `${c.color}33` : `rgba(8,10,20,0.85)`,\n              border: `1.5px solid ${isAct ? c.color : `${c.color}66`}`,\n              cursor: \"pointer\", whiteSpace: \"nowrap\", zIndex: isAct ? 15 : 5,\n              transition: \"all 0.3s ease\", animation: \"riseUp 0.5s ease\",\n              boxShadow: isAct ? `0 0 20px ${c.color}33` : `0 0 12px ${c.color}15`,\n            }}>\n              <span style={{ opacity:0.5, marginRight:4, fontSize:8 }}>you</span>{c.label}\n            </div>\n          );\n        })}\n        {nodes.map((n, ni) => {\n          var _pi=nodes.indexOf(n); var _fbc=nodes.length; var _fbr=90; var p=pos[n.key]||{x:fieldSize?(fieldSize.w/2-55+Math.cos(2*Math.PI*_pi/_fbc)*_fbr):100, y:fieldSize?(fieldSize.h/2-18+Math.sin(2*Math.PI*_pi/_fbc)*_fbr):100}; const isDrag=dragging&&dragging.key===n.key;\n          const isSel = selectedNode === n.key;\n          const isSnap = snapTarget === n.key;\n          const canLink = selectedNode && selectedNode !== n.key && !hasConn(selectedNode, n.key) && !hasDiscovered(selectedNode, n.key);\n          return (\n            <div key={n.key} onPointerDown={function(e){startDrag(n.key,e);}} style={{\n              position: \"absolute\", left: p.x, top: p.y,\n              borderRadius: 999, display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n              fontSize: 12, fontWeight: 600, fontFamily: FB, color: \"white\",\n              textAlign: \"center\", lineHeight: 1.2,\n              padding: \"10px 18px\",\n              textTransform: \"uppercase\", letterSpacing: \"0.06em\",\n              whiteSpace: \"normal\", maxWidth: 110,\n              background: isSnap\n                ? \"rgba(125,183,174,0.15)\"\n                : n.w > 0.7 ? `rgba(214,178,109,0.18)` : \"rgba(244,241,234,0.08)\",\n              border: isSnap ? \"1.5px solid rgba(125,183,174,0.7)\"\n                : isSel ? \"1.5px solid #6BFFB8\"\n                : canLink ? `1.5px solid ${n.color}aa`\n                : n.w > 0.7 ? \"1.5px solid rgba(214,178,109,0.45)\"\n                : `1.5px solid rgba(244,241,234,0.22)`,\n              backdropFilter: \"blur(8px)\",\n              cursor: isDrag?\"grabbing\":\"pointer\", zIndex: isDrag?20: isSel||isSnap?10 :3,\n              transition: isDrag?\"none\":\"all 0.4s cubic-bezier(.25,.46,.45,.94)\",\n              transform: isDrag?\"scale(1.12)\": isSnap?\"scale(1.15)\": isSel?\"scale(1.08)\" :\"scale(1)\",\n              boxShadow: isSnap\n                ? \"0 0 20px rgba(125,183,174,0.4)\"\n                : isSel\n                ? \"0 0 20px rgba(107,255,184,0.25)\"\n                : `0 0 ${isDrag?25:12}px ${n.color}${isDrag?\"44\":\"18\"}`,\n              touchAction: \"none\", userSelect: \"none\",\n              animation: isDrag||isSel||isSnap ? \"none\" : \"nodeBreathe 8s ease-in-out infinite\",\n              animationDelay: `${ni*-1.5}s`,\n            }}>{n.display || n.key}</div>\n          );\n        })}\n        {activeConn && <InsightDrawer\n          connection={{nodeA:activeConn.from,nodeB:activeConn.to,label:activeConn.label,insight:activeConn.insight,color:activeConn.color}}\n          position={mid(activeConn)}\n          onClose={function(){setActiveConn(null);}}\n          onRespond={function(v,c,slider,cmt){\n              setResponses(function(prev){\n                var k=K(activeConn);var next=Object.assign({},prev);\n                next[k]={value:v,correction:c,slider:slider,comment:cmt||\"\",from:activeConn.from,to:activeConn.to,insight:activeConn.insight};\n                return next;\n              });\n              if (slider < 50 && cmt && cmt.trim() && onPatchSynthesis && activeConn) {\n                var uw = cmt.trim(), fn = activeConn.from, tn = activeConn.to;\n                onPatchSynthesis({connections:[{from:fn,to:tn,insight:uw,label:activeConn.label,userAuthored:true}]});\n                (async function(){\n                  try{\n                    var pr=\"User corrected an AI connection reading. Their words are PRIMARY \u2014 reflect them back, do not reinterpret.\\n\"\n                    +\"USER SAID the connection between [\"+fn+\"] and [\"+tn+\"] is: \\\"\"+uw+\"\\\"\\n\"\n                    +\"Write ONE sentence (max 18 words) that mirrors their words as the connection insight. JSON: {\\\"insight\\\":\\\"...\\\"}\";\n                    var rw=await callClaude(pr,\"Connection: \"+fn+\" + \"+tn+\"\\nUser said: \"+uw,150);\n                    var dw=parseJSON(rw);\n                    if(dw&&dw.insight) onPatchSynthesis({connections:[{from:fn,to:tn,insight:dw.insight,label:activeConn.label,userAuthored:true}]});\n                  }catch(e){}\n                })();\n              }\n            }}\n        />}\n        </>}\n      </div>\n      {explored>=1&&<button \n      \n      onClick={function(){var merged=Object.assign({},responses);discoveredConns.forEach(function(c){var k2=c.from+\"::\"+c.to;if(!merged[k2]) merged[k2]={value:\"discovered\",from:c.from,to:c.to,insight:c.insight||\"\",label:c.label||\"\",userDiscovered:true,comment:\"\"};});onComplete(merged);}} style={{ position:\"absolute\",bottom:16,left:\"50%\",transform:\"translateX(-50%)\",width:\"calc(100% - 32px)\",maxWidth:340,background:\"linear-gradient(135deg, rgba(30,40,60,0.92), rgba(20,30,55,0.95))\",border:\"1px solid rgba(107,184,255,0.35)\",borderRadius:24,padding:\"13px 28px\",color:\"rgba(107,184,255,0.9)\",fontSize:13,fontFamily:FB,fontWeight:500,cursor:\"pointer\",zIndex:25,animation:\"riseUp 0.5s ease\",backdropFilter:\"blur(12px)\",letterSpacing:\"0.06em\",boxShadow:\"0 4px 24px rgba(0,0,0,0.5)\" }}>continue \u2192</button>}\n    </div>\n  );\n}\n\nconst GUIDE_TYPES = {\n  act: { color: \"#6BFFB8\", icon: \"\u2192\" },\n  sit: { color: \"#6BB8FF\", icon: \"\u25ce\" },\n  deepen: { color: \"#FFB86B\", icon: \"\u25c7\" },\n  release: { color: \"#FF6B9D\", icon: \"\u21ba\" },\n  notice: { color: \"#9FB2D8\", icon: \"\u25c8\" },\n};\n\nconst GUIDE_ITEMS = [\n  { type: \"act\", text: \"Write down the one thing you'd build if money were irrelevant. Put it somewhere you'll see it tomorrow.\" },\n  { type: \"sit\", text: \"Sit with the question: when you say 'proof,' who are you proving it to? Don't answer. Just hold it.\" },\n  { type: \"deepen\", text: \"The word 'control' appeared 12 times. Ask yourself \u2014 what am I actually afraid of losing?\" },\n  { type: \"release\", text: \"Name one expectation about SAYCRD you're ready to set down. You don't have to drop it \u2014 just set it down.\" },\n  { type: \"notice\", text: \"This week, notice when you use the word 'should.' Write down what you actually feel instead.\" },\n];\n\nfunction SpectrumSlider({ color, poleA, poleB, onSet, value }) {\n  var [p, setP] = useState(value != null ? value : 50);\n  var [d, setD] = useState(false);\n  var [confirmed, setConfirmed] = useState(value != null);\n  var tr = useRef(null);\n  function upd(e) {\n    var r = tr.current ? tr.current.getBoundingClientRect() : null;\n    if (!r) return;\n    var cx = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);\n    setP(Math.max(0, Math.min(100, (cx - r.left) / r.width * 100)));\n  }\n  function hd(e) { e.preventDefault(); setD(true); upd(e); }\n  useEffect(function() {\n    if (!d) return;\n    function m(e) { upd(e); }\n    function u() { setD(false); }\n    window.addEventListener(\"pointermove\", m);\n    window.addEventListener(\"pointerup\", u);\n    return function() { window.removeEventListener(\"pointermove\", m); window.removeEventListener(\"pointerup\", u); };\n  }, [d]);\n  function confirm() {\n    setConfirmed(true);\n    onSet(Math.round(p));\n  }\n  return <div>\n    <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:14 }}>\n      <span style={{ fontSize:13, color: p < 40 ? color : \"rgba(255,255,255,0.35)\", fontFamily:FB, fontWeight:500, transition:\"color 0.3s\" }}>{poleA}</span>\n      <span style={{ fontSize:13, color: p > 60 ? color : \"rgba(255,255,255,0.35)\", fontFamily:FB, fontWeight:500, transition:\"color 0.3s\" }}>{poleB}</span>\n    </div>\n    <div ref={tr} onPointerDown={hd} style={{ position:\"relative\", height:36, display:\"flex\", alignItems:\"center\", cursor:\"pointer\", touchAction:\"none\" }}>\n      <div style={{ position:\"absolute\", left:0, right:0, height:3, background:\"rgba(255,255,255,0.06)\", borderRadius:2 }} />\n      <div style={{ position:\"absolute\", left:0, height:3, width:p+\"%\", background:\"linear-gradient(90deg,\"+color+\"33,\"+color+\"88)\", borderRadius:2, transition:d?\"none\":\"width 0.1s\" }} />\n      <div style={{ position:\"absolute\", left:p+\"%\", transform:\"translateX(-50%)\",\n        width:confirmed?30:26, height:confirmed?30:26, borderRadius:\"50%\",\n        background: confirmed ? color+\"66\" : \"rgba(255,255,255,0.1)\",\n        border:\"2px solid \"+(confirmed ? color : \"rgba(255,255,255,0.2)\"),\n        cursor:d?\"grabbing\":\"grab\",\n        boxShadow: confirmed ? \"0 0 18px \"+color+\"44\" : \"none\",\n        transition:d?\"none\":\"all 0.2s\", zIndex:2 }} />\n    </div>\n    {!confirmed\n      ? <div style={{ textAlign:\"center\", marginTop:14 }}>\n          <button onClick={confirm} style={{ fontSize:13, color:color, fontFamily:FB, fontWeight:600,\n            background:color+\"18\", border:\"1px solid \"+color+\"44\", borderRadius:20,\n            padding:\"8px 28px\", cursor:\"pointer\", letterSpacing:\"0.08em\", transition:\"all 0.2s\" }}>\n            confirm\n          </button>\n        </div>\n      : <div style={{ textAlign:\"center\", marginTop:10, fontSize:11, color:color+\"88\", fontFamily:FB, letterSpacing:\"0.1em\" }}>\n          \u2713 set \u2014 drag to adjust\n        </div>\n    }\n  </div>;\n}\n\nfunction GuideHoldSave({ color, onSave }) {\n  var [prog, setProg] = useState(0);\n  var [holding, setHolding] = useState(false);\n  var ref = useRef(null);\n  var startT = useRef(0);\n  function start(e) {\n    e.stopPropagation(); setHolding(true); startT.current = Date.now();\n    ref.current = setInterval(function() {\n      var p = Math.min((Date.now() - startT.current) / 900, 1);\n      setProg(p);\n      if (p >= 1) { clearInterval(ref.current); setHolding(false); setProg(0); onSave(); }\n    }, 30);\n  }\n  function end() { if (ref.current) clearInterval(ref.current); setHolding(false); setProg(0); }\n  return <div\n    onMouseDown={start} onMouseUp={end} onMouseLeave={end}\n    onTouchStart={start} onTouchEnd={end}\n    style={{ position: \"relative\", padding: \"6px 18px\", borderRadius: 20, background: color + (Math.round(8 + prog * 40)).toString(16).padStart(2, \"0\"), border: \"1px solid \" + color + \"44\", color: color, fontSize: 12, fontFamily: FB, cursor: \"pointer\", userSelect: \"none\", WebkitUserSelect: \"none\", overflow: \"hidden\" }}\n  >\n    <div style={{ position: \"absolute\", bottom: 0, left: 0, width: prog * 100 + \"%\", height: 2, background: color, transition: holding ? \"none\" : \"width 0.2s\" }} />\n    {holding ? \"...\" : \"hold\"}\n  </div>;\n}\n\nfunction GuideItem({ item, index, onPatchSynthesis, allGuide }) {\n  const [expanded, setExpanded] = useState(false);\n  const [response, setResponse] = useState(\"\");\n  const [saved, setSaved] = useState(false);\n  const [echo, setEcho] = useState(null);\n  const gt = GUIDE_TYPES[item.type] || GUIDE_TYPES.act;\n  const submit = async () => {\n    if (!response.trim()) return;\n    setSaved(true);\n    var ur = response.trim();\n    try {\n      var p = \"User responded to a guide suggestion. Their response is primary truth.\\n\"\n        + \"Do not praise. Do not validate. Mirror or sharpen. If they correct or reframe \u2014 honor the correction.\\n\"\n        + \"ONE sentence, max 25 words. JSON: {\\\"echo\\\":\\\"...\\\"}\";\n      var raw = await callClaude(p, \"Suggestion: \\\"\"+item.text+\"\\\"\\nUser said: \\\"\"+ur+\"\\\"\", 180);\n      var d = parseJSON(raw);\n      var echoText = d && d.echo ? d.echo : null;\n      if (echoText) setEcho(echoText);\n      if (onPatchSynthesis && allGuide) {\n        var updatedGuide = allGuide.map(function(g) {\n          if (g.text === item.text && g.type === item.type) {\n            return Object.assign({}, g, { userResponse: ur, echo: echoText, userAuthored: true });\n          }\n          return g;\n        });\n        onPatchSynthesis({ guide: updatedGuide });\n      }\n    } catch (e) {}\n  };\n  return (\n    <div onClick={function(){ if(!expanded && !saved) setExpanded(true); }} style={{\n      padding: \"16px 18px\", borderRadius: 14, background: \"rgba(16,20,26,0.8)\",\n      border: `1px solid ${saved ? `${gt.color}33` : expanded ? `${gt.color}22` : \"rgba(255,255,255,0.06)\"}`,\n      cursor: expanded || saved ? \"default\" : \"pointer\", transition: \"all 0.3s\",\n      animation: `riseUp 0.5s ease ${0.1 + index * 0.15}s both`,\n    }}>\n      <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, marginBottom: 8 }}>\n        <span style={{ fontSize: 14, color: gt.color }}>{gt.icon}</span>\n        <span style={{ fontSize: 10, letterSpacing: \"0.16em\", textTransform: \"uppercase\", fontWeight: 700, color: gt.color, fontFamily: FB }}>{item.type}</span>\n        {saved && <span style={{ fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, marginLeft: \"auto\" }}>responded</span>}\n        {!expanded && !saved && <span style={{ fontSize: 10, color: \"rgba(255,255,255,0.1)\", fontFamily: FB, marginLeft: \"auto\" }}>tap to respond</span>}\n      </div>\n      <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.65)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: 0 }}>{item.text}</p>\n      {expanded && !saved && (\n        <div style={{ marginTop: 14, animation: \"riseUp 0.3s ease\" }}>\n          <textarea value={response} onChange={function(e){ setResponse(e.target.value); }}\n            onKeyDown={function(e){ if (e.key === \"Enter\" && !e.shiftKey && response.trim()) { e.preventDefault(); submit(); } }}\n            placeholder=\"In your words\u2026\" rows={2} autoFocus\n            style={{ width: \"100%\", background: \"rgba(255,255,255,0.03)\", border: `1px solid ${gt.color}33`, borderRadius: 10, color: \"rgba(255,255,255,0.8)\", padding: \"10px 14px\", fontFamily: FB, fontSize: 14, resize: \"none\", outline: \"none\", lineHeight: 1.5 }} />\n          <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginTop: 8 }}>\n            <span style={{ fontSize: 11, color: \"rgba(255,255,255,0.1)\", fontFamily: FB }}>hold to save</span>\n            {response.trim() && <GuideHoldSave color={gt.color} onSave={submit} />}\n          </div>\n        </div>\n      )}\n      {saved && (\n        <div style={{ marginTop: 10 }}>\n          <div style={{ padding:\"12px 14px\", borderRadius:10,\n            background:gt.color+\"0a\", border:\"1px solid \"+gt.color+\"25\",\n            animation:\"riseUp 0.4s ease\" }}>\n            <div style={{ fontSize:9, letterSpacing:\"0.18em\", color:gt.color+\"66\",\n              fontFamily:FB, textTransform:\"uppercase\", marginBottom:6 }}>you said</div>\n            <p style={{ fontSize:15, color:\"rgba(255,255,255,0.88)\", fontFamily:FD,\n              fontStyle:\"italic\", margin:0, lineHeight:1.6 }}>{response}</p>\n          </div>\n          {echo && (\n            <div style={{ marginTop:8, paddingLeft:4, animation:\"riseUp 0.5s ease 0.2s both\" }}>\n              <p style={{ fontSize:13, color:gt.color+\"66\", fontFamily:FD,\n                fontStyle:\"italic\", lineHeight:1.6, margin:0 }}>{echo}</p>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction DescentGame({ cards: propCards, onDone }) {\n  const DESCENT_CARDS = (propCards && propCards.length > 0 ? propCards.slice(0, 4) : [\n    { type: \"energy\", phrase: \"wanting to be seen but not watched\", color: \"#FFB86B\" },\n    { type: \"binary\", prompt: \"right now you're drawn to\", option_a: \"building slowly\", option_b: \"leaping first\", color: \"#FF6B9D\" },\n    { type: \"spectrum\", prompt: \"where does this live?\", pole_a: \"still forming\", pole_b: \"ready to move\", color: \"#6BFFB8\" },\n    { type: \"binary\", prompt: \"the tension feels more like\", option_a: \"two things pulling apart\", option_b: \"one thing trying to split\", color: \"#6BB8FF\" },\n  ]).map(function(c,i){return Object.assign({},c,{color:c.color||NC[i%NC.length]});});\n  const [ci, setCi] = useState(0);\n  const [answers, setAnswers] = useState({});\n  const [showCompletion, setShowCompletion] = useState(false);\n  const c = DESCENT_CARDS[ci], ans = answers[ci] !== undefined;\n  function record(v) {\n    var newAnswers = Object.assign({}, answers, {[ci]: v});\n    setAnswers(newAnswers);\n    if (ci < DESCENT_CARDS.length - 1) {\n      setTimeout(function(){ setCi(ci + 1); }, 1600);\n    } else {\n      setTimeout(function(){ setShowCompletion(true); }, 1200);\n    }\n  }\n  \n  const allDone = Object.keys(answers).length >= DESCENT_CARDS.length;\n  useEffect(function() {\n    if (showCompletion) setTimeout(function(){ onDone({ answers: answers, cards: DESCENT_CARDS }); }, 3500);\n  }, [showCompletion]);\n\n  \n  const [swipeX, setSwipeX] = useState(0);\n  const [swiping, setSwiping] = useState(false);\n  const swipeStart = useRef(0);\n  const swipeThreshold = 80;\n\n  function onTouchStart(e) { swipeStart.current = e.touches[0].clientX; setSwiping(true); setSwipeX(0); }\n  function onTouchMove(e) { if (!swiping) return; var dx = e.touches[0].clientX - swipeStart.current; setSwipeX(dx); }\n  function onTouchEnd() {\n    if (!swiping) return;\n    setSwiping(false);\n    if (swipeX < -swipeThreshold) { record(\"a\"); }\n    else if (swipeX > swipeThreshold) { record(\"b\"); }\n    setSwipeX(0);\n  }\n  function onMouseDown(e) { swipeStart.current = e.clientX; setSwiping(true); setSwipeX(0); }\n  function onMouseMove(e) { if (!swiping) return; setSwipeX(e.clientX - swipeStart.current); }\n  function onMouseUp() { onTouchEnd(); }\n\n  \n  useEffect(function() {\n    setSwipeX(0); setSwiping(false); setHoldProg(0); setEnergyHolding(false);\n  }, [ci]);\n\n  \n  const [holdProg, setHoldProg] = useState(0);\n  const [energyHolding, setEnergyHolding] = useState(false);\n  const holdRef = useRef(null);\n  const holdStartT = useRef(0);\n\n  function startEnergyHold(e) {\n    if (ans) return;\n    e.stopPropagation();\n    setEnergyHolding(true);\n    holdStartT.current = Date.now();\n    holdRef.current = setInterval(function() {\n      var p = Math.min((Date.now() - holdStartT.current) / 1800, 1);\n      setHoldProg(p);\n      if (p >= 1) { clearInterval(holdRef.current); setEnergyHolding(false); record(5); }\n    }, 30);\n  }\n  function endEnergyHold() {\n    if (holdRef.current) clearInterval(holdRef.current);\n    if (energyHolding) {\n      setEnergyHolding(false);\n      if (holdProg >= 1) return;\n      \n      if (holdProg > 0.08) {\n        var val = Math.max(1, Math.ceil(holdProg * 5));\n        record(val);\n      }\n      setHoldProg(0);\n    }\n  }\n\n  \n  var swipeRatio = Math.min(Math.abs(swipeX) / swipeThreshold, 1);\n  var swipeDir = swipeX < 0 ? \"a\" : swipeX > 0 ? \"b\" : null;\n\n  return (\n    <div style={{ padding: \"20px 0\" }}>\n      \n      {showCompletion && <div style={{ textAlign: \"center\", padding: \"28px 0\", animation: \"riseUp 0.6s ease\" }}>\n        <div style={{ fontSize: 32, marginBottom: 16 }}>\u25c6</div>\n        <div style={{ fontSize: 18, color: \"rgba(214,178,109,0.85)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5, marginBottom: 12 }}>Descent complete.</div>\n        <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, letterSpacing: \"0.1em\" }}>\n          {Object.keys(answers).length} questions, {Object.keys(answers).length} honest answers.\n        </div>\n        <div style={{ marginTop: 20, display: \"flex\", flexDirection: \"column\", gap: 8, alignItems: \"stretch\", maxWidth: 280, margin: \"20px auto 0\" }}>\n          {DESCENT_CARDS.map(function(card, i) {\n            var ans = answers[i];\n            var display;\n            if (ans === undefined || ans === null) { display = \"\u2014\"; }\n            else if (card.type === \"energy\" && typeof ans === \"number\") {\n              var lvl = Math.max(0, Math.min(5, Math.round(ans)));\n              display = \"\u25cf\".repeat(lvl) + \"\u25cb\".repeat(5 - lvl);\n            } else if (card.type === \"spectrum\" && typeof ans === \"number\") {\n              display = ans + \"% \u2192 \" + (ans >= 50 ? (card.pole_b || \"b\") : (card.pole_a || \"a\"));\n            } else if (card.type === \"binary\" && typeof ans === \"string\") {\n              display = ans === \"a\" ? (card.option_a || \"a\") : (card.option_b || \"b\");\n            } else { display = String(ans); }\n            return <div key={i} style={{ display: \"flex\", alignItems: \"center\", gap: 10 }}>\n              <div style={{ width: 6, height: 6, borderRadius: \"50%\", background: card.color, opacity: 0.5, flexShrink: 0 }} />\n              <div style={{ fontSize: 12, color: card.color + \"AA\", fontFamily: FB, letterSpacing: \"0.04em\" }}>{display}</div>\n            </div>;\n          })}\n        </div>\n      </div>}\n\n      {!showCompletion && <><div style={{ display: \"flex\", gap: 8, marginBottom: 20, justifyContent: \"center\" }}>\n        {DESCENT_CARDS.map(function(_, i) { return <div key={i} style={{ width: i === ci ? 12 : 7, height: 7, borderRadius: 4, background: i < ci ? DESCENT_CARDS[i].color + \"88\" : i === ci ? \"white\" : \"rgba(255,255,255,0.1)\", transition: \"all 0.4s\" }} />; })}\n      </div>\n\n      <div key={ci} style={{ animation: \"slideIn 0.4s ease\" }}>\n        \n        {c.type === \"energy\" && <div\n          onMouseDown={startEnergyHold} onMouseUp={endEnergyHold} onMouseLeave={endEnergyHold}\n          onTouchStart={startEnergyHold} onTouchEnd={endEnergyHold}\n          style={{ borderRadius: 22, padding: \"40px 24px\", background: \"linear-gradient(160deg,\" + c.color + \"12,rgba(10,10,30,0.9),\" + c.color + \"08)\", border: \"1px solid \" + c.color + \"22\", textAlign: \"center\", cursor: \"pointer\", userSelect: \"none\", WebkitUserSelect: \"none\", position: \"relative\", overflow: \"hidden\" }}\n        >\n          \n          <div style={{ position:\"absolute\", bottom:0, left:0, width:(ans ? 100 : holdProg * 100)+\"%\", height:4, background:c.color, transition:energyHolding?\"none\":\"width 0.3s ease\", opacity:0.7, borderRadius:\"0 0 22px 22px\" }} />\n          \n          <div style={{ display:\"flex\", gap:12, justifyContent:\"center\", marginBottom:20 }}>\n            {[1,2,3,4,5].map(function(dot) {\n              var lit = ans ? (answers[ci] || 0) >= dot : holdProg * 5 >= dot;\n              return <div key={dot}\n                onClick={function(e){ if(!ans){ e.stopPropagation(); record(dot); } }}\n                style={{ width:18, height:18, borderRadius:\"50%\",\n                  background: lit ? c.color : \"rgba(255,255,255,0.08)\",\n                  boxShadow: lit ? \"0 0 12px \"+c.color+\"88\" : \"none\",\n                  border:\"1px solid \"+(lit ? c.color+\"88\" : \"rgba(255,255,255,0.12)\"),\n                  cursor: ans ? \"default\" : \"pointer\",\n                  transition:\"all 0.2s\" }} />;\n            })}\n          </div>\n          {!ans && <div style={{ fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.08em\", marginBottom:8 }}>tap a dot or hold to fill</div>}\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, marginBottom: 20 }}>{c.phrase}</div>\n          {!ans && <div style={{ fontSize: 11, color: \"rgba(255,255,255,0.15)\", fontFamily: FB, letterSpacing: \"0.12em\" }}>\n            {energyHolding ? \"hold longer = stronger...\" : \"hold to mark how much this matters\"}\n          </div>}\n          {ans && <div style={{ fontSize: 11, color: c.color + \"88\", fontFamily: FB, letterSpacing: \"0.12em\", animation: \"riseUp 0.3s ease\" }}>\n            {\"\u25cf\".repeat(answers[ci])}{\"\u25cb\".repeat(5 - answers[ci])} marked\n          </div>}\n        </div>}\n\n        \n        {c.type === \"binary\" && <div\n          onTouchStart={!ans ? onTouchStart : undefined}\n          onTouchMove={!ans ? onTouchMove : undefined}\n          onTouchEnd={!ans ? onTouchEnd : undefined}\n          onMouseDown={!ans ? onMouseDown : undefined}\n          onMouseMove={!ans ? onMouseMove : undefined}\n          onMouseUp={!ans ? onMouseUp : undefined}\n          onMouseLeave={!ans ? onMouseUp : undefined}\n          style={{ borderRadius: 22, padding: \"36px 24px\", background: \"linear-gradient(160deg,\" + c.color + \"12,rgba(10,10,30,0.9),\" + c.color + \"08)\", border: \"1px solid \" + c.color + \"22\", textAlign: \"center\", userSelect: \"none\", WebkitUserSelect: \"none\", cursor: ans ? \"default\" : \"grab\", position: \"relative\", overflow: \"hidden\", transform: ans ? \"none\" : \"translateX(\" + swipeX * 0.3 + \"px) rotate(\" + swipeX * 0.02 + \"deg)\", transition: swiping ? \"none\" : \"transform 0.3s ease\" }}\n        >\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, marginBottom: 24 }}>{c.prompt}</div>\n\n          {!ans && <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <div style={{ fontSize: 14, fontFamily: FB, fontWeight: 600, color: swipeDir === \"a\" ? c.color : \"rgba(255,255,255,0.25)\", opacity: swipeDir === \"a\" ? 0.3 + swipeRatio * 0.7 : 0.4, transition: swiping ? \"none\" : \"all 0.3s\", transform: \"scale(\" + (swipeDir === \"a\" ? 1 + swipeRatio * 0.15 : 1) + \")\" }}>\u2190 {c.option_a}</div>\n            <div style={{ fontSize: 14, fontFamily: FB, fontWeight: 600, color: swipeDir === \"b\" ? c.color : \"rgba(255,255,255,0.25)\", opacity: swipeDir === \"b\" ? 0.3 + swipeRatio * 0.7 : 0.4, transition: swiping ? \"none\" : \"all 0.3s\", transform: \"scale(\" + (swipeDir === \"b\" ? 1 + swipeRatio * 0.15 : 1) + \")\" }}>{c.option_b} \u2192</div>\n          </div>}\n          {!ans && <div style={{ marginTop: 18, display: \"flex\", gap: 10 }}>\n            <button onClick={function(e){ e.stopPropagation(); record(\"a\"); }}\n              style={{ flex:1, padding:\"12px 8px\", borderRadius:14,\n                background: swipeDir===\"a\" ? c.color+\"22\" : \"rgba(255,255,255,0.04)\",\n                border:\"1px solid \"+(swipeDir===\"a\" ? c.color+\"66\" : \"rgba(255,255,255,0.1)\"),\n                color: swipeDir===\"a\" ? c.color : \"rgba(255,255,255,0.55)\",\n                fontSize:13, fontFamily:FB, fontWeight:600, cursor:\"pointer\",\n                transition:\"all 0.2s\" }}>{c.option_a}</button>\n            <button onClick={function(e){ e.stopPropagation(); record(\"b\"); }}\n              style={{ flex:1, padding:\"12px 8px\", borderRadius:14,\n                background: swipeDir===\"b\" ? c.color+\"22\" : \"rgba(255,255,255,0.04)\",\n                border:\"1px solid \"+(swipeDir===\"b\" ? c.color+\"66\" : \"rgba(255,255,255,0.1)\"),\n                color: swipeDir===\"b\" ? c.color : \"rgba(255,255,255,0.55)\",\n                fontSize:13, fontFamily:FB, fontWeight:600, cursor:\"pointer\",\n                transition:\"all 0.2s\" }}>{c.option_b}</button>\n          </div>}\n          {!ans && <div style={{ fontSize:10, color:\"rgba(255,255,255,0.12)\", fontFamily:FB, letterSpacing:\"0.1em\", marginTop:10, textAlign:\"center\" }}>tap or swipe</div>}\n\n          {ans && <div style={{ animation: \"riseUp 0.4s ease\" }}>\n            <div style={{ fontSize: 16, fontFamily: FB, fontWeight: 600, color: c.color }}>{answers[ci] === \"a\" ? c.option_a : c.option_b}</div>\n          </div>}\n        </div>}\n\n        \n        {c.type === \"spectrum\" && <div style={{ borderRadius: 22, padding: \"32px 24px\", background: \"linear-gradient(160deg,\" + c.color + \"12,rgba(10,10,30,0.9),\" + c.color + \"08)\", border: \"1px solid \" + c.color + \"22\", position: \"relative\", overflow: \"hidden\" }}>\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, textAlign: \"center\", marginBottom: 24 }}>{c.prompt}</div>\n          <SpectrumSlider color={c.color} poleA={c.pole_a} poleB={c.pole_b} onSet={function(v){ record(v); }} value={answers[ci] !== undefined ? answers[ci] : null} />\n        </div>}\n      </div>\n\n      <div style={{ display: \"flex\", gap: 12, marginTop: 14, justifyContent: \"space-between\" }}>\n        {ci > 0 && <button onClick={function() { setCi(ci - 1); }} style={{ padding: \"8px 16px\", borderRadius: 20, border: \"1px solid rgba(255,255,255,0.06)\", background: \"transparent\", color: \"rgba(255,255,255,0.25)\", fontSize: 12, fontFamily: FB, cursor: \"pointer\" }}>\u2190</button>}\n        <div style={{ flex: 1 }} />\n        {ans && ci < DESCENT_CARDS.length - 1 && <button onClick={function() { setCi(ci + 1); }} style={{ padding: \"8px 20px\", borderRadius: 20, border: \"none\", background: c.color + \"22\", color: c.color + \"cc\", fontSize: 12, fontFamily: FB, fontWeight: 500, cursor: \"pointer\" }}>\u2192</button>}\n      </div>\n      </>}\n    </div>\n  );\n}\n\nfunction TappableSentence({ text, synthesisData, onReact }) {\n  var [state, setState] = useState(\"idle\"); \n  var [swipeX, setSwipeX] = useState(0);\n  var [swiping, setSwiping] = useState(false);\n  var swipeStart = useRef(0);\n  var holdTimer = useRef(null);\n  var holdStartT = useRef(0);\n  var [holdProg, setHoldProg] = useState(0);\n  \n  var [noteOpen, setNoteOpen] = React.useState(false);\n  var [noteDraft, setNoteDraft] = React.useState(\"\");\n  var [noteSaved, setNoteSaved] = React.useState(\"\");\n  var threshold = 60;\n\n  function onStart(clientX, e) {\n    if (state !== \"idle\") return;\n    e.stopPropagation();\n    setState(\"active\");\n    swipeStart.current = clientX;\n    setSwiping(true);\n    setSwipeX(0);\n    \n    holdStartT.current = Date.now();\n    holdTimer.current = setInterval(function() {\n      var p = Math.min((Date.now() - holdStartT.current) / 1200, 1);\n      setHoldProg(p);\n      if (p >= 1) { clearInterval(holdTimer.current); setState(\"held\"); setSwiping(false); setSwipeX(0); setHoldProg(0); if (onReact) onReact(text, \"held\"); }\n    }, 30);\n  }\n  function onMove(clientX) {\n    if (!swiping || state !== \"active\") return;\n    var dx = clientX - swipeStart.current;\n    setSwipeX(dx);\n    \n    if (Math.abs(dx) > 10 && holdTimer.current) { clearInterval(holdTimer.current); setHoldProg(0); }\n  }\n  function onEnd() {\n    if (holdTimer.current) clearInterval(holdTimer.current);\n    setHoldProg(0);\n    if (!swiping) return;\n    setSwiping(false);\n    if (state === \"held\") return;\n    if (swipeX < -threshold) { setState(\"landed\"); if (onReact) onReact(text, \"landed\"); }\n    else if (swipeX > threshold) { setState(\"resisted\"); if (onReact) onReact(text, \"resisted\"); }\n    else { setState(\"idle\"); } \n    setSwipeX(0);\n  }\n\n  var ratio = Math.min(Math.abs(swipeX) / threshold, 1);\n  var dir = swipeX < 0 ? \"land\" : swipeX > 0 ? \"resist\" : null;\n\n  if (state === \"idle\") {\n    return <span\n      onTouchStart={function(e) { onStart(e.touches[0].clientX, e); }}\n      onTouchMove={function(e) { onMove(e.touches[0].clientX); }}\n      onTouchEnd={onEnd}\n      onMouseDown={function(e) { onStart(e.clientX, e); }}\n      onMouseMove={function(e) { onMove(e.clientX); }}\n      onMouseUp={onEnd}\n      onMouseLeave={onEnd}\n      style={{ cursor: \"pointer\", color: \"inherit\", borderBottom: \"1px dotted rgba(214,178,109,0.15)\", paddingBottom: 1, transition: \"color 0.2s\" }}\n    >{text} </span>;\n  }\n\n  if (state === \"active\") {\n    return <span\n      onTouchMove={function(e) { onMove(e.touches[0].clientX); }}\n      onTouchEnd={onEnd}\n      onMouseMove={function(e) { onMove(e.clientX); }}\n      onMouseUp={onEnd}\n      onMouseLeave={onEnd}\n      style={{\n        display: \"inline-block\", cursor: \"grabbing\",\n        transform: \"translateX(\" + swipeX * 0.4 + \"px)\",\n        color: dir === \"land\" ? \"#7DB7AE\" : dir === \"resist\" ? \"#ff6090\" : holdProg > 0.3 ? \"#D6B26D\" : \"inherit\",\n        transition: swiping ? \"none\" : \"all 0.3s\",\n        background: holdProg > 0 ? \"rgba(214,178,109,\" + holdProg * 0.08 + \")\" : dir === \"land\" ? \"rgba(125,183,174,\" + ratio * 0.08 + \")\" : dir === \"resist\" ? \"rgba(255,96,144,\" + ratio * 0.08 + \")\" : \"transparent\",\n        borderRadius: 4, padding: \"0 2px\",\n      }}\n    >{text} {holdProg > 0.3 && <span style={{ fontSize: 9, color: \"#D6B26D88\", fontFamily: FB }}>holding...</span>}</span>;\n  }\n\n  \n\n  function saveNote() {\n    var n = noteDraft.trim();\n    if (n) {\n      setNoteSaved(n);\n      if (onReact) onReact(text, state, n);\n    }\n    setNoteOpen(false);\n    setNoteDraft(\"\");\n  }\n\n  var stateColor = state === \"landed\" ? \"#6BFFB8\"\n    : state === \"held\" ? \"#D6B26D\"\n    : state === \"resisted\" ? \"rgba(255,96,144,0.55)\" : \"inherit\";\n  var stateMark = state === \"landed\" ? \" \u2713\" : state === \"held\" ? \" \u25cf\" : state === \"resisted\" ? \" \u2715\" : \"\";\n  var stateLabel = state === \"landed\" ? \"resonates\" : state === \"held\" ? \"marked\" : state === \"resisted\" ? \"not quite\" : \"\";\n  var notePrompt = state === \"landed\" ? \"Add signal\"\n    : state === \"held\" ? \"Add signal\"\n    : \"Add signal \u2014 what's different?\";\n  var notePlaceholder = \"type anything \u2014 this won't be shown back to you\";\n\n  return (\n    <span style={{ display:\"inline\" }}>\n      <span style={{ color: stateColor, transition:\"color 0.3s\" }}>\n        {text}<span style={{ fontSize:9, fontFamily:FB, opacity:0.6, letterSpacing:\"0.05em\" }}>{stateMark}</span>{\" \"}\n      </span>\n      {!noteSaved && !noteOpen && (\n        <span onClick={function(e){e.stopPropagation(); setNoteOpen(true);}}\n          style={{ display:\"inline-block\", fontSize:10, color: stateColor, fontFamily:FB,\n            background:\"rgba(255,255,255,0.04)\", border:\"1px solid rgba(255,255,255,0.1)\",\n            borderRadius:10, padding:\"2px 10px\", cursor:\"pointer\", marginLeft:4,\n            letterSpacing:\"0.05em\", verticalAlign:\"middle\", opacity:0.75 }}>\n          + note\n        </span>\n      )}\n      {noteSaved && (\n        <span style={{ display:\"inline-block\", marginLeft:6, fontSize:10,\n          color:stateColor, fontFamily:FB, letterSpacing:\"0.08em\", opacity:0.7 }}>\n          incorporated\n        </span>\n      )}\n      {noteOpen && (\n        <span onClick={function(e){e.stopPropagation();}} style={{ display:\"block\", marginTop:8 }}>\n          <div style={{ fontSize:11, color:\"rgba(255,255,255,0.45)\", fontFamily:FB,\n            letterSpacing:\"0.08em\", marginBottom:6 }}>{notePrompt}</div>\n          <textarea value={noteDraft} onChange={function(e){setNoteDraft(e.target.value);}}\n            onKeyDown={function(e){ if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();saveNote();}\n              if(e.key===\"Escape\"){setNoteOpen(false);setNoteDraft(\"\");} }}\n            placeholder={notePlaceholder} autoFocus\n            style={{ width:\"100%\", minHeight:56, background:\"rgba(255,255,255,0.04)\",\n              border:\"1px solid \"+stateColor+\"44\", borderRadius:8,\n              color:\"rgba(255,255,255,0.88)\", fontFamily:FD, fontSize:14,\n              padding:\"9px 12px\", resize:\"none\", outline:\"none\", lineHeight:1.55,\n              boxSizing:\"border-box\" }} />\n          <div style={{ display:\"flex\", justifyContent:\"space-between\", marginTop:5 }}>\n            <button onClick={function(){setNoteOpen(false);setNoteDraft(\"\");}}\n              style={{ fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB,\n                background:\"transparent\", border:\"none\", cursor:\"pointer\" }}>cancel</button>\n            <button onClick={saveNote}\n              style={{ fontSize:11, color:stateColor, fontFamily:FB,\n                background:\"rgba(255,255,255,0.04)\", border:\"1px solid \"+stateColor+\"44\",\n                borderRadius:12, padding:\"4px 14px\", cursor:\"pointer\" }}>save note</button>\n          </div>\n        </span>\n      )}\n    </span>\n  );\n}\n\nfunction TappableReading({ text, synthesisData, onReact }) {\n  if (!text || text.trim().length === 0) return <span>{text}</span>;\n  var sentences = text.match(/[^.!?]+[.!?]+[\\u201D\\u201C\\u2019\\u2018\"']?\\s*/g);\n  if (!sentences || sentences.length === 0) {\n    return <TappableSentence text={text.trim()} synthesisData={synthesisData} onReact={onReact} />;\n  }\n  return <span>{sentences.map(function(s, i) {\n    return <TappableSentence key={i} text={s.trim()} synthesisData={synthesisData} onReact={onReact} />;\n  })}</span>;\n}\n\nfunction ClarityHoldInput({ value, onChange, onSave }) {\n  var [holdProg, setHoldProg] = useState(0);\n  var [holding, setHolding] = useState(false);\n  var holdRef = useRef(null);\n  var holdStartT = useRef(0);\n\n  function startHold(e) {\n    if (!value.trim()) return;\n    e.stopPropagation();\n    setHolding(true);\n    holdStartT.current = Date.now();\n    holdRef.current = setInterval(function() {\n      var p = Math.min((Date.now() - holdStartT.current) / 1200, 1);\n      setHoldProg(p);\n      if (p >= 1) { clearInterval(holdRef.current); setHolding(false); setHoldProg(0); onSave(); }\n    }, 30);\n  }\n  function endHold() {\n    if (holdRef.current) clearInterval(holdRef.current);\n    setHolding(false);\n    setHoldProg(0);\n  }\n\n  return <div>\n    <input type=\"text\" value={value} onChange={function(e) { onChange(e.target.value); }}\n      placeholder=\"Name it plainly\\u2026\" maxLength={140}\n      style={{ width: \"100%\", background: \"transparent\", border: \"none\", borderBottom: \"1px solid rgba(214,178,109,0.15)\", borderRadius: 0, color: \"rgba(255,255,255,0.9)\", padding: \"12px 0\", fontFamily: FB, fontSize: 16, outline: \"none\", letterSpacing: \"0.02em\" }} />\n    {value.trim() && <div style={{ marginTop: 16, position: \"relative\" }}>\n      <div\n        onMouseDown={startHold} onMouseUp={endHold} onMouseLeave={endHold}\n        onTouchStart={startHold} onTouchEnd={endHold}\n        style={{\n          padding: \"14px 24px\", borderRadius: 20, textAlign: \"center\", cursor: \"pointer\",\n          background: \"rgba(214,178,109,\" + (0.04 + holdProg * 0.12) + \")\",\n          border: \"1px solid rgba(214,178,109,\" + (0.15 + holdProg * 0.35) + \")\",\n          color: \"#D6B26D\", fontSize: 13, fontFamily: FB, userSelect: \"none\", WebkitUserSelect: \"none\",\n          transition: holding ? \"none\" : \"all 0.3s\",\n          transform: \"scale(\" + (1 + holdProg * 0.04) + \")\",\n        }}\n      >\n        {holding ? \"locking in\\u2026\" : \"hold to keep this\"}\n      </div>\n      <div style={{ position: \"absolute\", bottom: 0, left: 0, width: holdProg * 100 + \"%\", height: 2, borderRadius: 1, background: \"#D6B26D\", transition: holding ? \"none\" : \"width 0.2s ease\", opacity: 0.6 }} />\n    </div>}\n  </div>;\n}\n\nfunction SessionPhase({ onComplete, synthesisData, onPatchSynthesis }) {\n  const [descentOpen, setDescentOpen] = useState(false);\n  const [descentDone, setDescentDone] = useState(false);\n  const [descentResult, setDescentResult] = useState(null);\n  const [clarity, setClarity] = useState(\"\");\n  const [claritySaved, setClaritySaved] = useState(false);\n  const [showNoticing, setShowNoticing] = useState(false);\n  const scrollRef = useRef(null);\n\n  \n  \n  \n  const [reactions, setReactions] = useState({});\n  const [corrections, setCorrections] = useState({}); \n  \n  \n  const [signals, setSignals] = useState({ resisted_count:0, held_count:0, landed_count:0, counter_topics:[], shifted_tension:false });\n  const [revisedSynthesis, setRevisedSynthesis] = useState(null);\n  const [isRevising, setIsRevising] = useState(false);\n  const [signalStatus, setSignalStatus] = useState(null); \n\n  \n  function extractTopics(note) {\n    if (!note) return [];\n    \n    var stop = new Set([\"that\",\"this\",\"with\",\"have\",\"from\",\"they\",\"been\",\"were\",\"what\",\"when\",\"about\",\"just\",\"also\",\"into\",\"more\",\"some\",\"than\",\"them\",\"then\",\"very\",\"will\",\"your\",\"their\",\"which\",\"would\",\"could\",\"there\"]);\n    return note.toLowerCase().replace(/[^a-z\\s]/g,\"\").split(/\\s+/).filter(function(w){ return w.length >= 4 && !stop.has(w); }).slice(0,4);\n  }\n\n  \n  \n  \n  \n  function handleReact(sentenceOrId, reaction, note) {\n    setReactions(function(prev) { return Object.assign({}, prev, { [sentenceOrId]: reaction }); });\n    \n    setSignals(function(prev) {\n      var s = Object.assign({}, prev);\n      if (reaction === \"resisted\") s.resisted_count = (s.resisted_count||0) + 1;\n      if (reaction === \"held\") s.held_count = (s.held_count||0) + 1;\n      if (reaction === \"landed\") s.landed_count = (s.landed_count||0) + 1;\n      if (note) {\n        var topics = extractTopics(note);\n        s.counter_topics = Array.from(new Set((s.counter_topics||[]).concat(topics))).slice(0,10);\n        if (reaction === \"resisted\") s.shifted_tension = true;\n      }\n      return s;\n    });\n    \n    if (note && note.trim()) {\n      setCorrections(function(prev) { return Object.assign({}, prev, { [sentenceOrId]: note.trim() }); });\n    }\n    \n    if (reaction === \"resisted\" && note && note.trim()) {\n      fireRevision(note.trim(), sentenceOrId);\n    }\n  }\n\n  async function fireRevision(counterEvidence, originalSentence) {\n    setIsRevising(true);\n    setSignalStatus(\"recomputing\");\n    try {\n      var themes = (sd.themes||[]).map(function(t){return t.label;}).join(\", \");\n      var tension = sd.tension ? sd.tension.a + \" vs \" + sd.tension.b : \"none\";\n      var raw = await callClaude(\n        \"The user has pushed back on part of your reading. Their pushback is the truth \u2014 not counter-evidence to be managed, but correction to be honored.\\n\"\n        + \"RULE: The resisted sentence was YOUR interpretation. The user knows their experience better than you do.\\n\"\n        + \"RULE: Do not defend or reframe the original reading. Update it.\\n\"\n        + \"RULE: The new synthesis should INCORPORATE what they said, not find a clever way around it.\\n\"\n        + \"RULE: If they gave words, their words are the new truth for that area. Reflect them back.\\n\"\n        + \"Return ONLY JSON: {\\\"synthesis\\\": \\\"1-2 sentences that honor both the original patterns AND the user's correction\\\", \\\"new_connection\\\": \\\"one link that emerges from THEIR words (or null)\\\", \\\"tension_text\\\": \\\"...\\\"}\",\n        \"Original reading: \\\"\" + (sd.synthesis||\"\") + \"\\\"\\n\"\n        + \"Resisted sentence: \\\"\" + originalSentence + \"\\\"\\n\"\n        + \"Counter-evidence topics (do not quote): \" + extractTopics(counterEvidence).join(\", \") + \"\\n\"\n        + \"Themes: \" + themes + \"\\n\"\n        + \"Tension: \" + tension,\n        280\n      );\n      var d = parseJSON(raw);\n      if (d && d.synthesis) {\n        setRevisedSynthesis({ synthesis: d.synthesis, new_connection: d.new_connection||null, tension_text: d.tension_text||null });\n        setSignalStatus(d.new_connection ? \"new_connection\" : null);\n        if (onPatchSynthesis) {\n          var lp = { synthesis: d.synthesis };\n          if (d.tension_text) lp.tension = { text: d.tension_text };\n          onPatchSynthesis(lp);\n        }\n      }\n    } catch(e) { setSignalStatus(null); }\n    setIsRevising(false);\n  }\n\n  \n  function sectionResisted(sentencePrefix) {\n    return Object.keys(reactions).some(function(k) {\n      return k.startsWith(sentencePrefix) && reactions[k] === \"resisted\";\n    });\n  }\n  var saveClarity = function() {\n    if (clarity.trim()) {\n      setClaritySaved(true);\n      setTimeout(function() { setShowNoticing(true); }, 1200);\n    }\n  };\n\n  const sd = synthesisData || {};\n  var archData = sd.archetype || (sd.archetypes && sd.archetypes[0]) || null;\n  var sessions = []; try { sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\"); } catch(e) {}\n  var sessionNum = sessions.length + 1;\n  const THEMES = (sd.themes || []).map(function(t, i) { return { name: t.label, color: t.color || NC[i % NC.length], weight: Math.min((t.weight || 1) / 5, 1) }; });\n  const GUIDE_ITEMS = (sd.guide || []).map(function(g) { return { type: g.type || \"notice\", text: g.text || \"\" }; });\n  \n  const synthesis = sd.synthesis || null;\n  const underneath = sd.underneath || [];\n  var tension = sd.tension || null;\n  var opening = sd.opening || null;\n  var noticing = sd.noticing || null;\n  var mapTitle = sd.map_title || \"\";\n  var descentCards = (sd.descent_cards && sd.descent_cards.length > 0) ? sd.descent_cards : null;\n\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", overflow: \"auto\", WebkitOverflowScrolling: \"touch\" }} ref={scrollRef}>\n      <Particles color=\"rgba(214,178,109,0.15)\" count={8} />\n      <div style={{ maxWidth: 380, margin: \"0 auto\", padding: \"60px 20px 40px\", position: \"relative\", zIndex: 1 }}>\n\n        \n        <div style={{ marginBottom: archData ? 18 : 28, animation: \"riseUp 0.5s ease\" }}>\n          <div style={{ fontSize: 14, letterSpacing: \"0.2em\", textTransform: \"uppercase\", color: \"rgba(255,255,255,0.38)\", fontFamily: FB }}>\n            SESSION {sessionNum} \u00b7 {new Date().toLocaleDateString(\"en-US\", { month: \"long\", day: \"numeric\" }).toUpperCase()}\n          </div>\n        </div>\n\n        \n        {archData && <div style={{ marginBottom: 36, animation: \"riseUp 0.7s ease 0.05s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", color: \"rgba(232,67,147,0.75)\", fontFamily: FB, marginBottom: 10, textTransform: \"uppercase\" }}>your pattern</div>\n          <div style={{ fontSize: 34, color: \"white\", fontFamily: FB, fontWeight: 900, letterSpacing: \"0.01em\", lineHeight: 1.1, marginBottom: 8 }}>{archData.name}</div>\n          {archData.line && <div style={{ fontSize: 17, color: \"rgba(255,255,255,0.72)\", fontFamily: FD, lineHeight: 1.55 }}>{archData.line}</div>}\n        </div>}\n\n        \n        {THEMES.length > 0 && <div style={{ marginBottom: 32, animation: \"riseUp 0.5s ease 0.08s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#E84393\", marginBottom: 14, fontFamily: FB, textTransform: \"uppercase\", opacity: 0.75 }}>\n            {THEMES.length} forces\n          </div>\n          <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: 9 }}>\n            {THEMES.map(function(t, i) {\n              var sz = Math.round(11 + t.weight * 10);\n              var pad = t.weight > 0.7 ? \"11px 22px\" : \"8px 16px\";\n              return <div key={t.name} style={{ padding: pad, borderRadius: 24, background: t.color + \"18\", border: \"1px solid \" + t.color + \"40\", fontSize: sz, color: t.color, fontFamily: FB, fontWeight: 700, letterSpacing: \"0.04em\", animation: \"riseUp 0.5s ease \" + (i * 0.07) + \"s both\", lineHeight: 1 }}>{t.name}</div>;\n            })}\n          </div>\n        </div>}\n\n        \n        {synthesis && <div style={{ marginBottom: 32, animation: \"riseUp 0.6s ease 0.12s both\" }}>\n          <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", marginBottom: 14 }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#D6B26D\", fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>the reading</div>\n            {isRevising && <div style={{ fontSize:14, color:\"rgba(214,178,109,0.6)\", fontFamily:FB, letterSpacing:\"0.14em\", animation:\"pulse 1.5s ease infinite\" }}>recomputing...</div>}\n            {!isRevising && signalStatus === \"new_connection\" && <div style={{ fontSize:14, color:\"rgba(107,184,255,0.65)\", fontFamily:FB, letterSpacing:\"0.12em\" }}>new connection found \u2193</div>}\n            {!isRevising && signals.resisted_count > 0 && signalStatus !== \"new_connection\" && <div style={{ fontSize:14, color:\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>incorporated</div>}\n          </div>\n\n          {mapTitle && <div style={{ fontSize: 15, color: \"rgba(214,178,109,0.3)\", fontFamily: FD, marginBottom: 10 }}>{mapTitle}</div>}\n\n          {revisedSynthesis\n            ? <div style={{ animation: \"riseUp 0.6s ease\" }}>\n                <p style={{ fontSize: 20, color: \"rgba(255,255,255,0.9)\", fontFamily: FD, lineHeight: 1.75, margin: 0 }}>\n                  <TappableReading text={revisedSynthesis.synthesis} synthesisData={sd} onReact={handleReact} />\n                </p>\n                {revisedSynthesis.new_connection && <div style={{ marginTop:16, padding:\"12px 16px\", borderRadius:10,\n                  background:\"rgba(107,184,255,0.06)\", border:\"1px solid rgba(107,184,255,0.15)\", animation:\"riseUp 0.5s ease both\" }}>\n                  <div style={{ fontSize:14, color:\"rgba(107,184,255,0.6)\", fontFamily:FB, letterSpacing:\"0.2em\", textTransform:\"uppercase\", marginBottom:6 }}>new connection</div>\n                  <div style={{ fontSize:16, color:\"rgba(107,184,255,0.85)\", fontFamily:FD, lineHeight:1.6 }}>{revisedSynthesis.new_connection}</div>\n                </div>}\n              </div>\n            : <p style={{ fontSize: 20, color: \"rgba(255,255,255,0.88)\", fontFamily: FD, lineHeight: 1.75, margin: 0 }}>\n                <TappableReading text={synthesis} synthesisData={sd} onReact={handleReact} />\n              </p>\n          }\n        </div>}\n\n        \n        {underneath.length > 0 && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.2s both\" }}>\n          <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", marginBottom: 14 }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#B86BFF\", fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>what{\"'\"}s underneath</div>\n            <div style={{ fontSize: 14, color: \"rgba(183,107,255,0.38)\", fontFamily: FB, letterSpacing: \"0.05em\" }}>swipe right to push back</div>\n          </div>\n          {underneath.map(function(t, i) {\n            var uKey = \"underneath_\" + i;\n            var uReaction = reactions[uKey];\n            return <div key={i} style={{ padding: \"12px 14px 12px 20px\", borderRadius: 12,\n              background: uReaction === \"resisted\" ? \"rgba(255,96,144,0.03)\" : \"rgba(183,107,255,0.04)\",\n              border: \"1px solid \" + (uReaction === \"landed\" ? \"rgba(107,255,184,0.15)\" : uReaction === \"resisted\" ? \"rgba(255,96,144,0.12)\" : \"rgba(183,107,255,0.08)\"),\n              marginBottom: 8, position: \"relative\", animation: \"riseUp 0.5s ease \" + (0.3 + i * 0.1) + \"s both\", transition: \"all 0.3s\" }}>\n              <div style={{ position: \"absolute\", left: 10, top: 16, width: 3, height: 3, borderRadius: \"50%\",\n                background: uReaction === \"landed\" ? \"#6BFFB8\" : uReaction === \"resisted\" ? \"rgba(255,96,144,0.6)\" : \"#B86BFF\", opacity: 0.5 }} />\n              <p style={{ fontSize: 15, color: uReaction === \"resisted\" ? \"rgba(255,255,255,0.2)\" : \"rgba(255,255,255,0.55)\", fontFamily: FD, lineHeight: 1.65, margin: \"0 0 6px\" }}>\n                <TappableSentence text={t} onReact={function(_, r) { handleReact(uKey, r); }} />\n              </p>\n              {uReaction === \"landed\" && <div style={{ fontSize: 14, color: \"rgba(107,255,184,0.4)\", fontFamily: FB, letterSpacing: \"0.12em\" }}>\u2190 yes</div>}\n\n            </div>;\n          })}\n        </div>}\n\n        \n        {tension && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.3s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#FFB86B\", marginBottom: 14, fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>the tension</div>\n          <div style={{ display: \"flex\", alignItems: \"center\", gap: 10, marginBottom: tension.text ? 12 : 0 }}>\n            <div style={{ flex: 1, padding: \"14px 18px\", borderRadius: 12, background: \"rgba(255,184,107,0.07)\", border: \"1px solid rgba(255,184,107,0.18)\", textAlign: \"center\" }}>\n              <div style={{ fontSize: 19, color: \"#FFB86B\", fontFamily: FB, fontWeight: 900 }}>{tension.a}</div>\n            </div>\n            <div style={{ fontSize: 15, color: \"rgba(255,255,255,0.12)\", fontFamily: FB, flexShrink: 0 }}>\u2194</div>\n            <div style={{ flex: 1, padding: \"14px 18px\", borderRadius: 12, background: \"rgba(107,184,255,0.07)\", border: \"1px solid rgba(107,184,255,0.18)\", textAlign: \"center\" }}>\n              <div style={{ fontSize: 19, color: \"#6BB8FF\", fontFamily: FB, fontWeight: 900 }}>{tension.b}</div>\n            </div>\n          </div>\n          {(revisedSynthesis && revisedSynthesis.tension_text\n            ? <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.72)\", fontFamily: FD, lineHeight: 1.6, margin: \"0 0 4px\" }}>\n                {revisedSynthesis.tension_text}\n                <span style={{ fontSize: 9, color: \"rgba(255,96,144,0.4)\", fontFamily: FB, letterSpacing: \"0.2em\", marginLeft: 8 }}>revised</span>\n              </p>\n            : tension.text && <p style={{ fontSize: 15, color: reactions[\"tension\"] === \"resisted\" ? \"rgba(255,255,255,0.2)\" : \"rgba(255,255,255,0.62)\", fontFamily: FD, lineHeight: 1.6, margin: \"0 0 12px\" }}>{tension.text}</p>\n          )}\n          \n          {!reactions[\"tension\"] && <div style={{ display: \"flex\", gap: 8 }}>\n            <button onClick={function() { handleReact(\"tension\", \"landed\"); }} style={{ flex: 1, fontSize: 15, color: \"rgba(107,255,184,0.45)\", fontFamily: FB, background: \"rgba(107,255,184,0.04)\", border: \"1px solid rgba(107,255,184,0.1)\", borderRadius: 16, padding: \"8px 0\", cursor: \"pointer\", letterSpacing: \"0.06em\" }}>this lands \u2190</button>\n            <button onClick={function() { handleReact(\"tension\", \"resisted\"); }} style={{ flex: 1, fontSize: 15, color: \"rgba(255,96,144,0.45)\", fontFamily: FB, background: \"rgba(255,96,144,0.04)\", border: \"1px solid rgba(255,96,144,0.1)\", borderRadius: 16, padding: \"8px 0\", cursor: \"pointer\", letterSpacing: \"0.06em\" }}>\u2192 not right</button>\n          </div>}\n          {reactions[\"tension\"] === \"landed\" && <div style={{ fontSize: 14, color: \"rgba(107,255,184,0.4)\", fontFamily: FB, letterSpacing: \"0.15em\", animation: \"riseUp 0.3s ease\" }}>\u2190 noted</div>}\n          {reactions[\"tension\"] === \"resisted\" && <div style={{ fontSize:14, color:\"rgba(255,255,255,0.3)\", fontFamily:FB, letterSpacing:\"0.12em\", animation:\"riseUp 0.3s ease\" }}>signal incorporated</div>}\n        </div>}\n\n        \n        {opening && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.35s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#6BFFB8\", marginBottom: 14, fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>what{\"'\"}s opening</div>\n          <p style={{ fontSize: 19, color: \"rgba(107,255,184,0.88)\", fontFamily: FD, lineHeight: 1.65, margin: 0 }}>{opening}</p>\n        </div>}\n\n        \n        {GUIDE_ITEMS.length > 0 && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.4s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#7DB7AE\", marginBottom: 14, fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>your guide</div>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 10 }}>\n            {GUIDE_ITEMS.map(function(item, i) { return <GuideItem key={i} item={item} index={i} onPatchSynthesis={onPatchSynthesis} allGuide={sd.guide||[]} />; })}\n          </div>\n        </div>}\n\n        \n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\" }}>\n          {!descentOpen && !descentDone && (\n            <div onClick={function(){ setDescentOpen(true); }} style={{\n              display: \"flex\", alignItems: \"center\", justifyContent: \"center\", gap: 8,\n              fontFamily: FB, fontSize: 15, color: \"rgba(214,178,109,0.7)\", textAlign: \"center\",\n              cursor: \"pointer\", padding: \"18px 20px\", borderRadius: 14,\n              border: \"1px solid rgba(214,178,109,0.08)\", background: \"rgba(214,178,109,0.015)\",\n              transition: \"all 0.3s\", fontWeight: 600, letterSpacing: \"0.03em\",\n              animation: \"riseUp 0.5s ease 0.6s both\",\n            }}>\n              <span style={{ fontSize: 16 }}>\u25c6</span> See what's underneath\n            </div>\n          )}\n          {descentOpen && !descentDone && (\n            <div style={{ animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 14, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#D6B26D\", marginBottom: 8, fontFamily: FB, textAlign: \"center\" }}>THE DESCENT</div>\n              <DescentGame cards={descentCards} onDone={function(data) { setDescentResult(data); setDescentDone(true); }} />\n            </div>\n          )}\n          {descentDone && <div style={{ textAlign: \"center\", padding: \"20px 0\", animation: \"riseUp 0.5s ease\" }}>\n            <div style={{ fontSize: 15, color: \"rgba(214,178,109,0.5)\", fontFamily: FB, letterSpacing: \"0.2em\" }}>\u25c6 DESCENT COMPLETE \u25c6</div>\n            {descentResult && descentResult.cards && <div style={{ display: \"flex\", gap: 8, justifyContent: \"center\", marginTop: 12, flexWrap: \"wrap\" }}>\n              {descentResult.cards.map(function(card, i) {\n                var ans = descentResult.answers ? descentResult.answers[i] : null;\n                if (ans === null || ans === undefined) return null;\n                var display;\n                if (card.type === \"energy\" && typeof ans === \"number\") {\n                  var lvl2 = Math.max(0, Math.min(5, Math.round(ans)));\n                  display = \"\u25cf\".repeat(lvl2) + \"\u25cb\".repeat(5 - lvl2);\n                } else if (card.type === \"spectrum\" && typeof ans === \"number\") {\n                  display = Math.round(ans) + \"%\";\n                } else if (card.type === \"binary\") { display = String(ans); }\n                else { display = String(ans); }\n                return <div key={i} style={{ padding: \"6px 12px\", borderRadius: 16, background: (card.color || \"#D6B26D\") + \"15\", border: \"1px solid \" + (card.color || \"#D6B26D\") + \"30\", fontSize: 14, color: (card.color || \"#D6B26D\") + \"88\", fontFamily: FB, letterSpacing: \"0.08em\" }}>{display}</div>;\n              })}\n            </div>}\n          </div>}\n        </div>\n\n        \n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\" }}>\n          <div style={{ fontSize: 14, letterSpacing: \"0.3em\", fontWeight: 600, color: \"rgba(214,178,109,0.35)\", marginBottom: 14, fontFamily: FB }}>WHAT ARE YOU TAKING WITH YOU?</div>\n          {!claritySaved ? (\n            <ClarityHoldInput value={clarity} onChange={setClarity} onSave={saveClarity} />\n          ) : (\n            <div style={{ animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 16, color: \"#D6B26D\", fontFamily: FB, lineHeight: 1.55, letterSpacing: \"0.02em\" }}>{clarity}</div>\n              <div style={{ fontSize: 9, letterSpacing: \"0.25em\", textTransform: \"uppercase\", color: \"#7DB7AE\", marginTop: 8, opacity: 0.4 }}>SAVED</div>\n            </div>\n          )}\n        </div>\n\n        \n        {showNoticing && noticing && (\n          <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 1s ease\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.35em\", color: \"rgba(214,178,109,0.35)\", fontFamily: FB, marginBottom: 8, textTransform: \"uppercase\" }}>the system notices</div>\n            <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.38)\", fontFamily: FD, lineHeight: 1.7 }}>\n              \u2726 {noticing}\n            </div>\n          </div>\n        )}\n\n        \n        <button onClick={function(){ onComplete({ descent: descentResult, clarity: clarity, claritySaved: claritySaved, reactions: reactions, corrections: corrections, signals: signals, revisedSynthesis: revisedSynthesis }); }} style={{\n          width: \"100%\", background: claritySaved ? \"linear-gradient(135deg, #6BFFB8, #3DFFAA)\" : \"rgba(107,255,184,0.08)\",\n          border: claritySaved ? \"none\" : \"1px solid rgba(107,255,184,0.15)\",\n          borderRadius: 24, padding: \"14px 28px\",\n          color: claritySaved ? \"#0A2E1A\" : \"rgba(107,255,184,0.3)\",\n          fontSize: 15, fontFamily: FB, fontWeight: claritySaved ? 600 : 400,\n          cursor: \"pointer\", transition: \"all 0.4s\",\n        }}>\n          {claritySaved ? \"See Your Field \u2192\" : \"Continue to What's Growing \u2192\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction ChrysalisButterfly({ phase }) {\n  \n  var stg = phase || \"dissolving\";\n  var isEmerged = stg === \"emergence\";\n  var isDissolved = stg === \"dissolving\";\n  var isClustering = stg === \"clustering\";\n  \n  var cocoonRx = isDissolved ? 20 : isClustering ? 26 : isEmerged ? 30 : 18;\n  var cocoonRy = isDissolved ? 38 : isClustering ? 50 : isEmerged ? 54 : 34;\n  var glowStr = isDissolved ? 0.12 : isClustering ? 0.22 : isEmerged ? 0 : 0.06;\n  return (\n    <svg viewBox=\"0 0 280 240\" style={{ width:\"100%\", maxWidth:240 }}>\n      <defs>\n        <radialGradient id=\"cocoon2\">\n          <stop offset=\"0%\" stopColor={isClustering?\"#7B5BE0\":isDissolved?\"#6B5B4B\":\"#8B7B5B\"} />\n          <stop offset=\"100%\" stopColor={isClustering?\"#3B1A7A\":isDissolved?\"#3B2B25\":\"#5B4B35\"} />\n        </radialGradient>\n        <radialGradient id=\"cGlow\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n          <stop offset=\"0%\" stopColor=\"#9060E0\" stopOpacity={glowStr} />\n          <stop offset=\"100%\" stopColor=\"#9060E0\" stopOpacity=\"0\" />\n        </radialGradient>\n        <linearGradient id=\"wL2\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\"><stop offset=\"0%\" stopColor=\"#E8A0D4\" /><stop offset=\"50%\" stopColor=\"#C470E8\" /><stop offset=\"100%\" stopColor=\"#7744CC\" /></linearGradient>\n        <linearGradient id=\"wR2\" x1=\"1\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"0%\" stopColor=\"#E8A0D4\" /><stop offset=\"50%\" stopColor=\"#C470E8\" /><stop offset=\"100%\" stopColor=\"#7744CC\" /></linearGradient>\n      </defs>\n\n      {!isEmerged ? (\n        <g>\n          \n          <ellipse cx=\"140\" cy=\"120\" rx={60} ry={70} fill=\"url(#cGlow)\" />\n          \n          <path d=\"M 140 42 Q 143 55 138 68\" stroke=\"#A09070\" strokeWidth=\"2\" fill=\"none\" />\n          \n          <ellipse cx=\"138\" cy=\"115\" rx={cocoonRx} ry={cocoonRy} fill=\"url(#cocoon2)\" opacity=\"0.9\">\n            <animate attributeName=\"ry\" values={cocoonRy+\";\"+( cocoonRy+4)+\";\"+cocoonRy} dur=\"4s\" repeatCount=\"indefinite\" />\n          </ellipse>\n          \n          {[0,1,2,3].map(function(i) {\n            var cy = 92 + i*16;\n            return <path key={i} d={\"M \"+(138-cocoonRx*0.7)+\" \"+cy+\" Q 138 \"+(cy-5)+\" \"+(138+cocoonRx*0.7)+\" \"+cy}\n              stroke={isClustering?\"rgba(180,120,255,0.25)\":\"rgba(200,180,140,0.18)\"} strokeWidth=\"1\" fill=\"none\" />;\n          })}\n          \n          <ellipse cx=\"138\" cy=\"108\" rx={cocoonRx*0.4} ry={cocoonRy*0.3}\n            fill={isClustering?\"rgba(180,120,255,0.2)\":\"rgba(255,255,255,0.06)\"}>\n            <animate attributeName=\"opacity\" values=\"0.4;1;0.4\" dur={isClustering?\"1.8s\":\"3s\"} repeatCount=\"indefinite\" />\n          </ellipse>\n          \n          {isClustering && [[-30,10],[30,-15],[0,30],[-20,-20]].map(function(xy,i) {\n            return <circle key={i} cx={138+xy[0]} cy={115+xy[1]} r=\"2\"\n              fill=\"rgba(180,120,255,0.5)\" opacity=\"0.6\">\n              <animate attributeName=\"opacity\" values=\"0.2;0.8;0.2\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n            </circle>;\n          })}\n        </g>\n      ) : (\n        <g style={{ animation:\"riseUp 1.2s ease\" }}>\n          \n          <path d=\"M 140 118 Q 68 62 50 100 Q 30 138 66 168 Q 96 188 140 144\" fill=\"url(#wL2)\" opacity=\"0.88\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" values=\"-3 140 120;3 140 120;-3 140 120\" dur=\"2.4s\" repeatCount=\"indefinite\" />\n          </path>\n          <path d=\"M 140 118 Q 212 62 230 100 Q 250 138 214 168 Q 184 188 140 144\" fill=\"url(#wR2)\" opacity=\"0.88\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" values=\"3 140 120;-3 140 120;3 140 120\" dur=\"2.4s\" repeatCount=\"indefinite\" />\n          </path>\n          {[[96,116,9],[184,116,9],[78,140,6],[202,140,6]].map(function(spot,i) {\n            return <circle key={i} cx={spot[0]} cy={spot[1]} r={spot[2]} fill=\"rgba(255,255,255,0.22)\" />;\n          })}\n          <ellipse cx=\"140\" cy=\"130\" rx=\"3\" ry=\"16\" fill=\"#1A0A2A\" />\n          <path d=\"M 138 114 Q 124 94 118 88\" stroke=\"#1A0A2A\" strokeWidth=\"1.5\" fill=\"none\" />\n          <path d=\"M 142 114 Q 156 94 162 88\" stroke=\"#1A0A2A\" strokeWidth=\"1.5\" fill=\"none\" />\n          <circle cx=\"118\" cy=\"88\" r=\"2.5\" fill=\"#FFE060\" />\n          <circle cx=\"162\" cy=\"88\" r=\"2.5\" fill=\"#FFE060\" />\n        </g>\n      )}\n    </svg>\n  );\n}\n\nfunction TensionPull({ clicked }) {\n  return (\n    <svg viewBox=\"0 0 320 180\" style={{ width: \"100%\", maxWidth: 320 }}>\n      {[80,60,40].map((r,i) => (\n        <ellipse key={i} cx=\"160\" cy=\"90\" rx={clicked ? r+60 : r} ry={clicked ? r*0.45+10 : r*0.45}\n          fill=\"none\" stroke=\"url(#tf)\" strokeWidth=\"0.8\" opacity={0.15-i*0.04}\n          style={{ transition: \"all 0.8s ease\" }} />\n      ))}\n      <g style={{ transform: `translateX(${clicked ? -35 : 0}px)`, transition: \"transform 0.8s ease\" }}>\n        <circle cx=\"75\" cy=\"90\" r=\"28\" fill=\"url(#pL)\" />\n        <circle cx=\"75\" cy=\"90\" r=\"34\" fill=\"none\" stroke=\"#FF6B6B\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"34;40;34\" dur=\"2s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>\n      <g style={{ transform: `translateX(${clicked ? 35 : 0}px)`, transition: \"transform 0.8s ease\" }}>\n        <circle cx=\"245\" cy=\"90\" r=\"28\" fill=\"url(#pR)\" />\n        <circle cx=\"245\" cy=\"90\" r=\"34\" fill=\"none\" stroke=\"#6BC5FF\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"34;40;34\" dur=\"2.3s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>\n      {clicked && (\n        <g style={{ animation: \"riseUp 0.6s ease\" }}>\n          <circle cx=\"160\" cy=\"50\" r=\"22\" fill=\"url(#gG)\" />\n          <text x=\"160\" y=\"56\" textAnchor=\"middle\" fontSize=\"18\" fill=\"#FFD700\" fontFamily=\"serif\">\u2726</text>\n        </g>\n      )}\n      {clicked && [0,1,2].map(i => (\n        <line key={i} x1={120+i*20} y1={75+i*5} x2={135+i*18} y2={80+i*3}\n          stroke=\"#FFD700\" strokeWidth=\"1.5\" opacity=\"0.5\" fill=\"none\">\n          <animate attributeName=\"opacity\" values=\"0.3;0.7;0.3\" dur={`${0.6+i*0.2}s`} repeatCount=\"indefinite\" />\n        </line>\n      ))}\n      <defs>\n        <linearGradient id=\"tf\"><stop offset=\"0%\" stopColor=\"#FF6B6B\" /><stop offset=\"50%\" stopColor=\"#FFD700\" /><stop offset=\"100%\" stopColor=\"#6BC5FF\" /></linearGradient>\n        <radialGradient id=\"pL\"><stop offset=\"0%\" stopColor=\"#FF8888\" /><stop offset=\"100%\" stopColor=\"#CC3333\" /></radialGradient>\n        <radialGradient id=\"pR\"><stop offset=\"0%\" stopColor=\"#88CCFF\" /><stop offset=\"100%\" stopColor=\"#3388CC\" /></radialGradient>\n        <radialGradient id=\"gG\"><stop offset=\"0%\" stopColor=\"rgba(255,215,0,0.4)\" /><stop offset=\"100%\" stopColor=\"rgba(255,215,0,0)\" /></radialGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction SessionPortrait() {\n  const rings = [\n    { r: 100, color: \"#FF6B9D\", width: 4, dash: \"8 4\", speed: 60 },\n    { r: 78, color: \"#FFB86B\", width: 3, dash: \"12 8\", speed: 45 },\n    { r: 56, color: \"#6BFFB8\", width: 2.5, dash: \"4 12\", speed: 80 },\n    { r: 38, color: \"#B86BFF\", width: 2, dash: \"20 4\", speed: 35 },\n    { r: 22, color: \"#FFD700\", width: 6, dash: \"2 6\", speed: 50 },\n  ];\n  return (\n    <svg viewBox=\"0 0 260 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n      {rings.map((ring, i) => (\n        <circle key={i} cx=\"130\" cy=\"130\" r={ring.r} fill=\"none\"\n          stroke={ring.color} strokeWidth={ring.width}\n          strokeDasharray={ring.dash} strokeLinecap=\"round\" opacity=\"0.7\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\"\n            from={`0 130 130`} to={`${i%2===0?360:-360} 130 130`} dur={`${ring.speed}s`} repeatCount=\"indefinite\" />\n        </circle>\n      ))}\n      <circle cx=\"130\" cy=\"130\" r=\"6\" fill=\"white\" opacity=\"0.8\" />\n      <circle cx=\"130\" cy=\"130\" r=\"12\" fill=\"none\" stroke=\"white\" strokeWidth=\"0.5\" opacity=\"0.3\">\n        <animate attributeName=\"r\" values=\"12;18;12\" dur=\"3s\" repeatCount=\"indefinite\" />\n      </circle>\n    </svg>\n  );\n}\n\nfunction ThreadTimeline() {\n  const points = [\n    { s: 3, strength: 0.2 }, { s: 7, strength: 0.3 }, { s: 12, strength: 0.1 },\n    { s: 18, strength: 0.15 }, { s: 28, strength: 0.6 }, { s: 29, strength: 0.7 },\n    { s: 30, strength: 0.8 }, { s: 32, strength: 0.9 },\n  ];\n  const w = 300, h = 100;\n  return (\n    <svg viewBox={`0 0 ${w} ${h}`} style={{ width: \"100%\", maxWidth: 300 }}>\n      <line x1=\"0\" y1={h-10} x2={w} y2={h-10} stroke=\"rgba(255,255,255,0.06)\" strokeWidth=\"1\" />\n      <path d={points.map((p, i) => {\n        const x = (p.s / 32) * w; const y = h - 10 - (p.strength * (h - 20));\n        return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;\n      }).join(' ')} fill=\"none\" stroke=\"url(#threadG)\" strokeWidth=\"2.5\" strokeLinecap=\"round\" />\n      {points.map((p, i) => {\n        const x = (p.s / 32) * w; const y = h - 10 - (p.strength * (h - 20));\n        return <circle key={i} cx={x} cy={y} r={3 + p.strength * 4} fill=\"#FFB86B\" opacity={0.4 + p.strength * 0.6} />;\n      })}\n      <text x=\"0\" y={h} fontSize=\"10\" fill=\"rgba(255,255,255,0.3)\" fontFamily={FB}>1</text>\n      <text x={w-10} y={h} fontSize=\"10\" fill=\"#FFB86B\" fontFamily={FB}>32</text>\n      <defs>\n        <linearGradient id=\"threadG\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\">\n          <stop offset=\"0%\" stopColor=\"rgba(255,184,107,0.3)\" /><stop offset=\"100%\" stopColor=\"#FFB86B\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction SeedToTree({ morphed }) {\n  return (\n    <svg viewBox=\"0 0 280 300\" style={{ width: \"100%\", maxWidth: 260 }}>\n      <ellipse cx=\"140\" cy=\"260\" rx={morphed ? 100 : 40} ry=\"8\" fill=\"rgba(107,255,184,0.1)\" style={{ transition: \"all 1.2s ease\" }} />\n      {!morphed ? (\n        <g>\n          <ellipse cx=\"140\" cy=\"240\" rx=\"14\" ry=\"10\" fill=\"#8B7B5B\" />\n          <ellipse cx=\"140\" cy=\"238\" rx=\"10\" ry=\"6\" fill=\"#A09070\" opacity=\"0.5\" />\n          <path d=\"M 140 230 Q 140 222 142 218\" stroke=\"#6BFFB8\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n          <ellipse cx=\"140\" cy=\"240\" rx=\"24\" ry=\"18\" fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"0.5\" opacity=\"0.2\">\n            <animate attributeName=\"rx\" values=\"24;30;24\" dur=\"3s\" repeatCount=\"indefinite\" />\n          </ellipse>\n        </g>\n      ) : (\n        <g style={{ animation: \"riseUp 1.2s ease\" }}>\n          <path d=\"M 140 258 Q 138 200 140 140\" stroke=\"#6B8B5B\" strokeWidth=\"5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 180 Q 110 160 90 150\" stroke=\"#6B8B5B\" strokeWidth=\"3\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 180 Q 170 155 195 148\" stroke=\"#6B8B5B\" strokeWidth=\"3\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 155 Q 120 135 100 128\" stroke=\"#6B8B5B\" strokeWidth=\"2.5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 155 Q 165 130 180 125\" stroke=\"#6B8B5B\" strokeWidth=\"2.5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 140 Q 130 120 125 108\" stroke=\"#6B8B5B\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 140 Q 155 118 162 108\" stroke=\"#6B8B5B\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n          {[[90,145,22],[195,143,20],[100,122,18],[180,120,18],[125,102,16],[162,102,16],[140,90,20]].map(([cx,cy,r],i) => (\n            <circle key={i} cx={cx} cy={cy} r={r} fill={`rgba(107,255,184,${0.12+i*0.02})`}>\n              <animate attributeName=\"r\" values={`${r};${r+2};${r}`} dur={`${2.5+i*0.3}s`} repeatCount=\"indefinite\" />\n            </circle>\n          ))}\n          {[[95,140],[188,138],[105,118],[175,116],[130,98],[155,98],[140,85]].map(([x,y],i) => (\n            <circle key={i} cx={x} cy={y} r=\"2\" fill=\"#6BFFB8\" opacity=\"0.6\">\n              <animate attributeName=\"opacity\" values=\"0.3;0.8;0.3\" dur={`${1.5+i*0.4}s`} repeatCount=\"indefinite\" />\n            </circle>\n          ))}\n          <path d=\"M 136 258 Q 120 268 105 272\" stroke=\"#5B7B4B\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n          <path d=\"M 144 258 Q 160 268 175 272\" stroke=\"#5B7B4B\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n        </g>\n      )}\n    </svg>\n  );\n}\n\nfunction SunriseViz() {\n  return (\n    <svg viewBox=\"0 0 320 200\" style={{ width: \"100%\", maxWidth: 320 }}>\n      <rect x=\"0\" y=\"0\" width=\"320\" height=\"200\" fill=\"url(#sky)\" rx=\"8\" />\n      <circle cx=\"160\" cy=\"110\" r=\"35\" fill=\"url(#sun)\">\n        <animate attributeName=\"cy\" values=\"110;95;110\" dur=\"6s\" repeatCount=\"indefinite\" />\n      </circle>\n      {[0,30,60,90,120,150,180,210,240,270,300,330].map((angle, i) => {\n        const rad = (angle * Math.PI) / 180;\n        const x1 = 160 + 42 * Math.cos(rad), y1 = 105 + 42 * Math.sin(rad);\n        const x2 = 160 + (55 + i%3*8) * Math.cos(rad), y2 = 105 + (55 + i%3*8) * Math.sin(rad);\n        return <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke=\"#FFD700\" strokeWidth=\"1.5\" opacity=\"0.3\" strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values=\"0.15;0.4;0.15\" dur={`${2+i*0.2}s`} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <line x1=\"0\" y1=\"145\" x2=\"320\" y2=\"145\" stroke=\"rgba(255,215,0,0.2)\" strokeWidth=\"1\" />\n      <ellipse cx=\"160\" cy=\"170\" rx=\"60\" ry=\"8\" fill=\"rgba(255,215,0,0.08)\" />\n      <defs>\n        <linearGradient id=\"sky\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n          <stop offset=\"0%\" stopColor=\"rgba(30,20,60,0.8)\" /><stop offset=\"50%\" stopColor=\"rgba(80,40,20,0.4)\" /><stop offset=\"100%\" stopColor=\"rgba(255,180,80,0.15)\" />\n        </linearGradient>\n        <radialGradient id=\"sun\"><stop offset=\"0%\" stopColor=\"#FFE44D\" /><stop offset=\"60%\" stopColor=\"#FFB830\" /><stop offset=\"100%\" stopColor=\"#FF8800\" /></radialGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction ArchSisyphus({ morphed, color }) {\n  var c = color || \"#FFB86B\";\n  return <svg viewBox=\"0 0 280 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs>\n      <radialGradient id=\"bld\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.5\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.15\" /></radialGradient>\n      <linearGradient id=\"hill\" x1=\"0\" y1=\"1\" x2=\"1\" y2=\"0\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.05\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.15\" /></linearGradient>\n    </defs>\n    <path d=\"M 20 240 Q 140 60 260 240\" fill=\"url(#hill)\" stroke={c} strokeWidth=\"1\" opacity=\"0.3\" />\n    {!morphed ? (<g>\n      <circle cx=\"100\" cy=\"195\" r=\"30\" fill=\"url(#bld)\" stroke={c} strokeWidth=\"2\" opacity=\"0.7\">\n        <animate attributeName=\"cx\" values=\"100;105;100\" dur=\"2s\" repeatCount=\"indefinite\" />\n      </circle>\n      <line x1=\"100\" y1=\"210\" x2=\"85\" y2=\"230\" stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.4\" />\n      <line x1=\"100\" y1=\"210\" x2=\"115\" y2=\"232\" stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.4\" />\n      <circle cx=\"100\" cy=\"200\" r=\"7\" fill={c} opacity=\"0.2\" />\n      {[0,1,2].map(function(i) { return <circle key={i} cx={100} cy={195} r={38+i*8} fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity={0.08}>\n        <animate attributeName=\"r\" values={(38+i*8)+\";\"+(42+i*8)+\";\"+(38+i*8)} dur={(3+i)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      <circle cx=\"140\" cy=\"80\" r=\"30\" fill=\"url(#bld)\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.9\">\n        <animate attributeName=\"cy\" values=\"80;75;80\" dur=\"3s\" repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"140\" cy=\"80\" r=\"12\" fill={c} opacity=\"0.15\"><animate attributeName=\"r\" values=\"12;18;12\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      {[0,1,2,3,4,5].map(function(i) {\n        var a = i * 60 * Math.PI / 180; var x = 140 + Math.cos(a) * 45; var y = 80 + Math.sin(a) * 45;\n        return <circle key={i} cx={x} cy={y} r=\"3\" fill={c} opacity=\"0.5\">\n          <animate attributeName=\"opacity\" values=\"0.2;0.7;0.2\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <text x=\"140\" y=\"250\" textAnchor=\"middle\" fontSize=\"11\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.5\" letterSpacing=\"0.15em\">IT REACHED THE TOP</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchMagician({ morphed, color }) {\n  var c = color || \"#B86BFF\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><radialGradient id=\"mglow\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.4\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient></defs>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"140\" r=\"40\" fill=\"url(#mglow)\" opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"5\" fill={c} opacity=\"0.4\"><animate attributeName=\"r\" values=\"4;7;4\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,72,144,216,288].map(function(a,i) {\n        var rad = a * Math.PI / 180; var x = 140 + Math.cos(rad) * 55; var y = 140 + Math.sin(rad) * 55;\n        return <circle key={i} cx={x} cy={y} r=\"3\" fill={c} opacity=\"0.25\">\n          <animate attributeName=\"opacity\" values=\"0.1;0.4;0.1\" dur={(2+i*0.4)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <circle cx=\"140\" cy=\"140\" r=\"55\" fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity=\"0.1\" strokeDasharray=\"4 8\" />\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <circle cx=\"140\" cy=\"130\" r=\"65\" fill=\"url(#mglow)\"><animate attributeName=\"r\" values=\"60;70;60\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,45,90,135,180,225,270,315].map(function(a,i) {\n        var rad = a * Math.PI / 180; var r1 = 30; var r2 = 70;\n        return <line key={i} x1={140+Math.cos(rad)*r1} y1={130+Math.sin(rad)*r1} x2={140+Math.cos(rad)*r2} y2={130+Math.sin(rad)*r2}\n          stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.6\">\n          <animate attributeName=\"opacity\" values=\"0.3;0.8;0.3\" dur={(1.2+i*0.2)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      {[0,60,120,180,240,300].map(function(a,i) {\n        var rad = a * Math.PI / 180; var x = 140 + Math.cos(rad) * 50; var y = 130 + Math.sin(rad) * 50;\n        return <circle key={\"o\"+i} cx={x} cy={y} r=\"6\" fill={c} opacity=\"0.6\">\n          <animate attributeName=\"r\" values=\"4;8;4\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n          <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 140 130\" to=\"360 140 130\" dur=\"20s\" repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <circle cx=\"140\" cy=\"130\" r=\"12\" fill={c} opacity=\"0.7\"><animate attributeName=\"r\" values=\"10;15;10\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchThreshold({ morphed, color }) {\n  var c = color || \"#FFD700\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      <rect x=\"90\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.2\" />\n      <rect x=\"178\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.2\" />\n      <path d=\"M 96 46 Q 140 22 184 46\" fill=\"none\" stroke={c} strokeWidth=\"1.5\" opacity=\"0.2\" />\n      <rect x=\"102\" y=\"46\" width=\"76\" height=\"184\" rx=\"2\" fill={c} opacity=\"0.03\" stroke={c} strokeWidth=\"0.5\" strokeOpacity=\"0.08\" />\n      <circle cx=\"170\" cy=\"140\" r=\"4\" fill={c} opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"3\" fill={c} opacity=\"0.15\"><animate attributeName=\"opacity\" values=\"0.1;0.3;0.1\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <rect x=\"70\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.3\" />\n      <rect x=\"198\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.3\" />\n      <path d=\"M 76 46 Q 140 22 204 46\" fill=\"none\" stroke={c} strokeWidth=\"2\" opacity=\"0.4\" />\n      <rect x=\"82\" y=\"46\" width=\"116\" height=\"184\" rx=\"2\" fill={c} opacity=\"0.06\" />\n      {[0,1,2,3,4,5,6].map(function(i) {\n        return <line key={i} x1=\"140\" y1={60+i*22} x2={140+(i%2===0?-1:1)*((i+1)*6)} y2={55+i*22} stroke={c} strokeWidth=\"1.5\" opacity={0.15+i*0.06} strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values={(0.1+i*0.05)+\";\"+(0.4+i*0.05)+\";\"+(0.1+i*0.05)} dur={(1+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <circle cx=\"140\" cy=\"140\" r=\"20\" fill={c} opacity=\"0.08\"><animate attributeName=\"r\" values=\"18;25;18\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.6\"><animate attributeName=\"opacity\" values=\"0.4;0.9;0.4\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <text x=\"140\" y=\"260\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">THE DOOR IS OPEN</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchTower({ morphed, color }) {\n  var c = color || \"#E84393\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><linearGradient id=\"twr\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.3\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.05\" /></linearGradient></defs>\n    {!morphed ? (<g>\n      <rect x=\"115\" y=\"40\" width=\"50\" height=\"180\" rx=\"4\" fill=\"url(#twr)\" stroke={c} strokeWidth=\"1\" opacity=\"0.6\" />\n      {[0,1,2,3,4,5].map(function(i) { return <line key={i} x1=\"120\" y1={55+i*28} x2=\"160\" y2={55+i*28} stroke={c} strokeWidth=\"0.7\" opacity=\"0.15\" />; })}\n      <line x1=\"130\" y1=\"38\" x2=\"150\" y2=\"38\" stroke={c} strokeWidth=\"2\" opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.15\"><animate attributeName=\"opacity\" values=\"0.1;0.25;0.1\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 0.6s ease\" }}>\n      <rect x=\"115\" y=\"40\" width=\"50\" height=\"180\" rx=\"4\" fill=\"url(#twr)\" opacity=\"0.2\" />\n      {[0,1,2,3,4,5,6,7].map(function(i) {\n        var x = 110 + Math.random() * 60; var y = 50 + i * 22; var rot = -30 + Math.random() * 60; var dx = (Math.random()-0.5)*40;\n        return <rect key={\"f\"+i} x={x} y={y} width={6+Math.random()*8} height={4+Math.random()*6} rx=\"1\" fill={c} opacity=\"0.25\"\n          transform={\"rotate(\"+rot+\" \"+x+\" \"+y+\")\"}>\n          <animate attributeName=\"x\" values={x+\";\"+String(x+dx)+\";\"+(x+dx*1.5)} dur={(2+i*0.3)+\"s\"} fill=\"freeze\" />\n          <animate attributeName=\"opacity\" values=\"0.3;0.15;0.05\" dur={(2+i*0.3)+\"s\"} fill=\"freeze\" />\n        </rect>;\n      })}\n      {[0,1,2].map(function(i) { return <circle key={\"sp\"+i} cx={120+i*20} cy={230-i*10} r=\"3\" fill={c} opacity=\"0.4\">\n        <animate attributeName=\"cy\" values={(230-i*10)+\";\"+(240-i*10)+\";\"+(230-i*10)} dur={(2+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <line x1=\"115\" y1=\"220\" x2=\"165\" y2=\"220\" stroke={c} strokeWidth=\"1\" opacity=\"0.2\" />\n      <circle cx=\"140\" cy=\"240\" r=\"8\" fill={c} opacity=\"0.2\"><animate attributeName=\"r\" values=\"6;12;6\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"240\" r=\"3\" fill={c} opacity=\"0.6\"><animate attributeName=\"opacity\" values=\"0.4;0.8;0.4\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <text x=\"140\" y=\"270\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">WHAT REMAINS IS REAL</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchDescent({ morphed, color }) {\n  var c = color || \"#6BB8FF\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><radialGradient id=\"cave\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.02\" /><stop offset=\"80%\" stopColor={c} stopOpacity=\"0.08\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient></defs>\n    <path d=\"M 60 80 Q 70 180 140 230 Q 210 180 220 80\" fill=\"url(#cave)\" stroke={c} strokeWidth=\"1\" opacity=\"0.15\" />\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"50\" r=\"6\" fill={c} opacity=\"0.5\" />\n      <circle cx=\"140\" cy=\"50\" r=\"12\" fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity=\"0.2\" />\n      {[0,1,2].map(function(i) { return <circle key={i} cx={140} cy={80+i*35} r=\"2\" fill={c} opacity={0.3-i*0.08}>\n        <animate attributeName=\"opacity\" values={(0.15-i*0.04)+\";\"+(0.35-i*0.04)+\";\"+(0.15-i*0.04)} dur={(2+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <text x=\"140\" y=\"270\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.25\" letterSpacing=\"0.15em\">GOING DOWN</text>\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      {[0,1,2,3,4].map(function(i) { return <circle key={i} cx={140} cy={60+i*35} r=\"2\" fill={c} opacity={0.1+i*0.05}>\n        <animate attributeName=\"opacity\" values={(0.05+i*0.03)+\";\"+(0.2+i*0.05)+\";\"+(0.05+i*0.03)} dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <circle cx=\"140\" cy=\"210\" r=\"25\" fill={c} opacity=\"0.06\"><animate attributeName=\"r\" values=\"22;30;22\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"210\" r=\"10\" fill={c} opacity=\"0.15\"><animate attributeName=\"r\" values=\"8;14;8\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"210\" r=\"4\" fill={c} opacity=\"0.7\"><animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,1,2,3,4,5].map(function(i) {\n        var a = i * 60 * Math.PI / 180; return <line key={\"r\"+i} x1={140+Math.cos(a)*15} y1={210+Math.sin(a)*15} x2={140+Math.cos(a)*35} y2={210+Math.sin(a)*35}\n          stroke={c} strokeWidth=\"1\" opacity=\"0.2\" strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values=\"0.1;0.35;0.1\" dur={(1.8+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <text x=\"140\" y=\"268\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.5\" letterSpacing=\"0.15em\">FOUND SOMETHING</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchWeaver({ morphed, color }) {\n  var c = color || \"#7DB7AE\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      {[0,1,2,3,4,5].map(function(i) {\n        var y = 50 + i * 35;\n        return <path key={i} d={\"M 50 \"+y+\" Q \"+(100+(i%2===0?-20:20))+\" \"+(y+15)+\" 140 \"+y+\" Q \"+(180+(i%2===0?20:-20))+\" \"+(y+15)+\" 230 \"+y}\n          fill=\"none\" stroke={c} strokeWidth=\"1\" opacity=\"0.15\" strokeLinecap=\"round\" />;\n      })}\n      {[0,1,2].map(function(i) { return <circle key={i} cx={90+i*50} cy={100+i*25} r=\"2\" fill={c} opacity=\"0.2\" />; })}\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      {[0,1,2,3,4,5,6].map(function(i) {\n        var y = 40 + i * 30;\n        return <path key={i} d={\"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y}\n          fill=\"none\" stroke={c} strokeWidth={1.5+i*0.15} opacity={0.15+i*0.06} strokeLinecap=\"round\">\n          <animate attributeName=\"d\" values={\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y+\";\"+\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-20:20))+\" \"+(y+(i%2===0?-16:16))+\" 140 \"+(y+2)+\" Q \"+(185+(i%2===0?20:-20))+\" \"+(y+(i%2===0?16:-16))+\" 230 \"+y+\";\"+\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y\n          } dur={(4+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n        </path>;\n      })}\n      {[0,1,2,3,4].map(function(i) {\n        return <circle key={\"kn\"+i} cx={70+i*40} cy={60+i*35+(i%2===0?0:15)} r={3+i*0.5} fill={c} opacity={0.3+i*0.08}>\n          <animate attributeName=\"opacity\" values={(0.2+i*0.05)+\";\"+(0.6+i*0.05)+\";\"+(0.2+i*0.05)} dur={(1.5+i*0.4)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <text x=\"140\" y=\"268\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">THE PATTERN HOLDS</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchPlanets({ morphed, color }) {\n  var c = color || \"#FFD700\";\n  var orbits = [{r:35,s:8,d:10,col:c},{r:60,s:5,d:16,col:\"#6BB8FF\"},{r:85,s:6,d:24,col:\"#FF6B9D\"},{r:110,s:4,d:35,col:\"#6BFFB8\"}];\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.3\" />\n      {orbits.map(function(o,i) { return <g key={i}>\n        <circle cx=\"140\" cy=\"140\" r={o.r} fill=\"none\" stroke={o.col} strokeWidth=\"0.5\" opacity=\"0.08\" strokeDasharray=\"4 8\" />\n        <circle cx={140+o.r} cy=\"140\" r={o.s*0.6} fill={o.col} opacity=\"0.2\" />\n      </g>; })}\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <circle cx=\"140\" cy=\"140\" r=\"10\" fill={c} opacity=\"0.6\"><animate attributeName=\"r\" values=\"8;12;8\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"140\" r=\"20\" fill={c} opacity=\"0.08\"><animate attributeName=\"r\" values=\"18;25;18\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      {orbits.map(function(o,i) { return <g key={i}>\n        <circle cx=\"140\" cy=\"140\" r={o.r} fill=\"none\" stroke={o.col} strokeWidth=\"0.8\" opacity=\"0.15\" />\n        <circle cx={140+o.r} cy=\"140\" r={o.s} fill={o.col} opacity=\"0.6\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 140 140\" to=\"360 140 140\" dur={o.d+\"s\"} repeatCount=\"indefinite\" />\n          <animate attributeName=\"r\" values={o.s+\";\"+(o.s+2)+\";\"+o.s} dur=\"2s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>; })}\n    </g>)}\n  </svg>;\n}\n\nfunction ArchPhoenix({ morphed, color }) {\n  var c = color || \"#E84393\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs>\n      <radialGradient id=\"pfire\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.4\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient>\n      <linearGradient id=\"pfeath\" x1=\"0\" y1=\"1\" x2=\"0\" y2=\"0\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.1\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.5\" /></linearGradient>\n    </defs>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"210\" r=\"25\" fill=\"url(#pfire)\" opacity=\"0.3\" />\n      {[0,1,2,3,4].map(function(i) { var x = 120 + i * 10; return <line key={i} x1={x} y1=\"210\" x2={x} y2={200-i*2} stroke={c} strokeWidth=\"1\" opacity={0.1+i*0.03}>\n        <animate attributeName=\"y2\" values={(200-i*2)+\";\"+(195-i*3)+\";\"+(200-i*2)} dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </line>; })}\n      <circle cx=\"140\" cy=\"210\" r=\"8\" fill={c} opacity=\"0.15\" />\n      <circle cx=\"140\" cy=\"210\" r=\"3\" fill={c} opacity=\"0.3\"><animate attributeName=\"opacity\" values=\"0.2;0.5;0.2\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      <circle cx=\"140\" cy=\"180\" r=\"45\" fill=\"url(#pfire)\"><animate attributeName=\"r\" values=\"40;50;40\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <path d=\"M 140 170 Q 80 120 60 80\" fill=\"none\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.6\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 140 170 Q 80 120 60 80;M 140 160 Q 75 105 50 60;M 140 170 Q 80 120 60 80\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      <path d=\"M 140 170 Q 200 120 220 80\" fill=\"none\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.6\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 140 170 Q 200 120 220 80;M 140 160 Q 205 105 230 60;M 140 170 Q 200 120 220 80\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      <path d=\"M 110 130 Q 125 80 140 50 Q 155 80 170 130\" fill=\"url(#pfeath)\" stroke={c} strokeWidth=\"1.5\" opacity=\"0.7\">\n        <animate attributeName=\"d\" values=\"M 110 130 Q 125 80 140 50 Q 155 80 170 130;M 105 125 Q 122 70 140 40 Q 158 70 175 125;M 110 130 Q 125 80 140 50 Q 155 80 170 130\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      {[0,1,2,3].map(function(i) { var x = 125+i*10; return <circle key={i} cx={x} cy={100+i*15} r={2+i} fill={c} opacity={0.3+i*0.1}>\n        <animate attributeName=\"opacity\" values={(0.2+i*0.1)+\";\"+(0.6+i*0.1)+\";\"+(0.2+i*0.1)} dur={(1+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <circle cx=\"140\" cy=\"65\" r=\"6\" fill={c} opacity=\"0.8\"><animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.2s\" repeatCount=\"indefinite\" /></circle>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchetypeGlyph({ name, sourceNodes, energy, morphed, size }) {\n  var sz = size || 260;\n  var cx = sz / 2, cy = sz / 2;\n\n  \n  var hash = 0;\n  var nm = (name || \"pattern\").toLowerCase();\n  for (var i = 0; i < nm.length; i++) { hash = ((hash << 5) - hash) + nm.charCodeAt(i); hash = hash & hash; }\n  hash = Math.abs(hash);\n\n  \n  var sides = 3 + (hash % 5); \n  var layers = 2 + (hash % 3); \n  var baseRotation = (hash % 60) - 30; \n  var pulseSpeed = 4 + (hash % 3);\n\n  \n  var palette = [\"#E84393\",\"#6BFFB8\",\"#B86BFF\",\"#6BB8FF\",\"#ff6090\",\"#FFB86B\",\"#50c0ff\",\"#f0c860\",\"#c070f0\",\"#4ae88a\"];\n  var c1 = palette[hash % palette.length];\n  var c2 = palette[(hash + 3) % palette.length];\n  var c3 = palette[(hash + 7) % palette.length];\n\n  \n  var energyMap = { heavy: 8, electric: 1.5, shattered: 2, still: 10, quiet: 7, warm: 5, grounded: 6, restless: 2, tender: 6, fierce: 1.8 };\n  var animSpeed = energyMap[energy] || pulseSpeed;\n\n  \n  var rings = [];\n  for (var L = 0; L < layers; L++) {\n    var r = 30 + L * 28;\n    var pts = [];\n    var n = sides + L; \n    for (var p = 0; p < n; p++) {\n      var angle = (p / n) * Math.PI * 2 + (baseRotation * Math.PI / 180) + (L * 0.2);\n      pts.push({ x: cx + Math.cos(angle) * r, y: cy + Math.sin(angle) * r, angle: angle });\n    }\n    rings.push({ r: r, points: pts, color: L === 0 ? c1 : L === 1 ? c2 : c3 });\n  }\n\n  \n  var nodePositions = (sourceNodes || []).slice(0, sides).map(function(label, i) {\n    var angle = (i / Math.max(sides, 1)) * Math.PI * 2 + (baseRotation * Math.PI / 180);\n    var r = 30 + (layers - 1) * 28 + 22;\n    return { label: label, x: cx + Math.cos(angle) * r, y: cy + Math.sin(angle) * r };\n  });\n\n  var uid = \"g\" + hash;\n\n  return (\n    <svg viewBox={\"0 0 \" + sz + \" \" + sz} style={{ width: \"100%\", maxWidth: sz }}>\n      <defs>\n        <radialGradient id={uid + \"glow\"}>\n          <stop offset=\"0%\" stopColor={c1} stopOpacity={morphed ? \"0.35\" : \"0.2\"} />\n          <stop offset=\"100%\" stopColor={c1} stopOpacity=\"0\" />\n        </radialGradient>\n        <filter id={uid + \"blur\"}><feGaussianBlur stdDeviation=\"3\" /></filter>\n      </defs>\n\n      \n      <circle cx={cx} cy={cy} r={morphed ? 90 : 65} fill={\"url(#\" + uid + \"glow)\"}>\n        <animate attributeName=\"r\" values={(morphed ? \"85;95;85\" : \"60;70;60\")} dur={animSpeed + \"s\"} repeatCount=\"indefinite\" />\n      </circle>\n\n      \n      {rings.map(function(ring, ri) {\n        return <g key={ri}>\n          \n          <circle cx={cx} cy={cy} r={ring.r} fill=\"none\" stroke={ring.color} strokeWidth={ri === 0 ? \"1.5\" : \"0.5\"} opacity={morphed ? 0.25 : 0.1} strokeDasharray={ri > 0 ? \"3 6\" : \"none\"}>\n            <animate attributeName=\"r\" values={(ring.r - 2) + \";\" + (ring.r + 2) + \";\" + (ring.r - 2)} dur={(animSpeed + ri) + \"s\"} repeatCount=\"indefinite\" />\n          </circle>\n\n          \n          {ring.points.map(function(pt, pi) {\n            var dotSize = ri === 0 ? 4 : 2.5;\n            return <circle key={pi} cx={pt.x} cy={pt.y} r={dotSize} fill={ring.color} opacity={morphed ? 0.7 : 0.35}>\n              <animate attributeName=\"opacity\" values={(morphed ? \"0.5;0.9;0.5\" : \"0.2;0.5;0.2\")} dur={(animSpeed * 0.7 + pi * 0.3) + \"s\"} repeatCount=\"indefinite\" />\n              <animate attributeName=\"r\" values={(dotSize - 0.5) + \";\" + (dotSize + 1) + \";\" + (dotSize - 0.5)} dur={(animSpeed + pi * 0.2) + \"s\"} repeatCount=\"indefinite\" />\n            </circle>;\n          })}\n\n          \n          {ring.points.map(function(pt, pi) {\n            var next = ring.points[(pi + 1) % ring.points.length];\n            return <line key={\"l\" + pi} x1={pt.x} y1={pt.y} x2={next.x} y2={next.y} stroke={ring.color} strokeWidth=\"0.8\" opacity={morphed ? 0.2 : 0.08}>\n              <animate attributeName=\"opacity\" values={(morphed ? \"0.1;0.3;0.1\" : \"0.04;0.12;0.04\")} dur={(animSpeed + 1) + \"s\"} repeatCount=\"indefinite\" />\n            </line>;\n          })}\n        </g>;\n      })}\n\n      \n      {rings.length >= 2 && rings[0].points.map(function(pt, pi) {\n        var outerRing = rings[rings.length - 1];\n        var oi = pi % outerRing.points.length;\n        var opt = outerRing.points[oi];\n        return <line key={\"cr\" + pi} x1={pt.x} y1={pt.y} x2={opt.x} y2={opt.y} stroke={c1} strokeWidth=\"0.5\" opacity={morphed ? 0.12 : 0.04} strokeDasharray=\"2 4\">\n          <animate attributeName=\"opacity\" values={(morphed ? \"0.06;0.18;0.06\" : \"0.02;0.08;0.02\")} dur={(animSpeed + 2) + \"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n\n      \n      <circle cx={cx} cy={cy} r={morphed ? 8 : 5} fill={c1} opacity={morphed ? 0.6 : 0.3}>\n        <animate attributeName=\"r\" values={(morphed ? \"6;10;6\" : \"4;7;4\")} dur={animSpeed + \"s\"} repeatCount=\"indefinite\" />\n        <animate attributeName=\"opacity\" values={(morphed ? \"0.4;0.8;0.4\" : \"0.2;0.4;0.2\")} dur={animSpeed + \"s\"} repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx={cx} cy={cy} r={morphed ? 3 : 2} fill=\"#fff\" opacity=\"0.6\" />\n\n      \n      {morphed && nodePositions.map(function(np, ni) {\n        return <text key={ni} x={np.x} y={np.y + 4} textAnchor=\"middle\" fontSize=\"9\" fill={c2} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.08em\">\n          {np.label}\n        </text>;\n      })}\n    </svg>\n  );\n}\n\nvar ARCH_REGISTRY = {\n  chrysalis: { name: \"Imaginal Cells\", icon: \"\ud83e\udd8b\", color: \"#4ae88a\", bg: \"linear-gradient(160deg, #0D1A12 0%, #1a3a2a 40%, #4ae88a44 100%)\",\n    phases: { consuming: \"Still building mass. The hunger is the work.\", dissolving: \"The old form can't hold. Dissolution IS the work.\", clustering: \"Imaginal cells found each other. Something coherent forming.\", emergence: \"Wings taking shape. The caterpillar wouldn't recognize what's coming.\" },\n    Viz: ChrysalisButterfly },\n  tower: { name: \"The Tower\", icon: \"\ud83d\uddfc\", color: \"#ff8a3a\", bg: \"linear-gradient(160deg, #1A0D06 0%, #3a1a08 40%, #ff8a3a44 100%)\",\n    phases: { trembling: \"Cracks showing. Something isn't as solid as you believed.\", falling: \"Coming down. Let it fall. Can't hold what wasn't real.\", rubble: \"Standing in the aftermath. Clearest view you've had.\", clearing: \"Ground is bare. Now you can build on what's real.\" },\n    Viz: ArchTower },\n  kintsugi: { name: \"Kintsugi\", icon: \"\u2726\", color: \"#e8b830\", bg: \"linear-gradient(160deg, #1A1408 0%, #2a2010 40%, #e8b83044 100%)\",\n    phases: { breaking: \"Something broke. The instinct is to hide the crack. Don't.\", holding: \"Looking at the pieces. Not fixing yet \u2014 just seeing.\", filling: \"Gold poured into the break. The repair is the art.\", whole: \"More beautiful than before it shattered. The scar shines.\" },\n    Viz: ArchMagician },\n  dark_night: { name: \"Dark Night\", icon: \"\ud83c\udf11\", color: \"#9070d0\", bg: \"linear-gradient(160deg, #0D0A18 0%, #14102a 40%, #9070d044 100%)\",\n    phases: { trigger: \"Old framework shattered. What made sense doesn't anymore.\", crisis: \"Everything questioned. Who are you if not what you believed?\", transformation: \"In the wreckage, a different way of seeing emerges.\", emergence: \"Old meaning gone. Something deeper replaced it.\" },\n    Viz: ArchMagician },\n  persephone: { name: \"Persephone\", icon: \"\ud83c\udf3a\", color: \"#c070f0\", bg: \"linear-gradient(160deg, #0D0618 0%, #2a1040 40%, #c070f044 100%)\",\n    phases: { descending: \"Something pulled you under. Not punishment \u2014 initiation.\", underworld: \"Learning the rules of a realm you didn't choose.\", pomegranate: \"Ate the seeds. Can't unknow it. The wound became wisdom.\", returning: \"Not the maiden anymore. The queen.\" },\n    Viz: ArchThreshold },\n  phoenix: { name: \"The Phoenix\", icon: \"\ud83d\udd25\", color: \"#ff5030\", bg: \"linear-gradient(160deg, #1A0606 0%, #3a0a08 40%, #ff503044 100%)\",\n    phases: { burning: \"Let it burn. Not everything survives this version of you.\", ash: \"What's left is what was always real.\", stirring: \"Movement in the ash. Not repetition \u2014 reinvention.\", rising: \"Airborne again. Same matter, utterly reconfigured.\" },\n    Viz: ArchTower },\n  hermit: { name: \"The Hermit\", icon: \"\ud83c\udfee\", color: \"#f0c860\", bg: \"linear-gradient(160deg, #0D0C10 0%, #1a1820 40%, #f0c86044 100%)\",\n    phases: { withdrawing: \"Stepped away. Something needs quiet.\", listening: \"A signal getting clearer.\", seeing: \"The lamp illuminates what was always there.\", returning: \"Carrying the light back.\" },\n    Viz: SeedToTree },\n  sisyphus: { name: \"Sisyphus\", icon: \"\ud83e\udea8\", color: \"#c0a078\", bg: \"linear-gradient(160deg, #0D0B08 0%, #201c18 40%, #c0a07844 100%)\",\n    phases: { pushing: \"Same weight. Same hill. Something in your grip changed.\", rolling_back: \"Came down again. What do you notice on the walk back?\", pausing: \"Stopped mid-slope. Choosing to feel it.\", meaning: \"Boulder didn't get lighter. You got stronger.\" },\n    Viz: ArchSisyphus },\n  magician: { name: \"The Magician\", icon: \"\u2727\", color: \"#a060ff\", bg: \"linear-gradient(160deg, #0D0818 0%, #1c1030 40%, #a060ff44 100%)\",\n    phases: { awakening: \"Realizing you have the tools. Always there.\", practicing: \"Testing what transforms.\", transforming: \"The transmutation is happening.\", mastery: \"Seeing what's possible in what already exists.\" },\n    Viz: ArchMagician },\n  lover: { name: \"The Lover\", icon: \"\ud83d\udc97\", color: \"#ff6090\", bg: \"linear-gradient(160deg, #1A0810 0%, #2a1020 40%, #ff609044 100%)\",\n    phases: { guarding: \"Walls keeping out more than danger.\", opening: \"A crack in the armor. The bravest thing.\", feeling: \"Letting it all in.\", merging: \"Connection isn't losing yourself.\" },\n    Viz: ChrysalisButterfly },\n  star: { name: \"The Star\", icon: \"\u2b50\", color: \"#50c0ff\", bg: \"linear-gradient(160deg, #060C18 0%, #0c1830 40%, #50c0ff44 100%)\",\n    phases: { darkness: \"Dark. But a point of light you haven't noticed.\", glimmer: \"Hope isn't optimism. It's stubbornness.\", pouring: \"Quietly tending what's left.\", shining: \"Effortless, steady, real.\" },\n    Viz: SeedToTree },\n  threshold: { name: \"The Threshold\", icon: \"\ud83d\udeaa\", color: \"#b8a880\", bg: \"linear-gradient(160deg, #0D0D0A 0%, #181814 40%, #b8a88044 100%)\",\n    phases: { approaching: \"Edge of something. The old room shrinking.\", standing: \"At the door. Not through yet.\", crossing: \"One foot on each side.\", arrived: \"Other side. The room is bigger.\" },\n    Viz: ArchThreshold },\n  weaver: { name: \"The Weaver\", icon: \"\ud83d\udd78\", color: \"#a080c0\", bg: \"linear-gradient(160deg, #0D0A10 0%, #1a1420 40%, #a080c044 100%)\",\n    phases: { gathering: \"Threads from different parts collecting.\", seeing: \"A pattern emerging.\", weaving: \"Actively connecting them.\", wearing: \"The pattern is complete enough to wear.\" },\n    Viz: ArchMagician },\n  tree: { name: \"The Tree\", icon: \"\ud83c\udf33\", color: \"#6BFFB8\", bg: \"linear-gradient(160deg, #0A1A12 0%, #0D2E1A 40%, #6BFFB844 100%)\",\n    phases: { seed: \"Something planted.\", roots: \"Going deep before going up.\", growing: \"Slow, steady expansion.\", canopy: \"The patience paid off.\" },\n    Viz: SeedToTree },\n  descent: { name: \"The Descent\", icon: \"\u2b07\", color: \"#6BB8FF\", bg: \"linear-gradient(160deg, #060C1A 0%, #0D1A2E 40%, #6BB8FF44 100%)\",\n    phases: { approaching: \"Edge of the underworld.\", entering: \"Going under.\", depths: \"In the deepest place.\", returning: \"Rising with what you found.\" },\n    Viz: ArchThreshold },\n  planets: { name: \"Forces in Orbit\", icon: \"\ud83e\ude90\", color: \"#FFB86B\", bg: \"linear-gradient(160deg, #1A120A 0%, #2E1A0D 40%, #FFB86B44 100%)\",\n    phases: { approaching: \"Forces circling.\", conjunction: \"Aligned.\", opposition: \"Pulling apart.\", integration: \"New orbit.\" },\n    Viz: ArchSisyphus },\n};\n\nfunction CrossSessionCard({ pastSessions, currentSd, advance }) {\n  var [view, setView] = React.useState(\"loading\"); \n  var [insight, setInsight] = React.useState(null);\n  var [sliderVal, setSliderVal] = React.useState(50);\n  var [sliderDone, setSliderDone] = React.useState(false);\n\n  var sd = currentSd || {};\n  var allSessions = pastSessions.slice(-4).concat([{\n    themes: (sd.themes || []).map(function(t) { return { label: t.label, weight: t.weight || 1 }; }),\n    alchemy: sd.alchemy || null,\n    tension: sd.tension || null,\n    mapResponses: {},\n  }]);\n  var N = allSessions.length;\n\n  \n  var themeMap = {};\n  allSessions.forEach(function(s, si) {\n    (s.themes || []).forEach(function(t) {\n      if (!t.label) return;\n      if (!themeMap[t.label]) themeMap[t.label] = [];\n      themeMap[t.label].push({ si: si, w: t.weight || 1 });\n    });\n  });\n\n  var persistent = [], growing = [], chrysalis = [], arriving = [];\n  Object.keys(themeMap).forEach(function(label) {\n    var entries = themeMap[label];\n    var inCurrent = entries.some(function(e) { return e.si === N - 1; });\n    var cnt = entries.length;\n    var firstW = entries[0].w, lastW = entries[entries.length-1].w;\n    if (cnt >= 3 && inCurrent) persistent.push({ label: label, entries: entries });\n    else if (cnt >= 2 && inCurrent && lastW > firstW + 0.3) growing.push({ label: label, entries: entries });\n    else if (cnt >= 2 && !inCurrent) chrysalis.push({ label: label });\n    else if (cnt === 1 && inCurrent && lastW > 0.6) arriving.push({ label: label, w: lastW });\n  });\n\n  var connFreq = {};\n  allSessions.forEach(function(s) {\n    Object.keys(s.mapResponses || {}).forEach(function(k) {\n      var r = s.mapResponses[k];\n      if (r && (r.value === \"yes\" || r.value === \"partly\")) connFreq[k] = (connFreq[k] || 0) + 1;\n    });\n  });\n  var diamondKey = Object.keys(connFreq).sort(function(a,b){return connFreq[b]-connFreq[a];})[0];\n  var diamondParts = diamondKey ? diamondKey.split(\"::\") : null;\n  var silverLining = arriving[0] || null;\n\n  var ALCH_COLORS = { nigredo: \"#666680\", albedo: \"#AAAACC\", citrinitas: \"#D6B26D\", rubedo: \"#E84393\" };\n  var ALCH_LABELS = { nigredo: \"dissolving\", albedo: \"clearing\", citrinitas: \"forming\", rubedo: \"arriving\" };\n  var alchArc = allSessions.map(function(s) { return s.alchemy ? s.alchemy.stage : null; });\n  var currentAlch = alchArc[alchArc.length-1];\n\n  \n  React.useEffect(function() {\n    if (pastSessions.length < 1) { setView(\"stats\"); return; }\n\n    var sumLines = allSessions.map(function(s, i) {\n      var th = (s.themes || []).map(function(t) { return t.label + (t.w > 3 || t.weight > 3 ? \"*\" : \"\"); }).join(\", \");\n      var al = s.alchemy ? s.alchemy.stage : \"\";\n      var tn = s.tension ? \"[\" + s.tension.a + \" vs \" + s.tension.b + \"]\" : \"\";\n      var fb = s.cardFeedback ? Object.keys(s.cardFeedback).map(function(k) {\n        var f = s.cardFeedback[k];\n        var score = f.slider !== undefined ? (f.slider >= 68 ? k + \"=landed\" : f.slider <= 32 ? k + \"=pushed_away\" : null) : null;\n        return score;\n      }).filter(Boolean).join(\",\") : \"\";\n      return \"Session \" + (i+1) + \": [\" + th + \"]\" + (al ? \" \" + al : \"\") + (tn ? \" tension=\" + tn : \"\") + (fb ? \" feedback={\" + fb + \"}\" : \"\");\n    }).join(\"\\n\");\n\n    var analysisBits = [];\n    if (persistent.length) analysisBits.push(\"Persistent: \" + persistent.map(function(t){return t.label;}).join(\", \"));\n    if (growing.length) analysisBits.push(\"Growing: \" + growing.map(function(t){return t.label;}).join(\", \"));\n    if (chrysalis.length) analysisBits.push(\"In chrysalis: \" + chrysalis.map(function(t){return t.label;}).join(\", \"));\n    if (diamondParts) analysisBits.push(\"Most confirmed link: \" + diamondParts[0] + \" \\u2194 \" + diamondParts[1]);\n\n    var prompt = \"You are reading someone's psychological sessions over time.\\n\\n\" +\n      \"DATA:\\n\" + sumLines + \"\\n\\n\" +\n      (analysisBits.length ? \"PATTERNS DETECTED:\\n\" + analysisBits.join(\"\\n\") + \"\\n\\n\" : \"\") +\n      \"TASK: Find the ONE most revealing cross-session pattern. The insight that, if named, would feel like something clicked into place.\\n\\n\" +\n      \"If there is a clear pattern: respond {\\\"has_insight\\\":true,\\\"insight\\\":\\\"...\\\",\\\"pattern_name\\\":\\\"THE ...\\\",\\\"color\\\":\\\"#hex\\\"}\\n\" +\n      \"insight: 1-2 sentences, direct. Start with 'you'. No hedging.\\n\" +\n      \"pattern_name: 2-3 caps words\\n\" +\n      \"color: a hex that feels emotionally right for this pattern\\n\\n\" +\n      \"If too sparse (only 1 prior session or no clear signal): respond {\\\"has_insight\\\":false}\\n\\n\" +\n      \"Respond ONLY with valid JSON, no markdown.\";\n\n    callClaude(prompt, \"\", 400)\n      .then(function(res) {\n        var d = parseJSON(res);\n        if (d && d.has_insight && d.insight) { setInsight(d); setView(\"poster\"); }\n        else setView(\"stats\");\n      })\n      .catch(function() { setView(\"stats\"); });\n  }, []);\n\n  var accent = insight ? (insight.color || \"#B86BFF\") : \"#B86BFF\";\n  var topColor = (sd.themes && sd.themes[0]) ? (sd.themes[0].color || \"#E84393\") : \"#E84393\";\n\n  \n  if (view === \"loading\") return (\n    <FC>\n      <FieldParticles color=\"#B86BFF\" count={14}/>\n      <BreathingOrb color=\"#B86BFF\" size={64}/>\n      <div style={{ marginTop: 28, fontSize: 11, letterSpacing: \"0.38em\", textTransform: \"uppercase\",\n        color: \"rgba(184,107,255,0.45)\", fontFamily: FB, animation: \"pulse 2s ease infinite\" }}>\n        reading the arc\n      </div>\n    </FC>\n  );\n\n  \n  if (view === \"poster\") return (\n    <div style={{ position: \"absolute\", inset: 0, display: \"flex\", flexDirection: \"column\",\n      alignItems: \"center\", justifyContent: \"center\", padding: \"56px 28px 40px\", overflow: \"hidden\" }}>\n      <FieldParticles color={accent} count={22}/>\n\n      \n      <svg style={{ position: \"absolute\", opacity: 0.055, width: \"100%\", height: \"100%\", pointerEvents: \"none\" }}\n        viewBox=\"0 0 400 600\" preserveAspectRatio=\"xMidYMid slice\">\n        {[0, 30, 60, 90].map(function(rot, i) {\n          return <polygon key={i} points=\"200,70 330,300 200,530 70,300\" fill=\"none\" stroke={accent}\n            strokeWidth=\"1.2\" transform={\"rotate(\" + rot + \" 200 300)\"} opacity={0.55 - i * 0.1}/>;\n        })}\n        <circle cx=\"200\" cy=\"300\" r=\"115\" fill=\"none\" stroke={accent} strokeWidth=\"0.6\" opacity=\"0.4\"/>\n        <circle cx=\"200\" cy=\"300\" r=\"68\" fill=\"none\" stroke={accent} strokeWidth=\"0.4\" opacity=\"0.3\"/>\n        <circle cx=\"200\" cy=\"300\" r=\"32\" fill=\"none\" stroke={accent} strokeWidth=\"0.3\" opacity=\"0.25\"/>\n      </svg>\n\n      \n      <svg viewBox=\"0 0 120 144\" style={{ width: 86, height: 104, marginBottom: 28, zIndex: 1,\n        filter: \"drop-shadow(0 0 22px \" + accent + \"66)\",\n        animation: \"nodeBreathe 6s ease-in-out infinite\" }}>\n        <defs>\n          <linearGradient id=\"dia1\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"white\" stopOpacity=\"0.18\"/>\n            <stop offset=\"100%\" stopColor={accent} stopOpacity=\"0.85\"/>\n          </linearGradient>\n          <linearGradient id=\"dia2\" x1=\"0%\" y1=\"100%\" x2=\"0%\" y2=\"0%\">\n            <stop offset=\"0%\" stopColor={accent} stopOpacity=\"0.35\"/>\n            <stop offset=\"100%\" stopColor={accent} stopOpacity=\"0.9\"/>\n          </linearGradient>\n        </defs>\n        <polygon points=\"60,6 102,54 60,46 18,54\" fill=\"url(#dia1)\"/>\n        <polygon points=\"60,6 102,54 60,46\" fill=\"white\" opacity=\"0.08\"/>\n        <polygon points=\"60,6 18,54 60,46\" fill={accent} opacity=\"0.55\"/>\n        <polygon points=\"18,54 60,46 102,54 60,138\" fill=\"url(#dia2)\"/>\n        <polygon points=\"18,54 60,46 60,138\" fill={accent} opacity=\"0.4\"/>\n        <polygon points=\"102,54 60,46 60,138\" fill=\"white\" opacity=\"0.04\"/>\n        <circle cx=\"60\" cy=\"6\" r=\"3\" fill=\"white\" opacity=\"0.95\"/>\n        <circle cx=\"60\" cy=\"138\" r=\"2\" fill={accent} opacity=\"0.7\"/>\n      </svg>\n\n      <div style={{ fontSize: 9, letterSpacing: \"0.5em\", color: accent + \"99\", fontFamily: FB,\n        textTransform: \"uppercase\", marginBottom: 16, zIndex: 1 }}>\n        {insight.pattern_name || \"THE PATTERN\"}\n      </div>\n\n      <div style={{ fontSize: 18, color: \"rgba(255,255,255,0.92)\", fontFamily: FD, fontStyle: \"italic\",\n        lineHeight: 1.68, maxWidth: 300, marginBottom: 36, zIndex: 1,\n        animation: \"riseUp 0.8s ease 0.1s both\" }}>\n        {insight.insight}\n      </div>\n\n      {!sliderDone ? (\n        <div data-noadvance=\"true\" style={{ width: \"100%\", maxWidth: 290, zIndex: 1 }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.28em\", color: \"rgba(255,255,255,0.28)\",\n            fontFamily: FB, textTransform: \"uppercase\", marginBottom: 14, textAlign: \"center\" }}>\n            does this land?\n          </div>\n          <SpectrumSlider color={accent} value={sliderVal} poleA=\"not quite\" poleB=\"that\\u2019s it\"\n            onSet={function(v) { setSliderVal(v); setSliderDone(true); }}/>\n        </div>\n      ) : (\n        <div style={{ zIndex: 1, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", gap: 12 }}>\n          <div style={{ fontSize: 12, color: accent + \"99\", fontFamily: FB, letterSpacing: \"0.18em\" }}>\n            {sliderVal >= 70 ? \"marked \\u2713\" : sliderVal <= 30 ? \"noted \\u2014 not quite\" : \"partially\"}\n          </div>\n          <button data-noadvance=\"true\" onClick={function(e) { e.stopPropagation(); setView(\"stats\"); }}\n            style={{ background: \"rgba(255,255,255,0.04)\", border: \"1px solid rgba(255,255,255,0.1)\",\n              borderRadius: 20, padding: \"8px 22px\", color: \"rgba(255,255,255,0.45)\", fontSize: 11,\n              fontFamily: FB, cursor: \"pointer\", letterSpacing: \"0.18em\" }}>\n            view the arc \\u2192\n          </button>\n        </div>\n      )}\n    </div>\n  );\n\n  \n  var stagnant = Object.keys(themeMap).filter(function(l) {\n    var e = themeMap[l];\n    if (e.length < 3) return false;\n    return Math.abs(e[e.length-1].w - e[0].w) < 0.3;\n  });\n\n  return (\n    <div style={{ position: \"absolute\", inset: 0, overflow: \"auto\", WebkitOverflowScrolling: \"touch\" }}>\n      <FieldParticles color={topColor} count={10}/>\n      <div style={{ maxWidth: 380, margin: \"0 auto\", padding: \"56px 24px 48px\", position: \"relative\", zIndex: 1 }}>\n\n        <div style={{ fontSize: 9, letterSpacing: \"0.5em\", color: \"rgba(255,255,255,0.28)\",\n          fontFamily: FB, textTransform: \"uppercase\", marginBottom: 32, textAlign: \"center\" }}>THE ARC</div>\n\n        \n        <div style={{ marginBottom: 36 }}>\n          <div style={{ display: \"flex\", gap: 5, alignItems: \"flex-end\", height: 52 }}>\n            {allSessions.map(function(s, si) {\n              var al = s.alchemy ? s.alchemy.stage : null;\n              var col = al ? (ALCH_COLORS[al] || \"#555\") : topColor + \"55\";\n              var h = 10 + (si / Math.max(N - 1, 1)) * 38;\n              var isLast = si === N - 1;\n              return (\n                <div key={si} style={{ flex: 1, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", gap: 4 }}>\n                  <div style={{ width: \"100%\", height: h, borderRadius: 3, background: col,\n                    opacity: isLast ? 1 : 0.5, animation: \"riseUp 0.5s ease \" + (si * 0.09) + \"s both\" }}/>\n                  <div style={{ fontSize: 9, color: \"rgba(255,255,255,0.22)\", fontFamily: FB,\n                    letterSpacing: \"0.05em\" }}>{si + 1}</div>\n                </div>\n              );\n            })}\n          </div>\n          {currentAlch && (\n            <div style={{ marginTop: 10, fontSize: 11, color: ALCH_COLORS[currentAlch] || topColor,\n              fontFamily: FB, letterSpacing: \"0.2em\" }}>\n              now: {ALCH_LABELS[currentAlch] || currentAlch}\n            </div>\n          )}\n        </div>\n\n        \n        {(persistent.length > 0 || growing.length > 0) && (\n          <div style={{ marginBottom: 28, animation: \"riseUp 0.6s ease 0.05s both\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.42em\", color: \"#6BFFB8\", fontFamily: FB,\n              marginBottom: 12, textTransform: \"uppercase\" }}>\\u2191 pulling forward</div>\n            <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: 8 }}>\n              {persistent.concat(growing).slice(0, 6).map(function(t, i) {\n                var tc = (sd.themes || []).find(function(th) { return th.label === t.label; });\n                var col = tc ? tc.color : \"#6BFFB8\";\n                return <div key={t.label} style={{ padding: \"6px 14px\", borderRadius: 20,\n                  background: col + \"18\", border: \"1px solid \" + col + \"44\",\n                  fontSize: 12, color: col, fontFamily: FB, fontWeight: 600, letterSpacing: \"0.06em\",\n                  animation: \"riseUp 0.5s ease \" + (i * 0.08) + \"s both\" }}>{t.label}</div>;\n              })}\n            </div>\n          </div>\n        )}\n\n        \n        {diamondParts && (connFreq[diamondKey] || 0) >= 2 && (\n          <div style={{ marginBottom: 28, animation: \"riseUp 0.6s ease 0.1s both\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.42em\", color: \"#FFD700\", fontFamily: FB,\n              marginBottom: 12, textTransform: \"uppercase\" }}>\\u25c6 diamond forming</div>\n            <div style={{ padding: \"14px 18px\", borderRadius: 12,\n              background: \"rgba(255,215,0,0.05)\", border: \"1px solid rgba(255,215,0,0.18)\" }}>\n              <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.72)\", fontFamily: FD, fontStyle: \"italic\" }}>\n                {diamondParts[0]} \\u2194 {diamondParts[1]}\n              </div>\n              <div style={{ marginTop: 5, fontSize: 10, color: \"rgba(255,215,0,0.5)\", fontFamily: FB,\n                letterSpacing: \"0.12em\" }}>confirmed {connFreq[diamondKey]}\\u00d7</div>\n            </div>\n          </div>\n        )}\n\n        \n        {chrysalis.length > 0 && (\n          <div style={{ marginBottom: 28, animation: \"riseUp 0.6s ease 0.15s both\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.42em\", color: \"#B86BFF\", fontFamily: FB,\n              marginBottom: 12, textTransform: \"uppercase\" }}>\\u25ce in chrysalis</div>\n            <div style={{ fontSize: 14, color: \"rgba(184,107,255,0.72)\", fontFamily: FD, fontStyle: \"italic\",\n              lineHeight: 1.6 }}>{chrysalis.slice(0, 3).map(function(t){return t.label;}).join(\", \")}</div>\n            <div style={{ marginTop: 5, fontSize: 11, color: \"rgba(184,107,255,0.38)\", fontFamily: FB }}>\n              appeared. then went quiet. not gone.\n            </div>\n          </div>\n        )}\n\n        \n        {silverLining && (\n          <div style={{ marginBottom: 28, animation: \"riseUp 0.6s ease 0.2s both\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.42em\", color: \"#C8E6C9\", fontFamily: FB,\n              marginBottom: 12, textTransform: \"uppercase\" }}>\\u2736 silver lining</div>\n            <div style={{ padding: \"12px 16px\", borderRadius: 12,\n              background: \"rgba(200,230,200,0.04)\", border: \"1px solid rgba(200,230,200,0.15)\" }}>\n              <div style={{ fontSize: 15, color: \"rgba(200,230,200,0.82)\", fontFamily: FD, fontStyle: \"italic\" }}>\n                {silverLining.label}\n              </div>\n              <div style={{ marginTop: 4, fontSize: 10, color: \"rgba(200,230,200,0.38)\", fontFamily: FB,\n                letterSpacing: \"0.1em\" }}>new this session</div>\n            </div>\n          </div>\n        )}\n\n        \n        {stagnant.length > 0 && (\n          <div style={{ marginBottom: 28, animation: \"riseUp 0.6s ease 0.25s both\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.42em\", color: \"rgba(255,255,255,0.22)\",\n              fontFamily: FB, marginBottom: 12, textTransform: \"uppercase\" }}>\\u2014 holding still</div>\n            <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.32)\", fontFamily: FD, fontStyle: \"italic\" }}>\n              {stagnant.join(\", \")}\n            </div>\n            <div style={{ marginTop: 4, fontSize: 11, color: \"rgba(255,255,255,0.18)\", fontFamily: FB }}>\n              consistent. not shifting. worth noticing.\n            </div>\n          </div>\n        )}\n\n        {insight && (\n          <div style={{ marginTop: 20, textAlign: \"center\" }}>\n            <button data-noadvance=\"true\" onClick={function(e) { e.stopPropagation(); setView(\"poster\"); }}\n              style={{ background: \"transparent\", border: \"1px solid rgba(255,255,255,0.1)\",\n                borderRadius: 20, padding: \"8px 22px\", color: \"rgba(255,255,255,0.3)\", fontSize: 11,\n                fontFamily: FB, cursor: \"pointer\", letterSpacing: \"0.18em\" }}>\n              \\u2190 the insight\n            </button>\n          </div>\n        )}\n\n        <div style={{ marginTop: 40, fontSize: 10, color: \"rgba(255,255,255,0.14)\", fontFamily: FB,\n          textAlign: \"center\", letterSpacing: \"0.15em\" }}>tap to continue</div>\n      </div>\n    </div>\n  );\n}\n\nfunction FC({ children }) {\n  return <div style={{ display:\"flex\", flexDirection:\"column\", justifyContent:\"center\", alignItems:\"center\", height:\"100%\", padding:\"60px 28px\", textAlign:\"center\", position:\"relative\" }}>{children}</div>;\n}\nfunction FLabel({ color, children }) {\n  return <div style={{ fontSize:14, letterSpacing:\"0.18em\", fontWeight:700, color, marginBottom:20, fontFamily:FB, zIndex:1, textTransform:\"uppercase\" }}>{children}</div>;\n}\nfunction FHero({ size=42, color=\"white\", children }) {\n  return <h1 style={{ fontSize:size, fontWeight:400, lineHeight:1.2, margin:0, color, fontFamily:FD, zIndex:1 }}>{children}</h1>;\n}\nfunction FBody({ color, style={}, children }) {\n  return <p style={{ fontSize:19, margin:0, lineHeight:1.6, fontFamily:FD, color, zIndex:1, ...style }}>{children}</p>;\n}\nfunction FTap({ color, children }) {\n  return <div style={{ fontSize:15, marginTop:24, fontFamily:FB, color, opacity:0.7, zIndex:1 }}>{children}</div>;\n}\nfunction FOrb({ color, children }) {\n  return <div style={{ width:72, height:72, borderRadius:\"50%\", background:`${color}22`, border:`2px solid ${color}55`, display:\"flex\", alignItems:\"center\", justifyContent:\"center\", fontSize:14, color, fontFamily:FB, fontWeight:500 }}>{children}</div>;\n}\n\nfunction DataPortrait({ themes }) {\n  var [active, setActive] = useState(null);\n  var rings = (themes || []).slice(0, 7).map(function(t, i) {\n    var base = 110 - i * 16;\n    return {\n      r: Math.max(16, base),\n      color: t.color || NC[i % NC.length],\n      width: 2 + (t.weight || 1) * 0.8,\n      dash: [8, 12, 4, 20, 6, 14][i % 6] + \" \" + [4, 8, 12, 4, 10, 6][i % 6],\n      speed: 30 + i * 12,\n      label: t.label || t.name || \"\",\n      weight: t.weight || 1,\n    };\n  });\n  var activeRing = active !== null ? rings[active] : null;\n  return (\n    <div data-noadvance=\"true\" style={{ position:\"relative\", width:\"100%\", maxWidth:240 }}>\n      <svg viewBox=\"0 0 260 260\" style={{ width:\"100%\", cursor:\"pointer\" }}\n        onClick={function(e){ e.stopPropagation(); setActive(null); }}>\n        {rings.map(function(ring, i) {\n          var isActive = active === i;\n          return <circle key={i} cx=\"130\" cy=\"130\" r={ring.r} fill=\"none\"\n            stroke={ring.color} strokeWidth={isActive ? ring.width + 2 : ring.width}\n            strokeDasharray={ring.dash} strokeLinecap=\"round\"\n            opacity={isActive ? 1 : 0.65}\n            style={{ cursor:\"pointer\" }}\n            onClick={function(e){ e.stopPropagation(); setActive(active === i ? null : i); }}>\n            <animateTransform attributeName=\"transform\" type=\"rotate\"\n              from=\"0 130 130\" to={(i%2===0?\"360\":\"-360\")+\" 130 130\"}\n              dur={ring.speed+\"s\"} repeatCount=\"indefinite\" />\n          </circle>;\n        })}\n        <circle cx=\"130\" cy=\"130\" r=\"6\" fill=\"white\" opacity=\"0.8\" />\n        <circle cx=\"130\" cy=\"130\" r=\"12\" fill=\"none\" stroke=\"white\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"12;18;12\" dur=\"3s\" repeatCount=\"indefinite\" />\n        </circle>\n      </svg>\n      \n      {activeRing\n        ? <div onClick={function(e){e.stopPropagation();setActive(null);}}\n            style={{ marginTop:14, padding:\"14px 20px\", borderRadius:14,\n              background:\"rgba(8,10,20,0.92)\",\n              border:\"1.5px solid \"+activeRing.color+\"55\",\n              boxShadow:\"0 0 28px \"+activeRing.color+\"22\",\n              animation:\"riseUp 0.3s ease both\", cursor:\"pointer\" }}>\n            <div style={{ fontSize:18, color:activeRing.color, fontFamily:FB, fontWeight:700, marginBottom:8 }}>{activeRing.label}</div>\n            <div style={{ height:4, borderRadius:2, background:\"rgba(255,255,255,0.06)\", marginBottom:8 }}>\n              <div style={{ height:\"100%\", width:Math.min(100,activeRing.weight/5*100)+\"%\", background:activeRing.color, borderRadius:2, transition:\"width 0.4s ease\" }} />\n            </div>\n            <div style={{ display:\"flex\", justifyContent:\"space-between\" }}>\n              <div style={{ fontSize:12, color:\"rgba(255,255,255,0.45)\", fontFamily:FB }}>weight {activeRing.weight.toFixed(1)}</div>\n              <div style={{ fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB }}>tap to close</div>\n            </div>\n          </div>\n        : <div style={{ textAlign:\"center\", marginTop:8, fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>\n            tap any ring\n          </div>\n      }\n    </div>\n  );\n}\n\nfunction saveSession(data) {\n  try {\n    var sessions = JSON.parse(localStorage.getItem(_sessionKey()) || \"[]\");\n    var themes = (data.themes || []).slice(0, 5).map(function(t) { return { label: t.label, weight: t.weight || 1 }; });\n    var avgWeight = themes.length > 0 ? themes.reduce(function(s, t) { return s + t.weight; }, 0) / themes.length : 0;\n    sessions.push({\n      date: new Date().toISOString(),\n      archetypes: (data.archetypes || []).map(function(a) {\n        return {\n          name: a.name || a.key || \"\",\n          line: a.line || \"\",\n          key: a.classical_resonance || a.key || \"\",\n          source_nodes: a.source_nodes || [],\n          evolution_from: a.evolution_from || null,\n        };\n      }),\n      themes: themes,\n      mapTitle: data.map_title || \"\",\n      synthesis: (data.synthesis || \"\").slice(0, 200),\n      tension: data.tension ? { a: data.tension.a, b: data.tension.b, text: (data.tension.text || \"\").slice(0, 120) } : null,\n      intensity: Math.round(avgWeight * 20) / 10,\n      \n      arrival: data.arrival || null,\n      alchemy: data.alchemy ? { stage: data.alchemy.stage, evidence: (data.alchemy.evidence || \"\").slice(0, 120) } : null,\n      underneath: (data.underneath || []).slice(0, 2).map(function(u) { return (typeof u === \"string\" ? u : u.observation || \"\").slice(0, 120); }),\n      blind_spot: (data.blind_spot || \"\").slice(0, 150),\n      opening: (typeof data.opening === \"string\" ? data.opening : (data.opening || {}).text || \"\").slice(0, 150),\n      mapResponses: data.mapResponses || {},\n      cardFeedback: data.cardFeedback || {},  \n      clarity: data.clarity || \"\",\n      reactions: data.reactions || {},\n      corrections: data.corrections || {},\n      revisedSynthesis: data.revisedSynthesis || null,\n    });\n    if (sessions.length > 50) sessions = sessions.slice(-50);\n    localStorage.setItem(_sessionKey(), JSON.stringify(sessions));\n    console.log(\"[SAYCRD] Session saved locally. Total sessions:\", sessions.length);\n    \n    \n    \n    (function() {\n      try {\n        if (window.storage && window.currentUser && window.currentUser.id !== \"local-user\") {\n          window.storage.set(\"sessions\", JSON.stringify(sessions)).then(function() {\n            console.log(\"[SAYCRD] Session synced to server.\");\n          }).catch(function(e) {\n            console.warn(\"[SAYCRD] Server sync failed (session saved locally):\", e);\n          });\n        }\n      } catch(e) { /* never block on server write */ }\n    })();\n  } catch (e) { console.error(\"[SAYCRD] Save error:\", e); }\n}\n\nfunction _sessionKey() {\n  \n  var uid = (window.currentUser && window.currentUser.id) ? window.currentUser.id : \"local\";\n  return \"saycrd-\" + uid + \"-sessions\";\n}\nfunction loadSessions() {\n  try {\n    var key = _sessionKey();\n    var data = JSON.parse(localStorage.getItem(key) || \"[]\");\n    /* Legacy migration: ONLY for local/anonymous users, never for real accounts.\n       This prevents a new account from inheriting sessions from a previous account. */\n    if (data.length === 0 && key.indexOf(\"saycrd-local-\") === 0) {\n      var legacyKeys = [\"saycrd-sessions\", \"saycrd-local-sessions\"];\n      for (var li = 0; li < legacyKeys.length; li++) {\n        var legacy = JSON.parse(localStorage.getItem(legacyKeys[li]) || \"[]\");\n        if (legacy.length > 0) {\n          localStorage.setItem(key, JSON.stringify(legacy));\n          return legacy;\n        }\n      }\n    }\n    return data;\n  } catch(e) { return []; }\n}\nfunction getArchetypeHistory() {\n  var sessions = loadSessions(); var counts = {};\n  sessions.forEach(function(s) {\n    (s.archetypes || []).forEach(function(a) {\n      var key = typeof a === \"string\" ? a : a.key;\n      counts[key] = (counts[key] || 0) + 1;\n    });\n  });\n  return counts;\n}\nfunction getThemeHistory() {\n  var sessions = loadSessions();\n  var themeMap = {};\n  sessions.forEach(function(s, si) {\n    (s.themes || []).forEach(function(t) {\n      var k = (t.label || \"\").toLowerCase().trim();\n      if (!k) return;\n      if (!themeMap[k]) themeMap[k] = { label: t.label, appearances: [] };\n      themeMap[k].appearances.push({ session: si, weight: t.weight || 1, date: s.date });\n    });\n  });\n  return themeMap;\n}\nfunction getSessionTimeline() {\n  var sessions = loadSessions();\n  return sessions.map(function(s, i) {\n    var archs = (s.archetypes || []).map(function(a) { return typeof a === \"string\" ? a : a.key; });\n    return { index: i, date: s.date, archetypes: archs, intensity: s.intensity || 0, mapTitle: s.mapTitle || \"\", themes: s.themes || [] };\n  });\n}\n\nvar PHASE_ORDER = {\n  chrysalis: [\"consuming\",\"dissolving\",\"clustering\",\"emergence\"],\n  tower: [\"trembling\",\"falling\",\"rubble\",\"clearing\"],\n  kintsugi: [\"breaking\",\"holding\",\"filling\",\"whole\"],\n  dark_night: [\"trigger\",\"crisis\",\"transformation\",\"emergence\"],\n  persephone: [\"descending\",\"underworld\",\"pomegranate\",\"returning\"],\n  phoenix: [\"burning\",\"ash\",\"stirring\",\"rising\"],\n  hermit: [\"withdrawing\",\"listening\",\"seeing\",\"returning\"],\n  sisyphus: [\"pushing\",\"rolling_back\",\"pausing\",\"meaning\"],\n  magician: [\"awakening\",\"practicing\",\"transforming\",\"mastery\"],\n  lover: [\"guarding\",\"opening\",\"feeling\",\"merging\"],\n  star: [\"darkness\",\"glimmer\",\"pouring\",\"shining\"],\n  threshold: [\"approaching\",\"standing\",\"crossing\",\"arrived\"],\n  weaver: [\"gathering\",\"seeing\",\"weaving\",\"wearing\"],\n  tree: [\"seed\",\"roots\",\"growing\",\"canopy\"],\n};\nvar ALCHEMY_ORDER = [\"nigredo\",\"albedo\",\"citrinitas\",\"rubedo\"];\n\nfunction computeFieldState() {\n  var sessions = loadSessions();\n  var n = sessions.length;\n  if (n === 0) return null;\n\n  var now = Date.now();\n  var firstDate = new Date(sessions[0].date).getTime();\n  var daysActive = Math.max(1, Math.round((now - firstDate) / 86400000));\n  var gaps = [];\n  for (var i = 1; i < n; i++) {\n    gaps.push(Math.round((new Date(sessions[i].date).getTime() - new Date(sessions[i-1].date).getTime()) / 86400000));\n  }\n  var avgGap = gaps.length > 0 ? Math.round(gaps.reduce(function(a,b){return a+b;},0) / gaps.length * 10) / 10 : 0;\n\n  \n  var themeTrack = {};\n  sessions.forEach(function(s, si) {\n    (s.themes || []).forEach(function(t) {\n      var k = (t.label || \"\").toLowerCase().trim();\n      if (!k) return;\n      if (!themeTrack[k]) themeTrack[k] = { label: t.label, weights: [], sessions: [] };\n      themeTrack[k].weights.push(t.weight || 1);\n      themeTrack[k].sessions.push(si);\n    });\n  });\n\n  var rising = [], fading = [], chronic = [], absent = [];\n  Object.keys(themeTrack).forEach(function(k) {\n    var t = themeTrack[k];\n    var w = t.weights;\n    if (w.length >= 2) {\n      var recent = w.slice(-2);\n      var delta = recent[recent.length - 1] - recent[0];\n      if (delta >= 1.5) rising.push({ label: t.label, delta: delta });\n      if (delta <= -1.5) fading.push({ label: t.label, delta: delta });\n      if (w.length >= 3 && t.sessions[t.sessions.length - 1] >= n - 1) chronic.push(t.label);\n    }\n    \n    if (t.sessions.length >= 2 && t.sessions[t.sessions.length - 1] < n - 2) {\n      absent.push(t.label);\n    }\n  });\n\n  \n  var archTrack = {};\n  sessions.forEach(function(s, si) {\n    (s.archetypes || []).forEach(function(a) {\n      var key = typeof a === \"string\" ? a : a.key;\n      var phase = a.phase || \"\";\n      var resp = s.archetypeResponse && s.archetypeResponse.key === key ? s.archetypeResponse.response : \"\";\n      if (!archTrack[key]) archTrack[key] = { appearances: [], phases: [], responses: [] };\n      archTrack[key].appearances.push(si);\n      archTrack[key].phases.push(phase);\n      archTrack[key].responses.push(resp);\n    });\n  });\n\n  var anchor = null, anchorCount = 0;\n  var archSignals = {};\n  Object.keys(archTrack).forEach(function(key) {\n    var a = archTrack[key];\n    if (a.appearances.length > anchorCount) { anchor = key; anchorCount = a.appearances.length; }\n\n    var order = PHASE_ORDER[key] || [];\n    var indices = a.phases.map(function(p) { return order.indexOf(p); }).filter(function(x) { return x >= 0; });\n\n    var velocity = \"stable\";\n    if (indices.length >= 2) {\n      var last2 = indices.slice(-2);\n      if (last2[1] > last2[0]) velocity = \"advancing\";\n      else if (last2[1] < last2[0]) velocity = \"regressing\";\n      else if (indices.length >= 3 && indices[indices.length-1] === indices[indices.length-2] && indices[indices.length-2] === indices[indices.length-3]) velocity = \"stuck\";\n    }\n\n    archSignals[key] = {\n      count: a.appearances.length,\n      currentPhase: a.phases[a.phases.length - 1] || \"\",\n      velocity: velocity,\n      phaseHistory: a.phases.join(\" \\u2192 \"),\n      lastResponse: a.responses.filter(Boolean).pop() || \"\",\n    };\n  });\n\n  \n  var tensions = sessions.map(function(s) { return s.tension; }).filter(Boolean);\n  var tensionAge = 0;\n  var tensionShape = null;\n  if (tensions.length >= 2) {\n    var last = tensions[tensions.length - 1];\n    tensionShape = last.a + \" vs \" + last.b;\n    \n    for (var ti = tensions.length - 1; ti >= 0; ti--) {\n      var t = tensions[ti];\n      if (t.a === last.a || t.b === last.b || t.a === last.b || t.b === last.a) tensionAge++;\n      else break;\n    }\n  }\n\n  \n  var energies = sessions.map(function(s) { return s.arrival ? s.arrival.energy : null; }).filter(Boolean);\n  var energyTrend = \"unknown\";\n  if (energies.length >= 2) {\n    var last = energies[energies.length - 1];\n    var prev = energies[energies.length - 2];\n    if (last === prev) {\n      energyTrend = energies.length >= 3 && energies[energies.length - 3] === last ? \"sustained\" : \"holding\";\n    } else {\n      var heavy = [\"heavy\",\"shattered\",\"restless\"];\n      var light = [\"warm\",\"tender\",\"still\",\"quiet\",\"grounded\"];\n      var lastH = heavy.indexOf(last) >= 0, prevH = heavy.indexOf(prev) >= 0;\n      var lastL = light.indexOf(last) >= 0, prevL = light.indexOf(prev) >= 0;\n      if (prevH && lastL) energyTrend = \"softening\";\n      else if (prevL && lastH) energyTrend = \"intensifying\";\n      else energyTrend = \"shifting\";\n    }\n  }\n\n  \n  var alchemies = sessions.map(function(s) { return s.alchemy ? s.alchemy.stage : null; }).filter(Boolean);\n  var alchemyStage = alchemies.length > 0 ? alchemies[alchemies.length - 1] : null;\n  var alchemyVelocity = \"stable\";\n  if (alchemies.length >= 2) {\n    var ai1 = ALCHEMY_ORDER.indexOf(alchemies[alchemies.length - 2]);\n    var ai2 = ALCHEMY_ORDER.indexOf(alchemies[alchemies.length - 1]);\n    if (ai2 > ai1) alchemyVelocity = \"advancing\";\n    else if (ai2 < ai1) alchemyVelocity = \"regressing\";\n  }\n\n  \n  var blindSpots = sessions.map(function(s) { return s.blind_spot || \"\"; }).filter(Boolean);\n  var lastBlindSpot = blindSpots.length > 0 ? blindSpots[blindSpots.length - 1] : \"\";\n\n  \n  var pairCounts = {};\n  sessions.forEach(function(s) {\n    var archs = (s.archetypes || []).map(function(a) { return typeof a === \"string\" ? a : a.key; });\n    for (var i = 0; i < archs.length; i++) {\n      for (var j = i + 1; j < archs.length; j++) {\n        var pair = [archs[i], archs[j]].sort().join(\"+\");\n        pairCounts[pair] = (pairCounts[pair] || 0) + 1;\n      }\n    }\n  });\n  var constellations = Object.keys(pairCounts).filter(function(k) { return pairCounts[k] >= 2; }).map(function(k) { return { pair: k, count: pairCounts[k] }; });\n\n  var state = {\n    sessionCount: n,\n    daysActive: daysActive,\n    avgGapDays: avgGap,\n    \n    rising: rising.slice(0, 3),\n    fading: fading.slice(0, 3),\n    absent: absent.slice(0, 3),\n    chronic: chronic.slice(0, 3),\n    \n    anchor: anchor,\n    anchorCount: anchorCount,\n    archSignals: archSignals,\n    \n    tensionShape: tensionShape,\n    tensionAge: tensionAge,\n    \n    energies: energies.slice(-5),\n    energyTrend: energyTrend,\n    \n    alchemyStage: alchemyStage,\n    alchemyVelocity: alchemyVelocity,\n    \n    lastBlindSpot: lastBlindSpot,\n    \n    constellations: constellations,\n  };\n\n  try { localStorage.setItem(\"saycrd-field-state\", JSON.stringify(state)); } catch(e) {}\n  return state;\n}\n\nvar ARCH_EVOLUTION = {\n  chrysalis: [\"Something is dissolving. You're in the space between.\", \"The chrysalis recognizes you. Deeper this time.\", \"You keep returning to transformation. The dissolving IS the work.\"],\n  tower: [\"Something is falling apart. Look at what's revealed.\", \"The tower visits again. What's built on false ground?\", \"You keep outgrowing structures. The collapse is graduation.\"],\n  kintsugi: [\"Something broke. The gold is coming.\", \"You've broken before. The repairs keep getting more beautiful.\", \"The cracks are your signature now.\"],\n  dark_night: [\"The old meaning dissolved. Stay in the dark.\", \"This darkness knows you. It's deeper this time.\", \"Each dark night strips another false floor.\"],\n  persephone: [\"Descending. Not punishment \u2014 initiation.\", \"The underworld recognizes you. You've been here.\", \"Queen of both worlds now. The descent is home.\"],\n  phoenix: [\"Burning. What survives is real.\", \"You've burned before. The rising gets faster.\", \"Fire is your element. Each version is truer.\"],\n  hermit: [\"Withdrew to hear something. Listen.\", \"The lamp is brighter. You've been here before.\", \"Solitude is your workshop now.\"],\n  sisyphus: [\"Same weight. Your grip is changing.\", \"The boulder knows your hands. What's different this time?\", \"You and the weight have an understanding now.\"],\n  magician: [\"Tools awakening. Watch what transforms.\", \"Your transmutation skills are growing.\", \"Lead into gold. You make it look easy now.\"],\n  lover: [\"The armor cracked. Let it.\", \"Opening wider. The terror and tenderness together.\", \"Vulnerability became your superpower.\"],\n  star: [\"Light in the dark. Notice it.\", \"You keep finding light. That's not luck.\", \"You ARE the light now. Steady, real.\"],\n  threshold: [\"Standing at the door.\", \"You've crossed thresholds before. This one's familiar.\", \"Doorways are your natural habitat.\"],\n  weaver: [\"Threads connecting.\", \"The pattern is getting clearer with each session.\", \"Master weaver. Seeing what others can't.\"],\n  tree: [\"Growth happening underground.\", \"Roots before branches \u2014 the tree grows in you.\", \"The patience IS the power.\"],\n  descent: [\"Going under. Treasure is down there.\", \"You've descended before. Faster each time.\", \"The underworld gives up its secrets to you.\"],\n  planets: [\"Forces in orbit around you.\", \"The cycles are getting familiar.\", \"You ride these forces now.\"],\n};\n\nvar FIELD_ALCHEMY = {\n  nigredo: { label: \"Nigredo\", sub: \"The Blackening\", season: \"Autumn\", color: \"#888\", bg: \"linear-gradient(160deg, #0D0A10 0%, #1a1018 40%, #44405030 100%)\" },\n  albedo: { label: \"Albedo\", sub: \"The Whitening\", season: \"Winter\", color: \"#e0e8f0\", bg: \"linear-gradient(160deg, #101418 0%, #1c2028 40%, #c0c8d030 100%)\" },\n  citrinitas: { label: \"Citrinitas\", sub: \"The Yellowing\", season: \"Spring\", color: \"#f0c840\", bg: \"linear-gradient(160deg, #141008 0%, #2a2010 40%, #d4a83030 100%)\" },\n  rubedo: { label: \"Rubedo\", sub: \"The Reddening\", season: \"Summer\", color: \"#ff5040\", bg: \"linear-gradient(160deg, #1A0608 0%, #2a0c10 40%, #cc303030 100%)\" },\n};\n\nfunction JourneyRiver({ timeline, currentArchetypes }) {\n  \n  var sessions = timeline || [];\n  var totalSessions = sessions.length;\n  if (totalSessions < 2) return null;\n\n  var w = 300, h = 200, pad = 20;\n  var usable = w - pad * 2;\n  var maxShow = Math.min(totalSessions, 12);\n  var recent = sessions.slice(-maxShow);\n  var step = usable / Math.max(maxShow - 1, 1);\n\n  \n  var points = recent.map(function(s, i) {\n    var x = pad + i * step;\n    var y = h * 0.5 - (s.intensity || 3) * 8;\n    return { x: x, y: Math.max(30, Math.min(h - 40, y)), archetypes: s.archetypes || [], intensity: s.intensity || 0 };\n  });\n\n  \n  var pathD = points.map(function(p, i) {\n    if (i === 0) return \"M \" + p.x + \" \" + p.y;\n    var prev = points[i - 1];\n    var cx = (prev.x + p.x) / 2;\n    return \"C \" + cx + \" \" + prev.y + \" \" + cx + \" \" + p.y + \" \" + p.x + \" \" + p.y;\n  }).join(\" \");\n\n  \n  var pathD2 = points.map(function(p, i) {\n    var y2 = p.y + 12 + (p.intensity || 0) * 3;\n    if (i === 0) return \"M \" + p.x + \" \" + y2;\n    var prev = points[i - 1];\n    var prevY2 = prev.y + 12 + (prev.intensity || 0) * 3;\n    var cx = (prev.x + p.x) / 2;\n    return \"C \" + cx + \" \" + prevY2 + \" \" + cx + \" \" + y2 + \" \" + p.x + \" \" + y2;\n  }).join(\" \");\n\n  return React.createElement(\"svg\", { viewBox: \"0 0 \" + w + \" \" + h, style: { width: \"100%\", maxWidth: 300 } }, [\n    React.createElement(\"defs\", { key: \"defs\" }, [\n      React.createElement(\"linearGradient\", { key: \"rg\", id: \"riverGrad\", x1: \"0\", y1: \"0\", x2: \"1\", y2: \"0\" }, [\n        React.createElement(\"stop\", { key: \"s0\", offset: \"0%\", stopColor: \"rgba(107,255,184,0.1)\" }),\n        React.createElement(\"stop\", { key: \"s1\", offset: \"100%\", stopColor: \"#6BFFB8\" })\n      ])\n    ]),\n    \n    React.createElement(\"path\", { key: \"river-top\", d: pathD, fill: \"none\", stroke: \"url(#riverGrad)\", strokeWidth: \"2.5\", strokeLinecap: \"round\", opacity: \"0.8\" }),\n    React.createElement(\"path\", { key: \"river-bot\", d: pathD2, fill: \"none\", stroke: \"url(#riverGrad)\", strokeWidth: \"1\", strokeLinecap: \"round\", opacity: \"0.3\" }),\n    \n    React.createElement(\"path\", { key: \"river-fill\", d: pathD + \" \" + points.slice().reverse().map(function(p, i) {\n      var y2 = p.y + 12 + (p.intensity || 0) * 3;\n      return (i === 0 ? \"L \" : \"L \") + p.x + \" \" + y2;\n    }).join(\" \") + \" Z\", fill: \"rgba(107,255,184,0.04)\", stroke: \"none\" }),\n    \n  ].concat(points.map(function(p, i) {\n    var archs = p.archetypes || [];\n    var isLast = i === points.length - 1;\n    var mainColor = \"#6BFFB8\";\n    if (archs.length > 0 && ARCH_REGISTRY[archs[0]]) mainColor = ARCH_REGISTRY[archs[0]].color;\n    return React.createElement(\"g\", { key: \"dot-\" + i }, [\n      React.createElement(\"circle\", { key: \"c\", cx: p.x, cy: p.y, r: isLast ? 6 : 3.5, fill: mainColor, opacity: isLast ? 0.9 : 0.4 + i * 0.04 }),\n      isLast ? React.createElement(\"circle\", { key: \"pulse\", cx: p.x, cy: p.y, r: \"10\", fill: \"none\", stroke: mainColor, strokeWidth: \"1\", opacity: \"0.3\", children: [\n        React.createElement(\"animate\", { key: \"a\", attributeName: \"r\", values: \"8;14;8\", dur: \"2s\", repeatCount: \"indefinite\" }),\n        React.createElement(\"animate\", { key: \"b\", attributeName: \"opacity\", values: \"0.3;0.1;0.3\", dur: \"2s\", repeatCount: \"indefinite\" })\n      ]}) : null,\n      archs.length > 1 && ARCH_REGISTRY[archs[1]] ? React.createElement(\"circle\", { key: \"c2\", cx: p.x + 6, cy: p.y - 5, r: 2.5, fill: ARCH_REGISTRY[archs[1]].color, opacity: 0.5 }) : null,\n    ]);\n  })).concat([\n    \n    React.createElement(\"text\", { key: \"lbl-start\", x: pad, y: h - 8, fontSize: \"9\", fill: \"rgba(255,255,255,0.2)\", fontFamily: FB }, totalSessions > maxShow ? \"...\" + (totalSessions - maxShow + 1) : \"1\"),\n    React.createElement(\"text\", { key: \"lbl-end\", x: w - pad, y: h - 8, fontSize: \"9\", fill: \"#6BFFB8\", fontFamily: FB, textAnchor: \"end\" }, \"now\"),\n    React.createElement(\"text\", { key: \"lbl-title\", x: w / 2, y: h - 8, fontSize: \"9\", fill: \"rgba(255,255,255,0.15)\", fontFamily: FB, textAnchor: \"middle\", letterSpacing: \"0.15em\" }, totalSessions + \" SESSIONS\")\n  ]));\n}\n\nfunction PatternWeave({ themeHistory, sessionCount }) {\n  \n  if (!themeHistory) return null;\n  var keys = Object.keys(themeHistory);\n  \n  var recurring = keys.filter(function(k) { return themeHistory[k].appearances.length >= 2; })\n    .sort(function(a, b) { return themeHistory[b].appearances.length - themeHistory[a].appearances.length; })\n    .slice(0, 5);\n  if (recurring.length === 0) return null;\n\n  return React.createElement(\"div\", { style: { display: \"flex\", flexDirection: \"column\", gap: 12, width: \"100%\", maxWidth: 300 } },\n    recurring.map(function(key, i) {\n      var theme = themeHistory[key];\n      var apps = theme.appearances;\n      var latest = apps[apps.length - 1];\n      var first = apps[0];\n      var weightShift = latest.weight - first.weight;\n      var color = NC[i % NC.length];\n      var direction = weightShift > 0 ? \"\u2191\" : weightShift < 0 ? \"\u2193\" : \"\u2192\";\n      var dirColor = weightShift > 0 ? \"#FF6B9D\" : weightShift < 0 ? \"#6BFFB8\" : \"rgba(255,255,255,0.3)\";\n      return React.createElement(\"div\", { key: key, style: { display: \"flex\", alignItems: \"center\", gap: 12, animation: \"riseUp 0.5s ease \" + (i * 0.1) + \"s both\" } }, [\n        React.createElement(\"div\", { key: \"dot\", style: { width: 8, height: 8, borderRadius: \"50%\", background: color, opacity: 0.6, flexShrink: 0 } }),\n        React.createElement(\"div\", { key: \"info\", style: { flex: 1 } }, [\n          React.createElement(\"div\", { key: \"label\", style: { fontSize: 15, color: \"white\", fontFamily: FD, fontStyle: \"italic\" } }, theme.label),\n          React.createElement(\"div\", { key: \"meta\", style: { fontSize: 11, color: \"rgba(255,255,255,0.55)\", fontFamily: FB, marginTop: 2 } },\n            apps.length + \" sessions\" + (apps.length >= 3 ? \" \u2014 this keeps returning\" : \"\"))\n        ]),\n        React.createElement(\"div\", { key: \"shift\", style: { fontSize: 18, color: dirColor, fontFamily: FD, flexShrink: 0 } }, direction)\n      ]);\n    })\n  );\n}\n\nfunction TensionCard({ poleA, poleB, subText, whisper, color, userFragment }) {\n  var c = color || \"#6BB8FF\";\n  var [active, setActive] = useState(null); \n  var [pulseA, setPulseA] = useState(1);\n  var [pulseB, setPulseB] = useState(1);\n\n  function tapA(e) {\n    e.stopPropagation();\n    setActive(\"a\");\n    setPulseA(1.35);\n    setPulseB(0.7);\n    setTimeout(function() { setPulseA(1.15); setPulseB(0.85); }, 600);\n  }\n  function tapB(e) {\n    e.stopPropagation();\n    setActive(\"b\");\n    setPulseB(1.35);\n    setPulseA(0.7);\n    setTimeout(function() { setPulseB(1.15); setPulseA(0.85); }, 600);\n  }\n\n  var lineOpacity = active ? 0.35 : 0.15;\n  return <div style={{ position: \"absolute\", inset: 0, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", justifyContent: \"center\", overflow: \"hidden\" }}>\n    \n    <svg style={{ position: \"absolute\", width: \"100%\", height: \"100%\", opacity: lineOpacity, transition: \"opacity 0.6s\" }}>\n      <line x1=\"12%\" y1=\"50%\" x2=\"88%\" y2=\"50%\" stroke={c} strokeWidth={active ? 2 : 1} strokeDasharray=\"6 10\"><animate attributeName=\"strokeDashoffset\" values=\"0;32\" dur=\"2s\" repeatCount=\"indefinite\"/></line>\n      {[0.35,0.42,0.5,0.58,0.65].map(function(y,i) {\n        return <line key={i} x1=\"18%\" y1={y*100+\"%\"} x2=\"82%\" y2={y*100+\"%\"} stroke={c} strokeWidth={0.5} opacity={0.8-Math.abs(y-0.5)*3} strokeDasharray=\"3 14\"><animate attributeName=\"strokeDashoffset\" values={\"0;\"+(16+i*4)} dur={(1.8+i*0.4)+\"s\"} repeatCount=\"indefinite\"/></line>;\n      })}\n    </svg>\n\n    <div style={{ fontSize: 10, color: c + \"55\", fontFamily: FB, letterSpacing: \"0.3em\", marginBottom: 24, zIndex: 1, animation: \"riseUp 0.6s ease both\" }}>TAP A SIDE</div>\n\n    <div style={{ display: \"flex\", alignItems: \"center\", width: \"100%\", padding: \"0 24px\", zIndex: 1 }}>\n      \n      <div onClick={tapA} style={{ flex: 1, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", cursor: \"pointer\", animation: \"riseUp 0.7s ease 0.1s both\" }}>\n        <div style={{\n          width: 100, height: 100, borderRadius: \"50%\",\n          background: \"radial-gradient(circle at 40% 40%, \" + c + (active === \"a\" ? \"55\" : \"25\") + \", \" + c + \"08)\",\n          border: \"2px solid \" + c + (active === \"a\" ? \"88\" : \"44\"),\n          display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n          boxShadow: \"0 0 \" + (active === \"a\" ? 60 : 25) + \"px \" + c + (active === \"a\" ? \"44\" : \"15\"),\n          transform: \"scale(\" + pulseA + \")\",\n          transition: \"all 0.5s cubic-bezier(.34,1.56,.64,1)\",\n        }}>\n          <span style={{ fontFamily: FB, fontSize: 16, fontWeight: 800, color: active === \"a\" ? \"white\" : c, textAlign: \"center\", lineHeight: 1.2, padding: 8 }}>{poleA}</span>\n        </div>\n      </div>\n\n      \n      <div style={{ width: 14, height: 14, borderRadius: \"50%\", background: c, flexShrink: 0, opacity: active ? 0.6 : 0.25, transform: \"scale(\" + (active ? 1.3 : 1) + \")\", transition: \"all 0.5s\", boxShadow: active ? \"0 0 20px \" + c + \"66\" : \"none\" }} />\n\n      \n      <div onClick={tapB} style={{ flex: 1, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", cursor: \"pointer\", animation: \"riseUp 0.7s ease 0.2s both\" }}>\n        <div style={{\n          width: 100, height: 100, borderRadius: \"50%\",\n          background: \"radial-gradient(circle at 60% 40%, \" + c + (active === \"b\" ? \"55\" : \"25\") + \", \" + c + \"08)\",\n          border: \"2px solid \" + c + (active === \"b\" ? \"88\" : \"44\"),\n          display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n          boxShadow: \"0 0 \" + (active === \"b\" ? 60 : 25) + \"px \" + c + (active === \"b\" ? \"44\" : \"15\"),\n          transform: \"scale(\" + pulseB + \")\",\n          transition: \"all 0.5s cubic-bezier(.34,1.56,.64,1)\",\n        }}>\n          <span style={{ fontFamily: FB, fontSize: 16, fontWeight: 800, color: active === \"b\" ? \"white\" : c, textAlign: \"center\", lineHeight: 1.2, padding: 8 }}>{poleB}</span>\n        </div>\n      </div>\n    </div>\n\n    {subText && <div style={{ fontFamily: FD, fontSize: 17, fontStyle: \"italic\", color: \"rgba(255,255,255,\" + (active ? \"0.65\" : \"0.5\") + \")\", maxWidth: 320, textAlign: \"center\", lineHeight: 1.7, marginTop: 28, zIndex: 1, transition: \"color 0.4s\", animation: \"riseUp 0.8s ease 0.4s both\" }}>{subText}</div>}\n    {userFragment && <div style={{ position: \"absolute\", bottom: 52, left: 28, right: 28, textAlign: \"center\", zIndex: 1, animation: \"riseUp 0.8s ease 0.6s both\" }}>\n      <div style={{ fontSize: 9, color: \"rgba(255,255,255,0.45)\", fontFamily: FB, letterSpacing: \"0.15em\", marginBottom: 5, textTransform: \"uppercase\" }}>you wrote</div>\n      <div style={{ fontSize: 15, color: \"rgba(255,255,255,0.68)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5 }}>{\"\\u201C\"}{userFragment}{\"\\u201D\"}</div>\n    </div>}\n    {whisper && <div style={{ position: \"absolute\", bottom: 28, fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.25em\" }}>{whisper}</div>}\n  </div>;\n}\n\nfunction AccuracySlider({ value, onSlide, color = \"#D6B26D\", leftLabel = \"not quite\", rightLabel = \"exactly this\" }) {\n  var trackRef = React.useRef(null);\n  var [dragging, setDragging] = React.useState(false);\n  function posToValue(clientX) {\n    var r = trackRef.current ? trackRef.current.getBoundingClientRect() : null;\n    if (!r) return value || 50;\n    return Math.round(Math.max(0, Math.min(1, (clientX - r.left) / r.width)) * 100);\n  }\n  function onDown(e) {\n    e.preventDefault(); e.stopPropagation();\n    setDragging(true);\n    var cx = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);\n    onSlide(posToValue(cx));\n  }\n  React.useEffect(function() {\n    if (!dragging) return;\n    function onMove(e) {\n      var cx = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);\n      onSlide(posToValue(cx));\n    }\n    function onUp() { setDragging(false); }\n    window.addEventListener(\"pointermove\", onMove, { passive: true });\n    window.addEventListener(\"pointerup\", onUp);\n    window.addEventListener(\"touchmove\", onMove, { passive: true });\n    window.addEventListener(\"touchend\", onUp);\n    return function() {\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      window.removeEventListener(\"touchmove\", onMove);\n      window.removeEventListener(\"touchend\", onUp);\n    };\n  }, [dragging]);\n  function onUp() { setDragging(false); }\n  var pct = value;\n  var alive = pct >= 68;\n  var away  = pct <= 32;\n\n  return (\n    <div onClick={function(e){ e.stopPropagation(); }} style={{ width:\"100%\", maxWidth:300, marginTop:22, animation:\"riseUp 0.6s ease 1.4s both\" }}>\n      <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:10 }}>\n        <span style={{ fontSize:11, color: away ? \"rgba(255,255,255,0.75)\" : \"rgba(255,255,255,0.35)\", fontFamily:FB, letterSpacing:\"0.05em\", transition:\"color 0.3s\" }}>{leftLabel}</span>\n        <span style={{ fontSize:11, color: alive ? color : \"rgba(255,255,255,0.35)\", fontFamily:FB, letterSpacing:\"0.05em\", transition:\"color 0.3s\" }}>{rightLabel}</span>\n      </div>\n      <div ref={trackRef}\n        onPointerDown={onDown} onTouchStart={onDown}\n        style={{ position:\"relative\", height:6, borderRadius:3, background:\"rgba(255,255,255,0.1)\", cursor:\"pointer\", userSelect:\"none\" }}>\n        <div style={{ position:\"absolute\", left:0, top:0, height:\"100%\", width:pct+\"%\", borderRadius:3,\n          background: alive ? \"linear-gradient(90deg,\"+color+\"66,\"+color+\")\" : away ? \"rgba(255,255,255,0.2)\" : \"linear-gradient(90deg,rgba(255,255,255,0.15),rgba(255,255,255,0.4))\",\n          transition:\"background 0.3s\", boxShadow: alive ? \"0 0 10px \"+color+\"55\" : \"none\" }} />\n        <div style={{ position:\"absolute\", top:\"50%\", left:pct+\"%\", transform:\"translate(-50%,-50%)\",\n          width:18, height:18, borderRadius:\"50%\", background: alive ? color : \"rgba(255,255,255,0.7)\",\n          boxShadow: alive ? \"0 0 14px \"+color+\"88\" : \"0 1px 4px rgba(0,0,0,0.4)\",\n          transition:\"background 0.3s, box-shadow 0.3s\", cursor:\"grab\" }} />\n      </div>\n    </div>\n  );\n}\n\nfunction BookmarkableCard({ text, label, color, children }) {\n  var holdTimer = React.useRef(null);\n  var [holding, setHolding] = React.useState(false);\n  var [saved, setSaved] = React.useState(false);\n  function start(e) {\n    if (saved) return;\n    setHolding(true);\n    holdTimer.current = setTimeout(function() {\n      try {\n        var bm = JSON.parse(localStorage.getItem(\"saycrd-bookmarks\") || \"[]\");\n        bm.push({ text, label, date: new Date().toISOString() });\n        localStorage.setItem(\"saycrd-bookmarks\", JSON.stringify(bm));\n      } catch(e2) {}\n      setSaved(true); setHolding(false);\n      setTimeout(function() { setSaved(false); }, 2500);\n    }, 1200);\n  }\n  function cancel() { clearTimeout(holdTimer.current); setHolding(false); }\n  return (\n    <div onMouseDown={start} onMouseUp={cancel} onMouseLeave={cancel}\n      onTouchStart={start} onTouchEnd={cancel} style={{ position:\"absolute\", inset:0 }}>\n      {children}\n      <div style={{ position:\"absolute\", bottom:28, right:24, fontSize:10, fontFamily:FB,\n        letterSpacing:\"0.1em\", color: saved ? \"#6BFFB8\" : holding ? \"rgba(255,255,255,0.55)\" : \"rgba(255,255,255,0.2)\",\n        transition:\"color 0.25s\", pointerEvents:\"none\", textTransform:\"uppercase\" }}>\n        {saved ? \"\u2713 bookmarked\" : holding ? \"hold...\" : \"hold to bookmark\"}\n      </div>\n    </div>\n  );\n}\n\nfunction UnderneathItem({ text, index }) {\n  var holdTimer = React.useRef(null);\n  var [holding, setHolding] = React.useState(false);\n  var [saved, setSaved] = React.useState(false);\n  var [swipeX, setSwipeX] = React.useState(0);\n  var [swiping, setSwiping] = React.useState(false);\n  var swipeStart = React.useRef(0);\n  var [reaction, setReaction] = React.useState(null);\n  var [noteOpen, setNoteOpen] = React.useState(false);\n  var [noteDraft, setNoteDraft] = React.useState(\"\");\n  var [noteSaved, setNoteSaved] = React.useState(false);\n  var HOLD_MS = 1100; var SWIPE_T = 60;\n\n  function startInteract(clientX, e) {\n    if (reaction) return;\n    e.stopPropagation();\n    swipeStart.current = clientX;\n    setSwiping(true); setSwipeX(0); setHolding(true);\n    holdTimer.current = setTimeout(function() {\n      try {\n        var bm = JSON.parse(localStorage.getItem(\"saycrd-bookmarks\") || \"[]\");\n        bm.push({ text: text, label:\"Underneath\", date:new Date().toISOString() });\n        localStorage.setItem(\"saycrd-bookmarks\", JSON.stringify(bm));\n      } catch(e2) {}\n      setSaved(true); setHolding(false); setSwiping(false);\n    }, HOLD_MS);\n  }\n  function moveInteract(clientX) {\n    if (!swiping || reaction) return;\n    var dx = clientX - swipeStart.current;\n    setSwipeX(dx);\n    if (Math.abs(dx) > 8) { clearTimeout(holdTimer.current); setHolding(false); }\n  }\n  function endInteract() {\n    clearTimeout(holdTimer.current); setHolding(false);\n    if (!swiping) return;\n    setSwiping(false);\n    var dx = swipeX; setSwipeX(0);\n    if (dx < -SWIPE_T) { setReaction(\"landed\"); }\n    else if (dx > SWIPE_T) { setReaction(\"pushed\"); setNoteOpen(true); }\n  }\n\n  var dir = swipeX < -8 ? \"land\" : swipeX > 8 ? \"push\" : null;\n  var bg = saved ? \"rgba(107,255,184,0.1)\"\n    : reaction === \"landed\" ? \"rgba(107,255,184,0.07)\"\n    : reaction === \"pushed\" ? \"rgba(255,96,144,0.07)\"\n    : holding ? \"rgba(184,107,255,0.18)\"\n    : \"rgba(184,107,255,0.07)\";\n  var bord = saved ? \"1px solid rgba(107,255,184,0.3)\"\n    : reaction === \"landed\" ? \"1px solid rgba(107,255,184,0.2)\"\n    : reaction === \"pushed\" ? \"1px solid rgba(255,96,144,0.2)\"\n    : holding ? \"1px solid rgba(184,107,255,0.45)\"\n    : \"1px solid rgba(184,107,255,0.14)\";\n\n  return (\n    <div style={{ animation:\"riseUp 0.5s ease \"+(index*0.15)+\"s both\" }}>\n      <div\n        onMouseDown={function(e){ startInteract(e.clientX,e); }}\n        onMouseMove={function(e){ moveInteract(e.clientX); }}\n        onMouseUp={endInteract} onMouseLeave={endInteract}\n        onTouchStart={function(e){ startInteract(e.touches[0].clientX,e); }}\n        onTouchMove={function(e){ moveInteract(e.touches[0].clientX); }}\n        onTouchEnd={endInteract}\n        onClick={function(e){ e.stopPropagation(); }}\n        style={{ padding:\"14px 18px\", borderRadius:14, background:bg, border:bord,\n          cursor:reaction?\"default\":\"grab\", transition:\"background 0.2s, border 0.2s\",\n          transform:swiping?\"translateX(\"+(swipeX*0.35)+\"px)\":\"none\",\n          userSelect:\"none\", WebkitUserSelect:\"none\" }}>\n        <p style={{ fontSize:17, fontFamily:FD, lineHeight:1.6, margin:\"0 0 6px\",\n          color: reaction===\"landed\" ? \"#6BFFB8\"\n            : reaction===\"pushed\" ? \"rgba(255,255,255,0.3)\"\n            : \"rgba(255,255,255,0.88)\" }}>{text}</p>\n        <div style={{ fontSize:10, fontFamily:FB, letterSpacing:\"0.08em\",\n          color: saved ? \"rgba(107,255,184,0.7)\"\n            : holding ? \"rgba(184,107,255,0.7)\"\n            : reaction===\"landed\" ? \"rgba(107,255,184,0.5)\"\n            : reaction===\"pushed\" ? \"rgba(255,96,144,0.5)\"\n            : dir===\"land\" ? \"rgba(107,255,184,0.4)\"\n            : dir===\"push\" ? \"rgba(255,96,144,0.4)\"\n            : \"rgba(255,255,255,0.18)\" }}>\n          {saved?\"\u2713 bookmarked\":holding?\"hold...\":reaction===\"landed\"?\"resonates \u2190\":reaction===\"pushed\"?\"pushed back \u2192\":dir===\"land\"?\"\u2190 resonates\":dir===\"push\"?\"push back \u2192\":\"hold to save \u00b7 swipe to react\"}\n        </div>\n      </div>\n      {noteOpen && !noteSaved && (\n        <div onClick={function(e){e.stopPropagation();}}\n          style={{ marginTop:8, padding:\"12px 14px\", borderRadius:12,\n            background:\"rgba(255,96,144,0.05)\", border:\"1px solid rgba(255,96,144,0.2)\",\n            animation:\"riseUp 0.3s ease both\" }}>\n          <div style={{ fontSize:11, color:\"rgba(255,96,144,0.65)\", fontFamily:FB,\n            letterSpacing:\"0.1em\", marginBottom:8 }}>what doesn't fit?</div>\n          <textarea value={noteDraft} onChange={function(e){setNoteDraft(e.target.value);}}\n            onKeyDown={function(e){\n              if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();setNoteSaved(true);setNoteOpen(false);}\n              if(e.key===\"Escape\"){setNoteOpen(false);setReaction(null);}\n            }}\n            placeholder=\"type anything \u2014 used as signal, not shown back\"\n            autoFocus\n            style={{ width:\"100%\", minHeight:52, background:\"rgba(255,255,255,0.03)\",\n              border:\"1px solid rgba(255,96,144,0.2)\", borderRadius:8,\n              color:\"rgba(255,255,255,0.85)\", fontFamily:FD, fontSize:14,\n              padding:\"8px 12px\", resize:\"none\", outline:\"none\",\n              lineHeight:1.55, boxSizing:\"border-box\" }} />\n          <div style={{ display:\"flex\", justifyContent:\"space-between\", marginTop:6 }}>\n            <button onClick={function(){setNoteOpen(false);setReaction(null);setNoteDraft(\"\");}}\n              style={{ fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FB,\n                background:\"transparent\", border:\"none\", cursor:\"pointer\" }}>cancel</button>\n            <button onClick={function(){setNoteSaved(true);setNoteOpen(false);}}\n              style={{ fontSize:12, fontFamily:FB, background:\"transparent\",\n                border:\"1px solid rgba(255,96,144,0.25)\", borderRadius:12,\n                padding:\"4px 16px\", cursor:\"pointer\",\n                color:noteDraft.trim()?\"rgba(255,96,144,0.8)\":\"rgba(255,96,144,0.3)\"\n              }}>signal sent</button>\n          </div>\n        </div>\n      )}\n      {noteSaved && (\n        <div style={{ marginTop:4, fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB,\n          paddingLeft:4 }}>incorporated</div>\n      )}\n    </div>\n  );\n}\n\nfunction ArchGlyph({ name, color, size }) {\n  var s = size || 160;\n  var cx = s / 2, cy = s / 2;\n  var nm = (name || \"\").toLowerCase();\n  var c = color || \"#E84393\";\n  var dim = c + \"44\";\n  var mid = c + \"88\";\n\n  \n  var family =\n    /complet|whole|finish|all|full|close|round/.test(nm) ? \"completion\" :\n    /build|make|found|forge|craft|creat|construct/.test(nm) ? \"builder\" :\n    /hold|anchor|ground|root|carry|bear|sustain/.test(nm) ? \"anchor\" :\n    /witness|watch|see|observe|aware|notice/.test(nm) ? \"witness\" :\n    /bridge|connect|link|weave|thread|join|between/.test(nm) ? \"bridge\" :\n    /threshold|door|gate|cross|edge|passage|guardian/.test(nm) ? \"threshold\" :\n    /break|shatter|crack|rupture|burn|fire|collapse/.test(nm) ? \"rupture\" :\n    /bloom|grow|rise|emerge|unfold|open|blossom/.test(nm) ? \"bloom\" :\n    /move|flow|river|change|shift|fluid/.test(nm) ? \"flow\" :\n    /still|quiet|pause|rest|wait|hold/.test(nm) ? \"still\" :\n    \"default\";\n\n  var r = s * 0.36;\n\n  if (family === \"completion\") {\n    \n    var gap = 22 * Math.PI / 180;\n    var startAngle = -Math.PI / 2 + gap / 2;\n    var endAngle = 3 * Math.PI / 2 - gap / 2;\n    var x1 = cx + r * Math.cos(startAngle), y1 = cy + r * Math.sin(startAngle);\n    var x2 = cx + r * Math.cos(endAngle), y2 = cy + r * Math.sin(endAngle);\n    var ir = r * 0.52;\n    var ix1 = cx + ir * Math.cos(startAngle), iy1 = cy + ir * Math.sin(startAngle);\n    var ix2 = cx + ir * Math.cos(endAngle), iy2 = cy + ir * Math.sin(endAngle);\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s} style={{ overflow:\"visible\" }}>\n        <circle cx={cx} cy={cy} r={r * 1.18} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <path d={\"M \"+x1+\" \"+y1+\" A \"+r+\" \"+r+\" 0 1 1 \"+x2+\" \"+y2} fill=\"none\" stroke={mid} strokeWidth=\"2.5\" strokeLinecap=\"round\"/>\n        <path d={\"M \"+ix1+\" \"+iy1+\" A \"+ir+\" \"+ir+\" 0 1 1 \"+ix2+\" \"+iy2} fill=\"none\" stroke={dim} strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\n        <circle cx={x1} cy={y1} r=\"4\" fill={c} opacity=\"0.7\"/>\n        <circle cx={x2} cy={y2} r=\"4\" fill={c} opacity=\"0.7\"/>\n        <line x1={x1} y1={y1} x2={x2} y2={y2} stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.9\">\n          <animate attributeName=\"opacity\" values=\"0.4;1;0.4\" dur=\"3s\" repeatCount=\"indefinite\"/>\n        </line>\n        <circle cx={cx} cy={cy} r=\"5\" fill={c} opacity=\"0.6\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"builder\") {\n    var pts = [cx, cy-r, cx-r*0.8, cy+r*0.55, cx+r*0.8, cy+r*0.55];\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <polygon points={pts.join(\",\")} fill=\"none\" stroke={mid} strokeWidth=\"2.5\" strokeLinejoin=\"round\"/>\n        <polygon points={[cx, cy-r*0.42, cx-r*0.36, cy+r*0.22, cx+r*0.36, cy+r*0.22].join(\",\")} fill={dim} stroke={c} strokeWidth=\"1.5\" strokeLinejoin=\"round\"/>\n        <line x1={cx-r*0.8} y1={cy+r*0.55} x2={cx+r*0.8} y2={cy+r*0.55} stroke={c} strokeWidth=\"2.5\" strokeLinecap=\"round\" opacity=\"0.8\"/>\n        <circle cx={cx} cy={cy-r} r=\"4\" fill={c} opacity=\"0.9\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"witness\") {\n    var spokes = 12;\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        {Array.from({length: spokes}).map(function(_,k) {\n          var a = (k / spokes) * Math.PI * 2;\n          var r1 = r * (k % 2 === 0 ? 0.35 : 0.2);\n          var r2 = r * (k % 2 === 0 ? 0.82 : 0.68);\n          return <line key={k} x1={cx+r1*Math.cos(a)} y1={cy+r1*Math.sin(a)} x2={cx+r2*Math.cos(a)} y2={cy+r2*Math.sin(a)} stroke={k % 2 === 0 ? mid : dim} strokeWidth={k % 2 === 0 ? 1.5 : 1} strokeLinecap=\"round\"/>;\n        })}\n        <circle cx={cx} cy={cy} r={r*0.16} fill={c} opacity=\"0.9\"/>\n        <circle cx={cx} cy={cy} r={r*0.08} fill=\"white\" opacity=\"0.6\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"threshold\") {\n    var pw = r * 0.18, ph = r * 1.1, py = cy - r * 0.55;\n    var archR = r * 0.72;\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <rect x={cx-archR-pw} y={py} width={pw} height={ph} fill={dim} stroke={mid} strokeWidth=\"1.5\" rx=\"2\"/>\n        <rect x={cx+archR} y={py} width={pw} height={ph} fill={dim} stroke={mid} strokeWidth=\"1.5\" rx=\"2\"/>\n        <path d={\"M \"+(cx-archR)+\" \"+py+\" A \"+archR+\" \"+archR+\" 0 0 1 \"+(cx+archR)+\" \"+py} fill=\"none\" stroke={c} strokeWidth=\"2.5\" strokeLinecap=\"round\"/>\n        <line x1={cx-archR*1.3} y1={cy+r*0.55} x2={cx+archR*1.3} y2={cy+r*0.55} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        <circle cx={cx} cy={cy+r*0.1} r=\"4\" fill={c} opacity=\"0.7\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"bridge\") {\n    var bx1 = cx - r * 0.9, bx2 = cx + r * 0.9, by = cy + r * 0.4;\n    var bcy = cy - r * 0.5;\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <path d={\"M \"+bx1+\" \"+by+\" Q \"+cx+\" \"+bcy+\" \"+bx2+\" \"+by} fill=\"none\" stroke={c} strokeWidth=\"3\" strokeLinecap=\"round\"/>\n        {[0.2,0.4,0.5,0.6,0.8].map(function(t,k) {\n          var bx = bx1 + (bx2-bx1)*t;\n          var bt = 1 - Math.abs(t-0.5)*2;\n          var topY = bcy + (by-bcy)*bt*bt;\n          return <line key={k} x1={bx} y1={topY} x2={bx} y2={by} stroke={mid} strokeWidth=\"1.5\" strokeLinecap=\"round\"/>;\n        })}\n        <line x1={bx1-10} y1={by} x2={bx2+10} y2={by} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        <circle cx={bx1} cy={by} r=\"5\" fill={c} opacity=\"0.8\"/>\n        <circle cx={bx2} cy={by} r=\"5\" fill={c} opacity=\"0.8\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"anchor\") {\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <circle cx={cx} cy={cy-r*0.6} r={r*0.18} fill=\"none\" stroke={c} strokeWidth=\"2.5\"/>\n        <line x1={cx} y1={cy-r*0.42} x2={cx} y2={cy+r*0.7} stroke={mid} strokeWidth=\"2.5\" strokeLinecap=\"round\"/>\n        <line x1={cx-r*0.55} y1={cy-r*0.05} x2={cx+r*0.55} y2={cy-r*0.05} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        <path d={\"M \"+(cx-r*0.5)+\" \"+(cy+r*0.7)+\" A \"+(r*0.5)+\" \"+(r*0.5)+\" 0 0 0 \"+(cx+r*0.5)+\" \"+(cy+r*0.7)} fill=\"none\" stroke={c} strokeWidth=\"2.5\" strokeLinecap=\"round\"/>\n        <circle cx={cx-r*0.5} cy={cy+r*0.7} r=\"4\" fill={c} opacity=\"0.8\"/>\n        <circle cx={cx+r*0.5} cy={cy+r*0.7} r=\"4\" fill={c} opacity=\"0.8\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"rupture\") {\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <polyline points={[cx-r*0.7,cy-r*0.5, cx-r*0.1,cy-r*0.1, cx-r*0.4,cy+r*0.1, cx,cy, cx+r*0.2,cy-r*0.2, cx+r*0.5,cy+r*0.6].join(\" \")} fill=\"none\" stroke={c} strokeWidth=\"2.5\" strokeLinejoin=\"round\" strokeLinecap=\"round\"/>\n        {[[cx-r*0.7,cy-r*0.5],[cx-r*0.4,cy+r*0.1],[cx+r*0.5,cy+r*0.6]].map(function(p,k) {\n          return <circle key={k} cx={p[0]} cy={p[1]} r=\"3.5\" fill={c} opacity={0.5+k*0.2}/>;\n        })}\n      </svg>\n    );\n  }\n\n  if (family === \"bloom\") {\n    var petals = 6;\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        {Array.from({length: petals}).map(function(_,k) {\n          var a = (k/petals)*Math.PI*2 - Math.PI/2;\n          var pr = r * 0.48;\n          var px = cx + pr * Math.cos(a), py = cy + pr * Math.sin(a);\n          return <circle key={k} cx={px} cy={py} r={r*0.34} fill=\"none\" stroke={k===0?c:mid} strokeWidth={k===0?\"2\":\"1.5\"} opacity={0.4+k*0.1}/>;\n        })}\n        <circle cx={cx} cy={cy} r={r*0.18} fill={c} opacity=\"0.8\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"still\") {\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <circle cx={cx} cy={cy} r={r*0.8} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <circle cx={cx} cy={cy} r={r*0.45} fill=\"none\" stroke={mid} strokeWidth=\"1.5\"/>\n        <circle cx={cx} cy={cy} r={r*0.12} fill={c} opacity=\"0.9\"/>\n        <line x1={cx} y1={cy-r*1.1} x2={cx} y2={cy-r*0.85} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        <line x1={cx} y1={cy+r*0.85} x2={cx} y2={cy+r*1.1} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        <line x1={cx-r*1.1} y1={cy} x2={cx-r*0.85} y2={cy} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n        <line x1={cx+r*0.85} y1={cy} x2={cx+r*1.1} y2={cy} stroke={mid} strokeWidth=\"2\" strokeLinecap=\"round\"/>\n      </svg>\n    );\n  }\n\n  if (family === \"flow\") {\n    var pts2 = [];\n    for (var t2=0; t2<=1; t2+=0.04) {\n      var wx = cx + r * 1.1 * (t2*2-1);\n      var wy = cy + r * 0.5 * Math.sin(t2 * Math.PI * 2.5);\n      pts2.push(wx+\",\"+wy);\n    }\n    return (\n      <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n        <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n        <polyline points={pts2.join(\" \")} fill=\"none\" stroke={c} strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        <polyline points={pts2.map(function(p){var parts=p.split(\",\");return parts[0]+\",\"+(parseFloat(parts[1])+r*0.28);}).join(\" \")} fill=\"none\" stroke={dim} strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        <circle cx={cx} cy={cy} r=\"4.5\" fill={c} opacity=\"0.9\"/>\n      </svg>\n    );\n  }\n\n  \n  return (\n    <svg viewBox={\"0 0 \"+s+\" \"+s} width={s} height={s}>\n      <circle cx={cx} cy={cy} r={r*1.2} fill=\"none\" stroke={dim} strokeWidth=\"1\"/>\n      <circle cx={cx} cy={cy} r={r} fill=\"none\" stroke={mid} strokeWidth=\"2\"/>\n      <polygon points={[\n        cx+\",\"+(cy-r*0.72),\n        cx+r*0.62+\",\"+(cy+r*0.36),\n        cx-r*0.62+\",\"+(cy+r*0.36)\n      ].join(\" \")} fill=\"none\" stroke={mid} strokeWidth=\"2\" strokeLinejoin=\"round\"/>\n      <polygon points={[\n        cx+\",\"+(cy+r*0.72),\n        cx+r*0.62+\",\"+(cy-r*0.36),\n        cx-r*0.62+\",\"+(cy-r*0.36)\n      ].join(\" \")} fill=\"none\" stroke={dim} strokeWidth=\"1.5\" strokeLinejoin=\"round\"/>\n      <circle cx={cx} cy={cy} r=\"5\" fill={c} opacity=\"0.9\"/>\n    </svg>\n  );\n}\n\nfunction hexDarken(hex, opacity) {\n  try {\n    var r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);\n    var dr = Math.round(r * opacity), dg = Math.round(g * opacity), db = Math.round(b * opacity);\n    return \"rgb(\"+dr+\",\"+dg+\",\"+db+\")\";\n  } catch(e) { return \"#1A0A2E\"; }\n}\n\nfunction FieldConditionCard({ themes, sd, primaryArch, sessionCount, portrait, portraitReady, goNext }) {\n        themes = themes || []; sd = sd || {};\n\n        \n        \n        var [_fcPhrase, _fcSetPhrase] = useState(null);\n        var [_fcLoading, _fcSetLoading] = useState(true);\n        var _fcColors = themes.slice(0,6).map(function(t){return t.color;});\n        var _fcBg1 = _fcColors[0] || \"#E84393\";\n        var _fcBg2 = _fcColors[1] || \"#6BB8FF\";\n        var _fcBg3 = _fcColors[2] || \"#6BFFB8\";\n\n        useEffect(function() {\n          \n          if (portrait && portrait.fieldCondition) {\n            _fcSetPhrase({ condition: portrait.fieldCondition, undercurrent: portrait.undercurrent || \"\" });\n            _fcSetLoading(false);\n            return;\n          }\n          if (portraitReady && !portrait) {\n            \n            var cancelled = false;\n            (async function() {\n              try {\n                var themeList = themes.map(function(t){return t.label+\"(\"+t.weight+\")\";}).join(\", \");\n                var p = \"Field quality in 2-4 words (not generic). Themes: \"+themeList+\". JSON: {\\\"phrase\\\":\\\"words\\\",\\\"undercurrent\\\":\\\"sentence 10-14 words\\\"}\";\n                var rr = await callClaude(p, \"fc\", 80);\n                if (!cancelled) { var dd = parseJSON(rr); if (dd) { if (dd.phrase && !dd.condition) dd.condition = dd.phrase; _fcSetPhrase(dd); } }\n              } catch(e) {} finally { if (!cancelled) _fcSetLoading(false); }\n            })();\n            return function(){ cancelled = true; };\n          }\n        }, [portrait, portraitReady]);\n\n        var _condWords = (_fcPhrase && _fcPhrase.condition) ? _fcPhrase.condition.split(\" \") : [];\n        var _condSizes = [72, 56, 48, 40]; \n        var _numThemes = themes.length;\n        var _numConns = (sd && sd.connections || []).length;\n\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\", background:\"#030308\" }}>\n            \n            {_fcColors.map(function(col, ci) {\n              var angles = [15, 75, 135, 200, 270, 330];\n              var radii = [55, 45, 60, 50, 55, 45];\n              var angle = (angles[ci] || ci*60) * Math.PI / 180;\n              var r = radii[ci] || 50;\n              var bx = 50 + Math.cos(angle) * r;\n              var by = 42 + Math.sin(angle) * r;\n              return <div key={ci} style={{\n                position:\"absolute\",\n                left: bx+\"%\", top: by+\"%\",\n                transform:\"translate(-50%,-50%)\",\n                width: 280 + ci*30, height: 280 + ci*30,\n                borderRadius:\"50%\",\n                background:\"radial-gradient(circle, \"+col+\"28 0%, \"+col+\"08 50%, transparent 72%)\",\n                filter:\"blur(55px)\",\n                pointerEvents:\"none\",\n                animation:\"breathe \"+(3+ci*0.7)+\"s ease-in-out infinite alternate\"\n              }}/>;\n            })}\n\n            \n            <svg style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\", opacity:0.25, pointerEvents:\"none\" }}>\n              {themes.map(function(t, ti) {\n                var angle = (ti / themes.length) * 2 * Math.PI - Math.PI/2;\n                var rx = 32, ry = 28;\n                var cx2 = 50 + Math.cos(angle)*rx;\n                var cy2 = 42 + Math.sin(angle)*ry;\n                return <g key={ti}>\n                  <circle cx={cx2+\"%\"} cy={cy2+\"%\"} r=\"2.5\" fill={t.color} opacity=\"0.7\"/>\n                  {themes.slice(ti+1, ti+3).map(function(t2, li){\n                    var angle2 = ((ti+li+1) / themes.length) * 2 * Math.PI - Math.PI/2;\n                    var cx3 = 50 + Math.cos(angle2)*rx;\n                    var cy3 = 42 + Math.sin(angle2)*ry;\n                    return <line key={li} x1={cx2+\"%\"} y1={cy2+\"%\"} x2={cx3+\"%\"} y2={cy3+\"%\"}\n                      stroke={t.color} strokeWidth=\"0.5\" opacity=\"0.3\"/>;\n                  })}\n                </g>;\n              })}\n            </svg>\n\n            \n            <div style={{ position:\"absolute\", top:46, left:24, fontSize:9, letterSpacing:\"0.5em\", color:\"rgba(255,255,255,0.1)\", fontFamily:FB }}>SAYCRD</div>\n\n            \n            <div style={{ position:\"absolute\", top:44, right:24, textAlign:\"right\" }}>\n              <div style={{ fontSize:8, letterSpacing:\"0.25em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\" }}>\n                {sessionCount > 1 ? \"SESSION \"+sessionCount : \"FIRST SESSION\"}\n              </div>\n            </div>\n\n            \n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"flex-start\", justifyContent:\"center\", padding:\"80px 28px 160px\", overflowX:\"hidden\" }}>\n              {_fcLoading ? (\n                <div style={{ display:\"flex\", flexDirection:\"column\", gap:16 }}>\n                  {[90,64,48].map(function(sz,i){\n                    return <div key={i} style={{ height:sz*0.85, width:[220,160,120][i], borderRadius:8,\n                      background:\"rgba(255,255,255,0.04)\", animation:\"breathe 1.5s ease-in-out \"+(i*0.2)+\"s infinite alternate\" }}/>;\n                  })}\n                </div>\n              ) : (\n                <>\n                  \n                  <div style={{ fontSize:10, letterSpacing:\"0.45em\", color:_fcBg2, fontFamily:FB, textTransform:\"uppercase\", marginBottom:20, animation:\"riseUp 0.6s ease both\",\n                    textShadow:\"0 0 20px \"+_fcBg2+\"66\" }}>\n                    THE FIELD CONDITION\n                  </div>\n                  \n                  <div style={{ display:\"flex\", flexDirection:\"column\", gap:2, marginBottom:32 }}>\n                    {_condWords.map(function(word, wi) {\n                      var sz = wi===0 ? 72 : wi===1 ? 58 : wi===2 ? 46 : 38;\n                      var col = _fcColors[wi] || \"rgba(255,255,255,0.9)\";\n                      return (\n                        <div key={wi} style={{\n                          fontSize: sz,\n                          fontWeight: 700,\n                          color: \"white\",\n                          fontFamily: FB,\n                          letterSpacing: \"-0.02em\",\n                          lineHeight: 0.92,\n                          textShadow: \"0 0 80px \"+col+\"66, 0 0 30px \"+col+\"33\",\n                          animation: \"riseUp 0.7s ease \"+(0.1+wi*0.12)+\"s both\"\n                        }}>\n                          {word}\n                        </div>\n                      );\n                    })}\n                  </div>\n                  \n                  {_fcPhrase && _fcPhrase.undercurrent && (\n                    <div style={{\n                      fontSize: 15,\n                      color: \"rgba(255,255,255,0.55)\",\n                      fontFamily: FD,\n                      fontStyle: \"italic\",\n                      lineHeight: 1.65,\n                      maxWidth: 290,\n                      animation: \"riseUp 0.8s ease 0.55s both\"\n                    }}>\n                      {_fcPhrase.undercurrent}\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n\n            \n            <div style={{ position:\"absolute\", bottom:0, left:0, right:0, padding:\"20px 24px 32px\",\n              background:\"linear-gradient(0deg, rgba(3,3,8,0.95) 0%, transparent 100%)\", cursor:\"pointer\" }} onClick={function(e){ e.stopPropagation(); if(goNext) goNext(); }}>\n              \n              <div style={{ display:\"flex\", gap:2, marginBottom:14, height:3, borderRadius:2, overflow:\"hidden\" }}>\n                {themes.map(function(t,ti){\n                  return <div key={ti} style={{ flex: t.weight||1, background:t.color, opacity:0.85 }}/>;\n                })}\n              </div>\n              \n              <div style={{ display:\"flex\", gap:20, alignItems:\"center\" }}>\n                <div style={{ textAlign:\"center\" }}>\n                  <div style={{ fontSize:28, fontWeight:700, color:\"white\", fontFamily:FB, lineHeight:1 }}>{_numThemes}</div>\n                  <div style={{ fontSize:10, color:\"rgba(255,255,255,0.6)\", fontFamily:FB, letterSpacing:\"0.15em\", textTransform:\"uppercase\", marginTop:4 }}>themes</div>\n                </div>\n                <div style={{ width:1, height:36, background:\"rgba(255,255,255,0.12)\" }}/>\n                <div style={{ textAlign:\"center\" }}>\n                  <div style={{ fontSize:28, fontWeight:700, color:\"white\", fontFamily:FB, lineHeight:1 }}>{_numConns}</div>\n                  <div style={{ fontSize:10, color:\"rgba(255,255,255,0.6)\", fontFamily:FB, letterSpacing:\"0.15em\", textTransform:\"uppercase\", marginTop:4 }}>connections</div>\n                </div>\n                {primaryArch && <>\n                  <div style={{ width:1, height:36, background:\"rgba(255,255,255,0.12)\" }}/>\n                  <div onClick={function(e){ e.stopPropagation(); if(goNext) goNext(); }} style={{ display:\"flex\", alignItems:\"center\", gap:10, cursor:\"pointer\" }}>\n                    <ArchGlyph name={primaryArch.name||\"\"} color={_fcBg1} size={30}/>\n                    <div style={{ fontSize:12, color:\"rgba(255,255,255,0.75)\", fontFamily:FB, letterSpacing:\"0.1em\", textTransform:\"uppercase\", fontWeight:600 }}>{primaryArch.name}</div>\n                  </div>\n                </>}\n                <div style={{ marginLeft:\"auto\" }}>\n                  <div style={{ display:\"flex\", gap:5 }}>\n                    {_fcColors.slice(0,5).map(function(col,ci){\n                      return <div key={ci} style={{ width:7, height:7, borderRadius:\"50%\", background:col, opacity:0.7 }}/>;\n                    })}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            \n      \n          {goNext && (\n            <div style={{ position:\"absolute\", bottom:0, left:0, right:0, height:80,\n              display:\"flex\", alignItems:\"flex-end\", justifyContent:\"center\",\n              paddingBottom:20, opacity:0, transition:\"opacity 0.2s\" }}\n              onMouseEnter={function(e){ e.currentTarget.style.opacity=\"1\"; }}\n              onMouseLeave={function(e){ e.currentTarget.style.opacity=\"0\"; }}\n              onClick={function(e){ e.stopPropagation(); goNext(); }}>\n              <div style={{ fontSize:11, color:\"rgba(255,255,255,0.7)\", fontFamily:FB,\n                letterSpacing:\"0.25em\", cursor:\"pointer\" }}>NEXT \u2192</div>\n            </div>\n          )}\n          </div>\n        );\n}\n\nfunction ArchBillboardCard({ themes, sd, primaryArch, archColor, sessionCount, prevArch, allSessions, portrait, portraitReady, goNext }) {\n        archColor = archColor || (themes && themes[0] && themes[0].color) || \"#E84393\";\n\n        \n        var _ab = primaryArch || (sd && sd.archetypes && sd.archetypes[0]) || null;\n        var _abName = _ab ? (_ab.name || \"\") : \"THE UNKNOWN\";\n        var _abColor = _ab ? (_ab.color || archColor) : archColor;\n        var _abWords = _abName.split(\" \");\n\n        \n        var _abBg = \"linear-gradient(145deg, \"+hexDarken(_abColor, 0.18)+\" 0%, \"+hexDarken(_abColor, 0.28)+\" 40%, #050208 100%)\";\n\n        \n        var [_abLine, _abSetLine] = useState(null);\n        var [_abLoaded, _abSetLoaded] = useState(false);\n\n        useEffect(function() {\n            if (portrait && portrait.archetypeRecognition) {\n              _abSetLine({\n                recognition: portrait.archetypeRecognition,\n                shift: portrait.archetypeShift || null,\n                shifted: !!(prevArch && prevArch.name !== _abName)\n              });\n              _abSetLoaded(true);\n              return;\n            }\n            if (portraitReady && !portrait) {\n              var cancelled = false;\n              (async function() {\n                try {\n                  var themeCtx = themes.slice(0,4).map(function(t){return t.label;}).join(\", \");\n                  var _prevArchName2 = prevArch ? prevArch.name : \"\";\n                  var _shifted2 = _prevArchName2 && _prevArchName2 !== _abName;\n                  var p = \"Archetype: \"+_abName+\". Prev: \"+(_prevArchName2||\"none\")+\". Themes: \"+themeCtx+\". Write a recognition sentence (10-16 words, bold, use 'You') and a shift phrase (3-5 words). JSON: {\\\"recognition\\\":\\\"...\\\",\\\"shift\\\":\\\"...\\\",\\\"shifted\\\":\"+(_shifted2?\"true\":\"false\")+\"}\";\n                  var rr = await callClaude(p, \"arch\", 120);\n                  if (!cancelled) {\n                    var dd = parseJSON(rr);\n                    _abSetLine(dd&&dd.recognition ? dd : null);\n                  }\n                } catch(e) {} finally { if (!cancelled) _abSetLoaded(true); }\n              })();\n              return function(){ cancelled = true; };\n            }\n          }, [portrait, portraitReady]);\n\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\", background:_abBg }}>\n            \n            <div style={{ position:\"absolute\", top:\"50%\", left:\"50%\", transform:\"translate(-50%,-50%)\",\n              opacity:0.06, pointerEvents:\"none\" }}>\n              <ArchGlyph name={_abName} color={_abColor} size={400}/>\n            </div>\n\n            \n            <div style={{ position:\"absolute\", top:0, left:0, right:0, height:\"55%\",\n              background:\"linear-gradient(180deg, \"+_abColor+\"18 0%, transparent 100%)\",\n              pointerEvents:\"none\" }}/>\n\n            \n            <div style={{ position:\"absolute\", top:100, left:24, right:24, height:1,\n              background:\"linear-gradient(90deg, \"+_abColor+\"88, \"+_abColor+\"22, transparent)\",\n              animation:\"riseUp 0.6s ease 0.2s both\" }}/>\n\n            \n            <div style={{ position:\"absolute\", top:46, left:24, fontSize:9, letterSpacing:\"0.5em\",\n              color:_abColor+\"44\", fontFamily:FB }}>SAYCRD</div>\n\n            \n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\",\n              justifyContent:\"center\", padding:\"100px 28px 120px\" }}>\n\n              \n              <div style={{ fontSize:9, letterSpacing:\"0.5em\", color:_abColor+\"BB\",\n                fontFamily:FB, textTransform:\"uppercase\", marginBottom:18,\n                animation:\"riseUp 0.6s ease both\" }}>\n                YOUR ARCHETYPE\n              </div>\n\n              \n              <div style={{ marginBottom:36, maxWidth:\"100%\", overflow:\"hidden\" }}>\n                {_abWords.map(function(word, wi) {\n                  var isLast = wi === _abWords.length - 1;\n                  var _baseSz = _abWords.length === 1 ? 72 : _abWords.length === 2 ? (wi===0?52:72) : (wi===0?44:wi===1?66:52);\n                  \n                  var _wordLen = word.length;\n                  var _scale = _wordLen <= 6 ? 1 : _wordLen <= 9 ? 0.82 : _wordLen <= 12 ? 0.68 : 0.56;\n                  var sz = Math.round(_baseSz * _scale);\n                  return (\n                    <div key={wi} style={{\n                      fontSize: sz,\n                      fontWeight: isLast ? 700 : 300,\n                      maxWidth:\"100%\", overflow:\"hidden\", wordBreak:\"break-word\",\n                      color: isLast ? \"white\" : _abColor+\"CC\",\n                      fontFamily: FB,\n                      letterSpacing: isLast ? \"-0.02em\" : \"0.1em\",\n                      lineHeight: 0.95,\n                      textTransform: \"uppercase\",\n                      textShadow: isLast ? \"0 0 100px \"+_abColor+\"44\" : \"none\",\n                      animation: \"riseUp 0.8s ease \"+(0.05+wi*0.1)+\"s both\"\n                    }}>\n                      {word}\n                    </div>\n                  );\n                })}\n              </div>\n\n              \n              <div style={{ width:48, height:2, background:_abColor, marginBottom:24,\n                animation:\"riseUp 0.5s ease 0.4s both\", borderRadius:1 }}/>\n\n              \n              <div style={{ minHeight:80, animation:\"riseUp 0.8s ease 0.5s both\" }}>\n                {!_abLoaded ? (\n                  <div style={{ display:\"flex\", flexDirection:\"column\", gap:8 }}>\n                    <div style={{ width:140, height:10, borderRadius:3,\n                      background:\"rgba(255,255,255,0.08)\", animation:\"breathe 1.5s ease-in-out infinite alternate\" }}/>\n                    <div style={{ width:280, height:22, borderRadius:3,\n                      background:\"rgba(255,255,255,0.05)\", animation:\"breathe 1.5s ease-in-out 0.2s infinite alternate\" }}/>\n                    <div style={{ width:220, height:22, borderRadius:3,\n                      background:\"rgba(255,255,255,0.04)\", animation:\"breathe 1.5s ease-in-out 0.4s infinite alternate\" }}/>\n                  </div>\n                ) : _abLine ? (\n                  <div>\n                    \n                    {_abLine.shift && (\n                      <div style={{\n                        display:\"inline-flex\", alignItems:\"center\", gap:8,\n                        marginBottom:12,\n                        padding:\"4px 12px 4px 0\"\n                      }}>\n                        {_abLine.shifted && (\n                          <div style={{ width:6, height:6, borderRadius:\"50%\",\n                            background:_abColor, boxShadow:\"0 0 8px \"+_abColor }}/>\n                        )}\n                        <div style={{\n                          fontSize:10, letterSpacing:\"0.4em\",\n                          color:_abColor,\n                          fontFamily:FB, textTransform:\"uppercase\",\n                          fontWeight:600\n                        }}>\n                          {_abLine.shift}\n                        </div>\n                      </div>\n                    )}\n                    \n                    <div style={{\n                      fontSize: _abLine.recognition && _abLine.recognition.length > 65 ? 18 : _abLine.recognition && _abLine.recognition.length > 45 ? 21 : 24,\n                      fontWeight:800,\n                      color:\"rgba(255,255,255,0.97)\",\n                      fontFamily:FB,\n                      lineHeight:1.3,\n                      letterSpacing:\"-0.015em\",\n                      textShadow:\"0 2px 40px rgba(0,0,0,0.6), 0 0 60px \"+_abColor+\"22\"\n                    }}>\n                      {_abLine.recognition}\n                    </div>\n                  </div>\n                ) : (\n                  <div style={{ fontSize:20, fontWeight:700, color:\"rgba(255,255,255,0.9)\",\n                    fontFamily:FB, lineHeight:1.3 }}>\n                    You hold what others cannot yet name.\n                  </div>\n                )}\n              </div>\n            </div>\n\n            \n            <div style={{ position:\"absolute\", bottom:0, left:0, right:0,\n              padding:\"16px 24px 30px\",\n              background:\"linear-gradient(0deg, rgba(3,2,8,0.9) 0%, transparent 100%)\" }}>\n              <div style={{ display:\"flex\", gap:6, marginBottom:12, height:2, borderRadius:1, overflow:\"hidden\" }}>\n                {themes.map(function(t,ti){\n                  return <div key={ti} style={{ flex:t.weight||1, background:t.color, opacity:0.7 }}/>;\n                })}\n              </div>\n              <div style={{ display:\"flex\", justifyContent:\"space-between\", alignItems:\"center\" }}>\n                <div style={{ fontSize:10, color:\"rgba(255,255,255,0.35)\", fontFamily:FB,\n                  letterSpacing:\"0.15em\", textTransform:\"uppercase\" }}>\n                  {sessionCount > 1 ? \"SESSION \"+sessionCount : \"FIRST SESSION\"}\n                </div>\n                <div style={{ display:\"flex\", alignItems:\"center\", gap:12 }}>\n                  <div style={{ display:\"flex\", gap:5 }}>\n                    {themes.slice(0,5).map(function(t,ti){\n                      return <div key={ti} style={{ width:6, height:6, borderRadius:\"50%\", background:t.color, opacity:0.65 }}/>;\n                    })}\n                  </div>\n                  \n                </div>\n              </div>\n            </div>\n          </div>\n        );\n}\n\nfunction DepthsFieldCard({ themes, sd, tension, sessionCount, portrait, portraitReady, goNext }) {\n        themes = themes || []; sd = sd || {};\n\n        \n        var _dUnder = typeof (sd && sd.underneath) === \"string\" ? sd.underneath : \"\";\n        var _dBlind = typeof (sd && sd.blind_spot) === \"string\" ? sd.blind_spot : \"\";\n        var _dTension = tension && tension.a && tension.b ? String(tension.a) + \" and \" + String(tension.b) : \"\";\n\n        var [_dLine, _dSetLine] = useState(null);\n        var [_dReady, _dSetReady] = useState(false);\n\n        useEffect(function() {\n          if (portrait && portrait.depths) {\n            _dSetLine(portrait.depths);\n            _dSetReady(true);\n            return;\n          }\n          if (portraitReady && !portrait) {\n            var cancelled = false;\n            (async function() {\n              try {\n                var under = typeof (sd&&sd.underneath)===\"string\" ? sd.underneath : \"\";\n                var blind = typeof (sd&&sd.blind_spot)===\"string\" ? sd.blind_spot : \"\";\n                var p = \"One sentence (10-14 words): what is just out of sight in this person's field? From: underneath=\"+under+\" blind_spot=\"+blind+\". JSON: {\\\"revelation\\\":\\\"sentence\\\"}\";\n                var rr = await callClaude(p, \"df\", 80);\n                if (!cancelled) { var dd = parseJSON(rr); if (dd&&dd.revelation) _dSetLine(dd.revelation); }\n              } catch(e) {} finally { if (!cancelled) _dSetReady(true); }\n            })();\n            return function(){ cancelled = true; };\n          }\n        }, [portrait, portraitReady]);\n\n        \n        var _dParticles = useMemo(function() {\n          var pts = [];\n          for (var pi = 0; pi < 38; pi++) {\n            var seed = pi * 137.508;\n            pts.push({\n              x: ((seed * 7.3) % 100),\n              y: ((seed * 3.1) % 100),\n              size: 1 + (pi % 3) * 0.8,\n              dur: 6 + (pi % 5) * 2.4,\n              delay: -(pi % 7) * 1.3,\n              opacity: 0.15 + (pi % 4) * 0.12,\n              color: [\"#4EC9B8\",\"#6BB8FF\",\"#A78BFA\",\"#7FFFD4\",\"#38BDF8\"][pi % 5]\n            });\n          }\n          return pts;\n        }, []);\n\n        \n        var _dShafts = useMemo(function() {\n          return [\n            { x: 18, w: 6,  dur: 8,  delay: 0,    opacity: 0.04 },\n            { x: 42, w: 10, dur: 11, delay: -3,   opacity: 0.06 },\n            { x: 67, w: 7,  dur: 9,  delay: -5.5, opacity: 0.05 },\n            { x: 82, w: 5,  dur: 13, delay: -1.5, opacity: 0.03 },\n          ];\n        }, []);\n\n        var _depthText = _dLine || (_dUnder && typeof _dUnder === \"string\" && _dUnder.length > 0 ? _dUnder.split(\".\")[0] + \".\" : \"Something waits beneath the words you chose.\");\n\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n            background:\"linear-gradient(180deg, #021018 0%, #010C1A 20%, #040A22 45%, #05072A 68%, #03041A 85%, #010208 100%)\" }}>\n\n            \n            <div style={{ position:\"absolute\", inset:0, pointerEvents:\"none\" }}>\n              \n              <div style={{ position:\"absolute\", top:0, left:0, right:0, height:\"22%\",\n                background:\"linear-gradient(180deg, #0A3A4A44 0%, transparent 100%)\" }}/>\n              \n              <div style={{ position:\"absolute\", top:\"25%\", left:0, right:0, height:\"35%\",\n                background:\"linear-gradient(180deg, transparent, #050A3022 50%, transparent)\" }}/>\n              \n              <div style={{ position:\"absolute\", bottom:0, left:0, right:0, height:\"38%\",\n                background:\"linear-gradient(0deg, #03010F 0%, #06041A44 60%, transparent 100%)\" }}/>\n            </div>\n\n            \n            {_dShafts.map(function(sh, si) {\n              return (\n                <div key={si} style={{\n                  position:\"absolute\",\n                  top:0,\n                  left: sh.x + \"%\",\n                  width: sh.w + \"%\",\n                  height:\"60%\",\n                  background:\"linear-gradient(180deg, rgba(107,200,255,\"+sh.opacity+\") 0%, rgba(78,160,200,\"+Math.round(sh.opacity*0.4*100)/100+\") 40%, transparent 100%)\",\n                  transform:\"skewX(-8deg)\",\n                  transformOrigin:\"top center\",\n                  animation:\"shaftPulse \"+sh.dur+\"s ease-in-out \"+sh.delay+\"s infinite\",\n                  pointerEvents:\"none\"\n                }}/>\n              );\n            })}\n\n            \n            <svg style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\", overflow:\"visible\", pointerEvents:\"none\" }}>\n              {_dParticles.map(function(p, pi) {\n                return (\n                  <circle key={pi}\n                    cx={p.x+\"%\"} cy={p.y+\"%\"}\n                    r={p.size}\n                    fill={p.color}\n                    opacity={p.opacity}>\n                    <animate attributeName=\"cy\"\n                      values={p.y+\"%;\"+(p.y-28)+\"%;\"+(p.y-56)+\"%\"}\n                      dur={p.dur+\"s\"}\n                      begin={p.delay+\"s\"}\n                      repeatCount=\"indefinite\"\n                      calcMode=\"linear\"/>\n                    <animate attributeName=\"opacity\"\n                      values={p.opacity+\";\"+Math.min(p.opacity*2.5,0.7)+\";0\"}\n                      dur={p.dur+\"s\"}\n                      begin={p.delay+\"s\"}\n                      repeatCount=\"indefinite\"/>\n                    <animate attributeName=\"r\"\n                      values={p.size+\";\"+(p.size*1.6)+\";0\"}\n                      dur={p.dur+\"s\"}\n                      begin={p.delay+\"s\"}\n                      repeatCount=\"indefinite\"/>\n                  </circle>\n                );\n              })}\n            </svg>\n\n            \n            {[22, 45, 68].map(function(pct, li) {\n              return (\n                <div key={li} style={{\n                  position:\"absolute\",\n                  top: pct+\"%\",\n                  left:0, right:0,\n                  height:1,\n                  background:\"linear-gradient(90deg, transparent, rgba(107,184,255,\"+(0.04+li*0.02)+\") 30%, rgba(107,184,255,\"+(0.06+li*0.02)+\") 60%, transparent)\",\n                  pointerEvents:\"none\"\n                }}/>\n              );\n            })}\n\n            \n            <div style={{ position:\"absolute\", top:46, left:0, right:0, textAlign:\"center\" }}>\n              <div style={{ fontSize:8, letterSpacing:\"0.5em\", color:\"rgba(107,200,255,0.3)\",\n                fontFamily:FB, textTransform:\"uppercase\" }}>SAYCRD</div>\n            </div>\n\n            \n            <div style={{ position:\"absolute\", top:\"28%\", left:0, right:0, textAlign:\"center\",\n              animation:\"riseUp 0.8s ease 0.1s both\" }}>\n              <div style={{ fontSize:9, letterSpacing:\"0.55em\", color:\"rgba(107,200,255,0.22)\",\n                fontFamily:FB, textTransform:\"uppercase\", marginBottom:12 }}>DESCENDING INTO</div>\n              <div style={{ fontSize:38, fontWeight:700, color:\"rgba(200,235,255,0.88)\", fontFamily:FB,\n                letterSpacing:\"0.04em\", textTransform:\"uppercase\", lineHeight:1.1,\n                textShadow:\"0 0 60px rgba(107,184,255,0.25)\" }}>\n                DEPTHS\n              </div>\n              <div style={{ fontSize:38, fontWeight:300, color:\"rgba(150,200,255,0.5)\", fontFamily:FB,\n                letterSpacing:\"0.18em\", textTransform:\"uppercase\", lineHeight:1.1 }}>\n                OF THE FIELD\n              </div>\n            </div>\n\n            \n            <div style={{ position:\"absolute\", bottom:0, left:0, right:0,\n              padding:\"0 28px 44px\",\n              background:\"linear-gradient(0deg, #010208 0%, #02030F88 50%, transparent 100%)\" }}>\n\n              \n              <div style={{ width:\"100%\", height:1, marginBottom:22,\n                background:\"linear-gradient(90deg, transparent, rgba(107,184,255,0.3) 30%, rgba(164,220,255,0.5) 60%, rgba(107,184,255,0.2) 80%, transparent)\",\n                animation:\"riseUp 0.6s ease 0.3s both\" }}/>\n\n              \n              <div style={{ fontSize:8, letterSpacing:\"0.4em\", color:\"rgba(107,200,255,0.35)\",\n                fontFamily:FB, textTransform:\"uppercase\", marginBottom:12,\n                animation:\"riseUp 0.7s ease 0.4s both\" }}>\n                JUST OUT OF SIGHT\n              </div>\n\n              \n              <div style={{ fontSize:16, color:\"rgba(200,230,255,0.72)\", fontFamily:FD,\n                fontStyle:\"italic\", lineHeight:1.7, maxWidth:310,\n                minHeight:52,\n                animation:\"riseUp 0.9s ease 0.5s both\" }}>\n                {!_dReady ? (\n                  <div style={{ display:\"flex\", flexDirection:\"column\", gap:8 }}>\n                    <div style={{ width:\"88%\", height:14, borderRadius:3,\n                      background:\"rgba(107,184,255,0.07)\", animation:\"breathe 1.8s ease-in-out infinite alternate\" }}/>\n                    <div style={{ width:\"65%\", height:14, borderRadius:3,\n                      background:\"rgba(107,184,255,0.05)\", animation:\"breathe 1.8s ease-in-out 0.3s infinite alternate\" }}/>\n                  </div>\n                ) : _depthText}\n              </div>\n\n              \n              <div style={{ display:\"flex\", gap:5, marginTop:18 }}>\n                {themes.map(function(t,ti){\n                  return <div key={ti} style={{ width:5, height:5, borderRadius:\"50%\",\n                    background:t.color, opacity:0.25 }}/>;\n                })}\n              </div>\n            </div>\n      \n          </div>\n        );\n}\n\nfunction WhatsGrowingCard({ themes, sessionCount, goNext }) {\n  themes = themes || [];\n\n  \n  var _allSessions = (function() {\n    try { return loadSessions(); } catch(e) { return []; }\n  })();\n  var _recent = _allSessions.slice(-5);\n\n  var _wgFreq = {};\n  var _allColors = {};\n  _recent.forEach(function(s, si) {\n    var w = si + 1;\n    (s.themes || []).forEach(function(t) {\n      if (!t.label) return;\n      _wgFreq[t.label] = (_wgFreq[t.label] || 0) + w;\n      if (t.color) _allColors[t.label] = t.color;\n    });\n  });\n  themes.forEach(function(t) {\n    if (!t.label) return;\n    _wgFreq[t.label] = (_wgFreq[t.label] || 0) + 6;\n    if (t.color) _allColors[t.label] = t.color;\n  });\n\n  var NC2 = [\"#C4956A\",\"#7BAE8A\",\"#8B9EC4\",\"#C48B7A\",\"#9E8BC4\",\"#C4B97A\"];\n  var _branches = Object.keys(_wgFreq)\n    .map(function(label, idx) {\n      return { label: label, score: _wgFreq[label], color: _allColors[label] || NC2[idx % NC2.length] };\n    })\n    .sort(function(a,b) { return b.score - a.score; })\n    .slice(0, 5);\n\n  var _maxScore = _branches.length > 0 ? _branches[0].score : 1;\n\n  \n  var [_wgLine, _wgSetLine] = useState(null);\n  var [_wgReady, _wgSetReady] = useState(false);\n\n  useEffect(function() {\n    var cancelled = false;\n    (async function() {\n      try {\n        if (_branches.length === 0) { _wgSetReady(true); return; }\n        var top3 = _branches.slice(0,3).map(function(b){return b.label;}).join(\", \");\n        var p = \"Someone's inner life. The themes growing most in recent sessions: \" + top3 + \".\\n\"\n          + \"Write ONE sentence (8-12 words). Not advice. Not analysis.\\n\"\n          + \"What is this person's life reaching toward? Poetic, warm, surprising. No clich\u00e9s.\\n\"\n          + 'JSON only: {\"line\":\"sentence here\"}';\n        var rr = await callClaude(p, \"whats growing\", 80);\n        if (cancelled) return;\n        var dd = parseJSON(rr);\n        _wgSetLine(dd && dd.line ? dd.line : null);\n      } catch(e) {}\n      finally { if (!cancelled) _wgSetReady(true); }\n    })();\n    return function(){ cancelled = true; };\n  }, []);\n\n  \n  var _sizes =   [68, 48, 34, 24, 16];\n  var _weights = [700, 600, 400, 300, 300];\n  var _tracking = [\"-0.03em\", \"-0.02em\", \"0em\", \"0.02em\", \"0.04em\"];\n\n  return (\n    <div style={{\n      position:\"absolute\", inset:0, overflow:\"hidden\",\n      background:\"#F7F4EF\",\n      display:\"flex\", flexDirection:\"column\"\n    }}>\n      \n      <div style={{ padding:\"52px 32px 0\" }}>\n        \n        <div style={{ display:\"flex\", justifyContent:\"space-between\", alignItems:\"center\",\n          marginBottom:12 }}>\n          <div style={{ fontSize:7.5, letterSpacing:\"0.45em\", color:\"#999\", fontFamily:FB,\n            textTransform:\"uppercase\" }}>\n            SAYCRD\n          </div>\n          <div style={{ fontSize:7.5, letterSpacing:\"0.3em\", color:\"#bbb\", fontFamily:FB,\n            textTransform:\"uppercase\" }}>\n            {sessionCount > 1 ? \"SESSION \"+sessionCount : \"FIRST SESSION\"}\n          </div>\n        </div>\n        \n        <div style={{ height:0.75, background:\"#D0C8BC\", marginBottom:10 }}/>\n        \n        <div style={{ fontSize:8, letterSpacing:\"0.55em\", color:\"#888\", fontFamily:FB,\n          textTransform:\"uppercase\", marginBottom:10 }}>\n          WHAT'S GROWING\n        </div>\n        \n        <div style={{ height:0.5, background:\"#E0D8D0\" }}/>\n      </div>\n\n      \n      <div style={{ flex:1, display:\"flex\", flexDirection:\"column\",\n        justifyContent:\"center\", padding:\"0 32px\" }}>\n        {_branches.map(function(b, bi) {\n          var isFirst = bi === 0;\n          var sz = _sizes[bi] || 13;\n          var wt = _weights[bi] || 300;\n          var tr = _tracking[bi] || \"0.04em\";\n          var ratio = b.score / _maxScore;\n\n          return (\n            <div key={bi} style={{ marginBottom: isFirst ? 6 : bi===1 ? 8 : 10,\n              animation:\"riseUp 0.6s ease \"+(bi*0.12)+\"s both\" }}>\n              \n              {isFirst && (\n                <div style={{ width: Math.round(ratio * 140) + 32, height:2,\n                  background: b.color, borderRadius:1, marginBottom:8,\n                  opacity:0.85 }}/>\n              )}\n              <div style={{ display:\"flex\", alignItems:\"baseline\", gap:10 }}>\n                \n                {!isFirst && (\n                  <div style={{ width:4, height:4, borderRadius:\"50%\",\n                    background:b.color, flexShrink:0,\n                    marginBottom: sz * 0.15,\n                    opacity:0.7 }}/>\n                )}\n                <div style={{\n                  fontSize: sz,\n                  fontWeight: wt,\n                  fontFamily: bi <= 1 ? FB : FD,\n                  fontStyle: bi >= 3 ? \"italic\" : \"normal\",\n                  letterSpacing: tr,\n                  color: isFirst ? \"#1A1A1A\" : bi===1 ? \"#2A2A2A\" : bi===2 ? \"#555\" : \"#888\",\n                  lineHeight: 1.05,\n                  textTransform: bi <= 1 ? \"uppercase\" : \"none\"\n                }}>\n                  {b.label}\n                </div>\n                \n                {bi <= 1 && (\n                  <div style={{ marginLeft:\"auto\", display:\"flex\", gap:3, alignItems:\"center\" }}>\n                    {[0,1,2].map(function(di) {\n                      return <div key={di} style={{\n                        width:5, height:5, borderRadius:\"50%\",\n                        background: di < Math.ceil(ratio*3) ? b.color : \"#E0D8D0\"\n                      }}/>;\n                    })}\n                  </div>\n                )}\n              </div>\n              \n              {bi < _branches.length-1 && (\n                <div style={{ height:0.5, background:\"#E8E2D8\", marginTop: isFirst ? 10 : bi===1?10:8 }}/>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      \n      <div style={{ padding:\"0 32px 40px\" }}>\n        <div style={{ height:0.75, background:\"#D0C8BC\", marginBottom:18 }}/>\n        <div style={{ minHeight:52 }}>\n          {!_wgReady ? (\n            <div style={{ display:\"flex\", flexDirection:\"column\", gap:8 }}>\n              <div style={{ width:\"80%\", height:14, borderRadius:3, background:\"#E8E2D8\",\n                animation:\"breathe 1.8s ease-in-out infinite alternate\" }}/>\n              <div style={{ width:\"55%\", height:14, borderRadius:3, background:\"#EEE9E2\",\n                animation:\"breathe 1.8s ease-in-out 0.3s infinite alternate\" }}/>\n            </div>\n          ) : (\n            <div style={{ fontSize:17, color:\"#4A4038\", fontFamily:FD,\n              fontStyle:\"italic\", lineHeight:1.75 }}>\n              {_wgLine || (_branches[0] ? \"\\u201c\"+_branches[0].label+\" keeps returning \\u2014 it wants something.\\u201d\" : \"The field is learning what it loves.\")}\n            </div>\n          )}\n        </div>\n      </div>\n      \n    </div>\n  );\n}\n\nfunction MirrorCard({ themes, sd, sessionCount, rawText, portrait, portraitReady, goNext }) {\n  themes = themes || [];\n\n  var _allSessions = (function() {\n    try { return loadSessions(); } catch(e) { return []; }\n  })();\n  var _prev = _allSessions.length > 0 ? _allSessions[_allSessions.length - 1] : null;\n\n  var _prevArch = (_prev && _prev.archetypes && _prev.archetypes[0] && _prev.archetypes[0].name) || \"\";\n  var _prevDate = _prev && _prev.date\n    ? new Date(_prev.date).toLocaleDateString(\"en-US\",{month:\"long\",day:\"numeric\"})\n    : \"\";\n  var _currArch = (sd && sd.archetypes && sd.archetypes[0] && sd.archetypes[0].name) || \"\";\n  var _archShifted = _prevArch && _currArch && _prevArch !== _currArch;\n  var _isFirst = !_prev;\n\n  var _prevThemes  = _prev ? (_prev.themes||[]).slice(0,3).map(function(t){ return t.label||\"\"; }).filter(Boolean) : [];\n  var _currThemes  = themes.slice(0,3).map(function(t){ return t.label||\"\"; }).filter(Boolean);\n  var _newThemes   = _currThemes.filter(function(t){ return _prevThemes.indexOf(t) < 0; });\n  var _goneThemes  = _prevThemes.filter(function(t){ return _currThemes.indexOf(t) < 0; });\n  var _stayed      = _currThemes.filter(function(t){ return _prevThemes.indexOf(t) >= 0; });\n\n  \n  \n  var _sameContent = !_isFirst && _newThemes.length === 0 && _goneThemes.length === 0;\n  var _openingWords = (sd && typeof sd.opening === \"string\" && sd.opening)\n    ? [sd.opening.slice(0,60)]\n    : [];\n  var _blindWords = (sd && typeof sd.blind_spot === \"string\" && sd.blind_spot)\n    ? [sd.blind_spot.slice(0,60)]\n    : [];\n  \n  var _thenLabel = _sameContent ? \"BROUGHT IN\" : (\"THEN\" + (_prevDate ? \"  \u00b7  \"+_prevDate : \"\"));\n  var _nowLabel  = _sameContent ? \"SURFACED\" : \"NOW\";\n  var _thenWords = _sameContent ? _openingWords : (_prevThemes.length ? _prevThemes : _openingWords);\n  var _nowWords  = _sameContent ? _blindWords   : _currThemes;\n  var _prevTension = (_prev && _prev.tension && _prev.tension.a) ? _prev.tension.a+\" vs \"+_prev.tension.b : \"\";\n  var _currTension = (sd && sd.tension && sd.tension.a) ? sd.tension.a+\" vs \"+sd.tension.b : \"\";\n\n  var _currColor = themes[0] ? themes[0].color : \"#E8B87C\";\n\n  \n  var [_shift, _setShift] = useState(null);\n  var [_ready, _setReady] = useState(false);\n\n  useEffect(function() {\n    if (portrait && portrait.mirrorShift) {\n      _setShift(portrait.mirrorShift);\n      _setReady(true);\n      return;\n    }\n    if (portraitReady && !portrait) {\n      var cancelled = false;\n      (async function() {\n        try {\n          var prevThemes = _prev ? (_prev.themes||[]).slice(0,3).map(function(t){return t.label;}).join(\",\") : \"\";\n          var currThemes = themes.slice(0,3).map(function(t){return t.label;}).join(\",\");\n          var ctx = \"Previous session: arch=\"+_prevArch+\" themes=\"+prevThemes;\n          ctx += \" | This session: arch=\"+_currArch+\" themes=\"+currThemes;\n          if (sd.blind_spot) ctx += \" blind_spot=\"+String(sd.blind_spot).slice(0,60);\n          var p = \"One sentence (10-15 words): what specifically shifted internally between these two sessions? Plain, direct, third person.\\n\"+ctx+\"\\nJSON: {\\\"shift\\\":\\\"...\\\"}\";\n          var rr = await callClaude(p, \"mirror\", 80);\n          if (!cancelled) {\n            var dd = parseJSON(rr);\n            if (dd && dd.shift) _setShift(dd.shift);\n          }\n        } catch(e) {} finally { if (!cancelled) _setReady(true); }\n      })();\n      return function(){ cancelled = true; };\n    }\n  }, [portrait, portraitReady]);\n\n  return (\n    <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n        background:\"linear-gradient(160deg, #06080F 0%, #080610 60%, #08060C 100%)\",\n        display:\"flex\", flexDirection:\"column\" }}>\n\n      \n      <div style={{ position:\"absolute\", inset:0, opacity:0.025, pointerEvents:\"none\",\n        backgroundImage:\"url(\\\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E\\\")\",\n        backgroundSize:\"200px 200px\" }}/>\n\n      \n      <div style={{ padding:\"52px 28px 0\", flexShrink:0 }}>\n        <div style={{ fontSize:8, letterSpacing:\"0.55em\",\n          color:\"rgba(200,210,240,0.2)\", fontFamily:FB, marginBottom:6 }}>\n          SAYCRD\n        </div>\n        <div style={{ fontSize:10, letterSpacing:\"0.4em\",\n          color:\"rgba(200,210,240,0.35)\", fontFamily:FB }}>\n          THE MIRROR\n        </div>\n      </div>\n\n      \n      <div style={{ flex:1, display:\"flex\", flexDirection:\"column\",\n        justifyContent:\"center\", padding:\"0 28px\" }}>\n\n        {_isFirst ? (\n          <div style={{ animation:\"riseUp 0.8s ease 0.2s both\" }}>\n            <div style={{ fontSize:22, fontWeight:700, color:\"rgba(255,255,255,0.75)\",\n              fontFamily:FB, lineHeight:1.3, marginBottom:14,\n              wordBreak:\"break-word\" }}>\n              This is your first session.\n            </div>\n            <div style={{ fontSize:15, color:\"rgba(200,210,240,0.4)\",\n              fontFamily:FD, lineHeight:1.7 }}>\n              The mirror needs two sessions to show you what moved. Come back.\n            </div>\n          </div>\n        ) : (\n          <div>\n\n            \n            <div style={{ marginBottom:44, animation:\"riseUp 0.7s ease 0.1s both\" }}>\n              <div style={{ fontSize:9, letterSpacing:\"0.45em\",\n                color:\"rgba(200,210,240,0.25)\", fontFamily:FB, marginBottom:20 }}>\n                WHAT MOVED\n              </div>\n\n              {_ready && _shift ? (\n                <div style={{ fontSize:22, fontWeight:600,\n                  color:\"rgba(255,255,255,0.88)\", fontFamily:FD,\n                  lineHeight:1.55, wordBreak:\"break-word\",\n                  overflowWrap:\"break-word\" }}>\n                  {_shift}\n                </div>\n              ) : (\n                <div>\n                  <div style={{ width:\"90%\", height:22, borderRadius:3,\n                    background:\"rgba(255,255,255,0.06)\",\n                    animation:\"breathe 1.5s ease-in-out infinite alternate\",\n                    marginBottom:10 }}/>\n                  <div style={{ width:\"65%\", height:22, borderRadius:3,\n                    background:\"rgba(255,255,255,0.04)\",\n                    animation:\"breathe 1.5s ease-in-out 0.3s infinite alternate\" }}/>\n                </div>\n              )}\n            </div>\n\n            \n            <div style={{ animation:\"riseUp 0.6s ease 0.4s both\" }}>\n              <div style={{ display:\"flex\", alignItems:\"flex-start\", gap:16 }}>\n\n                \n                <div style={{ flex:1, minWidth:0 }}>\n                  <div style={{ fontSize:8, letterSpacing:\"0.4em\",\n                    color:\"rgba(120,150,200,0.4)\", fontFamily:FB, marginBottom:10 }}>\n                    {_thenLabel}\n                  </div>\n                  <div style={{ fontSize:16, fontWeight:700,\n                    color: _archShifted ? \"rgba(120,150,200,0.45)\" : \"rgba(120,150,200,0.7)\",\n                    fontFamily:FB, lineHeight:1.25,\n                    textDecoration: _archShifted ? \"line-through\" : \"none\",\n                    textDecorationColor:\"rgba(120,150,200,0.25)\",\n                    wordBreak:\"break-word\", overflowWrap:\"break-word\" }}>\n                    {_sameContent ? (_openingWords.join(\" \") || _prevArch || \"\u2014\") : (_prevArch || \"\u2014\")}\n                  </div>\n                </div>\n\n                \n                <div style={{ paddingTop:22, color:\"rgba(200,210,240,0.15)\",\n                  fontSize:18, flexShrink:0 }}>\n                  \u2192\n                </div>\n\n                \n                <div style={{ flex:1, minWidth:0 }}>\n                  <div style={{ fontSize:8, letterSpacing:\"0.4em\",\n                    color:_currColor+\"88\", fontFamily:FB, marginBottom:10 }}>\n                    {_nowLabel}\n                  </div>\n                  <div style={{ fontSize:16, fontWeight:800,\n                    color:_currColor, fontFamily:FB, lineHeight:1.25,\n                    textShadow:\"0 0 20px \"+_currColor+\"33\",\n                    wordBreak:\"break-word\", overflowWrap:\"break-word\" }}>\n                    {_sameContent ? (_blindWords.join(\" \") || _currArch || \"\u2014\") : (_currArch || \"\u2014\")}\n                  </div>\n                </div>\n\n              </div>\n\n              \n              {!_archShifted && _prevArch && (\n                <div style={{ marginTop:12, fontSize:11,\n                  color:\"rgba(200,210,240,0.22)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>\n                  SAME GROUND \u00b7 DEEPER WORK\n                </div>\n              )}\n            </div>\n\n          </div>\n        )}\n      </div>\n\n      \n      <div style={{ padding:\"0 28px 36px\", flexShrink:0,\n        display:\"flex\", justifyContent:\"space-between\", alignItems:\"center\" }}>\n        <div style={{ fontSize:8, letterSpacing:\"0.35em\",\n          color:\"rgba(200,210,240,0.12)\", fontFamily:FB }}>\n          SESSION {sessionCount}\n        </div>\n        \n      </div>\n\n    </div>\n  );\n}\n\nfunction RealmCard({ themes, sd, sessionCount, portrait, portraitReady, goNext }) {\n  themes = themes || [];\n\n  var [_rData, _setRData] = useState(null);\n  var [_rReady, _setRReady] = useState(false);\n\n  useEffect(function() {\n    if (portrait && portrait.realmWitness) {\n      _setRData({\n        realmName: portrait.realmName || \"THE THRESHOLD\",\n        realmPosition: portrait.realmPosition || 0.5,\n        witness: portrait.realmWitness,\n        declaration: portrait.realmDeclaration || \"\"\n      });\n      _setRReady(true);\n      return;\n    }\n    if (portraitReady && !portrait) {\n      var cancelled = false;\n      (async function() {\n        try {\n          var themeStr = themes.slice(0,4).map(function(t){return t.label;}).join(\", \");\n          var p = \"Place this person's soul in the vertical landscape of consciousness. Themes: \"+themeStr+\". Realms: THE FORGE(0.1), THE STORM(0.3), THE THRESHOLD(0.5), THE CHRYSALIS(0.7), THE DAWN(0.9). JSON: {\\\"realmName\\\":\\\"THE X\\\",\\\"realmPosition\\\":0.5,\\\"witness\\\":\\\"10-14 words\\\",\\\"declaration\\\":\\\"3-6 words\\\"}\";\n          var rr = await callClaude(p, \"realm\", 120);\n          if (!cancelled) {\n            var dd = parseJSON(rr);\n            if (dd&&dd.realmName) { dd.realmPosition=Math.max(0.05,Math.min(0.95,parseFloat(dd.realmPosition)||0.5)); _setRData(dd); }\n          }\n        } catch(e) {} finally { if (!cancelled) _setRReady(true); }\n      })();\n      return function(){ cancelled = true; };\n    }\n  }, [portrait, portraitReady]);\n\n  \n  var _pos = _rData ? _rData.realmPosition : 0.5;\n  var _sparkTop = (1 - _pos) * 72 + 8; \n\n  \n  var _sparkColor = _pos < 0.2 ? \"#FF4422\"\n    : _pos < 0.4 ? \"#FF8844\"\n    : _pos < 0.6 ? \"#A88CDF\"\n    : _pos < 0.8 ? \"#F0C060\"\n    : \"#FFF8E0\";\n\n  var _sparkGlow = _pos < 0.2 ? \"rgba(255,60,20,0.6)\"\n    : _pos < 0.4 ? \"rgba(255,120,40,0.5)\"\n    : _pos < 0.6 ? \"rgba(160,130,220,0.5)\"\n    : _pos < 0.8 ? \"rgba(240,190,80,0.5)\"\n    : \"rgba(255,248,220,0.6)\";\n\n  return (\n    <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\" }}>\n\n      \n\n      \n      <div style={{ position:\"absolute\", bottom:0, left:0, right:0, height:\"22%\",\n        background:\"linear-gradient(0deg, #1A0500 0%, #2D0A02 40%, #180804 70%, transparent 100%)\" }}/>\n      <div style={{ position:\"absolute\", bottom:0, left:0, right:0, height:\"14%\",\n        background:\"linear-gradient(0deg, #3D0A00 0%, #220600 60%, transparent 100%)\",\n        opacity:0.8 }}/>\n      \n      <div style={{ position:\"absolute\", bottom:\"2%\", left:\"15%\", width:\"18%\", height:\"10%\",\n        background:\"radial-gradient(ellipse, rgba(255,60,10,0.25) 0%, transparent 70%)\",\n        filter:\"blur(6px)\" }}/>\n      <div style={{ position:\"absolute\", bottom:\"3%\", right:\"20%\", width:\"22%\", height:\"8%\",\n        background:\"radial-gradient(ellipse, rgba(255,80,10,0.2) 0%, transparent 70%)\",\n        filter:\"blur(8px)\" }}/>\n\n      \n      <div style={{ position:\"absolute\", bottom:\"18%\", left:0, right:0, height:\"22%\",\n        background:\"linear-gradient(0deg, transparent, rgba(60,55,80,0.5) 30%, rgba(70,65,90,0.4) 60%, transparent 100%)\" }}/>\n      \n      {[15,30,50,68,82].map(function(x,i){\n        return <div key={i} style={{ position:\"absolute\",\n          bottom:(18+i*1.5)+\"%\", left:x+\"%\", width:\"1px\", height:\"12%\",\n          background:\"linear-gradient(0deg, transparent, rgba(180,170,210,0.07), transparent)\",\n          transform:\"skewX(-25deg)\", pointerEvents:\"none\" }}/>;\n      })}\n\n      \n      <div style={{ position:\"absolute\", bottom:\"36%\", left:0, right:0, height:\"20%\",\n        background:\"linear-gradient(0deg, transparent, rgba(80,100,90,0.3) 40%, rgba(90,110,100,0.25) 70%, transparent 100%)\" }}/>\n      <div style={{ position:\"absolute\", bottom:\"38%\", left:0, right:0, height:\"8%\",\n        background:\"linear-gradient(0deg, transparent, rgba(140,160,150,0.12) 50%, transparent 100%)\",\n        filter:\"blur(3px)\" }}/>\n\n      \n      <div style={{ position:\"absolute\", bottom:\"52%\", left:0, right:0, height:\"22%\",\n        background:\"linear-gradient(0deg, transparent, rgba(160,110,40,0.18) 40%, rgba(180,130,50,0.15) 70%, transparent 100%)\" }}/>\n      \n      <div style={{ position:\"absolute\", bottom:\"58%\", left:\"25%\", right:\"25%\", height:\"12%\",\n        background:\"radial-gradient(ellipse, rgba(220,160,60,0.1) 0%, transparent 70%)\",\n        filter:\"blur(10px)\" }}/>\n\n      \n      <div style={{ position:\"absolute\", top:0, left:0, right:0, height:\"30%\",\n        background:\"linear-gradient(180deg, rgba(255,245,200,0.12) 0%, rgba(240,210,120,0.07) 40%, transparent 100%)\" }}/>\n      <div style={{ position:\"absolute\", top:0, left:\"20%\", right:\"20%\", height:\"20%\",\n        background:\"radial-gradient(ellipse, rgba(255,248,220,0.15) 0%, transparent 70%)\",\n        filter:\"blur(12px)\" }}/>\n\n      \n      {[20, 38, 55, 72].map(function(pct, li) {\n        return <div key={li} style={{\n          position:\"absolute\", bottom:pct+\"%\", left:0, right:0, height:1,\n          background:\"linear-gradient(90deg, transparent, rgba(200,190,220,0.06) 30%, rgba(200,190,220,0.1) 60%, transparent)\",\n          pointerEvents:\"none\"\n        }}/>;\n      })}\n\n      \n      \n      <div style={{\n        position:\"absolute\", left:\"50%\", top:_sparkTop+\"%\",\n        transform:\"translate(-50%,-50%)\",\n        width:80, height:80,\n        background:\"radial-gradient(circle, \"+_sparkGlow+\" 0%, transparent 70%)\",\n        filter:\"blur(8px)\",\n        animation:\"breathe 2.5s ease-in-out infinite\",\n        pointerEvents:\"none\"\n      }}/>\n      \n      <div style={{\n        position:\"absolute\", left:\"50%\", top:_sparkTop+\"%\",\n        transform:\"translate(-50%,-50%)\",\n        width:32, height:32,\n        background:\"radial-gradient(circle, \"+_sparkColor+\"88 0%, transparent 70%)\",\n        filter:\"blur(3px)\",\n        animation:\"breathe 2.5s ease-in-out infinite\",\n        pointerEvents:\"none\"\n      }}/>\n      \n      <div style={{\n        position:\"absolute\", left:\"50%\", top:_sparkTop+\"%\",\n        transform:\"translate(-50%,-50%)\",\n        width:7, height:7,\n        borderRadius:\"50%\",\n        background:_sparkColor,\n        boxShadow:\"0 0 12px \"+_sparkGlow+\", 0 0 4px \"+_sparkColor,\n        animation:\"breathe 2s ease-in-out infinite\",\n        pointerEvents:\"none\"\n      }}/>\n      \n      <div style={{\n        position:\"absolute\", left:\"50%\", top:(_sparkTop-8)+\"%\",\n        transform:\"translateX(-50%)\",\n        width:1, height:\"8%\",\n        background:\"linear-gradient(0deg, \"+_sparkColor+\"66, transparent)\",\n        pointerEvents:\"none\"\n      }}/>\n\n      \n      <div style={{\n        position:\"absolute\", left:0, right:0,\n        top: Math.max(6, _sparkTop - 22)+\"%\",\n        textAlign:\"center\",\n        animation:\"riseUp 0.8s ease 0.6s both\",\n        pointerEvents:\"none\"\n      }}>\n        {_rReady && _rData ? (\n          <div style={{ fontSize:11, letterSpacing:\"0.55em\", color:_sparkColor,\n            fontFamily:FB, textTransform:\"uppercase\",\n            textShadow:\"0 0 30px \"+_sparkGlow,\n            opacity:0.9 }}>\n            {_rData.realmName}\n          </div>\n        ) : (\n          <div style={{ width:120, height:10, borderRadius:3, margin:\"0 auto\",\n            background:\"rgba(200,180,255,0.06)\",\n            animation:\"breathe 1.5s ease-in-out infinite alternate\" }}/>\n        )}\n      </div>\n\n      \n      <div style={{ position:\"absolute\", top:46, left:24, fontSize:9,\n        letterSpacing:\"0.5em\", color:\"rgba(200,180,255,0.18)\", fontFamily:FB }}>SAYCRD</div>\n      <div style={{ position:\"absolute\", top:46, right:24, fontSize:8,\n        letterSpacing:\"0.2em\", color:\"rgba(255,255,255,0.12)\", fontFamily:FB }}>\n        {sessionCount > 1 ? \"SESSION \"+sessionCount : \"FIRST SESSION\"}\n      </div>\n\n      \n      <div style={{ position:\"absolute\", bottom:0, left:0, right:0,\n        padding:\"0 28px 36px\",\n        background:\"linear-gradient(0deg, rgba(2,1,6,0.98) 0%, rgba(4,2,10,0.85) 50%, transparent 100%)\" }}>\n\n        <div style={{ width:\"100%\", height:0.75, marginBottom:18,\n          background:\"linear-gradient(90deg, transparent, rgba(200,180,255,0.2) 40%, rgba(200,180,255,0.3) 60%, transparent)\" }}/>\n\n        \n        {_rReady && _rData && _rData.declaration && (\n          <div style={{ fontSize:24, fontWeight:700, color:\"rgba(255,255,255,0.92)\",\n            fontFamily:FB, letterSpacing:\"0.02em\",\n            lineHeight:1.1, marginBottom:12,\n            animation:\"riseUp 0.7s ease 0.9s both\" }}>\n            {_rData.declaration}\n          </div>\n        )}\n\n        \n        <div style={{ minHeight:44 }}>\n          {!_rReady ? (\n            <div style={{ display:\"flex\", flexDirection:\"column\", gap:7 }}>\n              <div style={{ width:\"85%\", height:14, borderRadius:3,\n                background:\"rgba(200,180,255,0.06)\", animation:\"breathe 1.8s ease-in-out infinite alternate\" }}/>\n              <div style={{ width:\"60%\", height:14, borderRadius:3,\n                background:\"rgba(200,180,255,0.04)\", animation:\"breathe 1.8s ease-in-out 0.3s infinite alternate\" }}/>\n            </div>\n          ) : (\n            <div style={{ fontSize:16, color:\"rgba(220,210,240,0.72)\",\n              fontFamily:FD, fontStyle:\"italic\",\n              lineHeight:1.7,\n              animation:\"riseUp 0.8s ease 1.1s both\" }}>\n              {_rData && _rData.witness\n                ? _rData.witness\n                : \"Every realm on the journey is the journey.\"}\n            </div>\n          )}\n        </div>\n      </div>\n\n      \n    </div>\n  );\n}\n\nfunction YearReviewCard({ themes, sessionCount, goNext }) {\n  themes = themes || [];\n  var _all = (function(){ try { return loadSessions(); } catch(e){ return []; } })();\n\n  var NC3 = [\"#FF6B9D\",\"#FFB86B\",\"#6BFFB8\",\"#6BB8FF\",\"#B86BFF\",\"#FFD700\",\"#E84393\",\"#7DB7AE\",\n             \"#FF8C69\",\"#98D8C8\",\"#DDA0DD\",\"#F0E68C\",\"#87CEEB\",\"#DEB887\",\"#90EE90\",\"#FFB6C1\"];\n\n  var _rows = _all.map(function(s, si) {\n    var archName = (s.archetypes&&s.archetypes[0]&&s.archetypes[0].name)||\"\";\n    var archLine = (s.archetypes&&s.archetypes[0]&&s.archetypes[0].line)||\"\";\n    var alchemyStage = (s.alchemy&&s.alchemy.stage)||\"\";\n    var mapTitle = s.mapTitle||\"\";\n    var color = NC3[si % NC3.length];\n    var dateStr=\"\", timeStr=\"\";\n    if (s.date) {\n      var d = new Date(s.date);\n      if (!isNaN(d)) {\n        dateStr = (d.getMonth()+1)+\"/\"+(d.getDate());\n        var hr=d.getHours(), mn=d.getMinutes(), ampm=hr>=12?\"pm\":\"am\";\n        hr=hr%12||12;\n        timeStr = hr+\":\"+(mn<10?\"0\"+mn:mn)+ampm;\n      }\n    }\n    return { si, archName, archLine, alchemyStage, mapTitle, color, dateStr, timeStr, isCurrent: si === _all.length - 1 };\n  });\n\n  \n\n\n  \n  var _archFreq={};\n  _all.forEach(function(s){\n    var a=s.archetypes&&s.archetypes[0]&&s.archetypes[0].name;\n    if(a) _archFreq[a]=(_archFreq[a]||0)+1;\n  });\n  var _topArch=Object.keys(_archFreq).sort(function(a,b){return _archFreq[b]-_archFreq[a];})[0]||\"\";\n  var _topArchCount=_topArch?_archFreq[_topArch]:0;\n\n  var [_expanded, _setExpanded] = useState(null);\n\n  return (\n    <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n      background:\"linear-gradient(160deg, #0A0614 0%, #120820 40%, #0E0A1E 100%)\",\n      display:\"flex\", flexDirection:\"column\" }}>\n\n      \n      <div style={{ position:\"absolute\", top:\"-10%\", left:\"-10%\", width:\"60%\", height:\"50%\",\n        background:\"radial-gradient(ellipse, rgba(180,100,255,0.07) 0%, transparent 70%)\",\n        pointerEvents:\"none\" }}/>\n      <div style={{ position:\"absolute\", bottom:\"20%\", right:\"-10%\", width:\"50%\", height:\"40%\",\n        background:\"radial-gradient(ellipse, rgba(100,180,255,0.06) 0%, transparent 70%)\",\n        pointerEvents:\"none\" }}/>\n\n      \n      <div style={{ padding:\"52px 28px 0\", flexShrink:0 }}>\n        <div style={{ display:\"flex\", justifyContent:\"space-between\", alignItems:\"baseline\", marginBottom:14 }}>\n          <div style={{ fontSize:9, letterSpacing:\"0.55em\", color:\"rgba(255,255,255,0.2)\", fontFamily:FB }}>SAYCRD</div>\n          <div style={{ fontSize:9, letterSpacing:\"0.25em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB }}>\n            {sessionCount} {\"SESSION\"+(sessionCount===1?\"\":\"S\")}\n          </div>\n        </div>\n        <div style={{ marginBottom:4 }}>\n          <span style={{ fontSize:32, fontWeight:800, color:\"rgba(255,255,255,0.95)\",\n            fontFamily:FB, letterSpacing:\"-0.02em\", lineHeight:1 }}>WHAT'S COME</span>\n        </div>\n        <div style={{ fontSize:32, fontWeight:200, color:\"rgba(255,255,255,0.35)\",\n          fontFamily:FB, letterSpacing:\"0.08em\", lineHeight:1, marginBottom:18 }}>THROUGH THE FIELD</div>\n\n        \n        <div style={{ display:\"flex\", alignItems:\"center\",\n          paddingBottom:10, borderBottom:\"0.75px solid rgba(255,255,255,0.1)\" }}>\n          <div style={{ width:12, flexShrink:0 }}/>\n          <div style={{ width:60, flexShrink:0, fontSize:7.5, letterSpacing:\"0.35em\",\n            color:\"rgba(255,255,255,0.25)\", fontFamily:FB }}>DATE</div>\n          <div style={{ flex:1, fontSize:7.5, letterSpacing:\"0.35em\",\n            color:\"rgba(255,255,255,0.25)\", fontFamily:FB }}>ARCHETYPE</div>\n          <div style={{ width:24, flexShrink:0 }}/>\n        </div>\n      </div>\n\n      \n      <div style={{ flex:1, overflowY:\"auto\", padding:\"0 28px\",\n        WebkitOverflowScrolling:\"touch\" }}>\n\n        {_rows.map(function(row, ri) {\n          var isExp = _expanded === ri;\n          var isCurr = row.isCurrent;\n          var hasDetail = !!(row.archLine || row.alchemyStage || row.mapTitle);\n\n          return (\n            <div key={ri} style={{ borderBottom:\"0.5px solid rgba(255,255,255,\"+(isCurr?\"0.12\":\"0.05\")+\")\" }}>\n\n              \n              <div\n                onClick={function(){ if(hasDetail||isCurr) _setExpanded(isExp?null:ri); }}\n                style={{ display:\"flex\", alignItems:\"center\",\n                  padding:\"13px 0\",\n                  cursor: hasDetail?\"pointer\":\"default\",\n                  animation:\"riseUp 0.5s ease \"+(ri*0.035)+\"s both\" }}>\n\n                \n                <div style={{ width:12, flexShrink:0 }}>\n                  <div style={{\n                    width: isCurr?10:6, height: isCurr?10:6,\n                    borderRadius:\"50%\",\n                    background: isCurr?\"white\":row.color,\n                    boxShadow: isCurr\n                      ? \"0 0 0 3px rgba(255,255,255,0.1), 0 0 16px rgba(255,255,255,0.4)\"\n                      : \"0 0 8px \"+row.color+\"66\"\n                  }}/>\n                </div>\n\n                \n                <div style={{ width:60, flexShrink:0 }}>\n                  <div style={{ fontSize: isCurr?13:11,\n                    fontWeight: isCurr?700:400,\n                    color: isCurr?\"rgba(255,255,255,0.9)\":\"rgba(255,255,255,0.4)\",\n                    fontFamily:FB, lineHeight:1.1 }}>{row.dateStr}</div>\n                  {row.timeStr&&<div style={{ fontSize:9, color:\"rgba(255,255,255,0.2)\",\n                    fontFamily:FB, marginTop:1 }}>{row.timeStr}</div>}\n                </div>\n\n                \n                <div style={{ flex:1, minWidth:0 }}>\n                  {row.archName ? (\n                    <div style={{\n                      fontSize: isCurr?22:16,\n                      fontWeight: isCurr?800:500,\n                      color: isCurr?\"white\":row.color,\n                      fontFamily:FB,\n                      letterSpacing: isCurr?\"-0.02em\":\"-0.01em\",\n                      lineHeight:1.05,\n                      textShadow: isCurr\n                        ? \"0 0 30px \"+row.color+\"88\"\n                        : \"0 0 12px \"+row.color+\"44\",\n                      whiteSpace:\"nowrap\", overflow:\"hidden\", textOverflow:\"ellipsis\"\n                    }}>\n                      {row.archName}\n                    </div>\n                  ) : isCurr ? (\n                    <div style={{ fontSize:15, fontWeight:500,\n                      color:\"rgba(255,255,255,0.35)\", fontFamily:FB,\n                      fontStyle:\"italic\" }}>this session</div>\n                  ) : (\n                    <div style={{ fontSize:11, color:\"rgba(255,255,255,0.15)\",\n                      fontFamily:FB }}>\u2014</div>\n                  )}\n                </div>\n\n                \n                {hasDetail && (\n                  <div style={{ width:24, flexShrink:0, textAlign:\"right\" }}>\n                    <div style={{ fontSize:12, color:isExp?row.color:\"rgba(255,255,255,0.2)\",\n                      transition:\"transform 0.35s ease, color 0.2s ease\",\n                      transform:isExp?\"rotate(180deg)\":\"rotate(0deg)\",\n                      display:\"inline-block\" }}>\u25be</div>\n                  </div>\n                )}\n              </div>\n\n              \n              <div style={{\n                maxHeight: isExp ? \"300px\" : \"0px\",\n                overflow:\"hidden\",\n                transition:\"max-height 0.45s cubic-bezier(0.32,0.72,0,1)\"\n              }}>\n                <div style={{ padding:\"4px 0 20px 12px\",\n                  borderLeft:\"2px solid \"+row.color+\"44\",\n                  marginLeft:5, marginBottom:4 }}>\n\n                  \n                  {row.mapTitle && (\n                    <div style={{ fontSize:11, letterSpacing:\"0.1em\",\n                      color:\"rgba(255,255,255,0.35)\", fontFamily:FB,\n                      marginBottom:10, lineHeight:1.5 }}>\n                      {row.mapTitle}\n                    </div>\n                  )}\n\n                  \n                  {row.archLine && (\n                    <div style={{ fontSize:17, color:row.color,\n                      fontFamily:FD, fontStyle:\"italic\",\n                      lineHeight:1.7, marginBottom:12,\n                      textShadow:\"0 0 20px \"+row.color+\"33\" }}>\n                      \"{row.archLine}\"\n                    </div>\n                  )}\n\n                  \n                  {row.alchemyStage && (\n                    <div style={{ display:\"inline-flex\", alignItems:\"center\",\n                      gap:6, padding:\"4px 12px\", borderRadius:20,\n                      border:\"0.75px solid \"+row.color+\"44\",\n                      background:row.color+\"11\" }}>\n                      <div style={{ width:5, height:5, borderRadius:\"50%\",\n                        background:row.color, opacity:0.8 }}/>\n                      <div style={{ fontSize:9, letterSpacing:\"0.3em\",\n                        color:row.color+\"CC\", fontFamily:FB,\n                        textTransform:\"uppercase\" }}>{row.alchemyStage}</div>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n            </div>\n          );\n        })}\n\n        \n        {_topArch && _topArchCount >= 2 && (\n          <div style={{ margin:\"22px 0 8px\", padding:\"18px 18px\",\n            borderRadius:10,\n            background:\"linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.02) 100%)\",\n            border:\"0.75px solid rgba(255,255,255,0.1)\",\n            animation:\"riseUp 0.5s ease 0.6s both\" }}>\n            <div style={{ fontSize:8, letterSpacing:\"0.5em\",\n              color:\"rgba(255,255,255,0.25)\", fontFamily:FB,\n              textTransform:\"uppercase\", marginBottom:8 }}>THE RETURNING ONE</div>\n            <div style={{ fontSize:24, fontWeight:800, color:\"rgba(255,255,255,0.88)\",\n              fontFamily:FB, letterSpacing:\"-0.02em\", marginBottom:4,\n              textShadow:\"0 0 30px rgba(255,255,255,0.1)\" }}>\n              {_topArch}\n            </div>\n            <div style={{ fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB }}>\n              found you across {_topArchCount} sessions\n            </div>\n          </div>\n        )}\n\n        <div style={{ height:24 }}/>\n      </div>\n\n      \n      <div style={{ height:40, flexShrink:0,\n        background:\"linear-gradient(0deg, #0A0614 0%, transparent 100%)\",\n        pointerEvents:\"none\" }}/>\n\n      \n    </div>\n  );\n}\n\nfunction LandscapeCard({ themes, sessionCount, primaryArch, archReg, portrait, portraitReady, goNext }) {\n  themes = themes || [];\n\n  var [_scene, _setScene] = useState(null);\n  var [_word, _setWord] = useState(null);\n  var [_ready, _setReady] = useState(false);\n  var [_panelOpen, _setPanelOpen] = useState(false);\n\n  \n  var _all = (function(){ try { return loadSessions(); } catch(e){ return []; } })();\n\n  \n  var _archName  = (archReg && archReg.name)  || (primaryArch && primaryArch.name)  || \"\";\n  var _archIcon  = (archReg && archReg.icon)  || (primaryArch && primaryArch.icon)  || \"\u25c6\";\n  var _archColor = (archReg && archReg.color) || (primaryArch && primaryArch.color) || \"#E84393\";\n  var _archLine  = (primaryArch && primaryArch.line) || \"\";\n  \n  var _archPhases = archReg && archReg.phases ? archReg.phases : null;\n  var _archDesc = _archPhases\n    ? Object.values(_archPhases).slice(0,2).join(\" \")\n    : (_archLine || \"\");\n\n  useEffect(function() {\n    var cancelled = false;\n    (async function() {\n      try {\n        var totalSessions = _all.length + 1;\n        var _freq = {};\n        _all.forEach(function(s, si) {\n          var w = si + 1;\n          (s.themes||[]).forEach(function(t){\n            if (t.label) _freq[t.label] = (_freq[t.label]||0) + w;\n          });\n        });\n        themes.forEach(function(t){ if(t.label) _freq[t.label] = (_freq[t.label]||0)+6; });\n        var topThemes = Object.keys(_freq).sort(function(a,b){return _freq[b]-_freq[a];}).slice(0,6);\n        var firstWord = _all.length > 0 ? ((_all[0].themes||[])[0]||{}).label||\"\" : (themes[0]||{}).label||\"\";\n        var lastWord  = (themes[0]||{}).label||\"\";\n\n        var p = \"You are the cinematographer for someone's inner journey across \"+totalSessions+\" sessions.\\n\"\n          + \"Their recurring themes: \" + topThemes.join(\", \") + \"\\n\"\n          + \"Where they began: \" + firstWord + \"\\n\"\n          + \"Where they are now: \" + lastWord + \"\\n\\n\"\n          + \"Choose ONE landscape scene that is the visual metaphor of their entire journey:\\n\"\n          + \"STORMY_COAST \u2014 dark ocean, lighthouse, dramatic clouds, violent beauty, struggle and searching\\n\"\n          + \"DAWN_MOUNTAINS \u2014 misty peaks, rose-gold sky, valley still in shadow, light just arriving, emerging\\n\"\n          + \"DEEP_FOREST \u2014 cathedral trees, moon through canopy, searching in sacred darkness, depth\\n\"\n          + \"OPEN_PLAIN \u2014 infinite amber horizon, single tree, the held breath, steady and vast\\n\"\n          + \"CANYON_SUNRISE \u2014 red walls, gold light pouring in from above, the forge made beautiful, breakthrough\\n\"\n          + \"WINTER_CLEARING \u2014 snow, stars, bare trees, cold clarity, everything stripped to essential truth\\n\\n\"\n          + 'JSON only: {\"scene\":\"SCENE_NAME\"}';\n\n        var rr = await callClaude(p, \"landscape closing\", 80);\n        if (cancelled) return;\n        var dd = parseJSON(rr);\n        _setScene(dd && dd.scene ? dd.scene : \"DAWN_MOUNTAINS\");\n      } catch(e) {\n        _setScene(\"DAWN_MOUNTAINS\");\n      } finally {\n        if (!cancelled) _setReady(true);\n      }\n    })();\n    return function(){ cancelled = true; };\n  }, []);\n\n  var scene = _scene || \"DAWN_MOUNTAINS\";\n\n  function renderStormy() {\n    return <>\n      \n      <div style={{position:\"absolute\",inset:0,background:\"linear-gradient(180deg,#040308 0%,#0A0618 25%,#12082A 50%,#0E0C1E 70%,#060410 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",top:\"8%\",left:\"-10%\",right:\"-10%\",height:\"35%\",\n        background:\"radial-gradient(ellipse 80% 60% at 40% 50%, rgba(40,30,60,0.9) 0%, rgba(20,15,35,0.7) 50%, transparent 100%)\",\n        animation:\"breathe 8s ease-in-out infinite\"}}/>\n      <div style={{position:\"absolute\",top:\"15%\",left:\"20%\",right:\"-20%\",height:\"25%\",\n        background:\"radial-gradient(ellipse 70% 50% at 60% 40%, rgba(60,45,80,0.7) 0%, transparent 70%)\",\n        animation:\"breathe 6s ease-in-out 2s infinite\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:0,left:0,right:0,height:\"42%\",\n        background:\"linear-gradient(0deg,#020408 0%,#040A14 40%,#060D1A 70%,transparent 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"28%\",left:0,right:0,height:\"3%\",\n        background:\"linear-gradient(90deg,transparent,rgba(80,110,160,0.12) 30%,rgba(100,140,200,0.18) 60%,transparent)\",\n        animation:\"breathe 4s ease-in-out infinite\"}}/>\n      <div style={{position:\"absolute\",bottom:\"22%\",left:\"10%\",right:\"10%\",height:\"2%\",\n        background:\"linear-gradient(90deg,transparent,rgba(80,110,160,0.08) 50%,transparent)\",\n        animation:\"breathe 5s ease-in-out 1s infinite\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"38%\",left:0,right:0,height:1,\n        background:\"linear-gradient(90deg,transparent,rgba(100,120,180,0.15) 30%,rgba(120,140,200,0.25) 60%,transparent)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"38%\",right:\"22%\",width:3,height:\"22%\",\n        background:\"linear-gradient(0deg,#2A2030,#3A2A45)\",borderRadius:\"2px 2px 0 0\"}}/>\n      <div style={{position:\"absolute\",bottom:\"59%\",right:\"21.4%\",width:5,height:\"4%\",\n        background:\"#3D2A50\",borderRadius:\"3px 3px 0 0\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"61%\",right:\"22%\",\n        width:\"45%\",height:\"2px\",transformOrigin:\"right center\",\n        background:\"linear-gradient(270deg,rgba(255,240,180,0.35),transparent)\",\n        transform:\"rotate(-8deg)\",\n        animation:\"shaftPulse 3s ease-in-out infinite\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"60%\",right:\"20.5%\",width:14,height:14,\n        borderRadius:\"50%\",\n        background:\"radial-gradient(circle,rgba(255,240,160,0.95) 0%,rgba(255,220,100,0.4) 40%,transparent 70%)\",\n        animation:\"breathe 1.5s ease-in-out infinite\"}}/>\n    </>;\n  }\n\n  function renderDawnMountains() {\n    return <>\n      \n      <div style={{position:\"absolute\",inset:0,background:\"linear-gradient(180deg,#06040E 0%,#120820 20%,#2A1025 40%,#3D1A1A 55%,#4A2010 68%,#3A2010 80%,#1A100A 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",top:\"42%\",left:\"30%\",right:\"30%\",height:\"30%\",\n        background:\"radial-gradient(ellipse,rgba(200,80,20,0.25) 0%,rgba(160,60,15,0.1) 40%,transparent 70%)\",\n        filter:\"blur(15px)\",animation:\"breathe 5s ease-in-out infinite\"}}/>\n      <div style={{position:\"absolute\",top:\"48%\",left:\"35%\",right:\"35%\",height:\"20%\",\n        background:\"radial-gradient(ellipse,rgba(240,140,40,0.2) 0%,transparent 60%)\",\n        filter:\"blur(8px)\"}}/>\n      \n      <svg style={{position:\"absolute\",bottom:\"30%\",left:0,width:\"100%\",height:\"28%\"}} viewBox=\"0 0 100 30\" preserveAspectRatio=\"none\">\n        <path d=\"M0 30 L0 18 L8 10 L16 20 L24 8 L32 16 L40 4 L48 14 L56 6 L64 15 L72 5 L80 16 L88 9 L96 18 L100 14 L100 30 Z\"\n          fill=\"rgba(25,12,18,0.95)\"/>\n      </svg>\n      \n      <svg style={{position:\"absolute\",bottom:\"25%\",left:0,width:\"100%\",height:\"22%\"}} viewBox=\"0 0 100 22\" preserveAspectRatio=\"none\">\n        <path d=\"M0 22 L0 16 L12 6 L22 14 L34 2 L44 12 L58 0 L68 10 L80 4 L90 13 L100 8 L100 22 Z\"\n          fill=\"rgba(10,6,12,0.98)\"/>\n      </svg>\n      \n      <div style={{position:\"absolute\",bottom:\"25%\",left:0,right:0,height:\"6%\",\n        background:\"linear-gradient(0deg,transparent,rgba(180,160,200,0.06) 50%,transparent)\",\n        filter:\"blur(4px)\",animation:\"breathe 7s ease-in-out infinite\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:0,left:0,right:0,height:\"26%\",\n        background:\"linear-gradient(0deg,#040206 0%,#080410 60%,transparent 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",top:\"18%\",left:\"62%\",width:3,height:3,borderRadius:\"50%\",\n        background:\"rgba(255,240,200,0.9)\",\n        boxShadow:\"0 0 8px rgba(255,240,180,0.6)\",\n        animation:\"breathe 3s ease-in-out infinite\"}}/>\n    </>;\n  }\n\n  function renderDeepForest() {\n    return <>\n      \n      <div style={{position:\"absolute\",inset:0,background:\"linear-gradient(180deg,#020308 0%,#040510 30%,#060810 60%,#040608 100%)\"}}/>\n      \n      {[[15,12],[28,8],[42,15],[58,6],[72,11],[85,9],[35,20],[65,18]].map(function(p,i){\n        return <div key={i} style={{position:\"absolute\",left:p[0]+\"%\",top:p[1]+\"%\",\n          width:i%3===0?2:1,height:i%3===0?2:1,borderRadius:\"50%\",\n          background:\"rgba(220,230,255,\"+(0.4+i%4*0.1)+\")\",\n          animation:\"breathe \"+(2+i%3)+\"s ease-in-out \"+(i*0.5)+\"s infinite\"}}/>;\n      })}\n      \n      <div style={{position:\"absolute\",top:\"12%\",left:\"55%\",width:22,height:22,borderRadius:\"50%\",\n        background:\"radial-gradient(circle,rgba(240,235,220,0.9) 0%,rgba(220,215,200,0.7) 50%,transparent 70%)\",\n        boxShadow:\"0 0 30px rgba(220,215,190,0.15)\",\n        animation:\"breathe 8s ease-in-out infinite\"}}/>\n      \n      <div style={{position:\"absolute\",top:\"8%\",left:\"48%\",width:80,height:80,borderRadius:\"50%\",\n        background:\"radial-gradient(circle,rgba(200,200,180,0.06) 0%,transparent 70%)\",\n        filter:\"blur(10px)\"}}/>\n      \n      <svg style={{position:\"absolute\",bottom:0,left:0,width:\"100%\",height:\"75%\"}} viewBox=\"0 0 100 75\" preserveAspectRatio=\"none\">\n        \n        <rect x=\"5\" y=\"35\" width=\"2.5\" height=\"40\" fill=\"rgba(4,6,10,0.8)\"/>\n        <path d=\"M5 35 L6.25 15 L7.5 35 Z\" fill=\"rgba(4,6,10,0.8)\"/>\n        <rect x=\"18\" y=\"28\" width=\"3\" height=\"47\" fill=\"rgba(5,7,11,0.85)\"/>\n        <path d=\"M18 28 L19.5 5 L21 28 Z\" fill=\"rgba(5,7,11,0.85)\"/>\n        <rect x=\"72\" y=\"30\" width=\"3\" height=\"45\" fill=\"rgba(4,6,10,0.82)\"/>\n        <path d=\"M72 30 L73.5 8 L75 30 Z\" fill=\"rgba(4,6,10,0.82)\"/>\n        <rect x=\"85\" y=\"33\" width=\"2.5\" height=\"42\" fill=\"rgba(4,5,9,0.8)\"/>\n        <path d=\"M85 33 L86.25 12 L87.5 33 Z\" fill=\"rgba(4,5,9,0.8)\"/>\n        \n        <rect x=\"-2\" y=\"20\" width=\"5\" height=\"55\" fill=\"#020305\"/>\n        <path d=\"M-2 20 L0.5 -2 L3 20 Z\" fill=\"#020305\"/>\n        <rect x=\"30\" y=\"15\" width=\"5.5\" height=\"60\" fill=\"#020305\"/>\n        <path d=\"M30 15 L32.75 -5 L35.5 15 Z\" fill=\"#020305\"/>\n        <rect x=\"58\" y=\"18\" width=\"5\" height=\"57\" fill=\"#020305\"/>\n        <path d=\"M58 18 L60.5 -3 L63 18 Z\" fill=\"#020305\"/>\n        <rect x=\"90\" y=\"22\" width=\"5\" height=\"53\" fill=\"#020305\"/>\n        <path d=\"M90 22 L92.5 0 L95 22 Z\" fill=\"#020305\"/>\n      </svg>\n      \n      <div style={{position:\"absolute\",top:\"20%\",left:\"52%\",width:\"6%\",height:\"45%\",\n        background:\"linear-gradient(180deg,rgba(200,200,180,0.06) 0%,rgba(180,180,160,0.03) 60%,transparent 100%)\",\n        transform:\"skewX(3deg)\",filter:\"blur(4px)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:0,left:0,right:0,height:\"15%\",\n        background:\"linear-gradient(0deg,#010203 0%,#020306 60%,transparent 100%)\"}}/>\n    </>;\n  }\n\n  function renderOpenPlain() {\n    return <>\n      \n      <div style={{position:\"absolute\",inset:0,background:\"linear-gradient(180deg,#08060E 0%,#150C10 20%,#2A1008 40%,#3D1A06 55%,#4A2408 65%,#3A2010 75%,#180E08 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",top:\"52%\",left:\"10%\",right:\"10%\",height:\"20%\",\n        background:\"radial-gradient(ellipse,rgba(180,80,10,0.3) 0%,rgba(140,60,8,0.15) 50%,transparent 75%)\",\n        filter:\"blur(12px)\"}}/>\n      \n      {[[10,38,60],[25,32,40],[55,35,50],[70,30,35]].map(function(c,i){\n        return <div key={i} style={{position:\"absolute\",top:c[0]+\"%\",left:c[1]+\"%\",\n          width:c[2]+\"%\",height:\"1.5%\",\n          background:\"linear-gradient(90deg,transparent,rgba(160,80,20,0.12),transparent)\",\n          filter:\"blur(2px)\"}}/>;\n      })}\n      \n      <div style={{position:\"absolute\",bottom:\"32%\",left:0,right:0,height:1,\n        background:\"linear-gradient(90deg,transparent,rgba(160,100,30,0.3) 20%,rgba(180,110,30,0.4) 60%,transparent)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:0,left:0,right:0,height:\"33%\",\n        background:\"linear-gradient(0deg,#080402 0%,#0E0804 50%,#120A06 80%,transparent 100%)\"}}/>\n      \n      <svg style={{position:\"absolute\",bottom:\"31%\",left:\"28%\",width:\"18%\",height:\"28%\"}} viewBox=\"0 0 40 60\" preserveAspectRatio=\"none\">\n        <rect x=\"18\" y=\"35\" width=\"4\" height=\"25\" fill=\"#0A0604\"/>\n        \n        <line x1=\"20\" y1=\"42\" x2=\"8\" y2=\"28\" stroke=\"#0A0604\" strokeWidth=\"1.5\"/>\n        <line x1=\"20\" y1=\"38\" x2=\"32\" y2=\"22\" stroke=\"#0A0604\" strokeWidth=\"1.5\"/>\n        <line x1=\"20\" y1=\"35\" x2=\"12\" y2=\"18\" stroke=\"#0A0604\" strokeWidth=\"1.2\"/>\n        <line x1=\"20\" y1=\"32\" x2=\"28\" y2=\"14\" stroke=\"#0A0604\" strokeWidth=\"1\"/>\n        <line x1=\"20\" y1=\"30\" x2=\"20\" y2=\"12\" stroke=\"#0A0604\" strokeWidth=\"1.2\"/>\n        <line x1=\"8\" y1=\"28\" x2=\"4\" y2=\"20\" stroke=\"#0A0604\" strokeWidth=\"0.8\"/>\n        <line x1=\"32\" y1=\"22\" x2=\"36\" y2=\"14\" stroke=\"#0A0604\" strokeWidth=\"0.8\"/>\n      </svg>\n      \n      <div style={{position:\"absolute\",bottom:\"31.5%\",left:0,right:0,height:\"1.5%\",\n        background:\"linear-gradient(0deg,transparent,rgba(20,12,4,0.4),transparent)\"}}/>\n    </>;\n  }\n\n  function renderCanyonSunrise() {\n    return <>\n      \n      <div style={{position:\"absolute\",inset:0,background:\"linear-gradient(180deg,#0C0804 0%,#1A0C06 15%,#2D1208 30%,#3D1A0A 45%,#1A0C06 65%,#0A0604 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",top:0,left:\"25%\",right:\"25%\",height:\"45%\",\n        background:\"radial-gradient(ellipse at 50% 0%, rgba(240,140,20,0.35) 0%,rgba(200,100,10,0.15) 40%,transparent 70%)\",\n        filter:\"blur(8px)\",animation:\"breathe 4s ease-in-out infinite\"}}/>\n      <div style={{position:\"absolute\",top:0,left:\"35%\",right:\"35%\",height:\"30%\",\n        background:\"radial-gradient(ellipse at 50% 0%, rgba(255,180,40,0.25) 0%,transparent 60%)\",\n        filter:\"blur(4px)\"}}/>\n      \n      <svg style={{position:\"absolute\",top:0,left:0,width:\"32%\",height:\"100%\"}} viewBox=\"0 0 32 100\" preserveAspectRatio=\"none\">\n        <path d=\"M0 0 L0 100 L32 100 L32 60 L28 45 L32 30 L26 15 L32 0 Z\" fill=\"#1A0A04\"/>\n        <path d=\"M0 0 L0 100 L20 100 L18 60 L22 45 L18 25 L24 10 L20 0 Z\" fill=\"#0E0602\"/>\n        \n        <line x1=\"25\" y1=\"0\" x2=\"22\" y2=\"100\" stroke=\"rgba(0,0,0,0.4)\" strokeWidth=\"0.5\"/>\n        <line x1=\"18\" y1=\"0\" x2=\"16\" y2=\"100\" stroke=\"rgba(0,0,0,0.3)\" strokeWidth=\"0.3\"/>\n      </svg>\n      \n      <svg style={{position:\"absolute\",top:0,right:0,width:\"32%\",height:\"100%\"}} viewBox=\"0 0 32 100\" preserveAspectRatio=\"none\">\n        <path d=\"M32 0 L32 100 L0 100 L0 60 L4 45 L0 30 L6 15 L0 0 Z\" fill=\"#1A0A04\"/>\n        <path d=\"M32 0 L32 100 L12 100 L14 60 L10 45 L14 25 L8 10 L12 0 Z\" fill=\"#0E0602\"/>\n        <line x1=\"7\" y1=\"0\" x2=\"10\" y2=\"100\" stroke=\"rgba(0,0,0,0.4)\" strokeWidth=\"0.5\"/>\n        <line x1=\"14\" y1=\"0\" x2=\"16\" y2=\"100\" stroke=\"rgba(0,0,0,0.3)\" strokeWidth=\"0.3\"/>\n      </svg>\n      \n      <div style={{position:\"absolute\",bottom:0,left:\"15%\",right:\"15%\",height:\"20%\",\n        background:\"linear-gradient(0deg,#0A0604 0%,#140C06 60%,transparent 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",top:0,left:\"40%\",right:\"40%\",height:\"70%\",\n        background:\"linear-gradient(180deg,rgba(220,140,20,0.12) 0%,rgba(200,120,10,0.05) 60%,transparent 100%)\",\n        filter:\"blur(6px)\"}}/>\n      \n      <div style={{position:\"absolute\",top:\"10%\",left:\"30%\",width:\"8%\",height:\"60%\",\n        background:\"linear-gradient(90deg,transparent,rgba(200,100,15,0.08),transparent)\",\n        filter:\"blur(4px)\"}}/>\n    </>;\n  }\n\n  function renderWinterClearing() {\n    return <>\n      \n      <div style={{position:\"absolute\",inset:0,background:\"linear-gradient(180deg,#010208 0%,#020310 25%,#030412 50%,#020308 75%,#010204 100%)\"}}/>\n      \n      {[[8,8],[15,5],[22,12],[32,4],[40,9],[48,3],[55,7],[62,11],[70,5],[78,8],[85,4],[92,10],\n        [12,18],[28,15],[45,19],[60,16],[75,13],[88,17],[20,25],[50,22],[80,20]].map(function(p,i){\n        return <div key={i} style={{position:\"absolute\",left:p[0]+\"%\",top:p[1]+\"%\",\n          width:i%5===0?2:1,height:i%5===0?2:1,borderRadius:\"50%\",\n          background:\"rgba(210,220,255,\"+(0.5+i%3*0.15)+\")\",\n          animation:\"breathe \"+(2+i%4)+\"s ease-in-out \"+(i*0.3)+\"s infinite\"}}/>;\n      })}\n      \n      <div style={{position:\"absolute\",top:\"5%\",left:\"-20%\",right:\"-20%\",height:\"40%\",\n        background:\"linear-gradient(100deg,transparent 20%,rgba(160,170,220,0.03) 40%,rgba(180,190,240,0.05) 60%,transparent 80%)\",\n        transform:\"rotate(-15deg)\",filter:\"blur(8px)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:0,left:0,right:0,height:\"28%\",\n        background:\"linear-gradient(0deg,rgba(180,185,200,0.12) 0%,rgba(160,165,185,0.06) 50%,transparent 100%)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"28%\",left:0,right:0,height:1,\n        background:\"linear-gradient(90deg,transparent,rgba(190,195,215,0.2) 20%,rgba(200,205,225,0.3) 60%,transparent)\"}}/>\n      \n      <svg style={{position:\"absolute\",bottom:\"27%\",left:0,width:\"100%\",height:\"35%\"}} viewBox=\"0 0 100 35\" preserveAspectRatio=\"none\">\n        \n        <rect x=\"12\" y=\"15\" width=\"1.5\" height=\"20\" fill=\"rgba(30,35,50,0.9)\"/>\n        <line x1=\"12.75\" y1=\"20\" x2=\"6\" y2=\"12\" stroke=\"rgba(30,35,50,0.8)\" strokeWidth=\"0.8\"/>\n        <line x1=\"12.75\" y1=\"18\" x2=\"20\" y2=\"10\" stroke=\"rgba(30,35,50,0.8)\" strokeWidth=\"0.7\"/>\n        <line x1=\"12.75\" y1=\"15\" x2=\"8\" y2=\"6\" stroke=\"rgba(30,35,50,0.7)\" strokeWidth=\"0.6\"/>\n        <line x1=\"12.75\" y1=\"15\" x2=\"18\" y2=\"5\" stroke=\"rgba(30,35,50,0.7)\" strokeWidth=\"0.6\"/>\n        \n        <rect x=\"55\" y=\"10\" width=\"1.8\" height=\"25\" fill=\"rgba(25,30,45,0.9)\"/>\n        <line x1=\"55.9\" y1=\"16\" x2=\"46\" y2=\"6\" stroke=\"rgba(25,30,45,0.8)\" strokeWidth=\"0.9\"/>\n        <line x1=\"55.9\" y1=\"14\" x2=\"66\" y2=\"4\" stroke=\"rgba(25,30,45,0.8)\" strokeWidth=\"0.8\"/>\n        <line x1=\"55.9\" y1=\"10\" x2=\"50\" y2=\"0\" stroke=\"rgba(25,30,45,0.7)\" strokeWidth=\"0.6\"/>\n        <line x1=\"55.9\" y1=\"10\" x2=\"62\" y2=\"1\" stroke=\"rgba(25,30,45,0.7)\" strokeWidth=\"0.6\"/>\n        \n        <rect x=\"82\" y=\"18\" width=\"1.2\" height=\"17\" fill=\"rgba(20,25,40,0.7)\"/>\n        <line x1=\"82.6\" y1=\"22\" x2=\"77\" y2=\"14\" stroke=\"rgba(20,25,40,0.6)\" strokeWidth=\"0.6\"/>\n        <line x1=\"82.6\" y1=\"20\" x2=\"88\" y2=\"12\" stroke=\"rgba(20,25,40,0.6)\" strokeWidth=\"0.6\"/>\n      </svg>\n      \n      <div style={{position:\"absolute\",top:\"15%\",left:\"-5%\",width:\"40%\",height:\"40%\",\n        background:\"radial-gradient(ellipse,rgba(160,170,220,0.06) 0%,transparent 60%)\",\n        filter:\"blur(15px)\"}}/>\n      \n      <div style={{position:\"absolute\",bottom:\"12%\",left:\"20%\",right:\"20%\",height:\"2%\",\n        background:\"linear-gradient(90deg,transparent,rgba(190,200,230,0.06),transparent)\",\n        animation:\"breathe 5s ease-in-out infinite\"}}/>\n    </>;\n  }\n\n  var sceneMap = {\n    STORMY_COAST: renderStormy,\n    DAWN_MOUNTAINS: renderDawnMountains,\n    DEEP_FOREST: renderDeepForest,\n    OPEN_PLAIN: renderOpenPlain,\n    CANYON_SUNRISE: renderCanyonSunrise,\n    WINTER_CLEARING: renderWinterClearing\n  };\n\n  var renderScene = sceneMap[scene] || renderDawnMountains;\n\n  return (\n    <div style={{position:\"absolute\",inset:0,overflow:\"hidden\",background:\"#020208\"}}>\n\n      \n      {renderScene()}\n\n      \n      <div style={{position:\"absolute\",top:0,left:0,right:0,height:\"10%\",\n        background:\"linear-gradient(180deg,rgba(0,0,0,0.85) 0%,transparent 100%)\",pointerEvents:\"none\"}}/>\n      <div style={{position:\"absolute\",bottom:0,left:0,right:0,height:\"32%\",\n        background:\"linear-gradient(0deg,rgba(0,0,0,0.97) 0%,rgba(0,0,0,0.75) 45%,transparent 100%)\",pointerEvents:\"none\"}}/>\n\n      \n      <div style={{position:\"absolute\",top:44,left:28,fontSize:8,letterSpacing:\"0.5em\",\n        color:\"rgba(255,255,255,0.18)\",fontFamily:FB}}>SAYCRD</div>\n      <div style={{position:\"absolute\",top:44,right:28,fontSize:8,letterSpacing:\"0.2em\",\n        color:\"rgba(255,255,255,0.12)\",fontFamily:FB,textAlign:\"right\"}}>\n        {sessionCount} {\"SESSION\"+(sessionCount===1?\"\":\"S\")}\n      </div>\n\n      \n      <div\n        onClick={function(){ _setPanelOpen(function(o){return !o;}); }}\n        style={{\n          position:\"absolute\", bottom:0, left:0, right:0,\n          padding:\"0 28px 28px\",\n          cursor:\"pointer\",\n          zIndex:10\n        }}>\n\n        \n        <div style={{height:0.75, marginBottom:16,\n          background:\"linear-gradient(90deg,transparent,\"+_archColor+\"55 30%,\"+_archColor+\"88 60%,transparent)\"}}/>\n\n        \n        <div style={{fontSize:8, letterSpacing:\"0.5em\", color:_archColor+\"88\",\n          fontFamily:FB, textTransform:\"uppercase\", marginBottom:8,\n          animation:\"riseUp 0.6s ease 0.4s both\"}}>\n          YOUR ARCHETYPE\n        </div>\n\n        \n        <div style={{display:\"flex\", alignItems:\"center\", justifyContent:\"space-between\"}}>\n          <div style={{\n            fontSize: _archName.length > 16 ? 22 : _archName.length > 10 ? 28 : 34,\n            fontWeight:700,\n            color:\"rgba(255,255,255,0.94)\",\n            fontFamily:FB,\n            letterSpacing:\"-0.01em\",\n            lineHeight:1,\n            textShadow:\"0 0 40px \"+_archColor+\"44\",\n            animation:\"riseUp 0.8s ease 0.5s both\"\n          }}>\n            {_archName || \"\u2014\"}\n          </div>\n          \n          <div style={{display:\"flex\",alignItems:\"center\",gap:8}}>\n            <div style={{fontSize:22, lineHeight:1}}>{_archIcon}</div>\n            <div style={{\n              fontSize:10, color:\"rgba(255,255,255,0.3)\",\n              transform:_panelOpen?\"rotate(180deg)\":\"rotate(0deg)\",\n              transition:\"transform 0.4s ease\"\n            }}>\u25b2</div>\n          </div>\n        </div>\n\n        \n        <div style={{marginTop:12, fontSize:7,letterSpacing:\"0.3em\",color:\"rgba(255,255,255,0.15)\",\n          fontFamily:FB,textTransform:\"uppercase\"}}>\n          {themes.slice(0,4).map(function(t){return t.label||\"\";}).filter(Boolean).join(\"  \u00b7  \")}\n          {\"  \u00b7  SESSION \"+sessionCount}\n        </div>\n      </div>\n\n      \n      <div style={{\n        position:\"absolute\", bottom:0, left:0, right:0,\n        height:\"78%\",\n        background:\"rgba(6,4,14,0.97)\",\n        borderTop:\"0.75px solid \"+_archColor+\"44\",\n        borderRadius:\"12px 12px 0 0\",\n        transform:_panelOpen ? \"translateY(0)\" : \"translateY(100%)\",\n        transition:\"transform 0.5s cubic-bezier(0.32,0.72,0,1)\",\n        padding:\"28px 28px 40px\",\n        display:\"flex\",\n        flexDirection:\"column\",\n        zIndex:20,\n        boxShadow:\"0 -20px 60px rgba(0,0,0,0.8)\"\n      }}>\n\n        \n        <div style={{width:40,height:4,borderRadius:2,\n          background:\"rgba(255,255,255,0.12)\",\n          margin:\"0 auto 24px\",flexShrink:0}}/>\n\n        \n        <div style={{textAlign:\"center\",marginBottom:16,flexShrink:0}}>\n          <div style={{fontSize:72, lineHeight:1,\n            filter:\"drop-shadow(0 0 24px \"+_archColor+\"66)\",\n            animation:_panelOpen?\"riseUp 0.5s ease 0.1s both\":\"none\"}}>\n            {_archIcon}\n          </div>\n        </div>\n\n        \n        <div style={{textAlign:\"center\",marginBottom:10,flexShrink:0}}>\n          <div style={{\n            fontSize: _archName.length > 16 ? 22 : _archName.length > 10 ? 26 : 30,\n            fontWeight:700,\n            color:\"rgba(255,255,255,0.95)\",\n            fontFamily:FB,\n            letterSpacing:\"-0.01em\",\n            lineHeight:1.1,\n            animation:_panelOpen?\"riseUp 0.5s ease 0.15s both\":\"none\"\n          }}>\n            {_archName}\n          </div>\n        </div>\n\n        \n        <div style={{width:\"40%\",height:0.75,margin:\"0 auto 16px\",\n          background:\"linear-gradient(90deg,transparent,\"+_archColor+\"88,transparent)\",\n          flexShrink:0}}/>\n\n        \n        {_archLine && (\n          <div style={{textAlign:\"center\",marginBottom:20,flexShrink:0,\n            animation:_panelOpen?\"riseUp 0.5s ease 0.2s both\":\"none\"}}>\n            <div style={{fontSize:16,color:_archColor,fontFamily:FD,\n              fontStyle:\"italic\",lineHeight:1.6,maxWidth:300,margin:\"0 auto\"}}>\n              \"{_archLine}\"\n            </div>\n          </div>\n        )}\n\n        \n        {_archPhases && (\n          <div style={{flex:1,overflowY:\"auto\",WebkitOverflowScrolling:\"touch\"}}>\n            {Object.entries(_archPhases).map(function(entry, pi) {\n              var phaseName = entry[0];\n              var phaseText = entry[1];\n              return (\n                <div key={pi} style={{marginBottom:16,\n                  animation:_panelOpen?\"riseUp 0.5s ease \"+(0.25+pi*0.07)+\"s both\":\"none\"}}>\n                  <div style={{fontSize:8,letterSpacing:\"0.4em\",\n                    color:_archColor+\"66\",fontFamily:FB,\n                    textTransform:\"uppercase\",marginBottom:5}}>\n                    {phaseName}\n                  </div>\n                  <div style={{fontSize:14,color:\"rgba(220,215,240,0.65)\",\n                    fontFamily:FD,fontStyle:\"italic\",lineHeight:1.65}}>\n                    {phaseText}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {!_archPhases && _archDesc && (\n          <div style={{flex:1,animation:_panelOpen?\"riseUp 0.5s ease 0.25s both\":\"none\"}}>\n            <div style={{fontSize:14,color:\"rgba(220,215,240,0.65)\",\n              fontFamily:FD,fontStyle:\"italic\",lineHeight:1.75}}>\n              {_archDesc}\n            </div>\n          </div>\n        )}\n\n        \n        <div style={{textAlign:\"center\",marginTop:16,flexShrink:0}}>\n          <div style={{fontSize:9,letterSpacing:\"0.3em\",color:\"rgba(255,255,255,0.18)\",\n            fontFamily:FB,textTransform:\"uppercase\"}}\n            onClick={function(e){e.stopPropagation();_setPanelOpen(false);}}>\n            TAP TO CLOSE\n          </div>\n        </div>\n      </div>\n\n      \n    </div>\n  );\n}\n\nfunction UnderdrawingCard({ themes, sessionCount, portrait, portraitReady, goNext }) {\n  themes = themes || [];\n  var _all = (function(){ try { return loadSessions(); } catch(e){ return []; } })();\n\n  var [_question, _setQuestion] = useState(null);\n  var [_subtitle, _setSubtitle] = useState(null);\n  var [_ready, _setReady] = useState(false);\n\n  useEffect(function() {\n    if (portrait && portrait.question) {\n      _setQuestion(portrait.question);\n      _setSubtitle(portrait.toward || null);\n      _setReady(true);\n      return;\n    }\n    if (portraitReady && !portrait) {\n      var cancelled = false;\n      (async function() {\n        try {\n          var bio = _all.slice(-4).map(function(s,si){\n            var a=(s.archetypes&&s.archetypes[0]&&s.archetypes[0].name)||\"\";\n            var bl=typeof s.blind_spot===\"string\"?s.blind_spot:\"\";\n            var op=typeof s.opening===\"string\"?s.opening:\"\";\n            return \"S\"+(si+1)+\": arch=\"+a+\" blind=\"+bl.slice(0,60)+\" opening=\"+op.slice(0,60);\n          }).join(\"\\n\");\n          var p = \"What is the ONE question this person has been living inside? 8-14 words. Make them catch their breath.\\n\"+bio+\"\\nJSON: {\\\"question\\\":\\\"...\\\",\\\"toward\\\":\\\"4-7 words\\\"}\";\n          var rr = await callClaude(p, \"underdrawing\", 150);\n          if (!cancelled) {\n            var dd = parseJSON(rr);\n            if (dd&&dd.question) { _setQuestion(dd.question); _setSubtitle(dd.toward||null); }\n          }\n        } catch(e) {} finally { if (!cancelled) _setReady(true); }\n      })();\n      return function(){ cancelled = true; };\n    }\n  }, [portrait, portraitReady]);\n\n  return (\n    <div onClick={function(e){e.stopPropagation();}}\n      style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n        background:\"linear-gradient(160deg, #F5EFE0 0%, #EDE5CC 45%, #F0E8D5 100%)\",\n        display:\"flex\", flexDirection:\"column\", justifyContent:\"space-between\" }}>\n\n      \n      <div style={{ position:\"absolute\", inset:0, opacity:0.04, pointerEvents:\"none\",\n        backgroundImage:\"url(\\\"data:image/svg+xml,%3Csvg viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E\\\")\",\n        backgroundSize:\"300px 300px\" }}/>\n\n      \n      <div style={{ position:\"absolute\", top:\"25%\", left:\"10%\", right:\"10%\", height:\"55%\",\n        background:\"radial-gradient(ellipse, rgba(200,140,40,0.14) 0%, rgba(180,120,20,0.06) 45%, transparent 72%)\",\n        pointerEvents:\"none\" }}/>\n      <div style={{ position:\"absolute\", top:\"10%\", right:\"0%\", width:\"45%\", height:\"40%\",\n        background:\"radial-gradient(ellipse, rgba(210,160,60,0.09) 0%, transparent 65%)\",\n        pointerEvents:\"none\" }}/>\n      \n      <div style={{ position:\"absolute\", inset:0,\n        background:\"radial-gradient(ellipse 90% 90% at 50% 50%, transparent 55%, rgba(100,70,20,0.12) 100%)\",\n        pointerEvents:\"none\" }}/>\n\n      \n      <div style={{ padding:\"52px 32px 0\", flexShrink:0 }}>\n        <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:20 }}>\n          <div style={{ fontSize:8, letterSpacing:\"0.55em\",\n            color:\"rgba(80,55,20,0.35)\", fontFamily:FB }}>SAYCRD</div>\n          <div style={{ fontSize:8, letterSpacing:\"0.2em\",\n            color:\"rgba(80,55,20,0.28)\", fontFamily:FB }}>{sessionCount} SESSIONS</div>\n        </div>\n        <div style={{ height:0.75, marginBottom:18,\n          background:\"linear-gradient(90deg, transparent, rgba(120,80,20,0.25) 30%, rgba(140,90,20,0.35) 70%, transparent)\" }}/>\n        <div style={{ fontSize:8.5, letterSpacing:\"0.55em\",\n          color:\"rgba(100,65,20,0.4)\", fontFamily:FB,\n          textTransform:\"uppercase\", marginBottom:0 }}>\n          HELD TO THE LIGHT\n        </div>\n      </div>\n\n      \n      <div style={{ flex:1, display:\"flex\", flexDirection:\"column\",\n        justifyContent:\"center\", padding:\"0 32px\" }}>\n\n        {!_ready ? (\n          <div style={{ display:\"flex\", flexDirection:\"column\", gap:12, alignItems:\"center\" }}>\n            <div style={{ width:\"80%\", height:28, borderRadius:4,\n              background:\"rgba(120,80,20,0.07)\",\n              animation:\"breathe 2s ease-in-out infinite alternate\" }}/>\n            <div style={{ width:\"65%\", height:28, borderRadius:4,\n              background:\"rgba(120,80,20,0.05)\",\n              animation:\"breathe 2s ease-in-out 0.3s infinite alternate\" }}/>\n            <div style={{ width:\"50%\", height:20, borderRadius:4, marginTop:8,\n              background:\"rgba(120,80,20,0.04)\",\n              animation:\"breathe 2s ease-in-out 0.5s infinite alternate\" }}/>\n          </div>\n        ) : (\n          <div style={{ animation:\"riseUp 1s ease 0.2s both\" }}>\n            \n            <div style={{\n              fontSize:28,\n              fontWeight:400,\n              fontFamily:FD,\n              fontStyle:\"italic\",\n              color:\"rgba(35,20,5,0.88)\",\n              lineHeight:1.55,\n              letterSpacing:\"0.01em\",\n              marginBottom:28,\n              textAlign:\"left\"\n            }}>\n              {_question || \"what would it mean to finally stop carrying this?\"}\n            </div>\n\n            \n            <div style={{ width:48, height:1.5, marginBottom:18,\n              background:\"linear-gradient(90deg, rgba(160,100,20,0.6), rgba(180,120,20,0.3))\",\n              borderRadius:1 }}/>\n\n            \n            {_subtitle && (\n              <div style={{\n                fontSize:13,\n                fontFamily:FB,\n                fontWeight:400,\n                letterSpacing:\"0.18em\",\n                textTransform:\"uppercase\",\n                color:\"rgba(120,75,20,0.5)\"\n              }}>\n                {_subtitle}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      \n      <div style={{ padding:\"0 32px 40px\", flexShrink:0 }}>\n        <div style={{ height:0.75, marginBottom:16,\n          background:\"linear-gradient(90deg, transparent, rgba(120,80,20,0.25) 30%, rgba(140,90,20,0.35) 70%, transparent)\" }}/>\n        <div style={{ display:\"flex\", justifyContent:\"space-between\", alignItems:\"baseline\" }}>\n          <div style={{ fontSize:11, color:\"rgba(100,65,15,0.4)\",\n            fontFamily:FD, fontStyle:\"italic\", lineHeight:1.6 }}>\n            The question was always yours.\n          </div>\n          \n          <div style={{ display:\"flex\", gap:3, alignItems:\"center\" }}>\n            {Array.from({length:Math.min(sessionCount,20)}).map(function(_,di){\n              return <div key={di} style={{\n                width:4, height:4, borderRadius:\"50%\",\n                background: di===Math.min(sessionCount,20)-1\n                  ? \"rgba(160,100,20,0.8)\"\n                  : \"rgba(140,90,20,\"+(0.15+di*0.02)+\")\"\n              }}/>;\n            })}\n          </div>\n        </div>\n      </div>\n\n      \n    </div>\n  );\n}\n\nfunction FieldReportCard({ themes, sd, sessionCount, allSessions, portrait, portraitReady, goNext }) {\n  themes = themes || [];\n  allSessions = allSessions || [];\n\n  var [_report, _setReport] = useState(null);\n  var [_ready, _setReady] = useState(false);\n\n  useEffect(function() {\n    var cancelled = false;\n    (async function() {\n      try {\n        var total = allSessions.length; /* current session already saved in allSessions */\n\n        var slimBio = allSessions.map(function(s, si) {\n          var a = (s.archetypes && s.archetypes[0] && s.archetypes[0].name) || \"\";\n          var th = (s.themes || []).slice(0,2).map(function(t){ return t.label; }).join(\",\");\n          var bl = typeof s.blind_spot === \"string\" ? s.blind_spot.slice(0,60) : \"\";\n          var op = typeof s.opening === \"string\" ? s.opening.slice(0,50) : \"\";\n          var al = (s.alchemy && s.alchemy.stage) || \"\";\n          var ow = s.corrections\n            ? Object.values(s.corrections).filter(function(c){ return typeof c===\"string\" && c.length>4; }).slice(0,1).map(function(c){ return c.slice(0,60); }).join(\"\")\n            : \"\";\n          var res = s.reactions\n            ? Object.keys(s.reactions).filter(function(rk){ return s.reactions[rk]===\"resisted\"; }).slice(0,1).join(\"\")\n            : \"\";\n          return \"S\"+(si+1)+\":\"+(a?a+\"|\":\"\")+th+(bl?\"|blind:\"+bl:\"\")+(op?\"|open:\"+op:\"\")+(ow?\"|said:\"+ow:\"\")+(res?\"|resisted:\"+res:\"\");\n        }).join(\"\\n\");\n\n        var currSummary = [\n          themes.slice(0,3).map(function(t){ return t.label; }).join(\", \"),\n          sd.tension && sd.tension.a ? sd.tension.a+\" vs \"+sd.tension.b : \"\",\n          sd.blind_spot ? String(sd.blind_spot).slice(0,80) : \"\",\n          sd.opening ? String(sd.opening).slice(0,80) : \"\"\n        ].filter(Boolean).join(\" | \");\n\n        var allCorrections = [];\n        allSessions.forEach(function(s) {\n          if (s.corrections) {\n            Object.values(s.corrections).forEach(function(c) {\n              if (typeof c === \"string\" && c.length > 6) allCorrections.push(c.slice(0,80));\n            });\n          }\n        });\n\n        var resistFreq = {};\n        allSessions.forEach(function(s) {\n          if (s.reactions) {\n            Object.keys(s.reactions).forEach(function(rk) {\n              if (s.reactions[rk] === \"resisted\") resistFreq[rk] = (resistFreq[rk]||0)+1;\n            });\n          }\n        });\n        var topResist = Object.keys(resistFreq).sort(function(a,b){ return resistFreq[b]-resistFreq[a]; }).slice(0,3);\n\n        var intensities = allSessions.map(function(s,si){ return { si:si+1, v:s.intensity||0 }; });\n        var maxIntense = intensities.reduce(function(m,x){ return x.v>m.v?x:m; }, {si:0,v:0});\n        var recentAvg = intensities.slice(-3).reduce(function(s,x){ return s+x.v; },0) / Math.max(intensities.slice(-3).length,1);\n        var earlyAvg = intensities.slice(0,3).reduce(function(s,x){ return s+x.v; },0) / Math.max(Math.min(3,intensities.length),1);\n        var intensityDir = recentAvg > earlyAvg+0.5 ? \"deepening\" : recentAvg < earlyAvg-0.5 ? \"settling\" : \"steady\";\n\n        var archJourney = allSessions.map(function(s){ return (s.archetypes&&s.archetypes[0]&&s.archetypes[0].name)||\"\"; }).filter(Boolean);\n        var uniqueArchs = archJourney.filter(function(a,i){ return i===0||archJourney[i-1]!==a; });\n\n        var firstDate = allSessions.length>0 && allSessions[0].date\n          ? new Date(allSessions[0].date).toLocaleDateString(\"en-US\",{month:\"short\",day:\"numeric\"})\n          : \"\";\n        var lastDate = allSessions.length>0 && allSessions[allSessions.length-1].date\n          ? new Date(allSessions[allSessions.length-1].date).toLocaleDateString(\"en-US\",{month:\"short\",day:\"numeric\",year:\"numeric\"})\n          : \"\";\n\n        var stats = total+\" sessions. Intensity trend: \"+intensityDir+\". Peak: S\"+maxIntense.si+\".\";\n        if (uniqueArchs.length) stats += \" Archetype progression: \"+uniqueArchs.join(\" > \")+\".\";\n        if (allCorrections.length) stats += \" Subject said in their own words: \"+allCorrections.slice(0,3).map(function(c){return '\"'+c+'\"';}).join(\", \")+\".\";\n        if (topResist.length) stats += \" Kept pushing back on: \"+topResist.join(\"; \")+\".\";\n\n        var prompt = \"You are writing a confidential field report. Third person only. Always call the subject \\\"the subject\\\" \u2014 never he, she, him, her. Plain declarative past tense. Clinical but human.\\n\\n\"\n          + \"CRITICAL RULES: Only write what the data explicitly states. Do not invent themes, emotions, patterns, or history not present in the data below. If there is only 1 session, say so \u2014 do not imply more. If a field is blank, do not fill it in. No poetry. No therapy language. Short paragraphs, 2 sentences each, blank line between them.\\n\\n\"\n          + \"SUBJECT DATA:\\n\" + stats + \"\\n\"\n          + \"SESSION ARC:\\n\" + slimBio + \"\\n\"\n          + \"CURRENT SESSION: \" + currSummary + \"\\n\\n\"\n          + \"Write 3 sections. Each has: ALL-CAPS TITLE (3-5 words), then body in short paragraphs separated by blank lines.\\n\"\n          + \"SECTION 1 title like WHAT OCCURRED: What dominated, when it shifted. Name specific themes and archetypes. 3 short paragraphs.\\n\"\n          + \"SECTION 2 title like WHAT MOVED: Concrete change. Only if there are multiple sessions \u2014 what shifted between them. If only 1 session, describe what moved within it. 3 short paragraphs.\\n\"\n          + \"SECTION 3 title like WHAT REMAINS: Still unresolved. Still returning. No comfort. 2 short paragraphs.\\n\\n\"\n          + \"Also: oneLineVerdict \u2014 one plain third-person sentence (12-16 words). The single most honest thing about this subject right now. Written like a pencil note at the bottom of a file.\\n\"\n          + (firstDate && lastDate ? \"dateRange: \"+firstDate+\" to \"+lastDate+\".\\n\" : \"\")\n          + 'JSON only: {\"sections\":[{\"title\":\"...\",\"body\":\"...\"},{\"title\":\"...\",\"body\":\"...\"},{\"title\":\"...\",\"body\":\"...\"}],\"oneLineVerdict\":\"...\",\"dateRange\":\"...\"}';\n\n        var rr = await callClaude(prompt, \"field_report\", 700);\n        if (cancelled) return;\n        var dd = parseJSON(rr);\n        if (dd && dd.sections && dd.sections.length >= 3) {\n          _setReport(dd);\n        } else {\n          _setReport({\n            sections:[\n              {title:\"WHAT OCCURRED\", body:\"The sessions are on record.\\n\\nThe patterns are clear.\"},\n              {title:\"WHAT MOVED\", body:\"Something shifted between the early and recent sessions.\\n\\nThe evidence is in the arc.\"},\n              {title:\"WHAT REMAINS\", body:\"Some things have not moved.\\n\\nThey are still present.\"}\n            ],\n            dateRange: firstDate && lastDate ? firstDate+\" to \"+lastDate : \"\",\n            oneLineVerdict:\"The subject has done sustained inner work that has not yet fully resolved.\"\n          });\n        }\n      } catch(e) {\n        _setReport(null);\n      } finally {\n        if (!cancelled) _setReady(true);\n      }\n    })();\n    return function(){ cancelled = true; };\n  }, []);\n\n  var _accent = (themes[0] && themes[0].color) || \"#111\";\n\n  function renderBody(text) {\n    if (!text) return null;\n    var paras = text.split(/\\n\\n+/);\n    if (paras.length <= 1) paras = text.split(/\\n/);\n    paras = paras.filter(function(p){ return p.trim(); });\n    return paras.map(function(para, pi) {\n      return (\n        <div key={pi} style={{ marginBottom: pi < paras.length-1 ? 16 : 0 }}>\n          {para.trim()}\n        </div>\n      );\n    });\n  }\n\n  return (\n    <div onClick={function(e){e.stopPropagation();}}\n      style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n        background:\"#F9F9F7\", display:\"flex\", flexDirection:\"column\",\n        fontFamily:FB }}>\n\n      <div style={{ height:3, flexShrink:0,\n        background:\"linear-gradient(90deg, \"+_accent+\", \"+_accent+\"44)\" }}/>\n\n      <div style={{ padding:\"34px 30px 0\", flexShrink:0 }}>\n        <div style={{ display:\"flex\", justifyContent:\"space-between\",\n          alignItems:\"flex-start\", marginBottom:14 }}>\n          <div>\n            <div style={{ fontSize:13, letterSpacing:\"0.6em\",\n              color:\"rgba(0,0,0,0.28)\", marginBottom:6, fontWeight:600 }}>\n              SAYCRD \u00b7 FIELD REPORT\n            </div>\n            <div style={{ fontSize:34, fontWeight:800, color:\"rgba(0,0,0,0.88)\",\n              letterSpacing:\"-0.025em\", lineHeight:1 }}>\n              {sessionCount} {sessionCount===1 ? \"SESSION\" : \"SESSIONS\"}\n            </div>\n          </div>\n          <div style={{ textAlign:\"right\" }}>\n            {_report && _report.dateRange && (\n              <div style={{ fontSize:13, color:\"rgba(0,0,0,0.28)\",\n                letterSpacing:\"0.08em\", marginBottom:4 }}>\n                {_report.dateRange}\n              </div>\n            )}\n            <div style={{ fontSize:13, color:\"rgba(0,0,0,0.22)\",\n              letterSpacing:\"0.2em\", fontWeight:600 }}>CONFIDENTIAL</div>\n          </div>\n        </div>\n        <div style={{ height:1, background:\"rgba(0,0,0,0.1)\" }}/>\n      </div>\n\n      <div style={{ flex:1, overflowY:\"auto\", padding:\"0 30px\",\n        WebkitOverflowScrolling:\"touch\" }}>\n\n        {!_ready ? (\n          <div style={{ paddingTop:28, display:\"flex\", flexDirection:\"column\", gap:28 }}>\n            {[0,1,2].map(function(i){\n              return (\n                <div key={i} style={{ paddingBottom:24,\n                  borderBottom:\"1px solid rgba(0,0,0,0.06)\" }}>\n                  <div style={{ width:\"28%\", height:8, background:\"rgba(0,0,0,0.08)\",\n                    borderRadius:2, marginBottom:18,\n                    animation:\"breathe 2s ease-in-out \"+(i*0.2)+\"s infinite alternate\" }}/>\n                  {[0,1,2,3].map(function(j){\n                    return (\n                      <div key={j} style={{ width:(93-j*7)+\"%\", height:14,\n                        background:\"rgba(0,0,0,\"+(0.055-j*0.008)+\")\",\n                        borderRadius:2, marginBottom: j===1 ? 20 : 9,\n                        animation:\"breathe 2s ease-in-out \"+(i*0.2+j*0.08)+\"s infinite alternate\" }}/>\n                    );\n                  })}\n                </div>\n              );\n            })}\n          </div>\n        ) : _report ? (\n          <div style={{ paddingTop:24 }}>\n\n            {_report.oneLineVerdict && (\n              <div style={{ marginBottom:26, padding:\"16px 18px\",\n                borderLeft:\"3px solid \"+_accent,\n                background:\"rgba(0,0,0,0.03)\" }}>\n                <div style={{ fontSize:17, color:\"rgba(0,0,0,0.78)\",\n                  fontFamily:FD, lineHeight:1.65, fontWeight:500, fontStyle:\"normal\" }}>\n                  {_report.oneLineVerdict}\n                </div>\n              </div>\n            )}\n\n            {(_report.sections||[]).map(function(sec, si) {\n              return (\n                <div key={si} style={{ marginBottom:30, paddingBottom:30,\n                  borderBottom: si<2 ? \"1px solid rgba(0,0,0,0.09)\" : \"none\",\n                  animation:\"riseUp 0.5s ease \"+(si*0.12)+\"s both\" }}>\n\n                  <div style={{ fontSize:13, letterSpacing:\"0.5em\",\n                    color:_accent, marginBottom:16, fontWeight:700, opacity:0.75 }}>\n                    {sec.title}\n                  </div>\n\n                  <div style={{ fontSize:17, color:\"rgba(0,0,0,0.76)\",\n                    fontFamily:FD, lineHeight:1.9, fontWeight:400, fontStyle:\"normal\" }}>\n                    {renderBody(sec.body)}\n                  </div>\n\n                </div>\n              );\n            })}\n\n            \n            <div style={{ marginBottom:20, padding:\"14px 16px\",\n              background:\"rgba(0,0,0,0.03)\", borderRadius:3 }}>\n              <div style={{ fontSize:12, color:\"rgba(0,0,0,0.38)\",\n                fontFamily:FB, lineHeight:1.7 }}>\n                This report is for personal insight and reflection only. It is not a clinical assessment, medical advice, or psychological diagnosis. Nothing here should be used to make health or treatment decisions. If you are experiencing mental health difficulties, please speak with a qualified professional.\n              </div>\n            </div>\n\n            <div style={{ paddingBottom:10, display:\"flex\",\n              justifyContent:\"space-between\", alignItems:\"center\" }}>\n              <div style={{ fontSize:12, letterSpacing:\"0.35em\",\n                color:\"rgba(0,0,0,0.18)\", fontWeight:600 }}>\n                END OF REPORT\n              </div>\n              <div style={{ display:\"flex\", gap:3, alignItems:\"center\" }}>\n                {Array.from({length:Math.min(sessionCount,24)}).map(function(_,di){\n                  return (\n                    <div key={di} style={{ width:4, height:4, borderRadius:\"50%\",\n                      background: di===Math.min(sessionCount,24)-1\n                        ? _accent\n                        : \"rgba(0,0,0,\"+(0.07+di*0.004)+\")\" }}/>\n                  );\n                })}\n              </div>\n            </div>\n\n          </div>\n        ) : (\n          <div style={{ paddingTop:48, textAlign:\"center\" }}>\n            <div style={{ fontSize:16, color:\"rgba(0,0,0,0.3)\", fontFamily:FD }}>\n              Report unavailable.\n            </div>\n          </div>\n        )}\n\n        <div style={{ height:28 }}/>\n\n        {/* Close session */}\n        <div style={{ padding:\"0 32px 40px\", textAlign:\"center\" }}>\n          <div\n            onClick={function(){\n              var fade = document.createElement(\"div\");\n              fade.style.cssText = \"position:fixed;inset:0;background:#000;opacity:0;z-index:99999;transition:opacity 1.2s ease;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px;\";\n              fade.innerHTML = \"<div style=\\\"font-family:serif;font-size:13px;letter-spacing:0.4em;color:rgba(255,255,255,0.25);opacity:0;transition:opacity 1s ease 0.6s\\\">SESSION COMPLETE</div>\";\n              document.body.appendChild(fade);\n              requestAnimationFrame(function(){ fade.style.opacity=\"1\"; fade.querySelector(\"div\").style.opacity=\"1\"; });\n              setTimeout(function(){ try{ window.close(); } catch(e){} }, 1400);\n            }}\n            style={{ display:\"inline-block\", fontSize:10, letterSpacing:\"0.35em\",\n              color:\"rgba(0,0,0,0.2)\", fontFamily:FB, cursor:\"pointer\",\n              padding:\"10px 20px\", borderTop:\"1px solid rgba(0,0,0,0.08)\",\n              transition:\"color 0.2s\" }}\n            onMouseEnter={function(e){ e.currentTarget.style.color=\"rgba(0,0,0,0.45)\"; }}\n            onMouseLeave={function(e){ e.currentTarget.style.color=\"rgba(0,0,0,0.2)\"; }}>\n            \u2715  CLOSE SESSION\n          </div>\n        </div>\n      </div>\n\n      \n    </div>\n  );\n}\n\nfunction FieldPhase({ synthesisData, rawText, mapResponses, sessionData }) {\n  var sd = synthesisData || {};\n  var mr = mapResponses || {};\n  var sData = sessionData || {};\n  /* Merge session feedback into sd so all cards can access it */\n  if (sData.corrections && Object.keys(sData.corrections).length > 0) {\n    sd = Object.assign({}, sd, {\n      corrections: sData.corrections,\n      revisedSynthesis: sData.revisedSynthesis || sd.synthesis,\n      sessionClarity: sData.clarity || \"\",\n      sessionReactions: sData.reactions || {},\n    });\n  }\n\n  \n  var confirmedConns = [];\n  var insightMoments = [];\n  Object.keys(mr).forEach(function(connKey) {\n    var r = mr[connKey];\n    if (!r) return;\n    if (r.value === \"yes\" || r.value === \"partly\") {\n      var conn = { from: r.from || \"\", to: r.to || \"\", insight: r.insight || \"\", comment: r.comment || \"\", value: r.value };\n      confirmedConns.push(conn);\n      if (r.comment && r.comment.trim().length > 8) insightMoments.push(conn);\n    }\n  });\n  var featuredConn = insightMoments[0] || confirmedConns[0] || ((sd.connections && sd.connections.length > 0) ? sd.connections[0] : null);\n  var sReactions = sData.reactions || {};\n  var sCorrections = sData.corrections || {};\n  var revisedSynthesis = sData.revisedSynthesis || null;\n  var sSignals = sData.signals || {};\n\n  var themes = (sd.themes || []).map(function(t, i) { return { label: t.label, weight: t.weight || 1, color: t.color || NC[i % NC.length] }; });\n  var conns = sd.connections || [];\n  var tension = sd.tension || null;\n  var synthesis = sd.synthesis || \"\";\n  var underneath = sd.underneath || [];\n  var opening = sd.opening || \"\";\n  var archetypes = sd.archetypes || [];\n  var arrival = sd.arrival || null;\n  var alchemyData = sd.alchemy || null;\n  var blindSpot = sd.blind_spot || null;\n  var noticing = sd.noticing || \"\";\n\n  \n  if (archetypes.length === 0 && themes.length > 0) {\n    var allText = (synthesis + \" \" + opening + \" \" + (underneath||[]).join(\" \") + \" \" + (tension ? tension.text : \"\") + \" \" + (rawText||\"\").slice(0,500)).toLowerCase();\n    var archScores = [\n      { key: \"chrysalis\", words: [\"transform\",\"change\",\"becoming\",\"dissolving\",\"letting go\",\"shift\",\"shed\",\"release\"], title: \"Something is dissolving\", line: \"What you were is making room for what you're becoming.\" },\n      { key: \"sisyphus\", words: [\"again\",\"loop\",\"repeat\",\"cycle\",\"stuck\",\"same\",\"keep\",\"pattern\",\"tired\",\"push\"], title: \"The beautiful repetition\", line: \"What looks like going nowhere might be building the strength you need.\" },\n      { key: \"tower\", words: [\"fall\",\"break\",\"collapse\",\"end\",\"fail\",\"shatter\",\"crumble\",\"lose\",\"wrong\"], title: \"The necessary collapse\", line: \"What's falling apart was supposed to fall apart.\" },\n      { key: \"phoenix\", words: [\"fire\",\"burn\",\"rise\",\"rebirth\",\"ash\",\"new\",\"emerge\",\"born\",\"start over\"], title: \"Rising from the heat\", line: \"Something had to burn before this could exist.\" },\n      { key: \"hermit\", words: [\"alone\",\"quiet\",\"silence\",\"solitude\",\"withdraw\",\"space\",\"retreat\",\"still\"], title: \"The lamp in the dark\", line: \"You stepped away to hear something.\" },\n      { key: \"threshold\", words: [\"door\",\"choice\",\"decide\",\"leave\",\"enter\",\"between\",\"edge\",\"ready\",\"step\",\"next\"], title: \"Standing at the door\", line: \"You already know which side you belong on.\" },\n      { key: \"weaver\", words: [\"connect\",\"thread\",\"pattern\",\"link\",\"weave\",\"together\",\"relate\",\"between\",\"across\"], title: \"The threads are connecting\", line: \"What seemed separate is revealing itself as one pattern.\" },\n      { key: \"star\", words: [\"hope\",\"light\",\"small\",\"gentle\",\"quiet\",\"tender\",\"soft\",\"okay\",\"fine\"], title: \"Light after collapse\", line: \"Something survived that wasn't supposed to.\" },\n    ];\n    archScores.forEach(function(arch) {\n      arch.score = 0;\n      arch.words.forEach(function(w) { if (allText.indexOf(w) >= 0) arch.score++; });\n    });\n    archScores.sort(function(a, b) { return b.score - a.score; });\n    archetypes = archScores[0].score > 0 ? [archScores[0]] : [{ key: \"chrysalis\", title: \"Something is dissolving\", line: \"What you were is making room for what you're becoming.\" }];\n  }\n\n  var savedRef = useRef(false);\n  useEffect(function() { if (!savedRef.current && sd.themes) { savedRef.current = true; saveSession(Object.assign({}, sd, {\n          archetypes: archetypes,\n          mapResponses: mr,\n          reactions: sReactions,\n          corrections: sCorrections,\n          revisedSynthesis: revisedSynthesis || null,\n          cardFeedback: (function() {\n            \n            var fb = {};\n            Object.keys(sliderValues).forEach(function(k) {\n              fb[k] = Object.assign(fb[k] || {}, { slider: sliderValues[k] });\n            });\n            Object.keys(cardComments).forEach(function(k) {\n              if (cardComments[k] && cardComments[k].trim()) {\n                fb[k] = Object.assign(fb[k] || {}, { comment: cardComments[k].trim() });\n              }\n            });\n            return fb;\n          })()\n        })); } }, []);\n  var history = useMemo(function() { return getArchetypeHistory(); }, []);\n  var timeline = useMemo(function() { return getSessionTimeline(); }, []);\n  \n  var sessionCount = timeline.length + 1;\n\n  \n  var allSessions = loadSessions(); \n  \n  var prevSession = allSessions.length > 0 ? allSessions[allSessions.length - 1] : null;\n  var prevArch = prevSession && prevSession.archetypes && prevSession.archetypes[0]\n    ? prevSession.archetypes[0] : null;\n\n  \n  var themeRecurrence = {};\n  allSessions.forEach(function(s) {\n    var seen = {};\n    (s.themes || []).forEach(function(t) {\n      if (!seen[t.label]) { seen[t.label] = true; themeRecurrence[t.label] = (themeRecurrence[t.label] || 0) + 1; }\n    });\n  });\n  \n  var themesClassified = themes.map(function(t) {\n    var count = themeRecurrence[t.label] || 0;\n    return Object.assign({}, t, {\n      sessions: count,\n      tier: count >= 3 ? \"persistent\" : count >= 2 ? \"returning\" : \"new\"\n    });\n  });\n  var hasPersistentThemes = themesClassified.some(function(t) { return t.tier === \"persistent\"; });\n  var hasReturningThemes = themesClassified.some(function(t) { return t.tier === \"returning\" || t.tier === \"persistent\"; });\n\n  \n  var alchemyArc = allSessions.map(function(s) {\n    return { stage: s.alchemy ? s.alchemy.stage : null, date: s.date };\n  }).filter(function(a) { return a.stage; });\n\n  \n  var lastSessionOpening = allSessions.length > 0 ? (allSessions[allSessions.length - 1].opening || \"\") : \"\";\n  var currentOpening = sd.opening || opening || \"\";\n\n  \n  var currentTensionA = tension ? (tension.a || \"\").toLowerCase().trim() : \"\";\n  var currentTensionB = tension ? (tension.b || \"\").toLowerCase().trim() : \"\";\n  var tensionReturnCount = 0;\n  if (currentTensionA || currentTensionB) {\n    allSessions.forEach(function(s) {\n      if (!s.tension) return;\n      var pa = (s.tension.a || \"\").toLowerCase().trim();\n      var pb = (s.tension.b || \"\").toLowerCase().trim();\n      if ((pa && (pa === currentTensionA || pa === currentTensionB)) ||\n          (pb && (pb === currentTensionA || pb === currentTensionB))) {\n        tensionReturnCount++;\n      }\n    });\n  }\n\n  \n  var words = (rawText || \"\").split(/\\s+/).filter(Boolean);\n  var wordCount = words.length;\n  var uniqueWords = [...new Set(words.map(function(w) { return w.toLowerCase().replace(/[^a-z]/g, \"\"); }))].filter(function(w) { return w.length > 0; });\n  var firstWord = words[0] || \"\u2014\";\n  var lastWord = words[words.length - 1] || \"\u2014\";\n  var freq = {};\n  words.forEach(function(w) { var k = w.toLowerCase().replace(/[^a-z]/g, \"\"); if (k.length >= 4) freq[k] = (freq[k] || 0) + 1; });\n  var topWord = Object.keys(freq).sort(function(a, b) { return freq[b] - freq[a]; })[0] || \"this\";\n  var topWordCount = freq[topWord] || 0;\n  var strongConn = conns[0] || null;\n\n  \n  var primaryArch = archetypes[0] ? Object.assign({ color: (themes[0] && themes[0].color) || \"#E84393\" }, archetypes[0]) : null;\n  \n  var _regMatch = primaryArch ? ARCH_REGISTRY[primaryArch.key] : null;\n  var _archColor = (themes[0] && themes[0].color) || \"#E84393\";\n  var archReg = _regMatch || (primaryArch ? {\n    name: primaryArch.name || primaryArch.key || \"Pattern\",\n    icon: \"\u25c6\",\n    color: _archColor,\n    bg: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, \" + _archColor + \" 100%)\",\n    phases: null\n  } : null);\n  var alchStage = alchemyData ? (alchemyData.stage || \"nigredo\") : \"nigredo\";\n  var alchInfo = FIELD_ALCHEMY[alchStage] || FIELD_ALCHEMY.nigredo;\n  var alchColor = alchInfo.color || \"#888\";\n\n  var [archResponse, setArchResponse] = useState(null);\n  var [current, setCurrent] = useState(0);\n  var [clicked, setClicked] = useState(false);\n\n  \n  var [portrait, setPortrait] = useState(null);\n  var [portraitReady, setPortraitReady] = useState(false);\n\n  useEffect(function() {\n    var cancelled = false;\n    (async function() {\n      try {\n        \n        var sessCount = allSessions.length + 1;\n\n        \n        var currBrief = \"\";\n        if (synthesis) currBrief += synthesis.slice(0,150) + \"\\n\";\n        if (themes.length) currBrief += \"themes:\" + themes.map(function(t){return t.label;}).join(\",\") + \"\\n\";\n        if (tension && tension.a) currBrief += \"tension:\" + tension.a + \"vs\" + tension.b + \"\\n\";\n        if (blindSpot) currBrief += \"blind:\" + (typeof blindSpot===\"string\"?blindSpot:blindSpot.observation||\"\").slice(0,60) + \"\\n\";\n        if (opening) currBrief += \"open:\" + (typeof opening===\"string\"?opening:opening.text||\"\").slice(0,60) + \"\\n\";\n        if (archetypes[0]) currBrief += \"arch:\" + archetypes[0].name + \"\\n\";\n        var corrections = sData.corrections || {};\n        var corrVoice = Object.values(corrections).filter(function(c){return typeof c===\"string\"&&c.length>4;}).slice(0,2);\n        if (corrVoice.length) currBrief += \"said:\" + corrVoice.join(\";\").slice(0,100) + \"\\n\";\n        \n        var arcBrief = allSessions.slice(-6).map(function(s, si) {\n          var parts = [];\n          var a = s.archetypes && s.archetypes[0];\n          if (a && a.name) parts.push(\"arch:\"+a.name+(a.line?\"('\"+a.line.slice(0,60)+\"')\":\"\"));\n          if (s.themes && s.themes[0]) parts.push(\"theme:\"+s.themes.slice(0,2).map(function(t){return t.label;}).join(\",\"));\n          if (s.tension && s.tension.a) parts.push(\"tension:\"+s.tension.a+\"vs\"+s.tension.b);\n          if (typeof s.blind_spot===\"string\"&&s.blind_spot) parts.push(\"blind:\"+s.blind_spot.slice(0,80));\n          if (typeof s.opening===\"string\"&&s.opening) parts.push(\"opening:\"+s.opening.slice(0,80));\n          if (s.synthesis) parts.push(\"reading:\"+s.synthesis.slice(0,120));\n          \n          var sc = s.corrections ? Object.values(s.corrections).filter(function(c){return typeof c===\"string\"&&c.length>4;}).slice(0,1) : [];\n          if (sc.length) parts.push(\"said:\"+sc[0].slice(0,80));\n          return \"S\"+(allSessions.length-6+si+1)+\": \"+parts.join(\" | \");\n        }).join(\"\\n\");\n\n        var prevArchName = prevArch ? prevArch.name : \"\";\n\n        var p = \"You are the most perceptive analyst this person has ever encountered.\\n\"\n          + \"You have access to their complete inner biography. You are going to generate\\n\"\n          + \"a rich portrait that will feed every card in their personal field.\\n\\n\"\n          + \"TOTAL SESSIONS: \" + sessCount + \"\\n\"\n          + \"PREVIOUS ARCHETYPE: \" + (prevArchName||\"none\") + \"\\n\\n\"\n          + \"=== CURRENT SESSION ===\\n\" + currBrief + \"\\n\"\n          + (arcBrief ? \"=== RECENT ARC (last 6 sessions) ===\\n\" + arcBrief + \"\\n\\n\" : \"\\n\")\n          + \"Generate a portrait with these specific fields. Be SPECIFIC to THIS person.\\n\"\n          + \"Nothing generic. If it could apply to anyone, rewrite it.\\n\"\n          + \"Use their actual words, their actual tensions, their specific archetype.\\n\\n\"\n          + \"fieldCondition: 2-4 words \u2014 the atmospheric quality of their field RIGHT NOW. Specific. e.g. 'Tender and Searching' not 'Inner Journey'\\n\"\n          + \"undercurrent: 1 sentence (10-14 words) \u2014 what's running beneath everything this session. From THEIR words.\\n\"\n          + \"depths: 1 sentence (10-14 words) \u2014 what is JUST out of sight. The thing almost surfacing. From blind_spot + underneath.\\n\"\n          + \"growing: 1 sentence (8-12 words) \u2014 what life is reaching toward. From opening + arc.\\n\"\n          + \"mirrorShift: 1 sentence (10-15 words) \u2014 what SPECIFICALLY changed from previous session to this one. Concrete.\\n\"\n          + \"realmWitness: 1 sentence (10-14 words) \u2014 honoring WHERE they are in the larger journey. Sacred not therapeutic.\\n\"\n          + \"realmDeclaration: 3-6 words \u2014 the mythic truth of their current realm.\\n\"\n          + \"archetypeRecognition: 1 sentence (10-16 words) \u2014 what this person did internally that most people never do. Bold. Direct. Use 'You'.\\n\"\n          + \"archetypeShift: 3-5 words \u2014 what moved (if arch changed) or the power of staying.\\n\"\n          + \"question: the ONE question they have been living inside. 8-14 words. Should make them catch their breath.\\n\"\n          + \"toward: 4-7 words \u2014 what is pulling them forward across the whole arc.\\n\"\n          + \"pivotalLine: the single most piercing line from the entire synthesis. Their truth, precisely.\\n\"\n          + 'JSON only \u2014 no markdown:\\n{\"fieldCondition\":\"...\",\"undercurrent\":\"...\",\"depths\":\"...\",\"growing\":\"...\",\"mirrorShift\":\"...\",\"realmWitness\":\"...\",\"realmDeclaration\":\"...\",\"archetypeRecognition\":\"...\",\"archetypeShift\":\"...\",\"question\":\"...\",\"toward\":\"...\",\"pivotalLine\":\"...\"}';\n\n        var rr = await callClaude(p, \"portrait\", 600);\n        if (cancelled) return;\n        var dd = parseJSON(rr);\n        if (dd && dd.fieldCondition) {\n          setPortrait(dd);\n        }\n      } catch(e) {\n        console.warn(\"[SAYCRD] Portrait generation failed:\", e);\n      } finally {\n        if (!cancelled) setPortraitReady(true);\n      }\n    })();\n    return function(){ cancelled = true; };\n  }, []);\n  var containerRef = useRef(null);\n  \n  var [sliderValues, setSliderValues] = useState({});\n  function setSlider(key, v) { setSliderValues(function(prev) { return Object.assign({}, prev, {[key]: v}); }); }\n  var [cardComments, setCardComments] = useState({});\n  function setCardComment(key, text) { setCardComments(function(prev) { return Object.assign({}, prev, {[key]: text}); }); }\n  \n  var [bookmarks, setBookmarks] = useState(function() { try { return JSON.parse(localStorage.getItem(\"saycrd-bookmarks\")||\"[]\"); } catch(e) { return []; } });\n\n  function handleArchResponse(response) {\n    setArchResponse(response);\n    setClicked(true);\n    try {\n      var sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n      var last = sessions[sessions.length - 1];\n      if (last && primaryArch) { last.archetypeResponse = { key: primaryArch.key, response: response }; localStorage.setItem(\"saycrd-sessions\", JSON.stringify(sessions)); }\n    } catch(e) {}\n  }\n\n  \n  var archColor = primaryArch ? (primaryArch.color || (themes[0] && themes[0].color) || \"#E84393\") : (themes[0] && themes[0].color) || \"#E84393\";\n  var CARDS = useMemo(function() {\n    var c = [];\n\n    \n    var pastSessions = loadSessions();\n    var lastArch = null;\n    if (pastSessions.length > 0) {\n      var prev = pastSessions[pastSessions.length - 1];\n      if (prev.archetypes && prev.archetypes.length > 0) {\n        var pa = prev.archetypes[0];\n        lastArch = { name: pa.name || pa.key || \"\", line: pa.line || \"\" };\n      }\n    }\n    var currentArchName = (primaryArch && primaryArch.name) ? primaryArch.name : \"\";\n    var showEvolution = lastArch && lastArch.name && lastArch.name !== currentArchName;\n\n    \n    var archColor = primaryArch ? (primaryArch.color || (themes[0] && themes[0].color) || \"#E84393\") : \"#E84393\";\n    var posterBg = \"linear-gradient(160deg, #06040E 0%, \" + hexDarken(archColor, 0.14) + \" 45%, \" + hexDarken(archColor, 0.22) + \" 100%)\";\n    \n    c.push({ type: \"field_condition\", bg: \"#030308\" });\n\n    \n    c.push({ type: \"arch_billboard\", bg: \"#030308\" });\n\n    \n    c.push({ type: \"depths_field\", bg: \"#010810\" });\n\n    \n    c.push({ type: \"whats_growing\", bg: \"#010A04\" });\n\n    \n    c.push({ type: \"the_mirror\", bg: \"#08080C\" });\n\n    \n    c.push({ type: \"the_realm\", bg: \"#04020A\" });\n\n    \n    c.push({ type: \"year_review\", bg: \"#060606\" });\n\n    \n    c.push({ type: \"field_report\", bg: \"#FAFAF8\" });\n    return c;\n  }, [archResponse, tension, underneath.length, primaryArch, blindSpot, strongConn, topWordCount, themes.length]);\n\n  console.log(\"[FIELD] CARDS[0]:\", CARDS[0]&&CARDS[0].type, \"CARDS[1]:\", CARDS[1]&&CARDS[1].type, \"current:\", current, \"total:\", CARDS.length);\n  var card = CARDS[current];\n\n  var advance = function() {\n    if (card && card.interactive && !clicked) { setClicked(true); return; }\n    if (current < CARDS.length - 1) { setCurrent(function(c) { return c + 1; }); setClicked(false); }\n  };\n  var goBack = function() { if (current > 0) { setCurrent(function(c) { return c - 1; }); setClicked(false); } };\n  var handleClick = function(e) {\n    if (e.target.closest && (e.target.closest(\"button\") || e.target.closest(\"[data-noadvance]\") || e.target.tagName === \"circle\" || e.target.tagName === \"svg\")) return;\n    var rect = containerRef.current ? containerRef.current.getBoundingClientRect() : null;\n    if (!rect) return;\n    var x = (e.clientX || (e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientX : 0)) - rect.left;\n    x < rect.width * 0.25 ? goBack() : advance();\n  };\n  useEffect(function() {\n    var handler = function(e) { if (e.key === \"ArrowRight\" || e.key === \" \") advance(); else if (e.key === \"ArrowLeft\") goBack(); };\n    window.addEventListener(\"keydown\", handler);\n    return function() { window.removeEventListener(\"keydown\", handler); };\n  }, [current, clicked, CARDS.length]);\n\n  var renderCard = function() {\n    switch (card.type) {\n\n      case \"field_condition\": {\n        return <FieldConditionCard themes={themes} sd={sd} primaryArch={primaryArch} sessionCount={sessionCount} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"arch_billboard\": {\n        return <ArchBillboardCard themes={themes} sd={sd} primaryArch={primaryArch} archColor={archColor} sessionCount={sessionCount} prevArch={prevArch} allSessions={allSessions} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"depths_field\": {\n        return <DepthsFieldCard themes={themes} sd={sd} sessionCount={sessionCount} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"whats_growing\": {\n        return <WhatsGrowingCard themes={themes} sd={sd} sessionCount={sessionCount} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n\n      case \"the_mirror\": {\n        return <MirrorCard themes={themes} sd={sd} sessionCount={sessionCount} rawText={rawText} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"the_realm\": {\n        return <RealmCard themes={themes} sd={sd} sessionCount={sessionCount} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"year_review\": {\n        return <YearReviewCard themes={themes} sd={sd} sessionCount={sessionCount} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"field_report\": {\n        return <FieldReportCard themes={themes} sd={sd} sessionCount={sessionCount} allSessions={allSessions} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"the_underdrawing\": {\n        return <UnderdrawingCard themes={themes} sd={sd} sessionCount={sessionCount} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"the_landscape\": {\n        return <LandscapeCard themes={themes} sd={sd} sessionCount={sessionCount} primaryArch={primaryArch} archReg={archReg} portrait={portrait} portraitReady={portraitReady} goNext={advance}/>;\n      }\n      case \"archetype_poster\": {\n        var ap = primaryArch || {};\n        var apName = ap.name || ap.title || \"Your Pattern\";\n        var apLine = ap.line || \"\";\n        var apColor = ap.color || (themes[0] && themes[0].color) || \"#E84393\";\n        var apSources = ap.source_nodes || [];\n        var apLastArch = card.lastArch;\n        var apShowEvol = card.showEvolution;\n        \n        var apHero = apName.replace(/^The\\s+/i, \"\").toUpperCase();\n        var apThe = apName.match(/^The\\s+/i) ? \"THE\" : \"\";\n        return (\n          <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px 50px\", overflow:\"hidden\" }}>\n            <FieldParticles color={apColor} count={22}/>\n            \n            <div style={{ position:\"absolute\", top:\"30%\", left:\"50%\", transform:\"translateX(-50%)\", width:300, height:300, borderRadius:\"50%\", background:\"radial-gradient(circle, \"+apColor+\"18, transparent 70%)\", filter:\"blur(50px)\", pointerEvents:\"none\" }}/>\n            \n            <div style={{ position:\"absolute\", top:48, left:28, fontSize:9, letterSpacing:\"0.35em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\" }}>\n              {sessionCount > 1 ? \"SESSION \"+sessionCount : \"FIRST SESSION\"}\n            </div>\n            \n            {apShowEvol && apLastArch && (\n              <div style={{ position:\"absolute\", top:48, right:28, fontSize:9, letterSpacing:\"0.12em\", color:apColor+\"66\", fontFamily:FB, textAlign:\"right\" }}>\n                evolving from<br/><span style={{ color:apColor+\"99\" }}>{apLastArch.name}</span>\n              </div>\n            )}\n            \n            <div style={{ animation:\"riseUp 0.9s ease both\", marginBottom:8 }}>\n              <ArchGlyph name={apName} color={apColor} size={150}/>\n            </div>\n            \n            {apThe && <div style={{ fontSize:11, letterSpacing:\"0.55em\", color:apColor+\"66\", fontFamily:FB, marginBottom:4, animation:\"riseUp 0.8s ease 0.15s both\" }}>{apThe}</div>}\n            \n            <div style={{ fontSize: apHero.length > 12 ? 34 : apHero.length > 8 ? 42 : 52, fontWeight:700, color:\"white\", fontFamily:FB, letterSpacing:\"0.06em\", textAlign:\"center\", lineHeight:1.1, animation:\"riseUp 0.8s ease 0.25s both\", textShadow:\"0 0 60px \"+apColor+\"44\" }}>\n              {apHero}\n            </div>\n            \n            {apLine && <div style={{ marginTop:14, fontSize:16, color:\"rgba(255,255,255,0.5)\", fontFamily:FD, fontStyle:\"italic\", textAlign:\"center\", maxWidth:290, lineHeight:1.65, animation:\"riseUp 0.8s ease 0.4s both\" }}>\n              {apLine}\n            </div>}\n            \n            {apSources.length > 0 && (\n              <div style={{ display:\"flex\", gap:8, flexWrap:\"wrap\", justifyContent:\"center\", marginTop:22, animation:\"riseUp 0.7s ease 0.6s both\" }}>\n                {apSources.slice(0,3).map(function(src, si) {\n                  return <div key={si} style={{ fontSize:10, color:apColor+\"aa\", fontFamily:FB, letterSpacing:\"0.08em\", padding:\"4px 10px\", borderRadius:12, border:\"1px solid \"+apColor+\"22\", background:apColor+\"0A\" }}>{src}</div>;\n                })}\n              </div>\n            )}\n            <div style={{ position:\"absolute\", bottom:32, fontSize:11, color:\"rgba(255,255,255,0.12)\", fontFamily:FB, letterSpacing:\"0.2em\" }}>tap to continue \u2192</div>\n          </div>\n        );\n      }\n\n      \n      case \"arch_evolution\": {\n        var ev = card.lastArch;\n        var evCur = primaryArch || {};\n        var evCurName = evCur.name || \"Your Pattern\";\n        var evCurColor = evCur.color || (themes[0] && themes[0].color) || \"#E84393\";\n        var evPastColor = \"#888890\";\n        return (\n          <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px\", overflow:\"hidden\" }}>\n            <FieldParticles color={evCurColor} count={14}/>\n            <div style={{ fontSize:10, letterSpacing:\"0.4em\", color:\"rgba(255,255,255,0.2)\", fontFamily:FB, marginBottom:32, textTransform:\"uppercase\", animation:\"riseUp 0.6s ease both\" }}>what shifted</div>\n            <div style={{ display:\"flex\", alignItems:\"center\", gap:24, width:\"100%\", justifyContent:\"center\", animation:\"riseUp 0.8s ease 0.1s both\" }}>\n              \n              <div style={{ textAlign:\"center\", flex:1, opacity:0.55 }}>\n                <ArchGlyph name={ev ? ev.name : \"\"} color={evPastColor} size={90}/>\n                <div style={{ fontSize:10, color:\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.2em\", marginTop:10, textTransform:\"uppercase\" }}>was</div>\n                <div style={{ fontSize:15, color:\"rgba(255,255,255,0.4)\", fontFamily:FB, fontWeight:600, marginTop:4 }}>{ev ? ev.name : \"\"}</div>\n                {ev && ev.line && <div style={{ fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FD, fontStyle:\"italic\", marginTop:5, lineHeight:1.5 }}>{ev.line.slice(0,60)}{ev.line.length>60?\"\u2026\":\"\"}</div>}\n              </div>\n              \n              <div style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", gap:6 }}>\n                <div style={{ width:2, height:40, background:\"linear-gradient(180deg, rgba(255,255,255,0.06), \"+evCurColor+\"55)\" }}/>\n                <div style={{ fontSize:18, color:evCurColor, opacity:0.7 }}>\u2193</div>\n              </div>\n              \n              <div style={{ textAlign:\"center\", flex:1 }}>\n                <ArchGlyph name={evCurName} color={evCurColor} size={110}/>\n                <div style={{ fontSize:10, color:evCurColor+\"88\", fontFamily:FB, letterSpacing:\"0.2em\", marginTop:10, textTransform:\"uppercase\" }}>now</div>\n                <div style={{ fontSize:17, color:\"rgba(255,255,255,0.85)\", fontFamily:FB, fontWeight:700, marginTop:4 }}>{evCurName}</div>\n                {evCur.line && <div style={{ fontSize:11, color:\"rgba(255,255,255,0.4)\", fontFamily:FD, fontStyle:\"italic\", marginTop:5, lineHeight:1.5 }}>{evCur.line.slice(0,60)}{evCur.line.length>60?\"\u2026\":\"\"}</div>}\n              </div>\n            </div>\n            \n            {sd.synthesis && (\n              <div style={{ marginTop:32, fontSize:14, color:\"rgba(255,255,255,0.35)\", fontFamily:FD, fontStyle:\"italic\", textAlign:\"center\", maxWidth:290, lineHeight:1.7, animation:\"riseUp 0.8s ease 0.5s both\" }}>\n                {sd.synthesis.slice(0,120)}{sd.synthesis.length>120?\"\u2026\":\"\"}\n              </div>\n            )}\n          </div>\n        );\n      }\n\n      \n      case \"live_tension\": {\n        var lt = card.conn || {};\n        var ltA = lt.from || \"\"; var ltB = lt.to || \"\";\n        var ltInsight = lt.comment && lt.comment.trim().length > 8 ? lt.comment.trim() : lt.insight || \"\";\n        var ltUser = lt.comment && lt.comment.trim().length > 8; \n        var ltColA = card.colA || \"#E84393\"; var ltColB = card.colB || \"#6BB8FF\";\n        var ltArchName = card.archName || \"\"; var ltArchLine = card.archLine || \"\";\n        var ltArchColor = card.archColor || ltColA;\n        var ltIsInsight = card.isInsight;\n        var ltSv = sliderValues.live_tension !== undefined ? sliderValues.live_tension : 50;\n        var ltAlive = ltSv >= 68; var ltAway = ltSv <= 32;\n\n        \n        \n        var axisLabel = lt.value === \"partly\" ? \"in tension with\" : \"connected to\";\n\n        \n        var surpriseQs = [\n          \"What does \" + ltA + \" need from \" + ltB + \" that it hasn't asked for yet?\",\n          \"If \" + ltA + \" and \" + ltB + \" switched places for a day \u2014 what breaks?\",\n          \"What would it cost to fully separate \" + ltA + \" from \" + ltB + \"?\",\n          \"Which one is protecting the other?\",\n          \"What do \" + ltA + \" and \" + ltB + \" have in common that you haven't named yet?\",\n        ];\n        var surpriseQ = surpriseQs[(ltA.length + ltB.length) % surpriseQs.length];\n\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\" }}>\n            \n            <div style={{ position:\"absolute\", top:\"20%\", left:\"10%\", width:260, height:260, borderRadius:\"50%\", background:\"radial-gradient(circle, \"+ltColA+\"1A, transparent 65%)\", filter:\"blur(60px)\", pointerEvents:\"none\" }}/>\n            <div style={{ position:\"absolute\", bottom:\"15%\", right:\"8%\", width:240, height:240, borderRadius:\"50%\", background:\"radial-gradient(circle, \"+ltColB+\"18, transparent 65%)\", filter:\"blur(60px)\", pointerEvents:\"none\" }}/>\n            <FieldParticles color={ltAlive ? ltColA : \"rgba(255,255,255,0.3)\"} count={ltAlive ? 18 : 10}/>\n\n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"flex-start\", padding:\"52px 26px 24px\", overflowY:\"auto\" }}>\n\n              \n              <div style={{ fontSize:9, letterSpacing:\"0.45em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:28, animation:\"riseUp 0.6s ease both\" }}>\n                {ltUser ? \"YOUR INSIGHT\" : \"THE CONNECTION\"}\n              </div>\n\n              \n              <div style={{ display:\"flex\", alignItems:\"center\", width:\"100%\", maxWidth:340, gap:0, animation:\"riseUp 0.7s ease 0.1s both\" }}>\n                \n                <div style={{ flex:1, padding:\"14px 16px\", borderRadius:16, background:ltColA+\"18\", border:\"1.5px solid \"+ltColA+\"44\", textAlign:\"center\" }}>\n                  <div style={{ fontSize:15, color:\"rgba(255,255,255,0.9)\", fontFamily:FB, fontWeight:700, lineHeight:1.3 }}>{ltA}</div>\n                </div>\n                \n                <div style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", minWidth:54, gap:4 }}>\n                  <div style={{ width:2, height:20, background:\"linear-gradient(180deg,\"+ltColA+\"66, \"+ltColB+\"66)\" }}/>\n                  <div style={{ fontSize:8, color:\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.08em\", textTransform:\"uppercase\", textAlign:\"center\", lineHeight:1.4 }}>{axisLabel}</div>\n                  <div style={{ width:2, height:20, background:\"linear-gradient(180deg,\"+ltColA+\"66, \"+ltColB+\"66)\" }}/>\n                </div>\n                \n                <div style={{ flex:1, padding:\"14px 16px\", borderRadius:16, background:ltColB+\"18\", border:\"1.5px solid \"+ltColB+\"44\", textAlign:\"center\" }}>\n                  <div style={{ fontSize:15, color:\"rgba(255,255,255,0.9)\", fontFamily:FB, fontWeight:700, lineHeight:1.3 }}>{ltB}</div>\n                </div>\n              </div>\n\n              \n              {ltInsight && (\n                <div style={{ marginTop:22, fontSize:ltInsight.length > 80 ? 17 : 21, color: ltAlive ? \"rgba(255,255,255,0.95)\" : \"rgba(255,255,255,0.72)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.7, textAlign:\"center\", maxWidth:310, animation:\"riseUp 0.8s ease 0.25s both\", transition:\"color 0.4s\", textShadow: ltAlive ? \"0 0 40px \"+ltColA+\"33\" : \"none\" }}>\n                  {ltUser && <span style={{ fontSize:10, color:ltColA+\"99\", fontFamily:FB, letterSpacing:\"0.15em\", display:\"block\", marginBottom:8, textTransform:\"uppercase\", fontStyle:\"normal\" }}>you said \u2193</span>}\n                  \"{ltInsight}\"\n                </div>\n              )}\n\n              \n              {!ltAway && (\n                <div style={{ marginTop:20, padding:\"14px 18px\", borderRadius:16, background:\"rgba(255,255,255,0.03)\", border:\"1px solid rgba(255,255,255,0.07)\", maxWidth:310, animation:\"riseUp 0.8s ease 0.45s both\" }}>\n                  <div style={{ fontSize:10, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.18em\", marginBottom:8, textTransform:\"uppercase\" }}>to sit with</div>\n                  <div style={{ fontSize:15, color: ltAlive ? \"rgba(255,255,255,0.78)\" : \"rgba(255,255,255,0.5)\", fontFamily:FD, lineHeight:1.65, transition:\"color 0.4s\" }}>\n                    {surpriseQ}\n                  </div>\n                </div>\n              )}\n\n              \n              {ltArchName && (ltA.length > 0 || ltB.length > 0) && !ltAway && (\n                <div style={{ marginTop:16, display:\"flex\", alignItems:\"center\", gap:10, animation:\"riseUp 0.7s ease 0.6s both\", opacity:0.7 }}>\n                  <ArchGlyph name={ltArchName} color={ltArchColor} size={36}/>\n                  <div>\n                    <div style={{ fontSize:9, color:ltArchColor+\"88\", fontFamily:FB, letterSpacing:\"0.2em\", textTransform:\"uppercase\" }}>{ltArchName}</div>\n                    {ltArchLine && <div style={{ fontSize:11, color:\"rgba(255,255,255,0.3)\", fontFamily:FD, fontStyle:\"italic\", marginTop:2, lineHeight:1.5, maxWidth:220 }}>{ltArchLine}</div>}\n                  </div>\n                </div>\n              )}\n\n              \n              <div style={{ width:\"100%\", maxWidth:320, marginTop:20, animation:\"riseUp 0.7s ease 0.7s both\" }} data-noadvance=\"true\">\n                <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:8 }}>\n                  <span style={{ fontSize:10, color:\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>PUSHING AWAY</span>\n                  <span style={{ fontSize:10, color:\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>LANDS</span>\n                </div>\n                <div style={{ position:\"relative\", height:6, background:\"rgba(255,255,255,0.07)\", borderRadius:3, cursor:\"pointer\" }}\n                  onPointerDown={function(e) {\n                    e.stopPropagation();\n                    var rect = e.currentTarget.getBoundingClientRect();\n                    var pct = Math.round(Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100)));\n                    setSlider(\"live_tension\", pct);\n                    var move = function(ev) {\n                      var p = Math.round(Math.max(0, Math.min(100, ((ev.clientX - rect.left) / rect.width) * 100)));\n                      setSlider(\"live_tension\", p);\n                    };\n                    var up = function() { window.removeEventListener(\"pointermove\", move); window.removeEventListener(\"pointerup\", up); };\n                    window.addEventListener(\"pointermove\", move);\n                    window.addEventListener(\"pointerup\", up);\n                  }}>\n                  <div style={{ position:\"absolute\", left:0, top:0, height:\"100%\", width:ltSv+\"%\", background:\"linear-gradient(90deg,\"+ltColA+\"66,\"+ltColB+\")\", borderRadius:3, transition:\"width 0.15s\", boxShadow: ltAlive ? \"0 0 10px \"+ltColB+\"55\" : \"none\" }}/>\n                  <div style={{ position:\"absolute\", top:\"50%\", left:ltSv+\"%\", transform:\"translate(-50%,-50%)\", width:16, height:16, borderRadius:\"50%\", background: ltAlive ? ltColB : \"rgba(255,255,255,0.4)\", border:\"2px solid rgba(255,255,255,0.6)\", transition:\"left 0.15s, background 0.3s\", boxShadow: ltAlive ? \"0 0 8px \"+ltColB : \"none\" }}/>\n                </div>\n                {ltAway && <div style={{ marginTop:10, fontSize:12, color:\"rgba(255,255,255,0.4)\", fontFamily:FB, textAlign:\"center\" }}>tap \u2192 to keep moving</div>}\n              </div>\n\n            </div>\n          </div>\n        );\n      }\n\n      \n      case \"arrival\": return (\n        <FC><FieldParticles color=\"#E84393\" count={28} />\n          <div style={{ fontSize: 11, letterSpacing: \"0.4em\", color: \"rgba(255,255,255,0.2)\", fontFamily: FB, marginBottom: 40, animation: \"riseUp 0.8s ease both\" }}>\n            {sessionCount > 1 ? \"SESSION \" + sessionCount : \"THIS SESSION\"}\n          </div>\n          <FHero size={48} color=\"white\">{arrival ? arrival.line : \"Your\\nField\"}</FHero>\n          {arrival && arrival.energy && <div style={{ marginTop: 28, display: \"flex\", alignItems: \"center\", gap: 10, animation: \"riseUp 1s ease 0.5s both\" }}>\n            <div style={{ width: 8, height: 8, borderRadius: \"50%\", background: \"#E84393\", boxShadow: \"0 0 14px rgba(232,67,147,0.5)\" }} />\n            <span style={{ fontSize: 12, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, letterSpacing: \"0.2em\", textTransform: \"uppercase\" }}>{arrival.energy}</span>\n          </div>}\n          {archetypes.length > 0 && archReg && <div style={{ display: \"flex\", gap: 10, marginTop: 36, flexWrap: \"wrap\", justifyContent: \"center\", animation: \"riseUp 0.8s ease 0.8s both\" }}>\n            <div style={{ padding: \"6px 16px\", borderRadius: 20, background: archReg.color + \"14\", border: \"1px solid \" + archReg.color + \"30\", fontSize: 12, color: archReg.color + \"cc\", fontFamily: FB }}>{archReg.icon} {archReg.name}</div>\n          </div>}\n          <div style={{ marginTop: 48, fontSize: 12, color: \"rgba(255,255,255,0.15)\", fontFamily: FB }}>tap to begin \u2192</div>\n        </FC>\n      );\n\n      \n      case \"words\": {\n        \n        var txt = (rawText || \"\").toLowerCase();\n        var tones = [\n          { key:\"doubt\",       label:\"Doubt\",       color:\"#6BB8FF\", words:[\"maybe\",\"unsure\",\"wonder\",\"question\",\"not sure\",\"unclear\",\"confused\",\"doubt\",\"uncertain\",\"hesit\"] },\n          { key:\"clarity\",     label:\"Clarity\",     color:\"#6BFFB8\", words:[\"clear\",\"understand\",\"realize\",\"see now\",\"know\",\"certain\",\"obvious\",\"makes sense\",\"finally\"] },\n          { key:\"optimism\",    label:\"Optimism\",    color:\"#FFD700\", words:[\"hope\",\"better\",\"possible\",\"excited\",\"looking forward\",\"believe\",\"will\",\"can\",\"going to\",\"good\"] },\n          { key:\"frustration\", label:\"Frustration\", color:\"#FF6B9D\", words:[\"frustrated\",\"stuck\",\"again\",\"why\",\"tired\",\"enough\",\"over it\",\"annoyed\",\"keeps\",\"always\",\"never\"] },\n          { key:\"curiosity\",   label:\"Curiosity\",   color:\"#B86BFF\", words:[\"curious\",\"wonder\",\"what if\",\"interesting\",\"explore\",\"discover\",\"notice\",\"find\",\"question\",\"how\"] },\n          { key:\"urgency\",     label:\"Urgency\",     color:\"#FFB86B\", words:[\"need\",\"must\",\"now\",\"urgent\",\"soon\",\"time\",\"quickly\",\"asap\",\"before\",\"deadline\",\"running out\"] },\n        ];\n        var scored = tones.map(function(t) {\n          var score = 0; t.words.forEach(function(w) { var re = new RegExp(w,\"g\"); var m = txt.match(re); if(m) score += m.length; }); return Object.assign({},t,{score});\n        }).filter(function(t) { return t.score > 0; }).sort(function(a,b) { return b.score-a.score; }).slice(0,4);\n        \n        if (scored.length === 0) {\n          var energy = (arrival && arrival.energy) || \"restless\";\n          var energyMap = { heavy:\"frustration\", electric:\"urgency\", shattered:\"doubt\", still:\"clarity\", quiet:\"clarity\", warm:\"optimism\", grounded:\"clarity\", restless:\"urgency\", tender:\"curiosity\", fierce:\"urgency\" };\n          var fallbackKey = energyMap[energy] || \"curiosity\";\n          scored = [tones.find(function(t){return t.key===fallbackKey;})||tones[4]];\n        }\n        var maxScore = scored[0].score || 1;\n        return (\n          <FC><FieldParticles color=\"#6BFFB8\" count={20} />\n            <FLabel color=\"#6BFFB8\">YOU POURED</FLabel>\n            <div style={{ fontSize: wordCount > 999 ? 90 : 116, fontWeight: 300, color: \"white\", lineHeight: 1, fontFamily: FD, letterSpacing: \"-0.04em\", animation: \"riseUp 0.6s ease both\" }}>{wordCount.toLocaleString()}</div>\n            <div style={{ fontSize: 18, color: \"rgba(255,255,255,0.6)\", fontFamily: FB, marginBottom: 32, animation: \"riseUp 0.6s ease 0.2s both\" }}>words</div>\n            <div style={{ width:\"100%\", maxWidth:290, display:\"flex\", flexDirection:\"column\", gap:10, animation:\"riseUp 0.7s ease 0.4s both\" }}>\n              <div style={{ fontSize:11, color:\"rgba(255,255,255,0.45)\", fontFamily:FB, letterSpacing:\"0.18em\", textTransform:\"uppercase\", marginBottom:4 }}>What came through</div>\n              {scored.map(function(t, i) {\n                var pct = Math.min(100, Math.round((t.score / maxScore) * 100));\n                return <div key={t.key} style={{ animation:\"riseUp 0.5s ease \"+(0.45+i*0.12)+\"s both\" }}>\n                  <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:5 }}>\n                    <span style={{ fontSize:16, color:\"rgba(255,255,255,0.88)\", fontFamily:FB, fontWeight:600 }}>{t.label}</span>\n                    <span style={{ fontSize:13, color:t.color, fontFamily:FB }}>{pct}%</span>\n                  </div>\n                  <div style={{ height:6, background:\"rgba(255,255,255,0.07)\", borderRadius:3, overflow:\"hidden\" }}>\n                    <div style={{ width:pct+\"%\", height:\"100%\", background:\"linear-gradient(90deg,\"+t.color+\"55,\"+t.color+\")\", borderRadius:3, animation:\"growWidth 0.9s ease \"+(0.5+i*0.15)+\"s both\", boxShadow:\"0 0 8px \"+t.color+\"44\" }} />\n                  </div>\n                </div>;\n              })}\n            </div>\n          </FC>\n        );\n      }\n\n      \n      case \"top_themes\": return (\n        <FC><FieldParticles color=\"#FF6B9D\" count={14} />\n          <FLabel color=\"#FF6B9D\">YOUR FORCES</FLabel>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 14, width: \"100%\", maxWidth: 310 }}>\n            {themes.slice(0, 5).map(function(t, i) {\n              var pct = Math.min(100, Math.round((t.weight / 5) * 100));\n              return <div key={i} style={{ display: \"flex\", alignItems: \"center\", gap: 14, animation: \"riseUp 0.5s ease \" + (i * 0.12) + \"s both\" }}>\n                <span style={{ fontSize: 26, color: t.color, fontFamily: FD, fontWeight: 700, width: 28, textAlign: \"right\" }}>{i + 1}</span>\n                <div style={{ flex: 1 }}>\n                  <span style={{ fontSize: 21, color: \"white\", fontFamily: FB, fontWeight: 600 }}>{t.label}</span>\n                  <div style={{ height: 5, background: \"rgba(255,255,255,0.06)\", borderRadius: 3, overflow: \"hidden\", marginTop: 6 }}>\n                    <div style={{ width: pct + \"%\", height: \"100%\", background: \"linear-gradient(90deg, \" + t.color + \"55, \" + t.color + \")\", borderRadius: 3, animation: \"growWidth 1s ease \" + (i * 0.15) + \"s both\" }} />\n                  </div>\n                </div>\n              </div>;\n            })}\n          </div>\n        </FC>\n      );\n\n      \n      case \"synthesis\": {\n        var sv = sliderValues.synthesis !== undefined ? sliderValues.synthesis : 50;\n        var alive = sv >= 68; var away = sv <= 32;\n        return (\n          <BookmarkableCard text={synthesis} label=\"The Reading\" color=\"#D6B26D\">\n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\",\n              alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px 80px\",\n              transition:\"opacity 0.5s\", opacity: away ? 0.55 : 1 }}>\n              <FieldParticles color={alive ? \"#E8B84E\" : \"#D6B26D\"} count={alive ? 20 : 8} />\n              <FLabel color=\"#D6B26D\">THE READING</FLabel>\n              <div style={{ fontSize:22, color: alive ? \"white\" : \"rgba(255,255,255,0.85)\",\n                fontFamily:FD, lineHeight:1.65, textAlign:\"center\", maxWidth:320,\n                animation:\"riseUp 0.8s ease both\",\n                textShadow: alive ? \"0 0 40px rgba(232,184,78,0.25)\" : \"none\",\n                transition:\"text-shadow 0.5s, color 0.3s\" }}>\n                {synthesis || \"Something is moving underneath your words.\"}\n              </div>\n              {alive && <div style={{ position:\"absolute\", inset:20, borderRadius:20,\n                border:\"1px solid rgba(232,184,78,0.18)\", pointerEvents:\"none\",\n                animation:\"riseUp 0.4s ease both\" }} />}\n              {noticing && !away && <div style={{ marginTop:24, padding:\"12px 18px\", borderRadius:12,\n                background:\"rgba(214,178,109,0.07)\", border:\"1px solid rgba(214,178,109,0.15)\",\n                maxWidth:290, animation:\"riseUp 0.8s ease 0.5s both\" }}>\n                <div style={{ fontSize:14, color:\"rgba(255,200,120,0.8)\", fontFamily:FB, lineHeight:1.65 }}>\u2726 {noticing}</div>\n              </div>}\n              {away && <div style={{ marginTop:24, fontSize:14, color:\"rgba(255,255,255,0.55)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>didn't land \u2014 keep moving</div>}\n              <AccuracySlider value={sv} onSlide={function(v){setSlider(\"synthesis\",v);}} color=\"#D6B26D\" leftLabel=\"doesn't fit\" rightLabel=\"exactly this\" />\n            </div>\n          </BookmarkableCard>\n        );\n      }\n\n      \n      case \"bigword\": {\n        var bwSv = sliderValues.bigword !== undefined ? sliderValues.bigword : 50;\n        var bwAlive = bwSv >= 68;\n        \n        var bwQuestions = [\n          \"What does \"+topWord+\" want from you right now?\",\n          \"Every time you wrote \"+topWord+\", something needed to be named. What is it?\",\n          \"You reached for \"+topWord+\" \"+topWordCount+\" times. What does it carry?\",\n          \"The word \"+topWord+\" showed up repeatedly. Is it a craving, or a weight?\",\n        ];\n        var bwQ = bwQuestions[topWordCount % bwQuestions.length];\n        return (\n          <FC><FieldParticles color={bwAlive ? \"#A8E8DA\" : \"#7ECABA\"} count={bwAlive ? 24 : 14} />\n            <FLabel color=\"#7ECABA\">HIDDEN PATTERN</FLabel>\n            <div style={{ fontSize:14, color:\"rgba(255,255,255,0.65)\", fontFamily:FB, marginBottom:8, animation:\"riseUp 0.6s ease both\" }}>you wrote the word</div>\n            <div style={{ fontSize:52, color: bwAlive ? \"#A8E8DA\" : \"#7ECABA\", fontFamily:FD, animation:\"riseUp 0.7s ease 0.2s both\", letterSpacing:\"-0.01em\",\n              textShadow: bwAlive ? \"0 0 50px rgba(126,202,186,0.5)\" : \"none\", transition:\"all 0.4s\" }}>{topWord}</div>\n            <div style={{ fontSize:100, fontWeight:300, color:\"white\", lineHeight:1, fontFamily:FD, animation:\"riseUp 0.8s ease 0.3s both\" }}>{topWordCount}</div>\n            <div style={{ fontSize:16, color:\"rgba(255,255,255,0.55)\", fontFamily:FB, animation:\"riseUp 0.6s ease 0.45s both\", marginBottom:4 }}>times</div>\n            <div style={{ marginTop:16, fontSize:15, color:\"rgba(126,202,186,0.8)\", fontFamily:FD, maxWidth:280, textAlign:\"center\", lineHeight:1.65, animation:\"riseUp 0.8s ease 0.9s both\" }}>\n              {bwQ}\n            </div>\n            <AccuracySlider value={bwSv} onSlide={function(v){setSlider(\"bigword\",v);}} color=\"#7ECABA\" leftLabel=\"coincidence\" rightLabel=\"significant\" />\n          </FC>\n        );\n      }\n\n      \n      case \"connection\": {\n        var cSv = sliderValues.connection !== undefined ? sliderValues.connection : 50;\n        var cAlive = cSv >= 68; var cAway = cSv <= 32;\n        var fromColor = (themes.find(function(t){return t.label===strongConn?.from;}))||{color:\"#FFB86B\"};\n        var toColor   = (themes.find(function(t){return t.label===strongConn?.to;}))||{color:\"#6BB8FF\"};\n        return (\n          <FC><FieldParticles color={cAlive ? \"#9DCFFF\" : \"#6BB8FF\"} count={cAlive ? 22 : 12} />\n            <FLabel color=\"#6BB8FF\">THE LINK</FLabel>\n            {strongConn && <>\n              <div style={{ display:\"flex\", alignItems:\"center\", gap:14, margin:\"16px 0\", animation:\"riseUp 0.7s ease 0.1s both\",\n                filter: cAway ? \"opacity(0.4)\" : \"none\", transition:\"filter 0.4s\" }}>\n                <FOrb color={fromColor.color}>{(strongConn.from||\"\").length>10?strongConn.from.slice(0,9)+\"\u2026\":strongConn.from}</FOrb>\n                <div style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", gap:5 }}>\n                  <div style={{ width: cAlive ? 64 : 44, height: cAlive ? 3 : 2, background:\"linear-gradient(90deg,\"+fromColor.color+\",\"+toColor.color+\")\",\n                    boxShadow: cAlive ? \"0 0 12px rgba(107,184,255,0.4)\" : \"none\", transition:\"all 0.4s\" }} />\n                  <span style={{ fontSize:11, color:\"rgba(255,255,255,0.55)\", fontFamily:FB, fontWeight:700, textTransform:\"uppercase\", letterSpacing:\"0.1em\" }}>{strongConn.label}</span>\n                </div>\n                <FOrb color={toColor.color}>{(strongConn.to||\"\").length>10?strongConn.to.slice(0,9)+\"\u2026\":strongConn.to}</FOrb>\n              </div>\n              <div style={{ fontSize:19, color: cAlive ? \"rgba(255,255,255,0.95)\" : \"rgba(255,255,255,0.72)\", fontFamily:FD, maxWidth:290, lineHeight:1.65, animation:\"riseUp 0.8s ease 0.35s both\",\n                textShadow: cAlive ? \"0 0 30px rgba(107,184,255,0.3)\" : \"none\", transition:\"all 0.4s\" }}>{strongConn.insight}</div>\n              {cAlive && <div style={{ marginTop:12, fontSize:14, color:\"rgba(107,184,255,0.7)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>What does this connection ask of you?</div>}\n              {cAway && <div style={{ marginTop:12, fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>Not quite \u2014 explore the map to find the link that does fit.</div>}\n            </>}\n            <AccuracySlider value={cSv} onSlide={function(v){setSlider(\"connection\",v);}} color=\"#6BB8FF\" leftLabel=\"forced\" rightLabel=\"I see it\" />\n          </FC>\n        );\n      }\n\n      \n      case \"tension\": {\n        var tA = tension ? tension.a : \"one force\";\n        var tB = tension ? tension.b : \"another\";\n        var tText = tension ? tension.text : \"\";\n        var tSv = sliderValues.tension !== undefined ? sliderValues.tension : 50;\n        var tAlive = tSv >= 68; var tAway = tSv <= 32;\n        var tQuestions = [\n          \"What would it cost you to stop managing this tension?\",\n          \"Which side are you secretly on?\",\n          \"What if the tension IS the answer \u2014 not a problem to solve?\",\n          \"Who taught you these two things couldn't coexist?\",\n        ];\n        var tQ = tQuestions[(tA+tB).length % tQuestions.length];\n        return <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px\" }}>\n          <FLabel color=\"#6BB8FF\">YOUR TENSION</FLabel>\n          <div style={{ display:\"flex\", justifyContent:\"space-between\", gap:12, width:\"100%\", maxWidth:320, marginBottom:4, animation:\"riseUp 0.6s ease both\" }}>\n            <div style={{ flex:1, textAlign:\"center\", padding:\"14px 12px\", borderRadius:14, background:\"rgba(255,128,128,0.1)\", border:\"1px solid rgba(255,128,128,0.2)\", fontSize:20, color:\"#FF8080\", fontFamily:FD, fontWeight:600, wordBreak:\"break-word\" }}>{tA}</div>\n            <div style={{ flex:1, textAlign:\"center\", padding:\"14px 12px\", borderRadius:14, background:\"rgba(107,197,255,0.1)\", border:\"1px solid rgba(107,197,255,0.2)\", fontSize:20, color:\"#6BC5FF\", fontFamily:FD, fontWeight:600, wordBreak:\"break-word\" }}>{tB}</div>\n          </div>\n          <TensionPull clicked={clicked} />\n          {!clicked\n            ? <div onClick={function(e){e.stopPropagation();setClicked(true);}} style={{ marginTop:8, fontSize:14, color:\"rgba(107,184,255,0.8)\", fontFamily:FB, letterSpacing:\"0.08em\", cursor:\"pointer\", padding:\"10px 20px\", border:\"1px solid rgba(107,184,255,0.2)\", borderRadius:20 }}>tap to see what lives here</div>\n            : <div style={{ animation:\"riseUp 0.6s ease\", textAlign:\"center\", width:\"100%\" }}>\n                <div style={{ fontSize:19, color: tAlive ? \"rgba(255,255,255,0.95)\" : \"rgba(255,255,255,0.78)\", fontFamily:FD, maxWidth:290, lineHeight:1.65,\n                  transition:\"color 0.3s\", textShadow: tAlive ? \"0 0 30px rgba(107,184,255,0.25)\" : \"none\" }}>{tText}</div>\n                {tAlive && <div style={{ marginTop:18, fontSize:15, color:\"rgba(107,197,255,0.75)\", fontFamily:FD, maxWidth:280, lineHeight:1.6, animation:\"riseUp 0.5s ease both\" }}>{tQ}</div>}\n                {tAway && <div style={{ marginTop:18, fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>This doesn't fit \u2014 bring your real tension into the map.</div>}\n                <AccuracySlider value={tSv} onSlide={function(v){setSlider(\"tension\",v);}} color=\"#6BB8FF\" leftLabel=\"not quite\" rightLabel=\"that's the one\" />\n              </div>}\n        </div>;\n      }\n\n      \n      case \"underneath\": {\n        var uSv = sliderValues.underneath !== undefined ? sliderValues.underneath : 50;\n        var uAlive = uSv >= 68;\n        return (\n          <FC><FieldParticles color={uAlive ? \"#D08BFF\" : \"#B86BFF\"} count={uAlive ? 20 : 10} />\n            <FLabel color=\"#B86BFF\">WHAT'S UNDERNEATH</FLabel>\n            <div style={{ fontSize:11, color:\"rgba(255,255,255,0.3)\", fontFamily:FB, letterSpacing:\"0.1em\", marginBottom:16 }}>hold to save \u00b7 swipe to react</div>\n            <div style={{ display:\"flex\", flexDirection:\"column\", gap:12, maxWidth:320, width:\"100%\" }}>\n              {underneath.slice(0,3).map(function(t, idx) {\n                var text = typeof t === \"string\" ? t : t.observation || \"\";\n                return <UnderneathItem key={idx} text={text} index={idx} />;\n              })}\n            </div>\n          </FC>\n        );\n      }\n\n      \n      case \"blind_spot\": {\n        var bsSv = sliderValues.blind_spot !== undefined ? sliderValues.blind_spot : 50;\n        var bsAlive = bsSv >= 68; var bsAway = bsSv <= 32;\n        var bsWords = (blindSpot||\"\").split(\" \");\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n            background:\"linear-gradient(185deg, #010508 0%, #030C14 40%, #041020 70%, #071828 100%)\" }}>\n            \n            <div style={{ position:\"absolute\", bottom:0, left:\"50%\", transform:\"translateX(-50%)\",\n              width:500, height:320,\n              background:\"radial-gradient(ellipse at 50% 100%, rgba(30,80,160,0.18) 0%, rgba(20,50,120,0.08) 45%, transparent 70%)\",\n              pointerEvents:\"none\" }} />\n            \n            {bsAlive && [0,1,2].map(function(_,i) {\n              return <div key={i} style={{ position:\"absolute\", left: (20+i*30)+\"%\", top:0, bottom:0, width:1,\n                background:\"linear-gradient(180deg,transparent,rgba(80,140,255,0.06),transparent)\",\n                animation:\"sweep \"+(4+i*1.5)+\"s ease-in-out infinite\", animationDelay:i*0.8+\"s\", pointerEvents:\"none\" }} />;\n            })}\n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px\" }}>\n              \n              <div style={{ fontSize:13, color:\"rgba(80,140,255,0.9)\", fontFamily:FB, letterSpacing:\"0.22em\", fontWeight:700, textTransform:\"uppercase\", marginBottom:28, animation:\"riseUp 0.8s ease both\" }}>WHAT YOU MIGHT NOT SEE</div>\n              \n              <div style={{ textAlign:\"center\", maxWidth:320, marginBottom:16 }}>\n                {bsWords.map(function(w, i) {\n                  return <span key={i} style={{ fontFamily:FD, fontSize:22, fontWeight:400,\n                    color: bsAlive ? \"rgba(180,210,255,0.95)\" : bsAway ? \"rgba(255,255,255,0.35)\" : \"rgba(255,255,255,0.78)\",\n                    animation:\"fallIn 0.7s ease \"+(0.3+i*0.12)+\"s both\",\n                    display:\"inline-block\", marginRight:7, marginBottom:4, transition:\"color 0.4s\",\n                    textShadow: bsAlive ? \"0 0 20px rgba(80,140,255,0.4)\" : \"none\" }}>{w}</span>;\n                })}\n              </div>\n              {bsAlive && <div style={{ fontSize:15, color:\"rgba(80,160,255,0.75)\", fontFamily:FD, maxWidth:280, textAlign:\"center\", lineHeight:1.65, animation:\"riseUp 0.5s ease both\", marginBottom:8 }}>\n                What becomes possible when you can finally see this?\n              </div>}\n              {bsAway && <div style={{ fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\", marginBottom:8 }}>\n                Not the right angle \u2014 keep exploring.\n              </div>}\n              <AccuracySlider value={bsSv} onSlide={function(v){setSlider(\"blind_spot\",v);}} color=\"#5090FF\" leftLabel=\"way off\" rightLabel=\"that's the gap\" />\n            </div>\n          </div>\n        );\n      }\n\n      \n      case \"archetype\": {\n        if (!primaryArch || !archReg) return null;\n        var Viz = archReg.Viz;\n        var c = archReg.color;\n        var timesAppeared = history[primaryArch.key] || 0;\n        var vizEl = null;\n        var archPhase = primaryArch ? primaryArch.phase : null;\n        try { vizEl = <Viz phase={archPhase} color={c} />; } catch(e) { vizEl = <div style={{fontSize:52}}>{archReg.icon}</div>; }\n\n        if (!clicked) return (\n          <FC><FieldParticles color={c} count={20} />\n            <FLabel color={c}>{archReg.name.toUpperCase()}</FLabel>\n            <FHero size={26} color=\"rgba(255,255,255,0.6)\">{primaryArch.title || archReg.name}</FHero>\n            <div style={{ margin: \"16px 0\" }}>{vizEl}</div>\n            <FTap color={c}>tap to see what's emerging \u2192</FTap>\n          </FC>\n        );\n        return (\n          <FC><FieldParticles color={c} count={28} />\n            <FLabel color={c}>{archReg.name.toUpperCase()}</FLabel>\n            {primaryArch.phase && archReg.phases && archReg.phases[primaryArch.phase] && <div style={{ fontSize: 11, color: c, opacity: 0.5, fontFamily: FB, letterSpacing: \"0.2em\", textTransform: \"uppercase\", marginBottom: 14, animation: \"riseUp 0.5s ease both\" }}>{primaryArch.phase.replace(/_/g,\" \")}</div>}\n            <div style={{ margin: \"8px 0 14px\" }}>{vizEl}</div>\n            <div style={{ fontSize: 18, color: \"rgba(255,255,255,0.7)\", fontFamily: FD, fontStyle: \"italic\", maxWidth: 300, lineHeight: 1.65, animation: \"riseUp 0.8s ease 0.3s both\" }}>{primaryArch.reading || primaryArch.line || archReg.phases?.dissolving || \"\"}</div>\n            {timesAppeared > 1 && <div style={{ marginTop: 16, fontSize: 12, color: c + \"77\", fontFamily: FB, animation: \"riseUp 0.6s ease 0.6s both\" }}>This pattern has visited you {timesAppeared} times.</div>}\n            {alchemyData && alchemyData.stage && <div style={{ marginTop: 22, padding: \"10px 18px\", borderRadius: 12, background: \"rgba(255,255,255,0.03)\", border: \"1px solid rgba(255,255,255,0.07)\", animation: \"riseUp 0.7s ease 0.7s both\" }}>\n              <div style={{ fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.2em\", marginBottom: 5 }}>{(FIELD_ALCHEMY[alchemyData.stage]||{}).label || alchemyData.stage}</div>\n              {alchemyData.evidence && <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.38)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6 }}>{alchemyData.evidence}</div>}\n            </div>}\n          </FC>\n        );\n      }\n\n      \n      case \"portrait\": return (\n        <FC><FieldParticles color=\"#E84393\" count={14} />\n          <FLabel color=\"#E84393\">SESSION PORTRAIT</FLabel>\n          <DataPortrait themes={themes} />\n        </FC>\n      );\n\n      \n      case \"opening\": return (\n        <FC><FieldParticles color=\"#6BFFB8\" count={18} />\n          <FLabel color=\"#6BFFB8\">WHAT'S OPENING</FLabel>\n          <div style={{ fontSize: 26, color: \"#6BFFB8\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5, textAlign: \"center\", maxWidth: 300, animation: \"riseUp 0.8s ease both\" }}>\n            {opening || \"Something is trying to emerge.\"}\n          </div>\n          <div style={{ marginTop: 40, textAlign: \"center\", animation: \"riseUp 0.8s ease 0.5s both\" }}>\n            <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, marginBottom: 8 }}>Your first word</div>\n            <div style={{ fontSize: 28, color: \"rgba(255,255,255,0.3)\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 24 }}>{firstWord}</div>\n            <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, marginBottom: 8 }}>Your last word</div>\n            <div style={{ fontSize: 36, color: \"#6BFFB8\", fontFamily: FD, fontStyle: \"italic\" }}>{lastWord}</div>\n          </div>\n        </FC>\n      );\n\n      \n      case \"submersion\": {\n        var subSv = sliderValues.submersion;\n        var subInteracted = subSv !== undefined;\n        var subZone = !subInteracted ? null : subSv < 33 ? \"away\" : subSv < 68 ? \"uncertain\" : \"truth\";\n        var subComment = (cardComments && cardComments.submersion) || \"\";\n        var subDeepText = card.deep || \"\";\n        var subSecText = card.secondary || \"\";\n        var subThemeColor = (themes[0] && themes[0].color) || \"#3DA8D4\";\n\n        \n        var zoneGlow = subZone === \"truth\" ? \"#1AD4C8\" : subZone === \"uncertain\" ? \"#C8A84B\" : subZone === \"away\" ? \"#4A6FA8\" : \"rgba(20,60,90,0.0)\";\n        var zoneGlowRGB = subZone === \"truth\" ? \"26,212,200\" : subZone === \"uncertain\" ? \"200,168,75\" : \"80,110,168\";\n\n        \n        var depthLabel = !subInteracted ? \"DEPTH UNKNOWN\" : subZone === \"truth\" ? \"SURFACED\" : subZone === \"uncertain\" ? \"STIRRING\" : \"RECEDING\";\n        var depthPct = !subInteracted ? 72 : subZone === \"truth\" ? 15 : subZone === \"uncertain\" ? 50 : 85;\n\n        \n        var subArchColor = _archColor || subThemeColor;\n\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n            background: subInteracted\n              ? (subZone===\"truth\"\n                ? \"linear-gradient(190deg, #010308 0%, #020D1A 30%, #03202E 65%, #041C2A 100%)\"\n                : subZone===\"uncertain\"\n                ? \"linear-gradient(190deg, #010308 0%, #0D0B04 30%, #1A1404 65%, #120F04 100%)\"\n                : \"linear-gradient(190deg, #010308 0%, #04080E 30%, #070A10 65%, #060810 100%)\")\n              : \"linear-gradient(190deg, #010308 0%, #020810 30%, #030E1C 60%, #040C18 100%)\" }}>\n\n            \n            {!subInteracted && <>\n              <div style={{ position:\"absolute\", top:\"8%\", left:\"20%\", width:280, height:180,\n                background:\"radial-gradient(ellipse, rgba(15,80,130,0.06), transparent 70%)\",\n                filter:\"blur(40px)\", animation:\"pulse 4s ease infinite\", pointerEvents:\"none\" }}/>\n              <div style={{ position:\"absolute\", top:\"30%\", left:\"50%\", width:220, height:150,\n                background:\"radial-gradient(ellipse, rgba(10,60,100,0.05), transparent 70%)\",\n                filter:\"blur(50px)\", animation:\"pulse 6s ease 1s infinite\", pointerEvents:\"none\" }}/>\n              <div style={{ position:\"absolute\", top:\"55%\", left:\"30%\", width:300, height:200,\n                background:\"radial-gradient(ellipse, rgba(5,40,80,0.08), transparent 70%)\",\n                filter:\"blur(60px)\", animation:\"pulse 5s ease 2s infinite\", pointerEvents:\"none\" }}/>\n            </>}\n\n            \n            {subInteracted && <div style={{ position:\"absolute\", bottom:-40, left:\"50%\", transform:\"translateX(-50%)\",\n              width:440, height:340,\n              background:\"radial-gradient(ellipse, rgba(\"+zoneGlowRGB+\",0.18), transparent 65%)\",\n              filter:\"blur(50px)\", transition:\"all 1.2s ease\", pointerEvents:\"none\" }}/>}\n\n            \n            <svg style={{ position:\"absolute\", left:14, top:0, height:\"100%\", width:28, opacity:0.35, pointerEvents:\"none\" }}>\n              {[10,20,30,40,50,60,70,80,90].map(function(pct) {\n                var y = pct/100 * 600;\n                var isMark = pct % 20 === 0;\n                return [\n                  <line key={\"l\"+pct} x1={isMark?6:10} y1={y} x2={20} y2={y} stroke=\"rgba(100,180,220,0.4)\" strokeWidth={isMark?1:0.5}/>,\n                  isMark && <text key={\"t\"+pct} x={2} y={y+3} fontSize={5} fill=\"rgba(100,180,220,0.35)\" fontFamily=\"monospace\">{pct}m</text>\n                ];\n              })}\n              <line x1={20} y1={0} x2={20} y2={600} stroke=\"rgba(100,180,220,0.2)\" strokeWidth={0.8}/>\n              \n              <circle cx={20} cy={depthPct/100*550 + 30} r={4} fill={subInteracted ? zoneGlow : \"rgba(60,140,200,0.5)\"}\n                style={{ transition:\"cy 1.4s cubic-bezier(.25,.46,.45,.94)\", filter:\"url(#blur)\" }}/>\n              <polygon points={\"6,\"+(depthPct/100*550+26)+\" 20,\"+(depthPct/100*550+30)+\" 6,\"+(depthPct/100*550+34)} fill={subInteracted ? zoneGlow : \"rgba(60,140,200,0.4)\"}\n                style={{ transition:\"all 1.4s cubic-bezier(.25,.46,.45,.94)\" }}/>\n            </svg>\n\n            \n            <FieldParticles color={subInteracted ? zoneGlow : \"rgba(80,160,220,0.5)\"} count={subInteracted && subZone===\"truth\" ? 22 : 8}/>\n\n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\",\n              justifyContent:\"flex-start\", padding:\"50px 32px 22px 46px\", overflowY:\"auto\" }}>\n\n              \n              <div style={{ fontSize:8, letterSpacing:\"0.5em\", color: subInteracted ? zoneGlow+\"CC\" : \"rgba(60,140,200,0.3)\",\n                fontFamily:FB, textTransform:\"uppercase\", marginBottom:22, transition:\"color 0.8s\",\n                animation:\"riseUp 0.6s ease both\" }}>\n                {depthLabel}\n              </div>\n\n              \n              {subInteracted && subComment && (\n                <div style={{ width:\"100%\", maxWidth:300, marginBottom:18, padding:\"12px 16px\", borderRadius:14,\n                  background:\"rgba(\"+zoneGlowRGB+\",0.1)\", border:\"1px solid rgba(\"+zoneGlowRGB+\",0.3)\",\n                  animation:\"riseUp 0.8s ease both\" }}>\n                  <div style={{ fontSize:8, color:zoneGlow+\"99\", fontFamily:FB, letterSpacing:\"0.2em\", textTransform:\"uppercase\", marginBottom:7 }}>\n                    {subZone===\"away\" ? \"YOUR READ\" : \"YOUR WORDS\"}\n                  </div>\n                  <div style={{ fontSize:18, color:\"rgba(255,255,255,0.88)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.7,\n                    textShadow:\"0 0 30px rgba(\"+zoneGlowRGB+\",0.25)\" }}>\n                    \"{subComment}\"\n                  </div>\n                </div>\n              )}\n\n              \n              <div style={{ width:\"100%\", maxWidth:300, marginBottom: subInteracted ? 14 : 20 }}>\n                \n                {!subInteracted && (\n                  <div style={{ fontSize:9, letterSpacing:\"0.3em\", color:\"rgba(60,140,200,0.3)\", fontFamily:FB,\n                    textTransform:\"uppercase\", marginBottom:14, animation:\"riseUp 0.7s ease 0.1s both\" }}>\n                    BELOW THE SURFACE\n                  </div>\n                )}\n                \n                {subInteracted && !subComment && (\n                  <div style={{ fontSize:9, letterSpacing:\"0.3em\", color:zoneGlow+\"88\", fontFamily:FB,\n                    textTransform:\"uppercase\", marginBottom:14, transition:\"color 0.8s\" }}>\n                    {subZone===\"truth\" ? \"SURFACED\" : subZone===\"uncertain\" ? \"SOMETHING STIRS\" : \"RECEDING\"}\n                  </div>\n                )}\n\n                <div style={{ fontSize: subInteracted && subZone===\"truth\" ? 22 : 19,\n                  color: subInteracted\n                    ? (subZone===\"truth\" ? \"rgba(255,255,255,0.92)\" : subZone===\"uncertain\" ? \"rgba(255,255,255,0.62)\" : \"rgba(255,255,255,0.28)\")\n                    : \"rgba(255,255,255,0.42)\",\n                  fontFamily:FD, fontStyle:\"italic\", lineHeight:1.78, maxWidth:300,\n                  textShadow: subInteracted && subZone===\"truth\" ? \"0 0 40px rgba(\"+zoneGlowRGB+\",0.35)\" : \"none\",\n                  transition:\"all 0.9s ease\", animation:\"riseUp 0.8s ease 0.2s both\" }}>\n                  {subDeepText}\n                </div>\n              </div>\n\n              \n              {subSecText && !subInteracted && (\n                <div style={{ width:\"100%\", maxWidth:300, marginBottom:16, opacity:0.35,\n                  animation:\"riseUp 0.7s ease 0.4s both\" }}>\n                  <div style={{ width:\"100%\", height:1, background:\"linear-gradient(90deg, transparent, rgba(60,140,200,0.15), transparent)\", marginBottom:12 }}/>\n                  <div style={{ fontSize:13, color:\"rgba(255,255,255,0.3)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.65 }}>\n                    {subSecText.slice(0,120)}{subSecText.length>120?\"\u2026\":\"\"}\n                  </div>\n                </div>\n              )}\n\n              \n              {subInteracted && subZone===\"truth\" && primaryArch && (\n                <div style={{ display:\"flex\", alignItems:\"center\", gap:10, marginBottom:14,\n                  animation:\"riseUp 0.8s ease 0.3s both\", opacity:0.75 }}>\n                  <ArchGlyph name={primaryArch.name||\"\"} color={subArchColor} size={32}/>\n                  <div style={{ fontSize:10, color:subArchColor+\"99\", fontFamily:FB, letterSpacing:\"0.15em\", textTransform:\"uppercase\" }}>\n                    {primaryArch.name||\"\"}\n                  </div>\n                </div>\n              )}\n\n              \n              <div style={{ width:\"100%\", maxWidth:300, marginTop:8, animation:\"riseUp 0.8s ease 0.55s both\" }}\n                data-noadvance=\"true\">\n                <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:8 }}>\n                  <span style={{ fontSize:9, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.08em\", textTransform:\"uppercase\" }}>not mine</span>\n                  <span style={{ fontSize:9, color:\"rgba(255,255,255,0.12)\", fontFamily:FB, letterSpacing:\"0.08em\", textTransform:\"uppercase\" }}>something there</span>\n                  <span style={{ fontSize:9, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.08em\", textTransform:\"uppercase\" }}>deep truth</span>\n                </div>\n                <div style={{ position:\"relative\", height:6, background:\"rgba(255,255,255,0.05)\", borderRadius:3, cursor:\"pointer\" }}\n                  onPointerDown={function(e) {\n                    e.stopPropagation();\n                    var rect = e.currentTarget.getBoundingClientRect();\n                    var pct = Math.round(Math.max(0, Math.min(100, ((e.clientX-rect.left)/rect.width)*100)));\n                    setSlider(\"submersion\", pct);\n                    var mv = function(ev) {\n                      var p = Math.round(Math.max(0, Math.min(100, ((ev.clientX-rect.left)/rect.width)*100)));\n                      setSlider(\"submersion\", p);\n                    };\n                    var up = function() { window.removeEventListener(\"pointermove\",mv); window.removeEventListener(\"pointerup\",up); };\n                    window.addEventListener(\"pointermove\", mv);\n                    window.addEventListener(\"pointerup\", up);\n                  }}>\n                  <div style={{ position:\"absolute\", left:0, top:0, height:\"100%\", width:(subSv||50)+\"%\",\n                    background: subInteracted\n                      ? \"linear-gradient(90deg, rgba(70,100,160,0.5), \"+zoneGlow+\")\"\n                      : \"linear-gradient(90deg, rgba(30,80,130,0.3), rgba(60,140,200,0.3))\",\n                    borderRadius:3, transition:\"width 0.15s, background 0.7s\",\n                    boxShadow: subInteracted && subZone===\"truth\" ? \"0 0 10px \"+zoneGlow+\"55\" : \"none\" }}/>\n                  <div style={{ position:\"absolute\", top:\"50%\", left:(subSv!==undefined?subSv:50)+\"%\",\n                    transform:\"translate(-50%,-50%)\", width:16, height:16, borderRadius:\"50%\",\n                    background: subInteracted ? zoneGlow : \"rgba(60,140,200,0.5)\",\n                    border:\"2px solid rgba(255,255,255,0.5)\",\n                    transition:\"left 0.15s, background 0.7s\",\n                    boxShadow: subInteracted && subZone===\"truth\" ? \"0 0 10px \"+zoneGlow : \"none\" }}/>\n                </div>\n              </div>\n\n              \n              {subInteracted && (\n                <div style={{ width:\"100%\", maxWidth:300, marginTop:14, animation:\"riseUp 0.6s ease both\" }}\n                  data-noadvance=\"true\">\n                  <textarea\n                    value={subComment}\n                    onChange={function(e) { setCardComment(\"submersion\", e.target.value); }}\n                    placeholder={subZone===\"away\" ? \"what's actually there for you...\" : \"say more, if something surfaces...\"}\n                    style={{ width:\"100%\", minHeight:52,\n                      background: subZone===\"away\" ? \"rgba(20,30,50,0.5)\" : \"rgba(255,255,255,0.025)\",\n                      border:\"1px solid rgba(\"+zoneGlowRGB+\",0.18)\",\n                      borderRadius:10, color:\"rgba(255,255,255,0.82)\",\n                      fontFamily:FD, fontSize:14, fontStyle:\"italic\",\n                      padding:\"9px 12px\", resize:\"none\", outline:\"none\",\n                      lineHeight:1.6, boxSizing:\"border-box\",\n                      transition:\"border-color 0.5s, background 0.5s\" }}\n                    onFocus={function(e){e.currentTarget.style.borderColor=\"rgba(\"+zoneGlowRGB+\",0.45)\";}}\n                    onBlur={function(e){e.currentTarget.style.borderColor=\"rgba(\"+zoneGlowRGB+\",0.18)\";}}\n                    onKeyDown={function(e){e.stopPropagation();}}\n                    onClick={function(e){e.stopPropagation();}}\n                  />\n                  <div style={{ display:\"flex\", justifyContent:\"flex-end\", marginTop:6 }}>\n                    <button onClick={function(e){e.stopPropagation(); advance();}}\n                      style={{ fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB,\n                        background:\"transparent\", border:\"none\", cursor:\"pointer\",\n                        letterSpacing:\"0.08em\", textTransform:\"uppercase\" }}>\n                      continue \u2192\n                    </button>\n                  </div>\n                </div>\n              )}\n\n            </div>\n          </div>\n        );\n      }\n\n      \n\n      case \"theme_arc\": {\n        var tierGroups = {\n          persistent: themesClassified.filter(function(t){return t.tier===\"persistent\";}),\n          returning:  themesClassified.filter(function(t){return t.tier===\"returning\";}),\n          new_t:      themesClassified.filter(function(t){return t.tier===\"new\";})\n        };\n        var taMaxSessions = themesClassified.reduce(function(m,t){return Math.max(m,t.sessions||1);},1);\n        var tierDefs = [\n          { key:\"persistent\", label:\"STILL WITH YOU\",  sub:\"recurring\", themes: tierGroups.persistent },\n          { key:\"returning\",  label:\"RETURNING\",        sub:\"came back\", themes: tierGroups.returning  },\n          { key:\"new_t\",      label:\"EMERGING NOW\",     sub:\"first time\",themes: tierGroups.new_t     },\n        ].filter(function(g){return g.themes.length>0;});\n        return (\n          <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"56px 26px 32px\", overflow:\"hidden\" }}>\n            <FieldParticles color=\"#6BB8FF\" count={12}/>\n            <div style={{ position:\"absolute\", top:\"28%\", left:\"50%\", transform:\"translateX(-50%)\", width:300, height:200, background:\"radial-gradient(ellipse, rgba(107,184,255,0.05), transparent 70%)\", pointerEvents:\"none\" }}/>\n            <div style={{ fontSize:9, letterSpacing:\"0.45em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:30, animation:\"riseUp 0.6s ease both\" }}>YOUR PATTERNS OVER TIME</div>\n            <div style={{ width:\"100%\", maxWidth:340, display:\"flex\", flexDirection:\"column\", gap:22 }}>\n              {tierDefs.map(function(tier, ti) {\n                return (\n                  <div key={tier.key} style={{ animation:\"riseUp 0.6s ease \"+(0.1+ti*0.15)+\"s both\" }}>\n                    <div style={{ display:\"flex\", alignItems:\"baseline\", gap:8, marginBottom:9 }}>\n                      <span style={{ fontSize:8, letterSpacing:\"0.3em\", color:\"rgba(255,255,255,0.25)\", fontFamily:FB, textTransform:\"uppercase\" }}>{tier.label}</span>\n                      <span style={{ fontSize:8, color:\"rgba(255,255,255,0.12)\", fontFamily:FB }}>{tier.sub}</span>\n                    </div>\n                    <div style={{ display:\"flex\", flexWrap:\"wrap\", gap:8 }}>\n                      {tier.themes.map(function(t, thi) {\n                        var dots = Math.min(t.sessions||1, 8);\n                        return (\n                          <div key={thi} style={{ display:\"flex\", flexDirection:\"column\", gap:5, padding:\"10px 14px\", borderRadius:14,\n                            background:t.color+(tier.key===\"persistent\"?\"18\":tier.key===\"returning\"?\"0E\":\"07\"),\n                            border:\"1px solid \"+t.color+(tier.key===\"persistent\"?\"44\":tier.key===\"returning\"?\"28\":\"14\") }}>\n                            <span style={{ fontSize:13, color:\"rgba(255,255,255,\"+(tier.key===\"persistent\"?\"0.92\":tier.key===\"returning\"?\"0.68\":\"0.45\")+\")\", fontFamily:FB, fontWeight:600 }}>{t.label}</span>\n                            {tier.key!==\"new_t\" && (\n                              <div style={{ display:\"flex\", gap:3 }}>\n                                {Array.from({length:dots}).map(function(_,di){\n                                  return <div key={di} style={{ width:5,height:5,borderRadius:\"50%\",background:t.color,opacity:di===dots-1?1:0.3 }}/>;\n                                })}\n                              </div>\n                            )}\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n            <div style={{ marginTop:22, fontSize:10, color:\"rgba(255,255,255,0.1)\", fontFamily:FB, letterSpacing:\"0.15em\", animation:\"riseUp 0.6s ease 0.5s both\" }}>session {sessionCount} of your record</div>\n          </div>\n        );\n      }\n\n      \n      case \"alchemy_journey\": {\n        var ALCH_META = {\n          nigredo:    { label:\"Nigredo\",    sub:\"the descent\",    color:\"#6066AA\" },\n          albedo:     { label:\"Albedo\",     sub:\"the cleansing\",  color:\"#B8C8E8\" },\n          citrinitas: { label:\"Citrinitas\", sub:\"illumination\",   color:\"#D6B26D\" },\n          rubedo:     { label:\"Rubedo\",     sub:\"integration\",    color:\"#E84393\" },\n        };\n        var arcArr = card.arc || [];\n        var curStage = card.current || (alchemyData && alchemyData.stage) || null;\n        var curMeta = curStage ? (ALCH_META[curStage] || ALCH_META.nigredo) : null;\n        var stageCounts = {};\n        arcArr.forEach(function(a){ stageCounts[a.stage]=(stageCounts[a.stage]||0)+1; });\n        var longestSt = Object.keys(stageCounts).reduce(function(b,k){ return (stageCounts[k]||0)>(stageCounts[b]||0)?k:b; }, Object.keys(stageCounts)[0]||\"nigredo\");\n        var dotLine = arcArr.slice(-14);\n        return (\n          <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"56px 26px 40px\", overflow:\"hidden\" }}>\n            <FieldParticles color={curMeta?curMeta.color:\"#B86BFF\"} count={14}/>\n            <div style={{ fontSize:9, letterSpacing:\"0.45em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:24, animation:\"riseUp 0.6s ease both\" }}>YOUR ALCHEMICAL ARC</div>\n            <div style={{ display:\"flex\", gap:18, marginBottom:24, flexWrap:\"wrap\", justifyContent:\"center\", animation:\"riseUp 0.6s ease 0.1s both\" }}>\n              {[\"nigredo\",\"albedo\",\"citrinitas\",\"rubedo\"].map(function(stKey) {\n                var m=ALCH_META[stKey]; var isCur=stKey===curStage; var cnt=stageCounts[stKey]||0;\n                return (\n                  <div key={stKey} style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", gap:4, opacity:cnt>0||isCur?1:0.18 }}>\n                    <div style={{ width:isCur?14:9, height:isCur?14:9, borderRadius:\"50%\", background:m.color, boxShadow:isCur?\"0 0 14px \"+m.color+\"99\":\"none\", border:isCur?\"2px solid rgba(255,255,255,0.6)\":\"none\", transition:\"all 0.3s\" }}/>\n                    <span style={{ fontSize:8, color:isCur?\"rgba(255,255,255,0.75)\":\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.08em\", textTransform:\"uppercase\" }}>{m.label}</span>\n                    {cnt>0 && <span style={{ fontSize:8, color:\"rgba(255,255,255,0.18)\", fontFamily:FB }}>\u00d7{cnt}</span>}\n                  </div>\n                );\n              })}\n            </div>\n            <div style={{ display:\"flex\", alignItems:\"center\", gap:4, flexWrap:\"wrap\", justifyContent:\"center\", maxWidth:320, marginBottom:28, animation:\"riseUp 0.7s ease 0.2s both\" }}>\n              {dotLine.map(function(a, di) {\n                var m2=ALCH_META[a.stage]||ALCH_META.nigredo; var isCur=di===dotLine.length-1;\n                return (\n                  <div key={di} style={{ display:\"flex\", alignItems:\"center\", gap:4 }}>\n                    <div style={{ width:isCur?16:9, height:isCur?16:9, borderRadius:\"50%\", background:m2.color, boxShadow:isCur?\"0 0 18px \"+m2.color+\"aa\":\"none\", border:isCur?\"2.5px solid rgba(255,255,255,0.7)\":\"none\", flexShrink:0, animation:isCur?\"pulse 2.5s ease infinite\":\"none\" }}/>\n                    {di<dotLine.length-1 && <div style={{ width:12, height:1.5, background:\"rgba(255,255,255,0.1)\", flexShrink:0 }}/>}\n                  </div>\n                );\n              })}\n            </div>\n            {curMeta && (\n              <div style={{ textAlign:\"center\", animation:\"riseUp 0.8s ease 0.35s both\" }}>\n                <div style={{ fontSize:30, color:curMeta.color, fontFamily:FD, fontWeight:700, letterSpacing:\"0.04em\", textShadow:\"0 0 40px \"+curMeta.color+\"55\" }}>{curMeta.label}</div>\n                <div style={{ fontSize:13, color:\"rgba(255,255,255,0.38)\", fontFamily:FD, fontStyle:\"italic\", marginTop:4 }}>{curMeta.sub}</div>\n                {alchemyData&&alchemyData.evidence && <div style={{ marginTop:14, fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FD, fontStyle:\"italic\", maxWidth:290, lineHeight:1.65 }}>\"{alchemyData.evidence}\"</div>}\n              </div>\n            )}\n            {longestSt && longestSt!==curStage && <div style={{ marginTop:14, fontSize:10, color:\"rgba(255,255,255,0.18)\", fontFamily:FB, animation:\"riseUp 0.6s ease 0.5s both\" }}>you've spent the most time in {(ALCH_META[longestSt]||{label:longestSt}).label}</div>}\n          </div>\n        );\n      }\n\n      \n      case \"opening_shift\": {\n        var osPast=card.past||\"\"; var osNow=card.now||\"\";\n        var osColor=(themes[0]&&themes[0].color)||\"#6BFFB8\";\n        return (\n          <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"56px 28px 40px\", overflow:\"hidden\" }}>\n            <FieldParticles color={osColor} count={12}/>\n            <div style={{ position:\"absolute\", inset:0, background:\"linear-gradient(180deg,transparent 40%,\"+osColor+\"07 100%)\", pointerEvents:\"none\" }}/>\n            <div style={{ fontSize:9, letterSpacing:\"0.45em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:32, animation:\"riseUp 0.6s ease both\" }}>WHAT SHIFTED</div>\n            <div style={{ width:\"100%\", maxWidth:320 }}>\n              <div style={{ padding:\"18px 20px 20px\", borderRadius:\"14px 14px 3px 3px\", background:\"rgba(255,255,255,0.025)\", border:\"1px solid rgba(255,255,255,0.06)\", animation:\"riseUp 0.7s ease 0.1s both\" }}>\n                <div style={{ fontSize:8, letterSpacing:\"0.3em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:10 }}>LAST SESSION</div>\n                <div style={{ fontSize:16, color:\"rgba(255,255,255,0.36)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.7 }}>{osPast.slice(0,160)}{osPast.length>160?\"\u2026\":\"\"}</div>\n              </div>\n              <div style={{ display:\"flex\", justifyContent:\"center\", padding:\"7px 0\", background:\"rgba(0,0,0,0.35)\" }}>\n                <div style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", gap:2 }}>\n                  <div style={{ width:1, height:10, background:\"linear-gradient(180deg,rgba(255,255,255,0.08),\"+osColor+\"55)\" }}/>\n                  <span style={{ fontSize:13, color:osColor+\"88\" }}>\u2193</span>\n                </div>\n              </div>\n              <div style={{ padding:\"18px 20px 20px\", borderRadius:\"3px 3px 14px 14px\", background:osColor+\"0B\", border:\"1px solid \"+osColor+\"26\", animation:\"riseUp 0.7s ease 0.25s both\" }}>\n                <div style={{ fontSize:8, letterSpacing:\"0.3em\", color:osColor+\"88\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:10 }}>NOW</div>\n                <div style={{ fontSize:20, color:\"rgba(255,255,255,0.88)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.7, textShadow:\"0 0 30px \"+osColor+\"1A\" }}>{osNow.slice(0,160)}{osNow.length>160?\"\u2026\":\"\"}</div>\n              </div>\n            </div>\n          </div>\n        );\n      }\n\n      \n      case \"tension_return\": {\n        var trCount=card.count||2;\n        var trA=tension?tension.a:\"\"; var trB=tension?tension.b:\"\"; var trText=tension?tension.text:\"\";\n        var trColA=(themes.find(function(t){return t.label===trA;})||themes[0]||{color:\"#FF8080\"}).color;\n        var trColB=(themes.find(function(t){return t.label===trB;})||themes[1]||themes[0]||{color:\"#6BB8FF\"}).color;\n        var retLabels=[\"twice now\",\"three times\",\"four times\",\"five times\"];\n        var retLabel=trCount<=5?(retLabels[trCount-2]||\"repeatedly\"):\"repeatedly\";\n        return (\n          <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"56px 28px 40px\", overflow:\"hidden\" }}>\n            <FieldParticles color={trColA} count={10}/>\n            <div style={{ position:\"absolute\", top:\"18%\", left:\"5%\", width:200, height:200, borderRadius:\"50%\", background:\"radial-gradient(circle,\"+trColA+\"10,transparent 65%)\", filter:\"blur(50px)\", pointerEvents:\"none\" }}/>\n            <div style={{ position:\"absolute\", bottom:\"18%\", right:\"5%\", width:200, height:200, borderRadius:\"50%\", background:\"radial-gradient(circle,\"+trColB+\"10,transparent 65%)\", filter:\"blur(50px)\", pointerEvents:\"none\" }}/>\n            <div style={{ fontSize:9, letterSpacing:\"0.45em\", color:\"rgba(255,255,255,0.18)\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:8, animation:\"riseUp 0.6s ease both\" }}>THIS TENSION HAS RETURNED</div>\n            <div style={{ fontSize:50, fontWeight:300, color:\"rgba(255,255,255,0.78)\", fontFamily:FD, lineHeight:1, letterSpacing:\"-0.02em\", marginBottom:22, animation:\"riseUp 0.7s ease 0.1s both\" }}>{retLabel}</div>\n            <div style={{ display:\"flex\", alignItems:\"center\", gap:12, marginBottom:18, animation:\"riseUp 0.7s ease 0.2s both\" }}>\n              <span style={{ fontSize:22, color:trColA, fontFamily:FD, fontWeight:600 }}>{trA}</span>\n              <div style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", gap:3 }}>\n                <div style={{ width:30, height:1.5, background:\"linear-gradient(90deg,\"+trColA+\",\"+trColB+\")\" }}/>\n                <span style={{ fontSize:7, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.12em\" }}>VS</span>\n                <div style={{ width:30, height:1.5, background:\"linear-gradient(90deg,\"+trColA+\",\"+trColB+\")\" }}/>\n              </div>\n              <span style={{ fontSize:22, color:trColB, fontFamily:FD, fontWeight:600 }}>{trB}</span>\n            </div>\n            {trText && <div style={{ fontSize:16, color:\"rgba(255,255,255,0.6)\", fontFamily:FD, fontStyle:\"italic\", maxWidth:290, lineHeight:1.7, textAlign:\"center\", marginBottom:20, animation:\"riseUp 0.8s ease 0.3s both\" }}>{trText}</div>}\n            <div style={{ padding:\"14px 20px\", borderRadius:14, background:\"rgba(255,255,255,0.025)\", border:\"1px solid rgba(255,255,255,0.06)\", maxWidth:300, animation:\"riseUp 0.7s ease 0.45s both\" }}>\n              <div style={{ fontSize:8, color:\"rgba(255,255,255,0.18)\", fontFamily:FB, letterSpacing:\"0.2em\", marginBottom:7, textTransform:\"uppercase\" }}>worth asking</div>\n              <div style={{ fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FD, lineHeight:1.65 }}>This keeps coming back. Is it something to resolve \u2014 or something to live inside?</div>\n            </div>\n          </div>\n        );\n      }\n\n      \n      case \"closing\": return (\n        <FC><FieldParticles color=\"#6BFFB8\" count={35} />\n          <div style={{ marginBottom: 28 }}>\n            <svg viewBox=\"0 0 160 160\" style={{ width: 110, height: 110 }}>\n              {[50,40,30,20].map(function(r, i) {\n                var col = themes[i] ? themes[i].color : \"#6BFFB8\";\n                return <circle key={i} cx=\"80\" cy=\"80\" r={r} fill=\"none\" stroke={col} strokeWidth={i===3?2.5:1} opacity={0.12+i*0.1}>\n                  <animate attributeName=\"r\" values={r+\";\"+(r+7)+\";\"+r} dur={(3+i*0.6)+\"s\"} repeatCount=\"indefinite\" />\n                  <animate attributeName=\"opacity\" values={(0.1+i*0.08)+\";\"+(0.2+i*0.1)+\";\"+(0.1+i*0.08)} dur={(3+i*0.6)+\"s\"} repeatCount=\"indefinite\" />\n                </circle>;\n              })}\n              <circle cx=\"80\" cy=\"80\" r=\"7\" fill={themes[0] ? themes[0].color : \"#6BFFB8\"} opacity=\"0.9\">\n                <animate attributeName=\"r\" values=\"7;9;7\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n              </circle>\n            </svg>\n          </div>\n          <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, letterSpacing: \"0.35em\", marginBottom: 28 }}>THE FIELD</div>\n          <FHero size={38} color=\"white\">You named<br/>what you're<br/>carrying</FHero>\n          {primaryArch && <div style={{ marginTop: 28, padding: \"8px 18px\", borderRadius: 20, background: _archColor + \"14\", border: \"1px solid \" + _archColor + \"28\", fontSize: 13, color: _archColor, fontFamily: FB }}>\n            \u25c6 {primaryArch.name || (archReg && archReg.name) || \"Your Pattern\"}\n          </div>}\n          <div style={{ marginTop: 32, fontSize: 14, color: \"rgba(255,255,255,0.2)\", fontFamily: FB }}>Next session whenever you're ready.</div>\n        </FC>\n      );\n\n      case \"cross_session_portrait\": return (\n        <CrossSessionCard pastSessions={card.pastSessions || []} currentSd={sd} />\n      );\n\n      default: return null;\n    }\n  };\n\n  \n  if (!card) {\n    console.error(\"[FIELD] card is undefined \u2014 CARDS.length:\", CARDS.length, \"current:\", current);\n    return <div style={{position:\"absolute\",inset:0,background:\"#060910\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",color:\"rgba(255,255,255,0.4)\",fontSize:13,fontFamily:\"sans-serif\",flexDirection:\"column\",gap:12}}>\n      <div>CARDS: {CARDS.length} | current: {current}</div>\n      {CARDS.map(function(c,i){return <div key={i} style={{fontSize:10,opacity:0.5}}>{i}: {c.type}</div>;})}\n    </div>;\n  }\n\n  return (\n    <div ref={containerRef} onClick={handleClick} style={{ width: \"100%\", height: \"100%\", background: card.bg, position: \"absolute\", inset: 0, cursor: \"pointer\", userSelect: \"none\", transition: \"background 0.7s ease\" }}>\n      \n      <div style={{ display:\"flex\", gap:3, padding:\"14px 16px 0\", position:\"absolute\", top:0, left:0, right:0, zIndex:10 }}>\n        {CARDS.map(function(_, i) {\n          var visited = i < current;\n          var isCurrent = i === current;\n          return <div key={i}\n            onClick={function(e){ e.stopPropagation(); if (i <= current) { setCurrent(i); setClicked(false); } }}\n            style={{ flex:1, height: isCurrent ? 3 : 2.5, borderRadius:2,\n              background: visited ? \"rgba(255,255,255,0.6)\" : isCurrent ? \"rgba(255,255,255,0.9)\" : \"rgba(255,255,255,0.12)\",\n              transition:\"all 0.3s\",\n              cursor: visited ? \"pointer\" : \"default\",\n              transform: visited ? \"scaleY(1)\" : \"scaleY(1)\" }} />;\n        })}\n      </div>\n      <div key={current + \"-\" + clicked} style={{ width: \"100%\", height: \"100%\", animation: clicked ? \"morphIn 0.5s ease\" : \"slideIn 0.35s ease-out\", position:\"relative\" }}>\n        {(function() { try { return renderCard(); } catch(e) { console.error(\"[FIELD] renderCard crashed on card\", current, \"type:\", card && card.type, \"error:\", e.message||e); return <div style={{position:\"absolute\",inset:0,display:\"flex\",alignItems:\"center\",justifyContent:\"center\",color:\"rgba(255,255,255,0.5)\",fontSize:13,fontFamily:\"sans-serif\",padding:40,textAlign:\"center\"}}>card error: {e.message}</div>; } })()}\n        \n      </div>\n    </div>\n  );\n}\n\nfunction LandingPhase({ onStart }) {\n  var [show, setShow] = useState(false);\n  var sessions = [];\n  try { sessions = JSON.parse(localStorage.getItem(_sessionKey()) || \"[]\"); } catch(e) {}\n  var returning = sessions.length > 0;\n  var SG = \"Space Grotesk, \" + FB;\n\n  useEffect(function() { setTimeout(function() { setShow(true); }, 100); }, []);\n\n  function guardedStart() {\n    if (window.currentUser) { onStart(); return; }\n    if (window._showAuthOverlay) { window._showAuthOverlay(onStart); }\n    else { onStart(); }\n  }\n\n  return (\n    <div style={{ width:\"100%\", height:\"100%\", overflowY:\"auto\", WebkitOverflowScrolling:\"touch\",\n      background:\"#0A0914\" }}>\n\n      {/* Ambient glows \u2014 large, colored, layered */}\n      <div style={{ position:\"fixed\", inset:0, pointerEvents:\"none\", zIndex:0, overflow:\"hidden\" }}>\n        <div style={{ position:\"absolute\", top:\"-10%\", right:\"-5%\", width:800, height:800,\n          borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(184,107,255,0.14), transparent 65%)\",\n          filter:\"blur(120px)\", animation:\"floatWord 22s ease-in-out infinite\" }} />\n        <div style={{ position:\"absolute\", top:\"30%\", left:\"-10%\", width:700, height:700,\n          borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(232,67,147,0.11), transparent 65%)\",\n          filter:\"blur(100px)\", animation:\"floatWord 26s ease-in-out infinite\", animationDelay:\"-8s\" }} />\n        <div style={{ position:\"absolute\", bottom:\"-10%\", right:\"20%\", width:600, height:600,\n          borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(107,184,255,0.1), transparent 65%)\",\n          filter:\"blur(90px)\", animation:\"floatWord 20s ease-in-out infinite\", animationDelay:\"-14s\" }} />\n        <div style={{ position:\"absolute\", bottom:\"20%\", left:\"20%\", width:500, height:500,\n          borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(107,255,184,0.07), transparent 65%)\",\n          filter:\"blur(80px)\", animation:\"floatWord 18s ease-in-out infinite\", animationDelay:\"-4s\" }} />\n      </div>\n\n      {/* Nav */}\n      <nav style={{ position:\"sticky\", top:0, zIndex:20, display:\"flex\", justifyContent:\"space-between\",\n        alignItems:\"center\", padding:\"20px 7vw\",\n        background:\"rgba(10,9,20,0.8)\", backdropFilter:\"blur(20px)\",\n        borderBottom:\"1px solid rgba(255,255,255,0.04)\" }}>\n        <div style={{ fontFamily:SG, fontSize:18, fontWeight:700, letterSpacing:\"0.3em\",\n          background:\"linear-gradient(90deg, #E84393, #B86BFF)\", WebkitBackgroundClip:\"text\",\n          WebkitTextFillColor:\"transparent\" }}>SAYCRD</div>\n        <button onClick={guardedStart} style={{ padding:\"10px 26px\", borderRadius:999,\n          background:\"linear-gradient(135deg, rgba(232,67,147,0.15), rgba(184,107,255,0.15))\",\n          border:\"1px solid rgba(232,67,147,0.3)\", color:\"#E84393\",\n          fontFamily:FB, fontSize:14, fontWeight:600, letterSpacing:\"0.06em\", cursor:\"pointer\" }}>\n          {returning ? \"new session\" : \"begin\"}\n        </button>\n      </nav>\n\n      <div style={{ position:\"relative\", zIndex:1, maxWidth:660, margin:\"0 auto\", padding:\"0 7vw 80px\" }}>\n\n        {/* Hero */}\n        <section style={{ padding:\"72px 0 56px\" }}>\n          <div style={{ fontSize:13, letterSpacing:\"0.4em\", fontFamily:FB, textTransform:\"uppercase\",\n            marginBottom:20, fontWeight:600,\n            background:\"linear-gradient(90deg, #E84393, #B86BFF)\", WebkitBackgroundClip:\"text\",\n            WebkitTextFillColor:\"transparent\",\n            opacity:show?1:0, transition:\"opacity 0.8s ease\" }}>\n            A place to go in the moment\n          </div>\n\n          <h1 style={{ fontFamily:FD, fontSize:\"clamp(42px,6.5vw,68px)\", fontWeight:300,\n            lineHeight:1.1, color:\"rgba(255,255,255,0.95)\", marginBottom:28, letterSpacing:\"-0.01em\",\n            opacity:show?1:0, transform:show?\"translateY(0)\":\"translateY(24px)\",\n            transition:\"all 1s cubic-bezier(.25,.46,.45,.94) 0.1s\" }}>\n            The space between your inner world and the next true move.\n          </h1>\n\n          <p style={{ fontFamily:FD, fontSize:21, fontWeight:300, fontStyle:\"italic\",\n            color:\"rgba(200,185,230,0.7)\", lineHeight:1.7, marginBottom:40, maxWidth:540,\n            opacity:show?1:0, transform:show?\"translateY(0)\":\"translateY(16px)\",\n            transition:\"all 1s cubic-bezier(.25,.46,.45,.94) 0.25s\" }}>\n            SAYCRD listens like a human, shapes what you say into a living visual, and remembers your patterns without turning you into a project.\n          </p>\n\n          <div style={{ display:\"flex\", gap:14, flexWrap:\"wrap\", alignItems:\"center\",\n            opacity:show?1:0, transition:\"opacity 1s ease 0.4s\", marginBottom:16 }}>\n            <button onClick={guardedStart} style={{ padding:\"16px 36px\", borderRadius:999,\n              background:\"linear-gradient(135deg, #E84393, #B86BFF)\", border:\"none\",\n              color:\"#fff\", fontFamily:FB, fontSize:16, fontWeight:700,\n              letterSpacing:\"0.05em\", cursor:\"pointer\",\n              boxShadow:\"0 12px 40px rgba(184,107,255,0.3)\" }}>\n              {returning ? \"continue your journey\" : \"start a session\"}\n            </button>\n            <button onClick={function(){ var el=document.getElementById(\"saycrd-why\");\n                if(el) el.scrollIntoView({behavior:\"smooth\"}); }}\n              style={{ padding:\"16px 28px\", borderRadius:999, background:\"transparent\",\n                border:\"1px solid rgba(255,255,255,0.12)\", color:\"rgba(255,255,255,0.5)\",\n                fontFamily:FB, fontSize:15, cursor:\"pointer\" }}>\n              see the concept\n            </button>\n          </div>\n\n          {returning && (\n            <div style={{ fontSize:13, color:\"rgba(232,67,147,0.5)\", fontFamily:FB, letterSpacing:\"0.06em\" }}>\n              {sessions.length} session{sessions.length !== 1 ? \"s\" : \"\"} in your field\n            </div>\n          )}\n\n          {/* Phase markers */}\n          <div style={{ display:\"grid\", gridTemplateColumns:\"repeat(3,1fr)\", gap:12, marginTop:48 }}>\n\n            {/* The Pour */}\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\", height:160,\n              background:\"linear-gradient(160deg, #1A0A2E, #0E0618)\",\n              border:\"1px solid rgba(184,107,255,0.2)\" }}>\n              <svg style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\", opacity:0.6 }}>\n                {[12,28,18,35,22,8,30,16,25,20,14,32,10,26,19].map(function(x,i){\n                  return <circle key={i} cx={x+\"%\"} cy={(15+i*5)+\"%\"} r={1.5+(i%3)*0.8}\n                    fill=\"#B86BFF\" opacity={0.3+i%4*0.15}/>;\n                })}\n                {[18,32,12,28,24,38,10,22].map(function(x,i){\n                  return <circle key={i+20} cx={x+\"%\"} cy={(20+i*8)+\"%\"} r={1+(i%2)*1.2}\n                    fill=\"#E84393\" opacity={0.2+i%3*0.1}/>;\n                })}\n              </svg>\n              <div style={{ position:\"absolute\", bottom:0, left:0, right:0, padding:\"14px 16px\",\n                background:\"linear-gradient(0deg, rgba(14,6,24,0.95) 0%, transparent 100%)\" }}>\n                <div style={{ fontSize:10, letterSpacing:\"0.3em\", color:\"rgba(184,107,255,0.6)\",\n                  fontFamily:FB, marginBottom:4 }}>01</div>\n                <div style={{ fontSize:16, fontWeight:600, color:\"#B86BFF\", fontFamily:FB }}>The Pour</div>\n                <div style={{ fontSize:12, color:\"rgba(255,255,255,0.35)\", fontFamily:FD, fontStyle:\"italic\" }}>say everything</div>\n              </div>\n            </div>\n\n            {/* The Synthesis */}\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\", height:160,\n              background:\"linear-gradient(160deg, #2A0818, #160412)\",\n              border:\"1px solid rgba(232,67,147,0.2)\" }}>\n              <svg style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\", opacity:0.55 }}>\n                {[15,30,45,60,75,85,25,55,70].map(function(x,i){\n                  return <g key={i}>\n                    <circle cx={x+\"%\"} cy={(18+i*7)+\"%\"} r={2.5} fill=\"#E84393\" opacity={0.4}/>\n                    {i < 8 && <line x1={x+\"%\"} y1={(18+i*7)+\"%\"}\n                      x2={[30,45,60,75,85,25,55,70,85][i]+\"%\"}\n                      y2={(18+(i+1)*7)+\"%\"}\n                      stroke=\"#E84393\" strokeWidth=\"0.5\" opacity=\"0.2\"/>}\n                  </g>;\n                })}\n                <circle cx=\"50%\" cy=\"45%\" r=\"12\" fill=\"none\" stroke=\"#B86BFF\" strokeWidth=\"0.8\" opacity=\"0.3\"/>\n                <circle cx=\"50%\" cy=\"45%\" r=\"6\" fill=\"rgba(232,67,147,0.3)\"/>\n              </svg>\n              <div style={{ position:\"absolute\", bottom:0, left:0, right:0, padding:\"14px 16px\",\n                background:\"linear-gradient(0deg, rgba(22,4,18,0.95) 0%, transparent 100%)\" }}>\n                <div style={{ fontSize:10, letterSpacing:\"0.3em\", color:\"rgba(232,67,147,0.6)\",\n                  fontFamily:FB, marginBottom:4 }}>02</div>\n                <div style={{ fontSize:16, fontWeight:600, color:\"#E84393\", fontFamily:FB }}>The Synthesis</div>\n                <div style={{ fontSize:12, color:\"rgba(255,255,255,0.35)\", fontFamily:FD, fontStyle:\"italic\" }}>meaning emerges</div>\n              </div>\n            </div>\n\n            {/* The Field */}\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\", height:160,\n              background:\"linear-gradient(160deg, #041A10, #020E0A)\",\n              border:\"1px solid rgba(107,255,184,0.2)\" }}>\n              <div style={{ position:\"absolute\", top:\"30%\", left:\"50%\",\n                transform:\"translate(-50%,-50%)\",\n                width:60, height:60, borderRadius:\"50%\",\n                background:\"radial-gradient(circle, rgba(107,255,184,0.4), transparent 70%)\",\n                animation:\"pulse 3s ease-in-out infinite\" }}/>\n              {[0,60,120,180,240,300].map(function(deg,i){\n                var rad = deg * Math.PI / 180;\n                var cx = 50 + Math.cos(rad) * 28;\n                var cy = 30 + Math.sin(rad) * 22;\n                return <svg key={i} style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\",\n                  pointerEvents:\"none\" }}>\n                  <circle cx={cx+\"%\"} cy={cy+\"%\"} r=\"2\" fill=\"#6BFFB8\" opacity=\"0.4\"/>\n                  <line x1=\"50%\" y1=\"30%\" x2={cx+\"%\"} y2={cy+\"%\"}\n                    stroke=\"#6BFFB8\" strokeWidth=\"0.5\" opacity=\"0.15\"/>\n                </svg>;\n              })}\n              <div style={{ position:\"absolute\", bottom:0, left:0, right:0, padding:\"14px 16px\",\n                background:\"linear-gradient(0deg, rgba(2,14,10,0.95) 0%, transparent 100%)\" }}>\n                <div style={{ fontSize:10, letterSpacing:\"0.3em\", color:\"rgba(107,255,184,0.6)\",\n                  fontFamily:FB, marginBottom:4 }}>03</div>\n                <div style={{ fontSize:16, fontWeight:600, color:\"#6BFFB8\", fontFamily:FB }}>The Field</div>\n                <div style={{ fontSize:12, color:\"rgba(255,255,255,0.35)\", fontFamily:FD, fontStyle:\"italic\" }}>you, mapped</div>\n              </div>\n            </div>\n\n          </div>\n        </section>\n\n        {/* Field visual */}\n        <div style={{ position:\"relative\", height:220, borderRadius:24, overflow:\"hidden\",\n          marginBottom:72,\n          background:\"linear-gradient(140deg, #0F0820 0%, #080514 50%, #060A18 100%)\",\n          border:\"1px solid rgba(184,107,255,0.15)\",\n          boxShadow:\"0 0 60px rgba(184,107,255,0.08), 0 20px 60px rgba(0,0,0,0.5)\" }}>\n          <div style={{ position:\"absolute\", inset:0, display:\"grid\", placeItems:\"center\" }}>\n            <div style={{ width:76, height:76, borderRadius:\"50%\",\n              background:\"radial-gradient(circle, rgba(232,67,147,0.7), rgba(184,107,255,0.3) 50%, transparent 70%)\",\n              animation:\"pulse 4s ease-in-out infinite\", boxShadow:\"0 0 40px rgba(232,67,147,0.3)\" }} />\n          </div>\n          {[\n            { text:\"What matters\", top:\"15%\", left:\"8%\", c:\"rgba(184,107,255,0.15)\" },\n            { text:\"The friction\", top:\"18%\", right:\"10%\", c:\"rgba(232,67,147,0.15)\" },\n            { text:\"What I keep avoiding\", top:\"50%\", left:\"5%\", c:\"rgba(107,184,255,0.1)\" },\n            { text:\"The pull\", top:\"42%\", right:\"12%\", c:\"rgba(232,67,147,0.12)\" },\n            { text:\"Quiet hope\", bottom:\"18%\", left:\"26%\", c:\"rgba(107,255,184,0.1)\" },\n            { text:\"Rest\", bottom:\"22%\", right:\"18%\", c:\"rgba(107,184,255,0.1)\" },\n          ].map(function(tag,i){\n            var s = { position:\"absolute\", padding:\"5px 14px\", borderRadius:999, fontSize:13,\n              fontFamily:FD, fontStyle:\"italic\", background:tag.c,\n              border:\"1px solid rgba(255,255,255,0.08)\", color:\"rgba(255,255,255,0.6)\" };\n            if(tag.top) s.top=tag.top;\n            if(tag.bottom) s.bottom=tag.bottom;\n            if(tag.left) s.left=tag.left;\n            if(tag.right) s.right=tag.right;\n            return <div key={i} style={s}>{tag.text}</div>;\n          })}\n          <div style={{ position:\"absolute\", bottom:12, left:0, right:0, textAlign:\"center\",\n            fontSize:11, letterSpacing:\"0.2em\", fontFamily:FB,\n            background:\"linear-gradient(90deg, #6BB8FF, #B86BFF)\", WebkitBackgroundClip:\"text\",\n            WebkitTextFillColor:\"transparent\" }}>\n            MEANING \u00b7 NOT RAW WORDS\n          </div>\n        </div>\n\n        {/* Three story sections */}\n        <section id=\"saycrd-why\" style={{ marginBottom:72 }}>\n          <div style={{ fontSize:22, fontWeight:700, fontFamily:FB, marginBottom:28,\n            letterSpacing:\"0.02em\",\n            background:\"linear-gradient(90deg, #6BFFB8, #6BB8FF)\", WebkitBackgroundClip:\"text\",\n            WebkitTextFillColor:\"transparent\" }}>Why it exists</div>\n\n          <div style={{ display:\"flex\", flexDirection:\"column\", gap:12 }}>\n\n            {/* The gap in the world */}\n            <div style={{ borderRadius:20, overflow:\"hidden\",\n              background:\"linear-gradient(135deg, rgba(232,67,147,0.08), rgba(184,107,255,0.04))\",\n              border:\"1px solid rgba(232,67,147,0.15)\", display:\"flex\", alignItems:\"stretch\", minHeight:140 }}>\n              <div style={{ width:140, flexShrink:0, position:\"relative\", overflow:\"hidden\",\n                borderRight:\"1px solid rgba(232,67,147,0.1)\" }}>\n                <svg width=\"140\" height=\"100%\" style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\" }}>\n                  {/* Scattered fragments \u2014 chaos / overwhelm */}\n                  {[\n                    [20,20],[45,35],[70,15],[90,40],[15,55],[55,60],[80,50],[30,75],[60,80],[85,70],\n                    [10,35],[40,10],[75,65],[95,25],[25,90],[50,45],[65,30],[35,60],[82,85],[12,70]\n                  ].map(function(p,i){\n                    var size = 1.5 + (i%4)*0.8;\n                    return React.createElement(\"circle\",{key:i,cx:p[0]+\"%\",cy:p[1]+\"%\",r:size,\n                      fill:\"#E84393\",opacity:0.15+i%5*0.1});\n                  })}\n                  {/* A few broken lines \u2014 disconnected */}\n                  {[[20,20,35,35],[55,60,40,75],[70,15,85,30],[30,75,20,90],[80,50,95,55]].map(function(l,i){\n                    return React.createElement(\"line\",{key:i,x1:l[0]+\"%\",y1:l[1]+\"%\",x2:l[2]+\"%\",y2:l[3]+\"%\",\n                      stroke:\"#E84393\",strokeWidth:\"0.8\",opacity:\"0.2\",strokeDasharray:\"2 4\"});\n                  })}\n                  {/* Central void */}\n                  <circle cx=\"50%\" cy=\"50%\" r=\"18\" fill=\"none\" stroke=\"#E84393\" strokeWidth=\"0.5\" opacity=\"0.1\"/>\n                </svg>\n              </div>\n              <div style={{ padding:\"28px 28px\" }}>\n                <h2 style={{ fontFamily:FD, fontSize:28, fontWeight:300,\n                  color:\"#E84393\", marginBottom:10, lineHeight:1.15 }}>The gap in the world</h2>\n                <p style={{ fontFamily:FD, fontSize:16, fontWeight:300, fontStyle:\"italic\",\n                  color:\"rgba(220,180,200,0.65)\", lineHeight:1.72, margin:0 }}>\n                  There is a moment when you are scattered and nothing feels clear. Journals are blank pages. To-do apps are laughable. Friends are tired. SAYCRD is the place you go in that moment.\n                </p>\n              </div>\n            </div>\n\n            {/* The loop closes */}\n            <div style={{ borderRadius:20, overflow:\"hidden\",\n              background:\"linear-gradient(135deg, rgba(107,255,184,0.06), rgba(107,184,255,0.04))\",\n              border:\"1px solid rgba(107,255,184,0.15)\", display:\"flex\", alignItems:\"stretch\", minHeight:140 }}>\n              <div style={{ width:140, flexShrink:0, position:\"relative\", overflow:\"hidden\",\n                borderRight:\"1px solid rgba(107,255,184,0.1)\" }}>\n                <svg width=\"140\" height=\"100%\" style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\" }}>\n                  {/* Inner/outer loop \u2014 transformation */}\n                  <circle cx=\"50%\" cy=\"50%\" r=\"38\" fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"0.6\" opacity=\"0.12\"/>\n                  <circle cx=\"50%\" cy=\"50%\" r=\"24\" fill=\"none\" stroke=\"#6BB8FF\" strokeWidth=\"0.8\" opacity=\"0.18\"/>\n                  <circle cx=\"50%\" cy=\"50%\" r=\"12\" fill=\"rgba(107,255,184,0.12)\" stroke=\"#6BFFB8\" strokeWidth=\"1\" opacity=\"0.4\"/>\n                  {/* Arrow suggesting inward flow */}\n                  {[0,60,120,180,240,300].map(function(deg,i){\n                    var rad=deg*Math.PI/180;\n                    var ox=50+Math.cos(rad)*38, oy=50+Math.sin(rad)*38;\n                    var ix=50+Math.cos(rad)*26, iy=50+Math.sin(rad)*26;\n                    return React.createElement(\"line\",{key:i,\n                      x1:ox+\"%\",y1:oy+\"%\",x2:ix+\"%\",y2:iy+\"%\",\n                      stroke:\"#6BFFB8\",strokeWidth:\"0.7\",opacity:\"0.25\"});\n                  })}\n                  {/* Outer dots */}\n                  {[30,90,150,210,270,330].map(function(deg,i){\n                    var rad=deg*Math.PI/180;\n                    return React.createElement(\"circle\",{key:i+10,\n                      cx:(50+Math.cos(rad)*38)+\"%\",cy:(50+Math.sin(rad)*38)+\"%\",\n                      r:\"2\",fill:\"#6BFFB8\",opacity:\"0.5\"});\n                  })}\n                  <circle cx=\"50%\" cy=\"50%\" r=\"4\" fill=\"#6BFFB8\" opacity=\"0.9\"/>\n                </svg>\n              </div>\n              <div style={{ padding:\"28px 28px\" }}>\n                <h2 style={{ fontFamily:FD, fontSize:28, fontWeight:300,\n                  color:\"#6BFFB8\", marginBottom:10, lineHeight:1.15 }}>The loop closes</h2>\n                <p style={{ fontFamily:FD, fontSize:16, fontWeight:300, fontStyle:\"italic\",\n                  color:\"rgba(180,220,200,0.65)\", lineHeight:1.72, margin:0 }}>\n                  Internal becomes external, in real time. Seeing the map changes how you relate to it. That shift is the mechanism. It is not productivity. It is clarity.\n                </p>\n              </div>\n            </div>\n\n            {/* The system remembers */}\n            <div style={{ borderRadius:20, overflow:\"hidden\",\n              background:\"linear-gradient(135deg, rgba(184,107,255,0.08), rgba(107,184,255,0.04))\",\n              border:\"1px solid rgba(184,107,255,0.15)\", display:\"flex\", alignItems:\"stretch\", minHeight:140 }}>\n              <div style={{ width:140, flexShrink:0, position:\"relative\", overflow:\"hidden\",\n                borderRight:\"1px solid rgba(184,107,255,0.1)\" }}>\n                <svg width=\"140\" height=\"100%\" style={{ position:\"absolute\", inset:0, width:\"100%\", height:\"100%\" }}>\n                  {/* Stacked time layers \u2014 memory */}\n                  {[45,35,25,16,8].map(function(r,i){\n                    return React.createElement(\"ellipse\",{key:i,cx:\"50%\",cy:\"50%\",rx:r,ry:r*0.55,\n                      fill:\"none\",stroke:\"#B86BFF\",strokeWidth:1-i*0.1,\n                      opacity:0.5-i*0.07,strokeDasharray:i>2?\"2 3\":undefined});\n                  })}\n                  {/* Session dots across layers */}\n                  {[\n                    {deg:30,r:45},{deg:110,r:45},{deg:200,r:45},{deg:290,r:45},\n                    {deg:60,r:35},{deg:180,r:35},{deg:300,r:35},\n                    {deg:90,r:25},{deg:230,r:25},\n                    {deg:45,r:16},\n                  ].map(function(s,i){\n                    var rad=s.deg*Math.PI/180;\n                    var x=50+Math.cos(rad)*s.r, y=50+Math.sin(rad)*s.r*0.55;\n                    return React.createElement(\"circle\",{key:i,cx:x+\"%\",cy:y+\"%\",\n                      r:i<4?2.5:2,fill:\"#B86BFF\",opacity:0.3+i%3*0.15});\n                  })}\n                  <circle cx=\"50%\" cy=\"50%\" r=\"4\" fill=\"rgba(184,107,255,0.5)\"/>\n                  <circle cx=\"50%\" cy=\"50%\" r=\"2\" fill=\"#B86BFF\"/>\n                </svg>\n              </div>\n              <div style={{ padding:\"28px 28px\" }}>\n                <h2 style={{ fontFamily:FD, fontSize:28, fontWeight:300,\n                  color:\"#B86BFF\", marginBottom:10, lineHeight:1.15 }}>The system remembers</h2>\n                <p style={{ fontFamily:FD, fontSize:16, fontWeight:300, fontStyle:\"italic\",\n                  color:\"rgba(200,180,230,0.65)\", lineHeight:1.72, margin:0 }}>\n                  The map stays with you. It recognizes patterns across sessions without feeling like surveillance. You build a living map of your inner life.\n                </p>\n              </div>\n            </div>\n\n          </div>\n        </section>\n\n\n                {/* Four capability tiles */}\n        <section style={{ marginBottom:72 }}>\n          <div style={{ fontSize:22, fontWeight:700, fontFamily:FB, marginBottom:24,\n            letterSpacing:\"0.02em\",\n            background:\"linear-gradient(90deg, #6BB8FF, #E84393)\", WebkitBackgroundClip:\"text\",\n            WebkitTextFillColor:\"transparent\" }}>What the system does</div>\n\n          <div style={{ display:\"grid\", gridTemplateColumns:\"repeat(auto-fit, minmax(260px, 1fr))\", gap:14 }}>\n\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\",\n              background:\"linear-gradient(160deg, #1A0614, #0E040E)\",\n              border:\"1px solid rgba(232,67,147,0.2)\" }}>\n              <div style={{ height:130, position:\"relative\" }}>\n                <svg width=\"100%\" height=\"130\" style={{ position:\"absolute\", inset:0 }}>\n                  {[0.15,0.3,0.55,0.85,0.65,0.4,0.7,0.3,0.5,0.9,0.4,0.6,0.25,0.75,0.45,0.8,0.35,0.6,0.5,0.7].map(function(h,i){\n                    var barH = h * 70; var y = (130 - barH) / 2;\n                    return React.createElement(\"rect\",{key:i,x:(5+i*4.8)+\"%\",y:y,width:\"2.5\",height:barH,rx:\"1.5\",fill:\"#E84393\",opacity:0.2+h*0.5});\n                  })}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"18\",fill:\"none\",stroke:\"#E84393\",strokeWidth:\"1\",opacity:\"0.15\"})}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"28\",fill:\"none\",stroke:\"#E84393\",strokeWidth:\"0.5\",opacity:\"0.08\"})}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"8\",fill:\"rgba(232,67,147,0.4)\"})}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"3\",fill:\"#E84393\"})}\n                </svg>\n              </div>\n              <div style={{ padding:\"0 22px 22px\" }}>\n                <h3 style={{ fontFamily:FB, fontSize:17, fontWeight:700, color:\"#E84393\", marginBottom:8 }}>AI that listens</h3>\n                <p style={{ fontFamily:FD, fontSize:15, fontStyle:\"italic\", color:\"rgba(220,180,200,0.55)\", lineHeight:1.65, margin:0 }}>\n                  It hears what is underneath, collapses related themes, and keeps the map clean even when the dump is long.\n                </p>\n              </div>\n            </div>\n\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\",\n              background:\"linear-gradient(160deg, #041A10, #020E0C)\",\n              border:\"1px solid rgba(107,255,184,0.2)\" }}>\n              <div style={{ height:130, position:\"relative\" }}>\n                <svg width=\"100%\" height=\"130\" style={{ position:\"absolute\", inset:0 }}>\n                  {[[50,50],[22,30],[78,28],[20,70],[80,72],[50,90],[35,15],[65,12],[88,50],[12,50]].map(function(n,i){\n                    return React.createElement(\"circle\",{key:i,cx:n[0]+\"%\",cy:n[1]*130/100,r:[7,4,5,3,4,3,2.5,3,2.5,2][i],fill:\"#6BFFB8\",opacity:[0.9,0.6,0.7,0.5,0.6,0.4,0.4,0.5,0.4,0.35][i]});\n                  })}\n                  {[[50,50,22,30],[50,50,78,28],[50,50,20,70],[50,50,80,72],[50,50,50,90],[22,30,35,15],[78,28,65,12],[22,30,12,50],[80,72,88,50]].map(function(l,i){\n                    return React.createElement(\"line\",{key:i,x1:l[0]+\"%\",y1:l[1]*130/100,x2:l[2]+\"%\",y2:l[3]*130/100,stroke:\"#6BFFB8\",strokeWidth:\"0.7\",opacity:\"0.2\"});\n                  })}\n                </svg>\n              </div>\n              <div style={{ padding:\"0 22px 22px\" }}>\n                <h3 style={{ fontFamily:FB, fontSize:17, fontWeight:700, color:\"#6BFFB8\", marginBottom:8 }}>Visual that is alive</h3>\n                <p style={{ fontFamily:FD, fontSize:15, fontStyle:\"italic\", color:\"rgba(180,220,200,0.55)\", lineHeight:1.65, margin:0 }}>\n                  A living field that holds vagueness, weight, proximity, and change over time.\n                </p>\n              </div>\n            </div>\n\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\",\n              background:\"linear-gradient(160deg, #0E0820, #08061A)\",\n              border:\"1px solid rgba(184,107,255,0.2)\" }}>\n              <div style={{ height:130, position:\"relative\" }}>\n                <svg width=\"100%\" height=\"130\" style={{ position:\"absolute\", inset:0 }}>\n                  {[52,38,26,16].map(function(r,i){\n                    return React.createElement(\"circle\",{key:i,cx:\"50%\",cy:\"65\",r:r,fill:\"none\",stroke:\"#B86BFF\",strokeWidth:1.2-i*0.25,strokeDasharray:i%2===0?\"4 3\":\"2 5\",opacity:0.5-i*0.08});\n                  })}\n                  {[0,72,144,216,288].map(function(deg,i){\n                    var rad=deg*Math.PI/180;\n                    return React.createElement(\"circle\",{key:i+10,cx:(50+Math.cos(rad)*28)+\"%\",cy:65+Math.sin(rad)*20,r:\"2.5\",fill:\"#B86BFF\",opacity:\"0.6\"});\n                  })}\n                  {[0,45,90,160,250].map(function(deg,i){\n                    var rad=deg*Math.PI/180;\n                    return React.createElement(\"circle\",{key:i+20,cx:(50+Math.cos(rad)*20)+\"%\",cy:65+Math.sin(rad)*15,r:\"1.8\",fill:\"#6BB8FF\",opacity:\"0.45\"});\n                  })}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"5\",fill:\"rgba(184,107,255,0.5)\"})}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"2\",fill:\"#B86BFF\"})}\n                </svg>\n              </div>\n              <div style={{ padding:\"0 22px 22px\" }}>\n                <h3 style={{ fontFamily:FB, fontSize:17, fontWeight:700, color:\"#B86BFF\", marginBottom:8 }}>Memory with care</h3>\n                <p style={{ fontFamily:FD, fontSize:15, fontStyle:\"italic\", color:\"rgba(200,180,230,0.55)\", lineHeight:1.65, margin:0 }}>\n                  Patterns are remembered, not tracked. The system knows what to surface and what to leave alone.\n                </p>\n              </div>\n            </div>\n\n            <div style={{ borderRadius:20, overflow:\"hidden\", position:\"relative\",\n              background:\"linear-gradient(160deg, #140E04, #0C0A02)\",\n              border:\"1px solid rgba(214,178,109,0.2)\" }}>\n              <div style={{ height:130, position:\"relative\" }}>\n                <svg width=\"100%\" height=\"130\" style={{ position:\"absolute\", inset:0 }}>\n                  {[42,32,20,10].map(function(r,i){\n                    return React.createElement(\"circle\",{key:i,cx:\"50%\",cy:\"65\",r:r,fill:\"none\",stroke:\"#D6B26D\",strokeWidth:1.2-i*0.2,opacity:0.1+i*0.06});\n                  })}\n                  {[0,45,90,135,180,225,270,315].map(function(deg,i){\n                    var rad=deg*Math.PI/180;\n                    return React.createElement(\"line\",{key:i,x1:(50+Math.cos(rad)*12)+\"%\",y1:65+Math.sin(rad)*12,x2:(50+Math.cos(rad)*22)+\"%\",y2:65+Math.sin(rad)*22,stroke:\"#D6B26D\",strokeWidth:\"0.8\",opacity:\"0.2\"});\n                  })}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"10\",fill:\"rgba(214,178,109,0.2)\",stroke:\"#D6B26D\",strokeWidth:\"1.2\",opacity:\"0.6\"})}\n                  {React.createElement(\"circle\",{cx:\"50%\",cy:\"65\",r:\"4\",fill:\"#D6B26D\",opacity:\"0.8\"})}\n                </svg>\n              </div>\n              <div style={{ padding:\"0 22px 22px\" }}>\n                <h3 style={{ fontFamily:FB, fontSize:17, fontWeight:700, color:\"#D6B26D\", marginBottom:8 }}>Practice, not features</h3>\n                <p style={{ fontFamily:FD, fontSize:15, fontStyle:\"italic\", color:\"rgba(220,200,160,0.55)\", lineHeight:1.65, margin:0 }}>\n                  A breath, a pause, a reflection \u2014 only when needed. The experience stays whole.\n                </p>\n              </div>\n            </div>\n\n          </div>\n        </section>\n\n                {/* Final CTA */}\n        <section style={{ textAlign:\"center\", padding:\"56px 32px\",\n          borderRadius:28,\n          background:\"linear-gradient(135deg, rgba(184,107,255,0.08), rgba(232,67,147,0.08))\",\n          border:\"1px solid rgba(184,107,255,0.15)\",\n          marginBottom:48 }}>\n          <h2 style={{ fontFamily:FD, fontSize:\"clamp(30px,4.5vw,44px)\", fontWeight:300,\n            color:\"rgba(255,255,255,0.88)\", marginBottom:14, lineHeight:1.2 }}>\n            Ready to listen to yourself?\n          </h2>\n          <p style={{ fontFamily:FD, fontSize:19, fontWeight:300, fontStyle:\"italic\",\n            color:\"rgba(200,185,230,0.5)\", marginBottom:36, lineHeight:1.7 }}>\n            No account needed. Your session stays private. Just start.\n          </p>\n          <button onClick={guardedStart} style={{ padding:\"18px 48px\", borderRadius:999,\n            background:\"linear-gradient(135deg, #E84393, #B86BFF)\", border:\"none\",\n            color:\"#fff\", fontFamily:FB, fontSize:17, fontWeight:700,\n            letterSpacing:\"0.05em\", cursor:\"pointer\",\n            boxShadow:\"0 16px 48px rgba(184,107,255,0.25)\" }}>\n            {returning ? \"continue your journey\" : \"start a session\"}\n          </button>\n        </section>\n\n      </div>\n    </div>\n  );\n}\n\nfunction CoSynthPhase({ rawText, synthesisData, mapResponses, onSynthesis, onComplete }) {\n  const [status, setStatus] = useState(\"reading\");\n  const sd = synthesisData || {};\n\n  var MESSAGES = [\n    \"listening\\u2026\",\n    \"finding the pattern\\u2026\",\n    \"seeing what's real\\u2026\",\n    \"building your session\\u2026\",\n    \"almost there\\u2026\"\n  ];\n  var [msgIdx, setMsgIdx] = useState(0);\n\n  useEffect(function() {\n    var interval = setInterval(function() {\n      setMsgIdx(function(i) { return (i + 1) % MESSAGES.length; });\n    }, 1800);\n    return function() { clearInterval(interval); };\n  }, []);\n\n  useEffect(function() {\n    (async function() {\n      try {\n        \n        var mr = mapResponses || {};\n        var confirmed = [], rejected = [], partial = [], userSaid = [];\n\n        Object.keys(mr).forEach(function(key) {\n          var r = mr[key];\n          if (!r) return;\n          var parts = key.split(\"::\");\n          var from = parts[0] || \"\", to = parts[1] || \"\";\n          var connLabel = from + \" \\u2194 \" + to;\n\n          \n          var origConn = (sd.connections || []).find(function(c) { return c.from === from && c.to === to; });\n          var origInsight = origConn ? origConn.insight : \"\";\n\n          if (r.value === \"yes\") {\n            var line = \"CONFIRMED: [\" + connLabel + \"]\";\n            if (origInsight) line += \" \\u2014 original read: \\\"\" + origInsight + \"\\\"\";\n            if (r.comment && r.comment.trim()) line += \" \\u2014 user added: \\\"\" + r.comment.trim() + \"\\\"\";\n            confirmed.push(line);\n          } else if (r.value === \"no\") {\n            var line = \"REJECTED: [\" + connLabel + \"]\";\n            if (origInsight) line += \" \\u2014 AI said: \\\"\" + origInsight + \"\\\" \\u2014 this was WRONG\";\n            if (r.comment && r.comment.trim()) line += \" \\u2014 user correction: \\\"\" + r.comment.trim() + \"\\\"\";\n            rejected.push(line);\n          } else if (r.value === \"partly\") {\n            var line = \"PARTIAL: [\" + connLabel + \"]\";\n            if (origInsight) line += \" \\u2014 partial truth: \\\"\" + origInsight + \"\\\"\";\n            if (r.comment && r.comment.trim()) line += \" \\u2014 what IS true: \\\"\" + r.comment.trim() + \"\\\"\";\n            if (r.correction && r.correction.trim() && r.correction !== r.comment) line += \" \\u2014 correction: \\\"\" + r.correction.trim() + \"\\\"\";\n            partial.push(line);\n          } else if (r.value === \"discovered\" || r.userDiscovered) {\n            var line = \"USER-DISCOVERED: [\" + connLabel + \"] \\u2014 the user connected these themselves\";\n            if (r.insight && r.insight !== \"\\u2026\") line += \"; AI read: \\\"\" + r.insight + \"\\\"\";\n            if (r.comment && r.comment.trim()) line += \"; user said: \\\"\" + r.comment.trim() + \"\\\"\";\n            confirmed.push(line);\n          }\n          if (r.comment && r.comment.trim()) userSaid.push(r.comment.trim());\n          if (r.correction && r.correction.trim()) userSaid.push(r.correction.trim());\n        });\n\n        var mapRecord = \"\";\n        if (confirmed.length) mapRecord += \"\\n\\u2550\\u2550 CONFIRMED BY USER (this is real, build on it) \\u2550\\u2550\\n\" + confirmed.join(\"\\n\");\n        if (partial.length) mapRecord += \"\\n\\n\\u2550\\u2550 PARTIALLY TRUE (refine these) \\u2550\\u2550\\n\" + partial.join(\"\\n\");\n        if (rejected.length) mapRecord += \"\\n\\n\\u2550\\u2550 REJECTED BY USER (these were projections \\u2014 retire them entirely) \\u2550\\u2550\\n\" + rejected.join(\"\\n\");\n\n        var hadNoFeedback = !confirmed.length && !rejected.length && !partial.length;\n\n        \n        var pastContext = \"\";\n        try {\n          var sessions = loadSessions();\n          if (sessions.length > 0) {\n            var recent = sessions.slice(-3);\n            var lines = recent.map(function(s, i) {\n              var line = \"Session \" + (sessions.length - recent.length + i + 1) + \":\";\n              if (s.synthesis) line += \" synthesis=\\\"\" + s.synthesis.slice(0, 100) + \"\\\"\";\n              if (s.mapTitle) line += \" title=\\\"\" + s.mapTitle + \"\\\"\";\n              return line;\n            });\n            pastContext = \"\\n\\n\\u2550\\u2550 PAST SESSIONS (for pattern tracking, not repetition) \\u2550\\u2550\\n\" + lines.join(\"\\n\");\n          }\n        } catch(e) {}\n\n        \n        var prompt =\n          \"You are the reflective engine behind SAYCRD \\u2014 a co-creation tool, not a diagnosis machine.\\n\"\n          + \"Your role: WITNESS, not analyst. COMPANION, not judge. MIRROR, not authority.\\n\\n\"\n\n          + \"\\u2550\\u2550 THE MATERIAL YOU ARE WORKING WITH \\u2550\\u2550\\n\"\n          + \"You have three layers of input. Use them in this exact priority order:\\n\\n\"\n          + \"1. USER'S OWN WORDS (primary) \\u2014 What they wrote in their share, and any words they added while reacting to connections. These are the source. Quote them. Build from them. Mirror them back. Do not paraphrase into your own voice.\\n\"\n          + \"2. CONFIRMED TERRITORY (foundation) \\u2014 Connections marked as true. These are the real structure of what's happening. Write as if you simply know this is true. Don't explain that they were 'confirmed' \\u2014 that's process narration. Just use it.\\n\"\n          + \"3. YOUR PATTERN INTELLIGENCE (secondary) \\u2014 What you see in the confirmed territory that the person may not have named yet. What does the combination point to? What's the thing underneath the things? Offer this as insight, not verdict.\\n\\n\"\n          + \"Connections NOT marked as true: GONE. Completely. Don't soften them, don't reference them, don't bring them back sideways. They weren't real for this person.\\n\"\n          + \"Partial connections: use only the part that was true, in the user's own words if they gave them.\\n\\n\"\n\n          + \"\\u2550\\u2550 HOW TO WRITE \\u2550\\u2550\\n\"\n          + \"Write as if you simply know what is true about this person right now. Not because they told you \\u2014 because it's evident in their words.\\n\"\n          + \"NEVER write: 'you confirmed', 'you corrected', 'you pushed back', 'you rejected', 'you told me', 'from your map', 'based on your feedback', 'you said', 'you marked'.\\n\"\n          + \"These are process words. They pull the person out of the reading and into a conversation about the conversation. Strip them entirely.\\n\\n\"\n          + \"WRONG: 'You confirmed that showing up despite pain is real for you.'\\n\"\n          + \"RIGHT: 'You show up when your body is asking you to stop. That's not new.'\\n\\n\"\n          + \"WRONG: 'You corrected me on the physical toll connection.'\\n\"\n          + \"RIGHT: (don't mention it at all \\u2014 it wasn't real, it doesn't exist)\\n\\n\"\n          + \"WRONG: 'You pushed back hard on...'\\n\"\n          + \"RIGHT: (just don't include it)\\n\\n\"\n\n          + \"\\u2550\\u2550 USE YOUR INTELLIGENCE \\u2550\\u2550\\n\"\n          + \"Look at the confirmed territory: what do these things have in common that the person hasn't said out loud?\\n\"\n          + \"What is the real tension underneath?\\n\"\n          + \"What single observation would reframe everything?\\n\"\n          + \"If something is obvious, say it plainly. Don't hedge.\\n\"\n          + \"If something is a question, ask it directly. Don't perform certainty you don't have.\\n\"\n          + \"Be curious. Be sharp. But not argumentative, not superior.\\n\\n\"\n\n          + \"\\u2550\\u2550 WHAT THIS IS NOT \\u2550\\u2550\\n\"\n          + \"Not a summary. Not a report about what happened in the session.\\n\"\n          + \"A reading of who this person is right now, made from the material they confirmed as real.\\n\"\n          + \"The person reads this and feels seen \\u2014 not like they're reading minutes from their own meeting.\\n\\n\"\n\n          + \"\\u2550\\u2550 TONE \\u2550\\u2550\\n\"\n          + \"Direct. Warm without being soft. Curious without being clinical.\\n\"\n          + \"You can name something obvious plainly. Not harshly.\\n\"\n          + \"Never punish. Never pathologize. Never imply broken.\\n\"\n          + \"Banned: navigating, sacred, container, healing, inner work, journey, integration, space where, cultivating, intentional.\\n\"\n          + \"NEVER: 'you resist', 'you avoid', 'you're not ready', 'you struggle with'. If something looks like avoidance, ask about it \\u2014 don't declare it.\\n\\n\"\n\n          + \"ORIGINAL THEMES: \" + (sd.themes || []).map(function(t) { return t.label; }).join(\", \") + \"\\n\"\n          + \"ORIGINAL MAP TITLE: \" + (sd.map_title || sd.mapTitle || \"none\") + \"\\n\\n\"\n\n          + \"Use the exact same JSON schema. Every field required.\\n\"\n          + \"CRITICAL: from/to in connections must exactly match a theme label you generate.\\n\"\n          + 'Respond with ONLY valid JSON, no markdown:\\n{\"themes\":[{\"label\":\"...\",\"weight\":1}],\"connections\":[{\"from\":\"exact\",\"to\":\"exact\",\"label\":\"...\",\"insight\":\"...\"}],\"guide\":[{\"type\":\"act\",\"text\":\"...\"}],\"map_title\":\"...\",\"descent_cards\":[{\"type\":\"energy\",\"phrase\":\"...\",\"color\":\"#...\"},{\"type\":\"binary\",\"prompt\":\"...\",\"option_a\":\"...\",\"option_b\":\"...\",\"color\":\"#...\"},{\"type\":\"spectrum\",\"prompt\":\"...\",\"pole_a\":\"...\",\"pole_b\":\"...\",\"color\":\"#...\"},{\"type\":\"energy\",\"phrase\":\"...\",\"color\":\"#...\"}],\"archetype\":{\"name\":\"The ...\",\"line\":\"...\",\"source_nodes\":[\"...\"],\"classical_resonance\":null,\"evolution_from\":null},\"synthesis\":\"...\",\"underneath\":[\"...\",\"...\",\"...\"],\"tension\":{\"a\":\"...\",\"b\":\"...\",\"text\":\"...\"},\"blind_spot\":\"...\",\"opening\":\"...\",\"noticing\":\"...\",\"alchemy\":{\"stage\":\"nigredo\",\"evidence\":\"...\"},\"field_cards\":[{\"type\":\"energy\",\"hero_text\":\"...\",\"sub_text\":\"...\",\"color\":\"#...\",\"user_fragment\":\"...\",\"whisper\":null}]}';\n\n        var userInput = (rawText || \"\") + \"\\n\\n\" +\n          (mapRecord ? \"\\u2550\\u2550 MAP CO-CREATION RECORD \\u2550\\u2550\\n\" + mapRecord : \"\") +\n          pastContext;\n\n        setStatus(\"building\");\n        var response = await callClaude(prompt, userInput, 3500);\n        var data = parseJSON(response);\n\n        if (data && data.themes && data.themes.length > 0) {\n          var NC = [\"#E84393\",\"#6BFFB8\",\"#FFB86B\",\"#6BB8FF\",\"#B86BFF\",\"#FF6B6B\",\"#FFD700\",\"#6BFFE8\"];\n          data.themes = data.themes.map(function(t, i) { return Object.assign({}, t, { color: NC[i % NC.length] }); });\n          if (data.archetype && !data.archetypes) data.archetypes = [data.archetype];\n          if (!data.archetypes) data.archetypes = [];\n          if (data.connections) data.connections = data.connections.map(function(c) {\n            var ft = (data.themes || []).find(function(t) { return t.label === c.from; });\n            return Object.assign({}, c, { color: ft ? ft.color : NC[0] });\n          });\n          onSynthesis(data);\n        }\n        onComplete();\n      } catch(e) {\n        console.error(\"[SAYCRD] CoSynth error:\", e);\n        onComplete(); \n      }\n    })();\n  }, []);\n\n  return (\n    <div style={{ width:\"100%\", height:\"100%\", display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", position:\"relative\", overflow:\"hidden\" }}>\n      <Particles color=\"#B86BFF\" count={20}/>\n\n      \n      <div style={{ position:\"absolute\", width:320, height:320, borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(184,107,255,0.12), transparent 70%)\", filter:\"blur(60px)\", pointerEvents:\"none\" }}/>\n\n      <div style={{ position:\"relative\", zIndex:1, textAlign:\"center\", padding:\"0 32px\" }}>\n        <BreathingOrb color=\"#B86BFF\" size={80}/>\n\n        <div style={{ marginTop:32, fontFamily:FB, fontSize:11, letterSpacing:\"0.4em\", textTransform:\"uppercase\", color:\"rgba(184,107,255,0.6)\", animation:\"pulse 1.8s ease infinite\" }}>\n          {MESSAGES[msgIdx]}\n        </div>\n\n        <div style={{ marginTop:16, fontFamily:FD, fontSize:14, fontStyle:\"italic\", color:\"rgba(255,255,255,0.2)\", lineHeight:1.7 }}>\n          building the session from what you marked\n        </div>\n\n        \n      </div>\n    </div>\n  );\n}\n\nfunction SAYCRDFlow() {\n  const [phase, setPhase] = useState(0);\n  const [rawText, setRawText] = useState(\"\");\n  const [synthesisData, setSynthesisData] = useState(null);\n  const [mapResponses, setMapResponses] = useState({});\n  const [sessionData, setSessionData] = useState({});\n  const [fieldTransition, setFieldTransition] = useState(false);\n\n  \n  function onPatchSynthesis(patch) {\n    setSynthesisData(function(prev) {\n      if (!prev) return prev;\n      var next = Object.assign({}, prev);\n      if (patch.synthesis) next.synthesis = patch.synthesis;\n      if (patch.tension) next.tension = Object.assign({}, prev.tension || {}, patch.tension);\n      if (patch.connections) {\n        var existing = prev.connections || [];\n        var updated = existing.map(function(c) {\n          var m = patch.connections.find(function(pc){ return pc.from===c.from && pc.to===c.to; });\n          return m ? Object.assign({}, c, m) : c;\n        });\n        patch.connections.forEach(function(pc) {\n          if (!updated.find(function(c){ return c.from===pc.from && c.to===pc.to; })) updated.push(pc);\n        });\n        next.connections = updated;\n      }\n      if (patch.guide) next.guide = patch.guide;\n      return next;\n    });\n  }\n\n  const cp = PHASES[phase];\n\n  function enterField() {\n    setFieldTransition(true);\n    setTimeout(function() { setPhase(6); setFieldTransition(false); }, 1200);\n  }\n  return (\n    <div style={{width:\"100%\",height:\"100vh\",background:\"#000\",display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}}>\n      <link href=\"https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Space+Grotesk:wght@300;400;500;600&display=swap\" rel=\"stylesheet\"/>\n      <div style={{width:\"100%\",maxWidth: cp === \"landing\" ? \"100%\" : 420,height:\"100vh\",maxHeight: cp === \"landing\" ? \"100%\" : 860,background:GRADIENTS[cp],position:\"relative\",overflow:\"hidden\",transition:\"background 0.8s ease\"}}>\n        {phase>=1&&phase<6&&<PhaseIndicator current={phase-1} phases={PHASES.slice(1,5)}/>}\n        <div key={phase} style={{width:\"100%\",height:\"100%\",animation:\"slideIn 0.4s ease-out\"}}>\n          {cp===\"landing\"&&<LandingPhase onStart={function(){setPhase(1);}}/>}\n          {cp===\"pour\"&&<PourPhase onComplete={function(t){setRawText(t);setPhase(2);}}/>}\n          {cp===\"synthesize\"&&<SynthesizePhase rawText={rawText} onComplete={function(){setPhase(3);}} onSynthesis={setSynthesisData}/>}\n          {cp===\"map\"&&<MapPhase onComplete={function(mapData){setMapResponses(mapData||{});setPhase(4);}} synthesisData={synthesisData} rawText={rawText} onPatchSynthesis={onPatchSynthesis}/>}\n          {cp===\"cosynth\"&&<CoSynthPhase rawText={rawText} synthesisData={synthesisData} mapResponses={mapResponses} onSynthesis={setSynthesisData} onComplete={function(){setPhase(5);}}/>}\n          {cp===\"session\"&&<SessionPhase onComplete={function(sData){setSessionData(sData||{});enterField();}} synthesisData={synthesisData} onPatchSynthesis={onPatchSynthesis}/>}\n          {cp===\"field\"&&<FieldPhase synthesisData={synthesisData} rawText={rawText} mapResponses={mapResponses} sessionData={sessionData}/>}\n          {fieldTransition && <div style={{ position: \"fixed\", inset: 0, zIndex: 999, background: \"#000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", animation: \"morphIn 0.4s ease both\" }}>\n            <div style={{ fontFamily: FB, fontSize: 11, letterSpacing: \"0.4em\", color: \"rgba(255,255,255,0.2)\", textTransform: \"uppercase\", animation: \"pulse 1.5s ease infinite\" }}>entering the field</div>\n          </div>}\n        </div>\n      </div>\n      <style>{`\n        @keyframes slideIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}\n        @keyframes morphIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}\n        @keyframes riseUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}\n        @keyframes pulse{0%,100%{opacity:0.7}50%{opacity:1}}\n        @keyframes spin{to{transform:rotate(360deg)}}\n        @keyframes growWidth{from{width:0%}}\n        @keyframes floatParticle{0%,100%{transform:translateY(0) translateX(0)}33%{transform:translateY(-10px) translateX(5px)}66%{transform:translateY(5px) translateX(-7px)}}\n        @keyframes fieldFloat{0%,100%{transform:translateY(0) translateX(0)}33%{transform:translateY(-12px) translateX(6px)}66%{transform:translateY(6px) translateX(-8px)}}\n        @keyframes floatWord{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}\n        @keyframes connBlink{0%,100%{opacity:0.65;filter:brightness(1)}50%{opacity:1;filter:brightness(1.4)}}\n        @keyframes ringPulse{0%,100%{opacity:0.3;transform:scale(1)}50%{opacity:0.7;transform:scale(1.15)}}\n        @keyframes nodeBreathe{0%,100%{filter:brightness(1)}50%{filter:brightness(1.12)}}\n        @keyframes shaftPulse { 0%,100%{opacity:0.7;transform:skewX(-8deg) scaleX(1)} 50%{opacity:1.4;transform:skewX(-5deg) scaleX(1.3)} }\n    @keyframes breathe{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.7}50%{transform:translate(-50%,-50%) scale(1.15);opacity:1}}\n        @keyframes drawerIn{from{opacity:0;transform:translate(-50%,24px) scale(0.95)}to{opacity:1;transform:translate(-50%,0) scale(1)}}\n        @keyframes sweep{0%,100%{transform:translateX(-100%)}50%{transform:translateX(100%)}}\n        @keyframes fallIn{from{opacity:0;transform:translateY(-18px)}to{opacity:1;transform:translateY(0)}}\n        *{box-sizing:border-box;-webkit-font-smoothing:antialiased}\n        body{margin:0;background:#000;overflow:hidden}\n        textarea::placeholder{color:rgba(255,255,255,0.15)}\n        textarea{caret-color:#6BB8FF}\n        button:active{transform:scale(0.97)}\n        ::-webkit-scrollbar{width:3px}\n        ::-webkit-scrollbar-track{background:transparent}\n        ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}\n      `}</style>\n      <div style={{ position: \"fixed\", bottom: 4, right: 8, fontSize: 9, color: \"rgba(255,255,255,0.35)\", fontFamily: FB, zIndex: 9999, pointerEvents: \"none\" }}>v5.2 | {cp}:{phase}</div>\n    </div>\n  );\n}\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(React.createElement(SAYCRDFlow));\n";
try {
  var compiled = Babel.transform(jsxCode, { presets: ['react'] }).code;
  var s = document.createElement('script');
  s.textContent = compiled;
  document.body.appendChild(s);
} catch(e) {
  document.getElementById('root').innerHTML = '<pre style="color:#ff6b6b;padding:20px;font-size:13px;white-space:pre-wrap">BABEL ERROR:\n' + e.message + '</pre>';
}
</script>
</body>
</html>