<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SAYCRD</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body,#root{width:100%;height:100%;overflow:hidden;background:#000}

    /* ═══ Auth UI ═══ */
    .auth-overlay{position:fixed;inset:0;z-index:99999;display:flex;align-items:center;justify-content:center;background:#060910;padding:1.5rem}
    .auth-card{width:100%;max-width:380px;text-align:center}
    .auth-logo{font-family:'Space Grotesk',sans-serif;font-size:2.4rem;letter-spacing:.5em;color:rgba(244,196,109,.8);text-transform:uppercase;font-weight:700;text-indent:.5em;margin-bottom:.5rem}
    .auth-sub{font-family:'Fraunces',serif;font-size:1rem;color:rgba(247,241,231,.35);margin-bottom:2.5rem;font-weight:300}
    .auth-input{display:block;width:100%;background:rgba(14,17,21,.8);border:1px solid rgba(244,241,234,.1);border-radius:12px;color:rgba(247,241,231,.9);padding:.8rem 1rem;font-family:'Space Grotesk',sans-serif;font-size:.95rem;margin-bottom:.8rem;outline:none;transition:border-color .2s;box-sizing:border-box}
    .auth-input:focus{border-color:rgba(214,178,109,.4)}
    .auth-input::placeholder{color:rgba(244,241,234,.2)}
    .auth-btn{width:100%;padding:.8rem;border-radius:12px;border:1px solid rgba(214,178,109,.4);background:rgba(214,178,109,.08);color:var(--accent,rgba(244,196,109,.9));font-family:'Space Grotesk',sans-serif;font-size:.95rem;font-weight:600;letter-spacing:.08em;cursor:pointer;transition:all .2s;margin-top:.4rem}
    .auth-btn:hover{background:rgba(214,178,109,.15);border-color:rgba(214,178,109,.6)}
    .auth-btn:disabled{opacity:.4;cursor:not-allowed}
    .auth-toggle{margin-top:1.5rem;font-size:.85rem;color:rgba(247,241,231,.3)}
    .auth-toggle a{color:rgba(214,178,109,.6);cursor:pointer;text-decoration:none}
    .auth-toggle a:hover{color:rgba(214,178,109,.9)}
    .auth-error{color:rgba(196,110,95,.8);font-size:.82rem;margin-top:.6rem;min-height:1.2em}
    .auth-divider{display:flex;align-items:center;gap:1rem;margin:1.2rem 0;color:rgba(247,241,231,.15);font-size:.75rem;letter-spacing:.1em;text-transform:uppercase}
    .auth-divider::before,.auth-divider::after{content:"";flex:1;height:1px;background:rgba(244,241,234,.06)}
    .auth-social{width:100%;padding:.7rem;border-radius:12px;border:1px solid rgba(244,241,234,.08);background:transparent;color:rgba(247,241,231,.5);font-family:'Space Grotesk',sans-serif;font-size:.88rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}
    .auth-social:hover{border-color:rgba(244,241,234,.2);color:rgba(247,241,231,.7)}
    .auth-forgot{display:block;text-align:right;font-size:.78rem;color:rgba(214,178,109,.35);cursor:pointer;margin-top:-.3rem;margin-bottom:.5rem}
    .auth-forgot:hover{color:rgba(214,178,109,.6)}
    .auth-hidden{display:none!important}
    .ws-user{font-size:.72rem;color:rgba(247,241,231,.25);cursor:pointer;letter-spacing:.04em}
    .ws-user:hover{color:rgba(247,241,231,.45)}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="auth-overlay" id="auth-overlay">
      <div class="auth-card">
        <div class="auth-logo">SAYCRD</div>
        <div class="auth-sub">clarity, not control</div>

        <!-- Login form -->
        <div id="auth-login">
          <input class="auth-input" type="text" id="auth-email" placeholder="Email" autocomplete="email" />
          <input class="auth-input" type="password" id="auth-password" placeholder="Password" autocomplete="current-password" />
          <span class="auth-forgot" id="auth-forgot" onclick="document.getElementById('auth-login').style.display='none';document.getElementById('auth-reset').style.display='block';">Forgot password?</span>
          <button class="auth-btn" id="auth-login-btn" onclick="
            (async function(){
              var btn=document.getElementById('auth-login-btn');btn.disabled=true;
              var err=document.getElementById('auth-error');err.textContent='';err.style.color='';
              var em=document.getElementById('auth-email').value.trim();
              var pw=document.getElementById('auth-password').value;
              if(!em||!pw){err.textContent='Enter email and password';btn.disabled=false;return;}
              if(em==='local'&&pw==='local'){window._localBypass();return;}
              try{
                var sb=window.sbClient;if(!sb||!sb.auth){err.textContent='Database connecting... try again or use Continue without account';btn.disabled=false;return;}
                var r=await sb.auth.signInWithPassword({email:em,password:pw});
                if(r.error){
                  var msg=r.error.message||'Login failed';
                  if(msg.toLowerCase().indexOf('email not confirmed')!==-1){
                    msg='Check your email for a confirmation link, then try again.';
                    err.style.color='rgba(244,196,109,.7)';
                  } else if(msg.toLowerCase().indexOf('invalid')!==-1){
                    msg='Wrong email or password. Try again or reset below.';
                  }
                  err.textContent=msg;btn.disabled=false;return;
                }
                currentUser=r.data.user;window.currentUser=currentUser;
                sb.auth.getSession().then(function(s){if(s.data.session)window._saycrdToken=s.data.session.access_token;});
                if(window._authResolve)window._authResolve();
                var o=document.getElementById('auth-overlay');o.style.opacity='0';o.style.transition='opacity .4s';setTimeout(function(){o.style.display='none';},400);
                var sn=document.getElementById('ws-signout');if(sn&&r.data.user.email)sn.textContent=r.data.user.email.split('@')[0]+' \u00B7 sign out';
              }catch(e){err.textContent=e.message||'Login failed';btn.disabled=false;}
            })();
          ">Enter</button>
          <div class="auth-error" id="auth-error"></div>
          <div class="auth-divider">or</div>
          <button class="auth-social" id="auth-google" onclick="
            var sb=window.sbClient;if(sb&&sb.auth)sb.auth.signInWithOAuth({provider:'google',options:{redirectTo:window.location.origin}});
          ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Continue with Google
          </button>
          <div class="auth-toggle">No account? <a id="auth-show-signup" onclick="document.getElementById('auth-login').style.display='none';document.getElementById('auth-signup').style.display='block';" style="cursor:pointer">Create one</a></div>
        </div>

        <!-- Signup form -->
        <div id="auth-signup" style="display:none">
          <input class="auth-input" type="email" id="auth-signup-email" placeholder="Email" autocomplete="email" />
          <input class="auth-input" type="password" id="auth-signup-password" placeholder="Password (min 6 chars)" autocomplete="new-password" />
          <button class="auth-btn" id="auth-signup-btn" onclick="
            (async function(){
              var btn=document.getElementById('auth-signup-btn');btn.disabled=true;
              var err=document.getElementById('auth-signup-error');err.textContent='';err.style.color='';
              var em=document.getElementById('auth-signup-email').value.trim();
              var pw=document.getElementById('auth-signup-password').value;
              if(!em||!pw){err.textContent='Enter email and password';btn.disabled=false;return;}
              if(pw.length<6){err.textContent='Password must be at least 6 characters';btn.disabled=false;return;}
              try{
                var sb=window.sbClient;if(!sb||!sb.auth){err.textContent='Database connecting... try Continue without account below';btn.disabled=false;return;}
                var r=await sb.auth.signUp({email:em,password:pw});
                if(r.error){
                  var msg=r.error.message||'Signup failed';
                  if(msg.toLowerCase().indexOf('already registered')!==-1){
                    msg='This email is already registered. Try signing in instead.';
                    err.style.color='rgba(244,196,109,.7)';
                  }
                  err.textContent=msg;btn.disabled=false;return;
                }
                /* Check if email confirmation is required */
                if(r.data.user&&!r.data.user.confirmed_at&&!r.data.session){
                  err.style.color='rgba(125,183,174,.7)';err.textContent='Check your email for a confirmation link, then come back and sign in.';btn.disabled=false;return;
                }
                /* Auto-confirm is on — user is logged in */
                currentUser=r.data.user;window.currentUser=currentUser;
                sb.auth.getSession().then(function(s){if(s.data.session)window._saycrdToken=s.data.session.access_token;});
                if(window._authResolve)window._authResolve();
                var o=document.getElementById('auth-overlay');o.style.opacity='0';o.style.transition='opacity .4s';setTimeout(function(){o.style.display='none';},400);
                var sn=document.getElementById('ws-signout');if(sn&&r.data.user.email)sn.textContent=r.data.user.email.split('@')[0]+' \u00B7 sign out';
              }catch(e){err.textContent=e.message||'Signup failed';btn.disabled=false;}
            })();
          ">Begin</button>
          <div class="auth-error" id="auth-signup-error"></div>
          <div class="auth-toggle">Already have an account? <a id="auth-show-login" onclick="document.getElementById('auth-signup').style.display='none';document.getElementById('auth-login').style.display='block';" style="cursor:pointer">Sign in</a></div>
        </div>

        <!-- Reset form -->
        <div id="auth-reset" style="display:none">
          <input class="auth-input" type="email" id="auth-reset-email" placeholder="Email" autocomplete="email" />
          <button class="auth-btn" id="auth-reset-btn" onclick="
            (async function(){
              var btn=document.getElementById('auth-reset-btn');btn.disabled=true;
              var err=document.getElementById('auth-reset-error');err.textContent='';
              var em=document.getElementById('auth-reset-email').value.trim();
              if(!em){err.textContent='Enter your email';btn.disabled=false;return;}
              try{
                var sb=window.sbClient;if(!sb||!sb.auth){err.textContent='Database offline';btn.disabled=false;return;}
                var r=await sb.auth.resetPasswordForEmail(em,{redirectTo:window.location.origin});
                if(r.error){err.textContent=r.error.message;btn.disabled=false;return;}
                err.style.color='rgba(125,183,174,.7)';err.textContent='Reset link sent \u2014 check your email.';btn.disabled=false;
              }catch(e){err.textContent=e.message||'Reset failed';btn.disabled=false;}
            })();
          ">Send reset link</button>
          <div class="auth-error" id="auth-reset-error"></div>
          <div class="auth-toggle"><a id="auth-show-login-2" onclick="document.getElementById('auth-reset').style.display='none';document.getElementById('auth-login').style.display='block';" style="cursor:pointer">Back to sign in</a></div>
        </div>

        <!-- BYPASS — always visible, inline handler, cannot fail -->
        <div style="margin-top:1.8rem;padding-top:1.2rem;border-top:1px solid rgba(244,241,234,.06)">
          <button id="auth-local-bypass" style="width:100%;padding:.7rem;border-radius:12px;border:1px solid rgba(244,241,234,.06);background:transparent;color:rgba(247,241,231,.3);font-family:'Space Grotesk',sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onclick="window._localBypass();">Continue without account</button>
        </div>
      </div>
    </div>


<div id="root">
<div style="position:fixed;top:10px;right:14px;z-index:99998;padding:5px 12px;font-family:'Space Grotesk',sans-serif;font-size:10px;color:rgba(255,255,255,0.2);cursor:pointer;letter-spacing:0.1em;border:1px solid rgba(255,255,255,0.07);border-radius:999px;background:rgba(0,0,0,0.3);transition:all 0.2s;" onmouseover="this.style.color='rgba(255,255,255,0.5)';this.style.borderColor='rgba(255,255,255,0.15)'" onmouseout="this.style.color='rgba(255,255,255,0.2)';this.style.borderColor='rgba(255,255,255,0.07)'" id="ws-signout">sign out</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

<script>
const SAYCRD_CONFIG = {
  SUPABASE_URL: "https://perataksccqmdocgshyl.supabase.co",
  SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBlcmF0YWtzY2NxbWRvY2dzaHlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NjU3MTEsImV4cCI6MjA4NjM0MTcxMX0.D_y3MF3UyRsyAPRpUWYw5x7fn5i9dCN8xnD5_n_-Nnc",
  API_ENDPOINT: "/api/claude",
};
</script>

<script>
/* ====================================================================
   Supabase Client + Auth
   ==================================================================== */
var sbClient = null;
window.sbClient = null;
var supabaseAvailable = false;
try {
  sbClient = window.supabase.createClient(
    SAYCRD_CONFIG.SUPABASE_URL,
    SAYCRD_CONFIG.SUPABASE_ANON_KEY
  );
  window.sbClient = sbClient;
  supabaseAvailable = true;
  console.log("Supabase client initialized");
} catch(sbInitErr) {
  console.warn("Supabase unavailable:", sbInitErr.message || sbInitErr);
}

var currentUser = null;
window.currentUser = null;

/* ── Storage Adapter (drop-in replacement for window.storage) ── */
/* Saves to Supabase if authenticated + available, otherwise localStorage */
/* AUTH GATE: storage ops wait for auth to resolve before executing */
var _authReady = null;
var _authResolve = null;
_authReady = new Promise(function(resolve) { _authResolve = resolve; });
window._authResolve = _authResolve;
/* Timeout: if auth doesn't resolve in 5s, proceed with whatever we have */
setTimeout(function() { _authResolve(); }, 5000);

function _storageMode() {
  if (currentUser && supabaseAvailable && currentUser.id !== "local-user") return "supabase";
  return "local";
}
function _localGet(key) {
  var uid = (currentUser && currentUser.id) || "local-user";
  var v = localStorage.getItem("saycrd-" + uid + "-" + key);
  if (v === null) return null;
  return { key: key, value: v };
}
function _localSet(key, value) {
  var uid = (currentUser && currentUser.id) || "local-user";
  localStorage.setItem("saycrd-" + uid + "-" + key, value);
  return { key: key, value: value };
}
function _localDelete(key) {
  var uid = (currentUser && currentUser.id) || "local-user";
  localStorage.removeItem("saycrd-" + uid + "-" + key);
  return { key: key, deleted: true };
}
function _localList(prefix) {
  var uid = (currentUser && currentUser.id) || "local-user";
  var pfx = "saycrd-" + uid + "-";
  var keys = [];
  for (var i = 0; i < localStorage.length; i++) {
    var k = localStorage.key(i);
    if (k && k.indexOf(pfx) === 0) {
      var clean = k.slice(pfx.length);
      if (!prefix || clean.indexOf(prefix) === 0) keys.push(clean);
    }
  }
  return { keys: keys };
}

/* ── Sync local data up to Supabase (runs once after auth) ── */
async function _syncLocalToSupabase() {
  if (_storageMode() !== "supabase") return;
  var uid = currentUser.id;
  var pfx = "saycrd-" + uid + "-";
  var synced = 0;
  for (var i = 0; i < localStorage.length; i++) {
    var k = localStorage.key(i);
    if (k && k.indexOf(pfx) === 0) {
      var cleanKey = k.slice(pfx.length);
      var val = localStorage.getItem(k);
      if (!val) continue;
      try {
        /* Check if supabase already has this key */
        var { data } = await sbClient.from("user_data").select("key").eq("user_id", uid).eq("key", cleanKey).limit(1);
        if (!data || data.length === 0) {
          /* Supabase doesn't have it — push local up */
          var parsed; try { parsed = JSON.parse(val); } catch(e) { parsed = val; }
          await sbClient.from("user_data").upsert({ user_id: uid, key: cleanKey, value: parsed }, { onConflict: "user_id,key" });
          synced++;
        }
      } catch(e) { /* skip silently */ }
    }
  }
  if (synced > 0) console.log("Synced " + synced + " local keys to Supabase");
}

window.storage = {
  async get(key) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    if (_storageMode() === "local") return _localGet(key);
    try {
      const { data, error } = await sbClient
        .from("user_data")
        .select("key, value")
        .eq("user_id", currentUser.id)
        .eq("key", key)
        .limit(1);
      if (error) { console.warn("Supabase get error for '" + key + "':", error.message); return _localGet(key); }
      var row = data && data.length > 0 ? data[0] : null;
      if (row) {
        /* Got from Supabase — also update local cache */
        var val = JSON.stringify(row.value);
        _localSet(key, val);
        return { key: row.key, value: val };
      }
      /* Supabase returned nothing — check if local has it (migration case) */
      var local = _localGet(key);
      if (local && local.value) {
        /* Push local data up to Supabase */
        try {
          var parsed; try { parsed = JSON.parse(local.value); } catch(e) { parsed = local.value; }
          await sbClient.from("user_data").upsert({ user_id: currentUser.id, key: key, value: parsed }, { onConflict: "user_id,key" });
          console.log("Migrated '" + key + "' from local to Supabase");
        } catch(e) { /* migration failed, no big deal */ }
        return local;
      }
      return null;
    } catch(e) { console.warn("Supabase get failed for '" + key + "':", e); return _localGet(key); }
  },

  async set(key, value) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    /* Always write to localStorage as backup */
    _localSet(key, value);
    if (_storageMode() === "local") return { key: key, value: value };
    try {
      let parsed;
      try { parsed = JSON.parse(value); } catch(e) { parsed = value; }
      const { error } = await sbClient
        .from("user_data")
        .upsert({
          user_id: currentUser.id,
          key: key,
          value: parsed
        }, { onConflict: "user_id,key" });
      if (error) { console.warn("Supabase set error for '" + key + "':", error.message); }
      return { key: key, value: value };
    } catch(e) { console.warn("Supabase set failed for '" + key + "':", e); return { key: key, value: value }; }
  },

  async delete(key) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    _localDelete(key);
    if (_storageMode() === "local") return { key: key, deleted: true };
    try {
      const { error } = await sbClient
        .from("user_data")
        .delete()
        .eq("user_id", currentUser.id)
        .eq("key", key);
      if (error) console.warn("Supabase delete error:", error.message);
    } catch(e) { console.warn("Supabase delete failed:", e); }
    return { key: key, deleted: true };
  },

  async list(prefix) {
    await _authReady;
    if (!currentUser) throw new Error("Not authenticated");
    if (_storageMode() === "local") return _localList(prefix);
    try {
      let query = sbClient
        .from("user_data")
        .select("key")
        .eq("user_id", currentUser.id);
      if (prefix) query = query.like("key", prefix + "%");
      const { data, error } = await query;
      if (error) { console.warn("Supabase list error:", error.message); return _localList(prefix); }
      return { keys: (data || []).map(function(d) { return d.key; }) };
    } catch(e) { console.warn("Supabase list failed:", e); return _localList(prefix); }
  }
};

/* ====================================================================
   FAILSAFE BYPASS — works even if Supabase is completely broken
   ==================================================================== */
window._localBypass = function() {
  currentUser = { id: "local-user", email: "local@saycrd" };
  window.currentUser = currentUser;
  if (_authResolve) _authResolve();
  /* storage already handles local mode via _storageMode() check */
  var overlay = document.getElementById("auth-overlay");
  if (overlay) {
    overlay.style.opacity = "0";
    overlay.style.transition = "opacity .4s ease";
    setTimeout(function() { overlay.style.display = "none"; }, 400);
  }
  var signoutEl = document.getElementById("ws-signout");
  if (signoutEl) signoutEl.textContent = "local \u00B7 sign out";
  console.log("LOCAL BYPASS ACTIVE — using localStorage");
};

/* ── Auth: restore session + sign out (all form handlers are inline in HTML) ── */
(function() {
  try {
    if (sbClient && sbClient.auth) {
      sbClient.auth.getSession().then(function(result) {
        if (result.data.session) {
          currentUser = result.data.session.user;
          window.currentUser = currentUser;
          window._saycrdToken = result.data.session.access_token;
          var o = document.getElementById("auth-overlay");
          if (o) { o.style.opacity = "0"; o.style.transition = "opacity .4s"; setTimeout(function(){ o.style.display = "none"; }, 400); }
          var sn = document.getElementById("ws-signout");
          if (sn && currentUser.email) sn.textContent = currentUser.email.split("@")[0] + " \u00B7 sign out";
          console.log("Session restored for:", currentUser.email);
          /* Resolve auth gate so storage ops proceed */
          if (_authResolve) _authResolve();
          /* Sync any local-only data up to Supabase */
          _syncLocalToSupabase().catch(function(e) { console.warn("Sync failed:", e); });
        } else {
          /* No session — resolve gate anyway so local mode works */
          if (_authResolve) _authResolve();
        }
      }).catch(function(e) {
        console.warn("Session restore failed:", e);
        if (_authResolve) _authResolve();
      });

      sbClient.auth.onAuthStateChange(function(event, session) {
        if (session && session.user) {
          currentUser = session.user;
          window.currentUser = currentUser;
          window._saycrdToken = session.access_token;
          var o = document.getElementById("auth-overlay");
          if (o) { o.style.opacity = "0"; o.style.transition = "opacity .4s"; setTimeout(function(){ o.style.display = "none"; }, 400); }
          var sn = document.getElementById("ws-signout");
          if (sn && session.user.email) sn.textContent = session.user.email.split("@")[0] + " \u00B7 sign out";
          /* Resolve auth gate on sign-in too */
          if (_authResolve) _authResolve();
          /* Sync local data after fresh sign-in */
          if (event === "SIGNED_IN") {
            _syncLocalToSupabase().catch(function(e) { console.warn("Sync failed:", e); });
          }
        }
      });
    } else {
      /* No supabase — resolve immediately */
      if (_authResolve) _authResolve();
    }
  } catch(e) {
    console.warn("Auth init:", e);
    if (_authResolve) _authResolve();
  }

  /* Sign out */
  document.getElementById("ws-signout")?.addEventListener("click", async function() {
    try { if (sbClient && sbClient.auth) await sbClient.auth.signOut(); } catch(e) {}
    currentUser = null;
    window.currentUser = null;
    var o = document.getElementById("auth-overlay");
    if (o) { o.style.display = ""; o.style.opacity = "1"; }
  });
})();


</script>

<script>
var jsxCode = "const { useState, useEffect, useRef, useCallback, useMemo } = React;\n\n// AI helpers\nvar _lastCallTime = 0;\nvar _CLAUDE_KEY = \"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\";\nasync function callClaude(sys, usr, max) {\n  try {\n    var now = Date.now(), gap = now - _lastCallTime;\n    if (gap < 800) await new Promise(function(r) { setTimeout(r, 800 - gap); });\n    _lastCallTime = Date.now();\n\n    var maxInput = 18000;\n    if ((sys.length + (usr||\"\").length) > maxInput) usr = (usr||\"\").slice(0, maxInput - sys.length);\n\n    var body = JSON.stringify({ model: \"claude-sonnet-4-20250514\", max_tokens: max || 1000,\n      messages: [{ role: \"user\", content: sys + \"\\n\\n---\\n\\nUser text:\\n\\n\" + (usr || \"\") }] });\n\n    console.log(\"[SAYCRD] API call:\", body.length, \"chars\");\n\n    // Try /api/claude proxy first, then direct with key\n    var r;\n    try {\n      r = await fetch(\"/api/claude\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: body });\n      if (!r.ok && r.status !== 429) throw new Error(\"proxy \" + r.status);\n    } catch (e) {\n      console.log(\"[SAYCRD] Proxy unavailable, using direct API\");\n      r = await fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-api-key\": _CLAUDE_KEY,\n          \"anthropic-version\": \"2023-06-01\",\n          \"anthropic-dangerous-direct-browser-access\": \"true\"\n        },\n        body: body\n      });\n    }\n\n    if (r.status === 429) {\n      console.log(\"[SAYCRD] Rate limited, retry in 3s\");\n      await new Promise(function(w) { setTimeout(w, 3000); });\n      r = await fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-api-key\": _CLAUDE_KEY,\n          \"anthropic-version\": \"2023-06-01\",\n          \"anthropic-dangerous-direct-browser-access\": \"true\"\n        },\n        body: body\n      });\n    }\n\n    if (!r.ok) {\n      var errText = await r.text().catch(function() { return \"\"; });\n      console.error(\"[SAYCRD] API error:\", r.status, errText.slice(0, 200));\n      return \"\";\n    }\n\n    var d = await r.json();\n    var result = (d.content || []).map(function(b) { return b.text || \"\"; }).join(\"\\n\");\n    console.log(\"[SAYCRD] Response:\", result.length, \"chars\");\n    return result;\n  } catch (e) { console.error(\"[SAYCRD] API error:\", e); return \"\"; }\n}\nfunction parseJSON(raw) {\n  if (!raw) return null;\n  try { var c = raw.replace(/```json|```/g, \"\").trim(); var m = c.match(/\\{[\\s\\S]*\\}/) || c.match(/\\[[\\s\\S]*\\]/); return m ? JSON.parse(m[0]) : null; } catch (e) { return null; }\n}\nvar NC = [\"#FF6B9D\",\"#FFB86B\",\"#6BFFB8\",\"#6BB8FF\",\"#B86BFF\",\"#FFD700\",\"#E84393\",\"#7DB7AE\"];\n\nconst FD = \"'DM Serif Display', Georgia, serif\";\nconst FB = \"'DM Sans', sans-serif\";\nconst PHASES = [\"landing\", \"pour\", \"synthesize\", \"map\", \"session\", \"field\"];\nconst GRADIENTS = {\n  landing: \"#000\",\n  pour: \"linear-gradient(160deg, #0A0A2E 0%, #1A1A4B 40%, #2D1B6B 100%)\",\n  synthesize: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, #E84393 100%)\",\n  map: \"linear-gradient(160deg, #060810 0%, #0B1020 40%, #111830 100%)\",\n  session: \"linear-gradient(160deg, #0A0A1E 0%, #1A1A3B 40%, #2D1B5B 100%)\",\n  field: \"#000\",\n};\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 SHARED COMPONENTS \u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction FloatingWords({ words, color = \"#6BB8FF\" }) {\n  const v = Array.from(new Set(words.filter(function(w){ return w.length > 4; }))).slice(-12);\n  if (!v.length) return null;\n  return <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\", zIndex: 0 }}>\n    {v.map((w, i) => <span key={\"\"+w+\"-\"+i} style={{ position: \"absolute\", left: `${10+(i/Math.max(v.length-1,1))*80}%`, top: `${45+(Math.sin(i*0.8)*15+(i%3)*10)}%`, fontSize: 13+(i%3)*2, color, opacity: 0.04+(i/v.length)*0.08, fontFamily: FD, fontStyle: \"italic\", animation: `floatWord ${18+(i%4)*3}s ease-in-out infinite`, animationDelay: `${-i*1.5}s`, whiteSpace: \"nowrap\" }}>{w}</span>)}\n  </div>;\n}\n\nfunction Particles({ color, count = 20 }) {\n  return <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\" }}>\n    {Array.from({length:count}).map((_,i) => { const s=(i*37+13)%100; return <div key={i} style={{ position: \"absolute\", left: `${s}%`, top: `${(s*53)%100}%`, width: 2+(s%4), height: 2+(s%4), borderRadius: \"50%\", background: color, opacity: 0.12+(s%20)*0.015, animation: `floatParticle ${5+s%6}s ease-in-out infinite`, animationDelay: `${-(s%5)}s` }}/>; })}\n  </div>;\n}\n\n// \u2550\u2550\u2550 LIVING IMAGERY \u2014 Imaginal Cells & Season Tree \u2550\u2550\u2550\n\n// ImaginalCells: the chrysalis from inside.\n// Imaginal cells are the blueprint of the butterfly \u2014 they exist inside the caterpillar\n// and the caterpillar's immune system tries to destroy them.\n// When there are enough, they win. The caterpillar dissolves. The butterfly forms.\n// Stage determines ratio of imaginal (glowing, colored) to incumbent (grey, hexagonal) cells.\nfunction ImaginalCells({ stage, velocity, color }) {\n  var ratios = { nigredo: 0.18, albedo: 0.42, citrinitas: 0.70, rubedo: 0.92 };\n  var imaginalRatio = ratios[stage] || 0.3;\n  var N = 30;\n  var seed = 54321;\n  function rng() { seed = (seed * 1664525 + 1013904223) & 0x7FFFFFFF; return seed / 0x7FFFFFFF; }\n  var cells = [];\n  for (var i2 = 0; i2 < N; i2++) {\n    var angle = rng() * Math.PI * 2;\n    var dist = rng() * 52 + 6;\n    var cx2 = 130 + Math.cos(angle) * dist;\n    var cy2 = 105 + Math.sin(angle) * dist * 0.72;\n    var isIm = i2 < Math.floor(N * imaginalRatio);\n    var sz = isIm ? (rng() * 5 + 4) : (rng() * 4 + 2.5);\n    var dur = (rng() * 3 + 2.5).toFixed(2);\n    var del = (rng() * 5).toFixed(2);\n    var dx = ((rng() - 0.5) * 5).toFixed(2);\n    var dy = ((rng() - 0.5) * 4).toFixed(2);\n    cells.push({ cx: cx2, cy: cy2, isIm, sz, dur, del, dx, dy, id: i2 });\n  }\n  var showWings = stage === \"rubedo\" || stage === \"citrinitas\";\n  var wingOpacity = stage === \"rubedo\" ? 0.4 : 0.18;\n  return (\n    <svg viewBox=\"0 0 260 210\" style={{ width: \"100%\", maxWidth: 290, display: \"block\" }}>\n      <defs>\n        <radialGradient id=\"ig_bg\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n          <stop offset=\"0%\" stopColor={color} stopOpacity=\"0.07\"/>\n          <stop offset=\"100%\" stopColor={color} stopOpacity=\"0\"/>\n        </radialGradient>\n        <filter id=\"ig_glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2.5\" result=\"blur\"/>\n          <feMerge><feMergeNode in=\"blur\"/><feMergeNode in=\"SourceGraphic\"/></feMerge>\n        </filter>\n        <filter id=\"ig_softglow\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"6\"/>\n        </filter>\n      </defs>\n\n      {/* Ambient glow */}\n      <ellipse cx=\"130\" cy=\"105\" rx=\"90\" ry=\"72\" fill=\"url(#ig_bg)\"/>\n\n      {/* Chrysalis \u2014 breathing outer shell */}\n      {[1.0, 1.12, 1.24].map(function(scale, si) {\n        return (\n          <ellipse key={si} cx=\"130\" cy=\"105\" rx={72 * scale} ry={58 * scale}\n            fill=\"none\" stroke={color} strokeWidth={si === 0 ? 1.2 : 0.5} strokeOpacity={si === 0 ? 0.22 : 0.06}>\n            <animate attributeName=\"rx\" values={72*scale+\";\"+74*scale+\";\"+72*scale} dur={(4+si)+\"s\"} repeatCount=\"indefinite\"/>\n            <animate attributeName=\"ry\" values={58*scale+\";\"+60*scale+\";\"+58*scale} dur={(4+si)+\"s\"} repeatCount=\"indefinite\"/>\n          </ellipse>\n        );\n      })}\n\n      {/* Suspension thread */}\n      <path d=\"M 130 45 Q 133 32 131 20\" stroke={color} strokeWidth=\"1.4\" fill=\"none\" strokeOpacity=\"0.3\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 130 45 Q 133 32 131 20;M 130 45 Q 127 32 132 20;M 130 45 Q 133 32 131 20\" dur=\"3.5s\" repeatCount=\"indefinite\"/>\n      </path>\n\n      {/* CELLS */}\n      {cells.map(function(cell) {\n        if (!cell.isIm) {\n          var pts = [0,1,2,3,4,5].map(function(j) {\n            var a = j * Math.PI / 3 + 0.2;\n            return (cell.cx + Math.cos(a) * cell.sz).toFixed(1) + \",\" + (cell.cy + Math.sin(a) * cell.sz).toFixed(1);\n          }).join(\" \");\n          return (\n            <polygon key={cell.id} points={pts}\n              fill=\"rgba(190,180,168,0.14)\" stroke=\"rgba(210,200,188,0.28)\" strokeWidth=\"0.5\">\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+cell.dx+\",\"+cell.dy+\";0,0\"} dur={cell.dur+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animate attributeName=\"opacity\" values=\"0.7;0.3;0.7\" dur={(parseFloat(cell.dur)*1.4).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n            </polygon>\n          );\n        }\n        return (\n          <g key={cell.id} filter=\"url(#ig_glow)\">\n            <circle cx={cell.cx} cy={cell.cy} r={cell.sz} fill={color} fillOpacity=\"0.45\">\n              <animate attributeName=\"r\" values={cell.sz+\";\"+(cell.sz*1.35)+\";\"+cell.sz} dur={cell.dur+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animate attributeName=\"fill-opacity\" values=\"0.4;0.8;0.4\" dur={cell.dur+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+cell.dx+\",\"+cell.dy+\";0,0\"} dur={(parseFloat(cell.dur)*0.9).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            <circle cx={cell.cx} cy={cell.cy} r={cell.sz * 0.42} fill={color} fillOpacity=\"0.95\">\n              <animate attributeName=\"r\" values={cell.sz*0.42+\";\"+(cell.sz*0.56)+\";\"+cell.sz*0.42} dur={(parseFloat(cell.dur)*0.7).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+cell.dx+\",\"+cell.dy+\";0,0\"} dur={(parseFloat(cell.dur)*0.9).toFixed(1)+\"s\"} begin={cell.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n          </g>\n        );\n      })}\n\n      {/* Wing shapes forming \u2014 visible at citrinitas and rubedo */}\n      {showWings && (\n        <g opacity={wingOpacity}>\n          <filter id=\"wingBlur\"><feGaussianBlur stdDeviation=\"3\"/></filter>\n          <path d=\"M 130 108 Q 94 82 76 100 Q 62 118 88 132 Q 112 140 130 120\"\n            fill={color} fillOpacity=\"0.22\" stroke={color} strokeWidth=\"1\" strokeOpacity=\"0.5\">\n            <animate attributeName=\"d\"\n              values=\"M 130 108 Q 94 82 76 100 Q 62 118 88 132 Q 112 140 130 120;M 130 108 Q 92 79 74 97 Q 60 115 86 129 Q 110 137 130 117;M 130 108 Q 94 82 76 100 Q 62 118 88 132 Q 112 140 130 120\"\n              dur=\"3.2s\" repeatCount=\"indefinite\"/>\n          </path>\n          <path d=\"M 130 108 Q 166 82 184 100 Q 198 118 172 132 Q 148 140 130 120\"\n            fill={color} fillOpacity=\"0.22\" stroke={color} strokeWidth=\"1\" strokeOpacity=\"0.5\">\n            <animate attributeName=\"d\"\n              values=\"M 130 108 Q 166 82 184 100 Q 198 118 172 132 Q 148 140 130 120;M 130 108 Q 168 79 186 97 Q 200 115 174 129 Q 150 137 130 117;M 130 108 Q 166 82 184 100 Q 198 118 172 132 Q 148 140 130 120\"\n              dur=\"3.2s\" repeatCount=\"indefinite\"/>\n          </path>\n        </g>\n      )}\n    </svg>\n  );\n}\n\n// SeasonTree: the tree as psychological symbol.\n// Roots visible \u2014 the underground work. Crown showing the season.\n// Spring = citrinitas (first buds, golden light rising).\n// Summer = rubedo (full bloom, leaves moving, alive).\nfunction SeasonTree({ stage, velocity, color }) {\n  var isSummer = stage === \"rubedo\";\n  var leafCount = isSummer ? 38 : 16;\n  var seed = 77665;\n  function rng() { seed = (seed * 1664525 + 1013904223) & 0x7FFFFFFF; return seed / 0x7FFFFFFF; }\n  var leaves = [];\n  for (var i3 = 0; i3 < leafCount; i3++) {\n    var t = rng();\n    var branchAngle = (t - 0.5) * Math.PI * 0.85;\n    var dist2 = rng() * 52 + 20;\n    var lx = 130 + Math.sin(branchAngle) * dist2;\n    var ly = 80 - Math.cos(branchAngle) * dist2 * 0.88 + rng() * 18;\n    var lr = isSummer ? (rng() * 11 + 7) : (rng() * 4 + 2.5);\n    var ldur = (rng() * 2.5 + 2.2).toFixed(2);\n    var ldel = (rng() * 5).toFixed(2);\n    var ldx = ((rng() - 0.5) * 4).toFixed(2);\n    leaves.push({ lx, ly, lr, ldur, ldel, ldx, id: i3 });\n  }\n  var branches = [\n    { d: \"M 130 130 Q 107 115 90 122\", w: 2.8, side: -1, pivot: \"90 130\" },\n    { d: \"M 130 115 Q 153 96 170 100\", w: 2.4, side: 1, pivot: \"170 130\" },\n    { d: \"M 130 100 Q 110 80 97 83\", w: 2.0, side: -1, pivot: \"97 130\" },\n    { d: \"M 130 88 Q 150 70 162 73\", w: 1.7, side: 1, pivot: \"162 130\" },\n    { d: \"M 130 78 Q 124 60 121 52\", w: 1.4, side: -0.5, pivot: \"121 130\" },\n    { d: \"M 130 78 Q 136 62 139 54\", w: 1.2, side: 0.5, pivot: \"139 130\" },\n  ];\n  return (\n    <svg viewBox=\"0 0 260 210\" style={{ width: \"100%\", maxWidth: 290, display: \"block\" }}>\n      <defs>\n        <radialGradient id=\"st_groundglow\" cx=\"50%\" cy=\"90%\" r=\"50%\">\n          <stop offset=\"0%\" stopColor={color} stopOpacity=\"0.14\"/>\n          <stop offset=\"100%\" stopColor={color} stopOpacity=\"0\"/>\n        </radialGradient>\n        <radialGradient id=\"st_crownGlow\" cx=\"50%\" cy=\"40%\" r=\"55%\">\n          <stop offset=\"0%\" stopColor={color} stopOpacity=\"0.07\"/>\n          <stop offset=\"100%\" stopColor={color} stopOpacity=\"0\"/>\n        </radialGradient>\n        <filter id=\"st_glow\" x=\"-60%\" y=\"-60%\" width=\"220%\" height=\"220%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" result=\"b\"/>\n          <feMerge><feMergeNode in=\"b\"/><feMergeNode in=\"SourceGraphic\"/></feMerge>\n        </filter>\n      </defs>\n\n      {/* Ground glow */}\n      <ellipse cx=\"130\" cy=\"182\" rx=\"72\" ry=\"18\" fill=\"url(#st_groundglow)\">\n        <animate attributeName=\"rx\" values=\"70;78;70\" dur=\"5s\" repeatCount=\"indefinite\"/>\n      </ellipse>\n\n      {/* Crown ambient glow */}\n      <ellipse cx=\"130\" cy=\"88\" rx={isSummer ? 72 : 45} ry={isSummer ? 60 : 38} fill=\"url(#st_crownGlow)\">\n        <animate attributeName=\"rx\" values={isSummer?\"70;78;70\":\"43;50;43\"} dur=\"4.5s\" repeatCount=\"indefinite\"/>\n        <animate attributeName=\"ry\" values={isSummer?\"58;66;58\":\"36;44;36\"} dur=\"4.5s\" repeatCount=\"indefinite\"/>\n      </ellipse>\n\n      {/* Roots */}\n      {[[-1.3,1.0,18], [-0.6,0.95,14], [0.2,1.0,14], [0.9,0.95,16], [1.5,1.05,18]].map(function(r, ri) {\n        var endX = (130 + r[0] * r[2]).toFixed(1);\n        var endY = (180 + r[1] * 14).toFixed(1);\n        var ctrlX = (130 + r[0] * 10).toFixed(1);\n        var ctrlY = (172 + r[1] * 6).toFixed(1);\n        return (\n          <path key={ri} d={\"M 130 168 Q \"+ctrlX+\" \"+ctrlY+\" \"+endX+\" \"+endY}\n            stroke={color} strokeWidth=\"1.2\" fill=\"none\" strokeOpacity=\"0.18\" strokeLinecap=\"round\">\n            <animate attributeName=\"stroke-opacity\" values=\"0.12;0.25;0.12\" dur={(2.5+ri*0.6)+\"s\"} begin={(ri*0.4)+\"s\"} repeatCount=\"indefinite\"/>\n          </path>\n        );\n      })}\n\n      {/* Trunk */}\n      <path d=\"M 126 168 Q 128 135 129 110 Q 130 82 130 60\"\n        stroke=\"rgba(180,155,110,0.4)\" strokeWidth=\"6\" fill=\"none\" strokeLinecap=\"round\"/>\n      <path d=\"M 134 168 Q 132 135 131 110 Q 130 82 130 60\"\n        stroke=\"rgba(155,130,90,0.22)\" strokeWidth=\"3.5\" fill=\"none\" strokeLinecap=\"round\"/>\n\n      {/* Branches with gentle sway */}\n      {branches.map(function(b, bi) {\n        return (\n          <path key={bi} d={b.d} stroke=\"rgba(180,155,110,0.32)\" strokeWidth={b.w} fill=\"none\" strokeLinecap=\"round\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\"\n              values={\"0 130 160;\"+b.side*1.8+\" 130 160;0 130 160\"}\n              dur={(3.5+bi*0.7)+\"s\"} begin={(bi*0.5)+\"s\"} repeatCount=\"indefinite\"/>\n          </path>\n        );\n      })}\n\n      {/* Leaves */}\n      {leaves.map(function(leaf) {\n        if (!isSummer) {\n          // Spring buds \u2014 small, first light\n          return (\n            <g key={leaf.id} filter=\"url(#st_glow)\">\n              <circle cx={leaf.lx} cy={leaf.ly} r={leaf.lr} fill={color} fillOpacity=\"0.6\">\n                <animate attributeName=\"r\" values={leaf.lr+\";\"+(leaf.lr*1.5)+\";\"+leaf.lr} dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n                <animate attributeName=\"fill-opacity\" values=\"0.5;0.85;0.5\" dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n              </circle>\n            </g>\n          );\n        }\n        return (\n          <g key={leaf.id}>\n            <circle cx={leaf.lx} cy={leaf.ly} r={leaf.lr} fill={color} fillOpacity=\"0.42\">\n              <animate attributeName=\"fill-opacity\" values=\"0.38;0.55;0.38\" dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\"\n                values={\"0,0;\"+leaf.ldx+\",\"+(parseFloat(leaf.ldx)*0.5)+\";0,0\"}\n                dur={leaf.ldur+\"s\"} begin={leaf.ldel+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n          </g>\n        );\n      })}\n\n      {/* Rising light particles */}\n      {[0,1,2,3,4].map(function(pi) {\n        var px = (108 + pi * 10).toFixed(0);\n        return (\n          <circle key={pi} cx={px} cy=\"155\" r=\"1.5\" fill={color} fillOpacity=\"0\">\n            <animate attributeName=\"cy\" values=\"155;70\" dur={(3.2+pi*0.7)+\"s\"} begin={(pi*1.1)+\"s\"} repeatCount=\"indefinite\"/>\n            <animate attributeName=\"fill-opacity\" values=\"0;0.5;0\" dur={(3.2+pi*0.7)+\"s\"} begin={(pi*1.1)+\"s\"} repeatCount=\"indefinite\"/>\n          </circle>\n        );\n      })}\n    </svg>\n  );\n}\n\n// \u2550\u2550\u2550 CUSTOM ARCHETYPE PORTRAIT \u2550\u2550\u2550\n// Built entirely from this person's data.\n// source_nodes are the themes the AI said this archetype emerged from.\n// Each node's color comes from their actual theme colors.\n// The forces orbit, pulse, converge \u2014 then the archetype name crystallises from them.\nfunction CustomArchViz({ archName, sourceNodes, themeColors, alchColor }) {\n  var nodes = (sourceNodes || []).slice(0, 4);\n  if (nodes.length === 0) nodes = [\"something\", \"unnamed\"];\n  var nodeCount = nodes.length;\n\n  // Seed deterministically from archName so same archetype = same layout\n  var seed = 0;\n  for (var si = 0; si < (archName || \"\").length; si++) seed = (seed * 31 + (archName || \"\").charCodeAt(si)) & 0x7FFFFFFF;\n  function rng() { seed = (seed * 1664525 + 1013904223) & 0x7FFFFFFF; return seed / 0x7FFFFFFF; }\n\n  // Position nodes in a loose orbit around centre (cx=130, cy=110)\n  var nodeData = nodes.map(function(n, ni) {\n    var baseAngle = (ni / nodeCount) * Math.PI * 2 - Math.PI / 2 + rng() * 0.4;\n    var dist = 54 + rng() * 24;\n    var cx = 130 + Math.cos(baseAngle) * dist;\n    var cy = 110 + Math.sin(baseAngle) * dist * 0.78;\n    var col = themeColors[n.toLowerCase()] || themeColors[n] || alchColor || \"#B86BFF\";\n    var r = 14 + rng() * 10;\n    var dur = (2.8 + rng() * 2.5).toFixed(2);\n    var del = (rng() * 4).toFixed(2);\n    var dx = ((rng() - 0.5) * 6).toFixed(2);\n    var dy = ((rng() - 0.5) * 4).toFixed(2);\n    return { n, col, cx, cy, r, dur, del, dx, dy };\n  });\n\n  // Connection lines between nodes \u2014 the web of forces\n  var lines = [];\n  for (var li = 0; li < nodeData.length; li++) {\n    for (var lj = li + 1; lj < nodeData.length; lj++) {\n      lines.push({ x1: nodeData[li].cx, y1: nodeData[li].cy, x2: nodeData[lj].cx, y2: nodeData[lj].cy,\n        col: nodeData[li].col, dur: (3.5 + li * 0.8).toFixed(2), del: (li * 0.6).toFixed(2) });\n    }\n  }\n\n  return (\n    <svg viewBox=\"0 0 260 210\" style={{ width: \"100%\", maxWidth: 290, display: \"block\" }}>\n      <defs>\n        <filter id=\"cav_glow\" x=\"-60%\" y=\"-60%\" width=\"220%\" height=\"220%\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"3\" result=\"b\"/>\n          <feMerge><feMergeNode in=\"b\"/><feMergeNode in=\"SourceGraphic\"/></feMerge>\n        </filter>\n        <filter id=\"cav_softglow\">\n          <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"8\"/>\n        </filter>\n      </defs>\n\n      {/* Soft ambient halo behind each node */}\n      {nodeData.map(function(nd, i) {\n        return (\n          <circle key={\"halo\"+i} cx={nd.cx} cy={nd.cy} r={nd.r * 2.8} fill={nd.col} fillOpacity=\"0.05\"\n            filter=\"url(#cav_softglow)\">\n            <animate attributeName=\"r\" values={nd.r*2.8+\";\"+(nd.r*3.4)+\";\"+nd.r*2.8} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n          </circle>\n        );\n      })}\n\n      {/* Connection lines \u2014 pulsing */}\n      {lines.map(function(l, li) {\n        return (\n          <line key={\"l\"+li} x1={l.x1} y1={l.y1} x2={l.x2} y2={l.y2}\n            stroke={l.col} strokeWidth=\"0.7\" strokeOpacity=\"0.18\">\n            <animate attributeName=\"stroke-opacity\" values=\"0.1;0.3;0.1\" dur={l.dur+\"s\"} begin={l.del+\"s\"} repeatCount=\"indefinite\"/>\n          </line>\n        );\n      })}\n\n      {/* Central convergence point \u2014 where they all meet */}\n      <circle cx=\"130\" cy=\"110\" r=\"3\" fill=\"white\" fillOpacity=\"0.35\">\n        <animate attributeName=\"r\" values=\"3;6;3\" dur=\"4s\" repeatCount=\"indefinite\"/>\n        <animate attributeName=\"fill-opacity\" values=\"0.2;0.55;0.2\" dur=\"4s\" repeatCount=\"indefinite\"/>\n      </circle>\n      {/* Outer ring */}\n      <circle cx=\"130\" cy=\"110\" r=\"22\" fill=\"none\" stroke=\"rgba(255,255,255,0.06)\" strokeWidth=\"0.8\">\n        <animate attributeName=\"r\" values=\"20;26;20\" dur=\"5s\" repeatCount=\"indefinite\"/>\n      </circle>\n\n      {/* Force nodes \u2014 each a circle with the theme name */}\n      {nodeData.map(function(nd, i) {\n        var label = nd.n.toUpperCase();\n        return (\n          <g key={\"n\"+i} filter=\"url(#cav_glow)\">\n            {/* Outer orbit ring */}\n            <circle cx={nd.cx} cy={nd.cy} r={nd.r + 6} fill=\"none\" stroke={nd.col} strokeWidth=\"0.5\" strokeOpacity=\"0.18\">\n              <animate attributeName=\"r\" values={(nd.r+5)+\";\"+(nd.r+10)+\";\"+((nd.r+5))} dur={(parseFloat(nd.dur)*1.3).toFixed(1)+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            {/* Core */}\n            <circle cx={nd.cx} cy={nd.cy} r={nd.r} fill={nd.col} fillOpacity=\"0.28\">\n              <animate attributeName=\"fill-opacity\" values=\"0.22;0.4;0.22\" dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            {/* Inner dot */}\n            <circle cx={nd.cx} cy={nd.cy} r={nd.r * 0.3} fill={nd.col} fillOpacity=\"0.9\">\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n            </circle>\n            {/* Label */}\n            <text x={nd.cx} y={nd.cy + nd.r + 14} textAnchor=\"middle\" fontSize=\"7.5\"\n              fill={nd.col} fillOpacity=\"0.7\" fontFamily=\"'DM Sans', sans-serif\" letterSpacing=\"0.12em\">\n              <animateTransform attributeName=\"transform\" type=\"translate\" values={\"0,0;\"+nd.dx+\",\"+nd.dy+\";0,0\"} dur={nd.dur+\"s\"} begin={nd.del+\"s\"} repeatCount=\"indefinite\"/>\n              {label}\n            </text>\n          </g>\n        );\n      })}\n    </svg>\n  );\n}\n\nfunction FieldParticles({ color, count = 20 }) {\n  const particles = useMemo(() =>\n    Array.from({ length: count }).map(() => ({\n      left: Math.random() * 100,\n      top: Math.random() * 100,\n      size: 2 + Math.random() * 3,\n      opacity: 0.15 + Math.random() * 0.25,\n      dur: 4 + Math.random() * 6,\n      delay: Math.random() * 5,\n    })), [count]);\n  return (\n    <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\" }}>\n      {particles.map((p, i) => (\n        <div key={i} style={{\n          position: \"absolute\", left: `${p.left}%`, top: `${p.top}%`,\n          width: p.size, height: p.size, borderRadius: \"50%\",\n          background: color, opacity: p.opacity,\n          animation: `fieldFloat ${p.dur}s ease-in-out infinite`,\n          animationDelay: `${p.delay}s`,\n        }} />\n      ))}\n    </div>\n  );\n}\n\nfunction BreathingOrb({ color, size = 80 }) {\n  return <svg viewBox=\"0 0 160 160\" style={{ width: size, height: size }}>\n    {[50,40,30,20].map((r,i) => <circle key={i} cx=\"80\" cy=\"80\" r={r} fill=\"none\" stroke={color} strokeWidth={i===3?2:0.8} opacity={0.08+i*0.06}><animate attributeName=\"r\" values={`${r};${r+5};${r}`} dur={`${3+i*0.4}s`} repeatCount=\"indefinite\"/></circle>)}\n    <circle cx=\"80\" cy=\"80\" r=\"6\" fill={color} opacity=\"0.7\"><animate attributeName=\"r\" values=\"6;8;6\" dur=\"2.5s\" repeatCount=\"indefinite\"/></circle>\n  </svg>;\n}\n\nfunction PhaseIndicator({ current, phases }) {\n  return <div style={{ display: \"flex\", gap: 3, padding: \"14px 20px 0\", position: \"absolute\", top: 0, left: 0, right: 0, zIndex: 20 }}>\n    {phases.map((p, i) => <div key={p} style={{ flex: 1, height: 3, borderRadius: 2, background: i<current?\"rgba(255,255,255,0.6)\":i===current?\"rgba(255,255,255,0.85)\":\"rgba(255,255,255,0.1)\" }}/>)}\n  </div>;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 1: POUR \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction PourPhase({ onComplete }) {\n  const [text, setText] = useState(\"\");\n  const [words, setWords] = useState([]);\n  const [focused, setFocused] = useState(false);\n  useEffect(() => { setWords(text.split(/\\s+/).filter(x => x.length > 3)); }, [text]);\n  const wc = text.split(/\\s+/).filter(Boolean).length;\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\", padding: \"80px 24px 40px\", overflow: \"hidden\" }}>\n      <FloatingWords words={words} color=\"#6BB8FF\"/><Particles color=\"#6BB8FF\" count={15}/>\n      <div style={{ fontSize: 11, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#6BB8FF\", marginBottom: 16, fontFamily: FB, zIndex: 1 }}>POUR</div>\n      <h1 style={{ fontSize: 36, fontFamily: FD, fontStyle: \"italic\", color: \"white\", margin: \"0 0 8px\", textAlign: \"center\", zIndex: 1, fontWeight: 400, lineHeight: 1.15 }}>What's alive<br/>in you right now?</h1>\n      <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.55)\", fontFamily: FB, margin: \"0 0 32px\", textAlign: \"center\", zIndex: 1 }}>Don't think. Just pour.</p>\n      <div style={{ width: \"100%\", maxWidth: 380, flex: 1, zIndex: 1, borderRadius: 16, background: focused?\"rgba(107,184,255,0.06)\":\"rgba(255,255,255,0.03)\", border: `1px solid ${focused?\"rgba(107,184,255,0.2)\":\"rgba(255,255,255,0.06)\"}`, transition: \"all 0.4s\", padding: 2 }}>\n        <textarea value={text} onChange={function(e){setText(e.target.value);}} onFocus={function(){setFocused(true);}} onBlur={function(){setFocused(false);}} placeholder=\"Start writing...\" style={{ width: \"100%\", height: \"100%\", background: \"transparent\", border: \"none\", outline: \"none\", resize: \"none\", color: \"rgba(255,255,255,0.85)\", fontSize: 17, fontFamily: FD, fontStyle: \"italic\", padding: 20, lineHeight: 1.7 }}/>\n      </div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", width: \"100%\", maxWidth: 380, marginTop: 16, zIndex: 1 }}>\n        <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB }}>{wc} words{wc>0&&wc<20&&<span style={{color:\"rgba(107,184,255,0.4)\"}}> \u00b7 keep going</span>}</div>\n        {wc>=20&&<button onClick={function(){ onComplete(text); }} style={{ background: \"linear-gradient(135deg, #6BB8FF, #3D8BFF)\", border: \"none\", borderRadius: 24, padding: \"10px 28px\", color: \"white\", fontSize: 14, fontFamily: FB, fontWeight: 500, cursor: \"pointer\", animation: \"riseUp 0.4s ease\" }}>Synthesize \u2192</button>}\n      </div>\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 2: SYNTHESIZE \u2014 calls AI, auto-advances \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction SynthesizePhase({ rawText, onComplete, onSynthesis }) {\n  const [step, setStep] = useState(0);\n  const [err, setErr] = useState(null);\n  const ran = useRef(false);\n  useEffect(() => {\n    if (ran.current) return; ran.current = true;\n    var t1 = setTimeout(function() { setStep(1); }, 800);\n\n    /* \u2500\u2500 Build temporal context from previous sessions \u2500\u2500 */\n    var prevSessions = [];\n    try { prevSessions = loadSessions(); } catch(e) {}\n    var temporalContext = \"\";\n    if (prevSessions.length > 0) {\n      var now = Date.now();\n      temporalContext = \"\\n\\nPREVIOUS SESSIONS (for temporal awareness \u2014 respect time gaps):\\n\";\n      prevSessions.slice(-6).forEach(function(s) {\n        var d = new Date(s.date);\n        var daysAgo = Math.round((now - d.getTime()) / 86400000);\n        var when = daysAgo === 0 ? \"today\" : daysAgo === 1 ? \"yesterday\" : daysAgo < 7 ? daysAgo + \" days ago\" : daysAgo < 30 ? Math.round(daysAgo / 7) + \" weeks ago\" : Math.round(daysAgo / 30) + \" months ago\";\n        var themes = (s.themes || []).map(function(t) { return t.label; }).join(\", \");\n        var archs = (s.archetypes || []).map(function(a) {\n          var key = typeof a === \"string\" ? a : a.key;\n          var phase = a.phase || \"\";\n          var resp = s.archetypeResponse && s.archetypeResponse.key === key ? s.archetypeResponse.response : \"\";\n          return key + (phase ? \"@\" + phase : \"\") + (resp ? \"(\" + resp + \")\" : \"\");\n        }).join(\", \");\n        var line = \"- \" + when + \": themes=[\" + themes + \"]\";\n        if (archs) line += \" archetypes=[\" + archs + \"]\";\n        if (s.alchemy) line += \" alchemy=\" + s.alchemy.stage;\n        if (s.synthesis) line += \" insight: \" + s.synthesis;\n        if (s.tension) line += \" tension: \" + s.tension.a + \" vs \" + s.tension.b;\n        // Past session rejections \u2014 these are user corrections, carry forward\n        var pastRejections = [];\n        var pastCorrections = [];\n        if (s.mapResponses) {\n          Object.keys(s.mapResponses).forEach(function(connKey) {\n            var mr = s.mapResponses[connKey];\n            if (!mr) return;\n            var parts = connKey.split(\"::\");\n            var connLabel = (parts[0]||\"\") + \" \u2194 \" + (parts[1]||\"\");\n            if (mr.value === \"no\") {\n              if (mr.comment && mr.comment.trim()) {\n                pastCorrections.push(\"[\" + connLabel + \"]: user said \\\"\" + mr.comment.trim() + \"\\\"\");\n              } else {\n                pastRejections.push(connLabel);\n              }\n            }\n          });\n        }\n        if (s.reactions) {\n          Object.keys(s.reactions).forEach(function(rk) {\n            if (s.reactions[rk] === \"resisted\") pastRejections.push(\"reading: \\\"\" + rk.slice(0,60) + \"\\\"\");\n          });\n        }\n        if (s.corrections) {\n          Object.keys(s.corrections).forEach(function(ck) {\n            if (s.corrections[ck] && s.corrections[ck].trim()) {\n              pastCorrections.push(\"on \\\"\" + ck.slice(0,40) + \"\\\": user said \\\"\" + s.corrections[ck].trim().slice(0,80) + \"\\\"\");\n            }\n          });\n        }\n        if (pastRejections.length > 0) line += \" | USER REJECTED: \" + pastRejections.join(\"; \");\n        if (pastCorrections.length > 0) line += \" | USER CORRECTIONS (their words ARE the truth): \" + pastCorrections.join(\"; \");\n        temporalContext += line + \"\\n\";\n      });\n      // Add archetype continuity note\n      var archCounts = {};\n      prevSessions.forEach(function(s) {\n        (s.archetypes || []).forEach(function(a) {\n          var key = typeof a === \"string\" ? a : (a.name || a.key || \"\");\n          if (!archCounts[key]) archCounts[key] = { count: 0, names: [], lastResponse: \"\" };\n          archCounts[key].count++;\n          if (a.name) archCounts[key].names.push(a.name);\n          if (s.archetypeResponse && (s.archetypeResponse.key === key || s.archetypeResponse.key === a.key)) archCounts[key].lastResponse = s.archetypeResponse.response;\n        });\n      });\n      // Collect ALL custom archetype names across sessions for evolution tracking\n      var allArchNames = [];\n      prevSessions.forEach(function(s) {\n        (s.archetypes || []).forEach(function(a) {\n          if (a.name) allArchNames.push(a.name);\n        });\n      });\n      if (allArchNames.length > 0) {\n        temporalContext += \"\\nPREVIOUS ARCHETYPE NAMES (for evolution tracking \u2014 generate evolution_from if pattern evolved):\\n\";\n        temporalContext += allArchNames.join(\" \u2192 \") + \"\\n\";\n      }\n      var recurring = Object.keys(archCounts).filter(function(k) { return archCounts[k].count >= 2; });\n      if (recurring.length > 0) {\n        temporalContext += \"\\nRECURRING PATTERNS:\\n\";\n        recurring.forEach(function(k) {\n          var a = archCounts[k];\n          temporalContext += \"- \" + k + \": appeared \" + a.count + \"x\";\n          if (a.lastResponse) temporalContext += \" (user \" + a.lastResponse + \" it last time)\";\n          temporalContext += \"\\n\";\n        });\n      }\n    }\n\n    // \u2500\u2500 Compute field state signals \u2500\u2500\n    var fieldState = computeFieldState();\n    if (fieldState && fieldState.sessionCount >= 2) {\n      temporalContext += \"\\nFIELD STATE (living signals \u2014 use these to deepen your reading):\\n\";\n      if (fieldState.rising.length > 0) temporalContext += \"RISING themes (getting louder): \" + fieldState.rising.map(function(r){return r.label + \" (+\" + r.delta + \")\";}).join(\", \") + \"\\n\";\n      if (fieldState.fading.length > 0) temporalContext += \"FADING themes (loosening grip): \" + fieldState.fading.map(function(f){return f.label + \" (\" + f.delta + \")\";}).join(\", \") + \"\\n\";\n      if (fieldState.absent.length > 0) temporalContext += \"ABSENT themes (disappeared \u2014 avoidance or completion?): \" + fieldState.absent.join(\", \") + \"\\n\";\n      if (fieldState.chronic.length > 0) temporalContext += \"CHRONIC themes (always present): \" + fieldState.chronic.join(\", \") + \"\\n\";\n      if (fieldState.anchor) {\n        var sig = fieldState.archSignals[fieldState.anchor] || {};\n        var userRejectedAnchor = sig.lastResponse === \"resisted\" || sig.lastResponse === \"pushed back\" || sig.lastResponse === \"no\";\n        if (userRejectedAnchor) {\n          temporalContext += \"PATTERN ALERT: \\\"\" + fieldState.anchor + \"\\\" appeared \" + fieldState.anchorCount + \"x BUT USER REJECTED IT last time. Do NOT repeat this archetype or its themes. Evolve past it.\\n\";\n        } else {\n          temporalContext += \"ANCHOR archetype: \" + fieldState.anchor + \" (appeared \" + fieldState.anchorCount + \"x\";\n          if (sig.velocity && sig.velocity !== \"stable\") temporalContext += \", \" + sig.velocity;\n          if (sig.currentPhase) temporalContext += \", currently @\" + sig.currentPhase;\n          temporalContext += \")\\n\";\n          if (sig.phaseHistory) temporalContext += \"  Phase journey: \" + sig.phaseHistory + \"\\n\";\n        }\n      }\n      if (fieldState.tensionShape && fieldState.tensionAge >= 2) temporalContext += \"RECURRING TENSION: \" + fieldState.tensionShape + \" (present \" + fieldState.tensionAge + \" sessions)\\n\";\n      if (fieldState.energies.length >= 2) temporalContext += \"ENERGY PATTERN: \" + fieldState.energies.join(\" \u2192 \") + \" (trend: \" + fieldState.energyTrend + \")\\n\";\n      if (fieldState.alchemyStage) temporalContext += \"ALCHEMY: \" + fieldState.alchemyStage + \" (\" + fieldState.alchemyVelocity + \")\\n\";\n      if (fieldState.lastBlindSpot) temporalContext += \"LAST BLIND SPOT: \" + fieldState.lastBlindSpot.slice(0, 100) + \"\\n\";\n      if (fieldState.constellations.length > 0) temporalContext += \"CONSTELLATIONS: \" + fieldState.constellations.map(function(c){return c.pair + \" (\" + c.count + \"x)\";}).join(\", \") + \"\\n\";\n    }\n\n    var prompt = \"You are the reflective engine behind SAYCRD \u2014 a co-creation tool, not a diagnosis tool.\\n\" +\n      \"Your role is WITNESS, not analyst. COMPANION, not judge. MIRROR, not authority.\\n\\n\" +\n      \"\u2550\u2550 AUTHORITY HIERARCHY \u2014 FOLLOW THIS EXACTLY \u2550\u2550\\n\" +\n      \"1. USER SIGNALS (highest) \u2014 if user pushed back on a connection, corrected a reading, or gave their own words: those words ARE the truth. Your interpretation was wrong. Update accordingly. Do not defend your original read.\\n\" +\n      \"2. USER BEHAVIOR \u2014 what they connected manually, held, returned to. This is unconscious truth.\\n\" +\n      \"3. USER TEXT \u2014 their exact words from the dump. Quote them. Mirror them. Do not paraphrase into your own voice.\\n\" +\n      \"4. AI INFERENCE (lowest) \u2014 patterns, archetypes, connections. Useful, not sovereign. Offer, never declare.\\n\\n\" +\n      \"IF USER SIGNALS EXIST IN THE INPUT: MANDATORY OVERRIDE. You must completely replace your reading with theirs. \\n\" +\n      \"- If user pushed back on a connection: that connection is WRONG. Your interpretation was wrong. Do not reference it, defend it, or find a 'nuanced' version of it.\\n\" +\n      \"- If user rejected an archetype or theme: DROP IT ENTIRELY. Do not bring it back in disguise.\\n\" +\n      \"- If user gave their own words: THOSE WORDS ARE THE SYNTHESIS. Reflect them back directly.\\n\" +\n      \"- If past sessions show USER REJECTED markers: those readings are PERMANENTLY retired.\\n\" +\n      \"- PATTERN ALERT sections mean: this archetype has overstayed. Find what's NEW.\\n\\n\" +\n      \"TEMPORAL AWARENESS:\\n\" +\n      \"- Current session + user signals are PRIMARY. Past sessions are CONTEXT only.\\n\" +\n      \"- If the user gave feedback on a past reading, their feedback is the truth about that moment.\\n\\n\" +\n      \"LANGUAGE RULES \u2014 CRITICAL:\\n\" +\n      \"- Every insight must pass: Is this rooted in THEIR actual words? If not, rewrite.\\n\" +\n      \"- Be SHORT. DIRECT. Root every line in their language.\\n\" +\n      \"- BAD: 'You are in a space where rest and creativity are integrating.'\\n\" +\n      \"- GOOD: 'Rest is driving it now. That's what you wrote.'\\n\" +\n      \"- Write as a witness who was paying close attention, not someone revealing hidden truths.\\n\" +\n      \"- BANNED: navigating, intentional, sacred, container, grounding, healing, inner work, your journey, meaningful way, deeper sense, space where, emerging, integration, cultivating.\\n\" +\n      \"- NEVER EVER say: 'you are not ready', 'you resist', 'you avoid', 'you cannot', 'you're not open', 'you're closed', 'you refuse', 'you struggle with', 'you haven't', 'not yet ready'. These are projections from a position of superiority. You do not know what the user is ready for. \\n\" +\n      \"- If you see a pattern that LOOKS like resistance \u2014 ASK about it. Never declare it.\\n\" +\n      \"- Example wrong: 'You're not ready to partner.' Example right: 'Something about partnership keeps showing up \u2014 what does that word actually mean to you?'\\n\\n\" +\n      \"1. THEMES: Extract 3-7 core themes. 1-3 word labels that DISTILL, not quote. Weight 1-5.\\n\" +\n      \"2. CONNECTIONS: 3-5 connections. 1-word label, one-sentence insight (punchy, not generic).\\n\" +\n      \"3. GUIDE: 3-5 items. Types: act, notice, deepen, release. Max 12 words.\\n\" +\n      \"4. MAP_TITLE: 3-6 words.\\n\" +\n      \"5. DESCENT_CARDS: 4 cards. Mix energy, binary, spectrum. Make prompts SHORT (under 8 words). Each must be immediately clear.\\n\" +\n      \"6. ARCHETYPE: Generate ONE custom archetype. Format: 'The [Adjective] [Noun]'. Grounded in THEIR patterns.\\n\" +\n      \"  - name, line, source_nodes (1-3 theme labels), classical_resonance (optional key or null), evolution_from (or null)\\n\" +\n      \"7. ALCHEMY: Stage nigredo|albedo|citrinitas|rubedo + 1 sentence evidence.\\n\" +\n      \"8. SYNTHESIS: 1-2 sentences rooted in THEIR exact words. If user signals exist, your synthesis MUST reflect them \u2014 not your original AI read. Mirror what they said, not what you inferred. Make them feel HEARD first. If you offer a new angle, frame it as a question, not a declaration.\\n\" +\n      \"9. UNDERNEATH: Array of EXACTLY 3 short strings (max 10 words each). These are what\\'s beneath the surface \u2014 things they haven\\'t quite said. Root each one in their actual words.\\n\" +\n      \"10. TENSION: Object {a, b, text}. a/b = opposing poles (1-3 words each). text = 1 punchy sentence about the cost of this specific tension for this specific person. Max 18 words.\\n\" +\n      \"11. BLIND_SPOT: 1 sentence. A pattern they may not have named yet \u2014 offered as a question if possible. If user signals suggest they DO see this, skip it and offer something genuinely unseen. Max 14 words.\\n\" +\n      \"12. OPENING: 1 question. Specific, uncomfortable, cracks it open. Under 12 words. Don\\'t soften.\\n\" +\n      \"13. NOTICING: 1 observation about HOW they write \u2014 rhythm, avoidance, repetition, what\\'s missing. Max 18 words.\\n\\n\" +\n      \"14. FIELD_CARDS \u2014 THIS IS THE MOST IMPORTANT PART.\\n\" +\n      \"You are designing Spotify Wrapped for the soul. Each card is a visual moment that BUILDS on the last.\\n\" +\n      \"Like Wrapped: '47,000 minutes' \u2192 'top genre: indie' \u2192 'but December was all jazz' \u2014 each card recontextualizes what came before.\\n\\n\" +\n      \"THE NARRATIVE ARC (follow this order):\\n\" +\n      \"1. Energy card \u2014 arrival word, huge. Sub_text quotes 5-10 words the user ACTUALLY WROTE that reveal the energy.\\n\" +\n      \"2. Themes card \u2014 type=themes_reveal. hero_text = the dominant theme name. sub_text names ALL themes. This is the 'top genre' moment.\\n\" +\n      \"3. Insight card \u2014 the synthesis. References the energy: 'You arrived [energy] because...' \\n\" +\n      \"4. Tension card \u2014 the core pull. hero_text = 'X vs Y'. Sub_text names the stakes.\\n\" +\n      \"5. Blind spot card \u2014 what they cannot see. References the tension.\\n\" +\n      \"6. Pattern/shift card \u2014 what is recurring or changing.\\n\" +\n      \"7. Identity card \u2014 the archetype. This is the CONCLUSION of everything above. The punchline.\\n\\n\" +\n      \"EVERY CARD MUST HAVE:\\n\" +\n      \"- type: energy|insight|tension|pattern|identity|blind_spot|shift|themes_reveal\\n\" +\n      \"- hero_text: 1-5 words max. The dominant visual element.\\n\" +\n      \"- sub_text: 1-2 sentences. Small context.\\n\" +\n      \"- color: hex color that FITS this card's emotion. BE CREATIVE. Never same color twice.\\n\" +\n      \"- user_fragment: 5-15 words the user ACTUALLY WROTE that this card is based on. Direct quote. This grounds every card in THEIR words.\\n\" +\n      \"- whisper: barely visible text (or null).\\n\\n\" +\n      \"DESIGN RULES:\\n\" +\n      \"- ONE dominant element per card. 60-80% visual space.\\n\" +\n      \"- The user_fragment is CRITICAL. It shows 'we heard you'. Pull real phrases from their text.\\n\" +\n      \"- Each card should make the NEXT card hit harder. Build tension.\\n\" +\n      \"- The insight card should reference the energy card. The blind spot should reference the tension.\\n\" +\n      \"- Would someone screenshot this? If not, make it bolder.\\n\\n\" +\n      \"THEMES_REVEAL CARD:\\n\" +\n      \"- hero_text = the single most dominant theme name (1-2 words, HUGE)\\n\" +\n      \"- sub_text = a sentence that names ALL themes: 'alongside [theme2], [theme3], and [theme4]'\\n\" +\n      \"- This is the 'your top genre' moment. Make it feel like a reveal.\\n\\n\" +\n      \"CRITICAL: FROM and TO in connections must EXACTLY match a theme label.\\n\" +\n      `Respond with ONLY valid JSON, no markdown:\\n{\"themes\":[{\"label\":\"...\",\"weight\":1}],\"connections\":[{\"from\":\"exact label\",\"to\":\"exact label\",\"label\":\"...\",\"insight\":\"...\"}],\"guide\":[{\"type\":\"act\",\"text\":\"...\"}],\"map_title\":\"...\",\"descent_cards\":[{\"type\":\"energy\",\"phrase\":\"wanting to be seen but not watched\",\"color\":\"#FFB86B\"},{\"type\":\"binary\",\"prompt\":\"lately you seem drawn to\",\"option_a\":\"building slowly\",\"option_b\":\"leaping first\",\"color\":\"#FF6B9D\"},{\"type\":\"spectrum\",\"prompt\":\"where does this live?\",\"pole_a\":\"still forming\",\"pole_b\":\"ready to move\",\"color\":\"#6BFFB8\"}],\"archetype\":{\"name\":\"The Attuned Builder\",\"line\":\"Builds through listening, not force.\",\"source_nodes\":[\"rest\",\"creativity\"],\"classical_resonance\":\"hermit\",\"evolution_from\":null},\"synthesis\":\"You\\'re not building a product. You\\'re building proof you\\'re allowed to take up space.\",\n\"underneath\":[\"Proof and worthiness collapsed into the same word\",\"The thing you\\'re building is the question you keep circling\",\"Rest appears as something you\\'re rationing\"],\n\"tension\":{\"a\":\"Control\",\"b\":\"Trust\",\"text\":\"You\\'re trying to engineer outcomes that only surrender can reach.\"},\n\"blind_spot\":\"You think the audience is watching. It\\'s a mirror.\",\n\"opening\":\"What would you make if no one would ever know?\",\n\"noticing\":\"You use \\'I want\\' four times and \\'I should\\' seven. The gap is the work.\",\n\"alchemy\":{\"stage\":\"nigredo\",\"evidence\":\"...\"},\"field_cards\":[{\"type\":\"energy\",\"hero_text\":\"TENDER\",\"sub_text\":\"You arrived softer than last time.\",\"color\":\"#c070f0\",\"user_fragment\":\"i feel like something cracked open today\",\"whisper\":\"session 4\"},{\"type\":\"themes_reveal\",\"hero_text\":\"SURRENDER\",\"sub_text\":\"alongside control, trust, and making\",\"color\":\"#B86BFF\",\"user_fragment\":\"i keep coming back to letting go\",\"whisper\":\"what surfaced\"},{\"type\":\"insight\",\"hero_text\":\"Your best ideas come when you stop pushing.\",\"sub_text\":\"You arrived tender \u2014 and that tenderness is the source.\",\"color\":\"#6BFFB8\",\"user_fragment\":\"when i stop trying it flows\",\"whisper\":null},{\"type\":\"tension\",\"hero_text\":\"control vs trust\",\"sub_text\":\"You keep choosing control. Trust keeps winning anyway.\",\"color\":\"#6BB8FF\",\"user_fragment\":\"i want to let go but i keep gripping\",\"whisper\":null},{\"type\":\"blind_spot\",\"hero_text\":\"You are performing strength.\",\"sub_text\":\"The control vs trust war has a third player: the audience you imagine watching.\",\"color\":\"#888890\",\"user_fragment\":\"i need to show them i can do this\",\"whisper\":\"what you cannot see\"},{\"type\":\"identity\",\"hero_text\":\"The Reluctant Opener\",\"sub_text\":\"Opens doors but stands in the frame.\",\"color\":\"#E84393\",\"user_fragment\":\"i opened the door but didnt walk through\",\"whisper\":\"your pattern\"}]}`;\n    console.log(\"[SAYCRD] Synthesizing dump:\", (rawText||\"\").slice(0,80) + \"...\");\n    (async function() {\n      try {\n        // \u2500\u2500 Build user signals from map feedback (highest authority) \u2500\u2500\n    var userSignals = \"\";\n    var mapR = mapResponses || {};\n    var signalLines = [];\n    Object.keys(mapR).forEach(function(k) {\n      var r = mapR[k];\n      if (!r) return;\n      var parts = k.split(\"::\");\n      var from = parts[0] || \"\", to = parts[1] || \"\";\n      var resonance = r.value === \"yes\" ? \"confirmed\" : r.value === \"partly\" ? \"partial\" : \"pushed back\";\n      var line = \"Connection [\" + from + \" \u2194 \" + to + \"]: \" + resonance;\n      if (r.comment && r.comment.trim()) {\n        line += \" \u2014 USER SAID: \\\"\" + r.comment.trim() + \"\\\"\";\n      }\n      if (r.correction && r.correction.trim() && r.correction !== r.comment) {\n        line += \" (USER CORRECTION: \\\"\" + r.correction.trim() + \"\\\")\";\n      }\n      signalLines.push(line);\n    });\n    // Also build banned readings from ALL past sessions\n    var bannedReadings = [];\n    var pastUserWords = [];\n    try {\n      var pastSessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n      pastSessions.forEach(function(ps) {\n        if (ps.mapResponses) {\n          Object.keys(ps.mapResponses).forEach(function(ck) {\n            var mr = ps.mapResponses[ck];\n            if (mr && mr.value === \"no\" && mr.comment && mr.comment.trim()) {\n              pastUserWords.push(mr.comment.trim());\n            }\n            if (mr && mr.value === \"no\" && !mr.comment) {\n              var pts = ck.split(\"::\");\n              bannedReadings.push(\"the connection between \" + (pts[0]||\"\") + \" and \" + (pts[1]||\"\"));\n            }\n          });\n        }\n        if (ps.reactions) {\n          Object.keys(ps.reactions).forEach(function(rk) {\n            if (ps.reactions[rk] === \"resisted\") bannedReadings.push(rk.slice(0, 80));\n          });\n        }\n        if (ps.corrections) {\n          Object.keys(ps.corrections).forEach(function(ck) {\n            var correction = ps.corrections[ck];\n            if (correction && correction.trim()) pastUserWords.push(correction.trim());\n          });\n        }\n      });\n    } catch(e) {}\n\n    var userSignalParts = [];\n    if (signalLines.length > 0) {\n      userSignalParts.push(\"\u2550\u2550 CURRENT SESSION USER SIGNALS (HIGHEST AUTHORITY) \u2550\u2550\\n\" +\n        \"These are the user's direct words RIGHT NOW. They override everything \u2014 past sessions, AI patterns, recurring themes.\\n\" +\n        signalLines.join(\"\\n\"));\n    }\n    if (bannedReadings.length > 0) {\n      userSignalParts.push(\"\u2550\u2550 BANNED READINGS (user rejected these \u2014 permanently retired) \u2550\u2550\\n\" +\n        bannedReadings.slice(-10).map(function(b){return \"- \" + b;}).join(\"\\n\"));\n    }\n    if (pastUserWords.length > 0) {\n      userSignalParts.push(\"\u2550\u2550 USER'S OWN WORDS FROM PAST SESSIONS (carry forward) \u2550\u2550\\n\" +\n        \"These are corrections the user gave. They are more accurate than any AI read.\\n\" +\n        pastUserWords.slice(-8).map(function(w){return \"\\\"\" + w + \"\\\"\";}).join(\"\\n\"));\n    }\n\n    if (userSignalParts.length > 0) {\n      userSignals = \"\\n\\n\" + userSignalParts.join(\"\\n\\n\") + \"\\n\u2550\u2550 END USER AUTHORITY \u2550\u2550\";\n    }\n    var raw = await callClaude(prompt, (rawText || \"\") + temporalContext + userSignals, 3500);\n        console.log(\"[SAYCRD] AI raw response:\", (raw||\"\").slice(0, 200));\n        setStep(2);\n        var data = parseJSON(raw);\n        console.log(\"[SAYCRD] Parsed data:\", data ? \"OK - \" + (data.themes||[]).length + \" themes\" : \"FAILED\");\n        if (data && data.themes && data.themes.length > 0) {\n          data.themes = data.themes.map(function(t, i) { return Object.assign({}, t, { color: NC[i % NC.length] }); });\n          // Normalize archetype: new format is singular object, old was array\n          if (data.archetype && !data.archetypes) {\n            data.archetypes = [data.archetype];\n          }\n          if (!data.archetypes) data.archetypes = [];\n          if (data.connections) data.connections = data.connections.map(function(c) {\n            var ft = (data.themes || []).find(function(t) { return t.label === c.from; });\n            return Object.assign({}, c, { color: ft ? ft.color : NC[0] });\n          });\n          onSynthesis(data);\n          setTimeout(onComplete, 1200);\n        } else { throw new Error(\"No themes parsed from AI response\"); }\n      } catch (e) {\n        console.error(\"[SAYCRD] Synthesis error:\", e);\n        setErr(e.message || \"API error\");\n        setStep(2);\n        // Stay here \u2014 never advance to map with null data\n      }\n    })();\n    return function() { clearTimeout(t1); };\n  }, []);\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\", overflow: \"hidden\" }}>\n      <Particles color=\"#E84393\" count={25}/>\n      <div style={{ flex: 1, display: \"flex\", alignItems: \"center\", justifyContent: \"center\", zIndex: 1 }}>\n        <div style={{ textAlign: \"center\" }}>\n          <BreathingOrb color=\"#E84393\" size={100}/>\n          <div style={{ marginTop: 28, fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"white\", animation: \"pulse 2s ease infinite\" }}>\n            {step===0&&\"Reading your words...\"}\n            {step===1&&\"Finding what's underneath...\"}\n            {step===2&&(err?\"Could not read your text \u2014 try again\":\"Building your map...\")}\n          {err && <button onClick={function(){ window.location.reload(); }} style={{ marginTop:16, padding:\"8px 22px\", borderRadius:999, border:\"1px solid rgba(255,107,107,0.3)\", background:\"transparent\", color:\"rgba(255,107,107,0.6)\", fontFamily:FB, fontSize:12, cursor:\"pointer\", display:\"block\", margin:\"16px auto 0\" }}>go back and retry</button>}\n          </div>\n          <div style={{ marginTop: 16, fontSize: 13, color: err?\"rgba(255,107,107,0.5)\":\"rgba(255,255,255,0.25)\", fontFamily: FB }}>\n            {err ? err.slice(0,60) : step < 2 ? \"analyzing patterns\u2026\" : \"themes found\"}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\nfunction InsightDrawer({ connection, position, onClose, onRespond }) {\n  const [value, setValue] = useState(null);\n  const [done, setDone] = useState(false);\n  const [comment, setComment] = useState(\"\");\n  const [showComment, setShowComment] = useState(false);\n  const ref = useRef(null);\n  const [dragOff, setDragOff] = useState(null);\n  const [dragPos, setDragPos] = useState(null);\n  var handlePD = function(e) { if(e.target.closest(\"[data-slider]\"))return; var r=ref.current?ref.current.getBoundingClientRect():null; if(!r)return; setDragOff({x:e.clientX-r.left,y:e.clientY-r.top}); };\n  useEffect(function() { if(!dragOff)return; function m(e){setDragPos({x:e.clientX-dragOff.x,y:e.clientY-dragOff.y});} function u(){setDragOff(null);} window.addEventListener(\"pointermove\",m); window.addEventListener(\"pointerup\",u); return function(){window.removeEventListener(\"pointermove\",m);window.removeEventListener(\"pointerup\",u);}; }, [dragOff]);\n\n  function handleSet(v) {\n    setValue(v);\n    var mapped = v < 33 ? \"no\" : v < 66 ? \"partly\" : \"yes\";\n    onRespond(mapped, null, v, \"\");\n    setDone(true);\n    if (v < 85) { setShowComment(true); }\n    else { setTimeout(function(){ onClose(); }, 1800); }\n  }\n  function submitComment() {\n    var mapped = value < 33 ? \"no\" : value < 66 ? \"partly\" : \"yes\";\n    var userWord = comment.trim();\n    // User word is primary \u2014 pass it as both correction AND comment\n    // onRespond receives: (resonance, correction, sliderValue, comment)\n    onRespond(mapped, userWord||null, value, userWord);\n    onClose();\n  }\n\n  const accent = connection.color || \"#6BB8FF\";\n  const s = dragPos ? { left: dragPos.x, top: dragPos.y, transform: \"none\" }\n    : { left: \"50%\", top: Math.max(10, Math.min(position.y - 60, 240)), transform: \"translate(-50%, 0)\" };\n  return (\n    <div ref={ref} onPointerDown={handlePD} onClick={function(e){e.stopPropagation();}} style={{\n      position: \"absolute\", ...s, width: 320, maxWidth: \"94%\",\n      background: `linear-gradient(160deg, rgba(10,12,20,0.98), rgba(20,15,35,0.96))`,\n      border: `1.5px solid ${accent}55`, borderRadius: 18, backdropFilter: \"blur(20px)\",\n      zIndex: 30, cursor: dragOff?\"grabbing\":\"grab\",\n      animation: \"drawerIn 0.4s cubic-bezier(.25,.46,.45,.94) forwards\",\n      touchAction: \"none\", boxShadow: `0 0 50px ${accent}20, 0 20px 60px rgba(0,0,0,0.6)`,\n    }}>\n      <div style={{ position: \"absolute\", top: 0, left: \"15%\", right: \"15%\", height: 2, background: `linear-gradient(90deg, transparent, ${accent}88, transparent)`, borderRadius: 1 }}/>\n      <button onClick={function(e){e.stopPropagation();onClose();}} style={{ position: \"absolute\", top: 12, right: 14, width: 26, height: 26, borderRadius: \"50%\", border: \"none\", background: \"rgba(255,255,255,0.06)\", color: \"rgba(255,255,255,0.4)\", fontSize: 12, cursor: \"pointer\", display: \"grid\", placeItems: \"center\" }}>{\"\\u2715\"}</button>\n      <div style={{ padding: \"22px 22px 20px\" }}>\n        <div style={{ fontSize: 10, letterSpacing: \"0.2em\", color: `${accent}99`, fontFamily: FB, textTransform: \"uppercase\", marginBottom: 10, fontWeight: 600 }}>{connection.nodeA} {\"\\u2194\"} {connection.nodeB}</div>\n        <div style={{ marginBottom:20 }}>\n          <div style={{ fontSize:9, letterSpacing:\"0.18em\", color:accent+\"55\", fontFamily:FB, textTransform:\"uppercase\", marginBottom:6 }}>ai read</div>\n          <div style={{ fontSize:17, color:\"rgba(255,255,255,0.85)\", fontFamily:FD, fontStyle:\"italic\", lineHeight:1.55 }}>{connection.insight}</div>\n        </div>\n        {!done && <div data-slider=\"true\">\n          <div style={{ fontSize: 11, color: `${accent}88`, fontFamily: FB, letterSpacing: \"0.1em\", textTransform: \"uppercase\", marginBottom: 14, textAlign: \"center\" }}>how much does this land?</div>\n          <SpectrumSlider color={accent} poleA=\"not at all\" poleB=\"deeply\" onSet={handleSet} value={value} />\n        </div>}\n        {done && !showComment && <div style={{textAlign:\"center\",padding:\"8px 0\",animation:\"riseUp 0.5s ease\"}}>\n          {value > 66\n            ? <div style={{fontSize:14,fontFamily:FB,color:accent,fontWeight:600}}>deep resonance \u2014 connection confirmed</div>\n            : value > 33\n            ? <div style={{fontSize:14,fontFamily:FB,color:accent,fontWeight:600}}>something's there \u2014 kept as signal</div>\n            : <div style={{fontSize:13,fontFamily:FB,color:\"rgba(214,178,100,0.8)\",fontWeight:600}}>your read carries this now</div>\n          }\n        </div>}\n        {done && showComment && <div style={{animation:\"riseUp 0.4s ease\",marginTop:8}}>\n          {value <= 33\n            ? <div style={{fontSize:11,color:\"rgba(214,178,100,0.7)\",fontFamily:FB,letterSpacing:\"0.1em\",marginBottom:10}}>YOUR READ \u2014 this replaces mine:</div>\n            : <div style={{fontSize:11,color:accent+\"88\",fontFamily:FB,letterSpacing:\"0.1em\",marginBottom:10}}>what's the actual connection?</div>\n          }\n          <textarea value={comment} onChange={function(e){setComment(e.target.value);}}\n            onKeyDown={function(e){if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();submitComment();}}}\n            placeholder={value<=33?\"what connects these, in your words...\":\"anything to add...\"}\n            autoFocus\n            style={{width:\"100%\",minHeight:64,\n              background:value<=33?\"rgba(40,30,8,0.6)\":\"rgba(255,255,255,0.04)\",\n              border:\"1px solid \"+(value<=33?\"rgba(214,178,100,0.3)\":accent+\"33\"),\n              borderRadius:10,color:\"rgba(255,255,255,0.9)\",fontFamily:FD,fontSize:15,\n              fontStyle:\"italic\",padding:\"10px 12px\",resize:\"none\",outline:\"none\",\n              lineHeight:1.6,boxSizing:\"border-box\"}}\n          />\n          <div style={{display:\"flex\",justifyContent:\"space-between\",marginTop:8,alignItems:\"center\"}}>\n            {value<=33\n              ? <div style={{fontSize:10,color:\"rgba(214,178,100,0.4)\",fontFamily:FB}}>your words carry this connection</div>\n              : <button onClick={onClose} style={{fontSize:11,color:\"rgba(255,255,255,0.25)\",fontFamily:FB,background:\"transparent\",border:\"none\",cursor:\"pointer\"}}>skip</button>\n            }\n            <button onClick={submitComment}\n              style={{fontSize:12,fontFamily:FB,background:\"transparent\",\n                border:\"1px solid \"+(comment.trim()?(value<=33?\"rgba(214,178,100,0.6)\":accent+\"44\"):\"rgba(255,255,255,0.1)\"),\n                borderRadius:16,padding:\"6px 18px\",cursor:\"pointer\",\n                color:comment.trim()?(value<=33?\"#D6B264\":accent):\"rgba(255,255,255,0.2)\"\n              }}>{value<=33?\"this is the connection\":\"noted\"}</button>\n          </div>\n        </div>}\n      </div>\n    </div>\n  );\n}\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 3: MAP \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction MapPhase({ onComplete, synthesisData, rawText, onPatchSynthesis }) {\n  const [activeConn, setActiveConn] = useState(null);\n  const [responses, setResponses] = useState({});\n  const [dragging, setDragging] = useState(null);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [discoveredConns, setDiscoveredConns] = useState([]);\n  const [snapTarget, setSnapTarget] = useState(null);\n  const SNAP_DIST = 130;\n\n  // synthesisData must come from real synthesis \u2014 never fall back to demo\n  const sd = synthesisData;\n  const nodes = useMemo(() => {\n    if (sd && sd.themes) return sd.themes.map(function(t, i) {\n      var label = t.label || \"\";\n      var display = label.length > 18 ? label.slice(0, 16).trim() + \"\\u2026\" : label;\n      return { key: t.label, display: display, color: t.color || NC[i % NC.length], w: Math.min(t.weight / 5, 1) };\n    });\n    return [];\n  }, [sd]);\n\n  const conns = useMemo(() => {\n    if (sd && sd.connections) return sd.connections.map(function(c) { return { from: c.from, to: c.to, label: (c.label || \"linked\").toUpperCase(), insight: c.insight || \"\", color: c.color || NC[0] }; });\n    return [];\n  }, [sd]);\n\n  // Auto-layout positions \u2014 fills available space\n  const [pos, setPos] = useState({});\n  const [fieldSize, setFieldSize] = useState({ w: 380, h: 520 });\n  const fieldRef = useRef(null);\n  const NR = 50;\n\n  // Measure field container\n  useEffect(() => {\n    if (!fieldRef.current) return;\n    const r = fieldRef.current.getBoundingClientRect();\n    if (r.width > 0 && r.height > 0) setFieldSize({ w: r.width, h: r.height });\n  }, []);\n\n  useEffect(() => {\n    if (nodes.length === 0) return;\n    var n = nodes.length;\n    var cx = fieldSize.w / 2;\n    var cy = fieldSize.h / 2;\n    var rx = (fieldSize.w / 2) - NR - 8;\n    var ry = (fieldSize.h / 2) - NR - 8;\n\n    // Build edge list as index pairs\n    var edges = [];\n    var allConns = (sd && sd.connections) ? sd.connections : [];\n    allConns.forEach(function(c) {\n      var ai = -1, bi = -1;\n      nodes.forEach(function(nd, i) { if (nd.key === c.from) ai = i; if (nd.key === c.to) bi = i; });\n      if (ai >= 0 && bi >= 0 && ai !== bi) edges.push([ai, bi]);\n    });\n\n    // Count crossings for a given ordering of node indices around the circle\n    function countCrossings(order) {\n      var cross = 0;\n      for (var i = 0; i < edges.length; i++) {\n        for (var j = i + 1; j < edges.length; j++) {\n          var a = order.indexOf(edges[i][0]), b = order.indexOf(edges[i][1]);\n          var c2 = order.indexOf(edges[j][0]), d = order.indexOf(edges[j][1]);\n          if (a > b) { var t = a; a = b; b = t; }\n          if (c2 > d) { var t2 = c2; c2 = d; d = t2; }\n          // Edges cross if one endpoint of each is between the other's endpoints\n          if (a < c2 && c2 < b && b < d) cross++;\n          if (c2 < a && a < d && d < b) cross++;\n        }\n      }\n      return cross;\n    }\n\n    // For <=7 nodes, try permutations (fix first node, permute rest)\n    var bestOrder = nodes.map(function(_, i) { return i; });\n    var bestCross = countCrossings(bestOrder);\n\n    if (n <= 8 && edges.length > 0) {\n      var rest = [];\n      for (var i = 1; i < n; i++) rest.push(i);\n\n      // Generate permutations of rest (max 720 for 7 nodes)\n      function permute(arr, l, r) {\n        if (l === r) {\n          var order = [0].concat(arr);\n          var c = countCrossings(order);\n          if (c < bestCross) { bestCross = c; bestOrder = order.slice(); }\n          return;\n        }\n        for (var i = l; i <= r; i++) {\n          var t = arr[l]; arr[l] = arr[i]; arr[i] = t;\n          permute(arr, l + 1, r);\n          var t2 = arr[l]; arr[l] = arr[i]; arr[i] = t2;\n        }\n      }\n      if (rest.length <= 6) {\n        permute(rest, 0, rest.length - 1);\n      } else {\n        // >7 nodes: greedy BFS placement\n        var adj = {};\n        nodes.forEach(function(_, i) { adj[i] = []; });\n        edges.forEach(function(e) { adj[e[0]].push(e[1]); adj[e[1]].push(e[0]); });\n        var placed = [0];\n        var visited = {}; visited[0] = true;\n        var queue = adj[0].slice();\n        while (placed.length < n) {\n          var next = -1;\n          for (var qi = 0; qi < queue.length; qi++) {\n            if (!visited[queue[qi]]) { next = queue[qi]; break; }\n          }\n          if (next === -1) {\n            for (var fi = 0; fi < n; fi++) { if (!visited[fi]) { next = fi; break; } }\n          }\n          if (next === -1) break;\n          placed.push(next);\n          visited[next] = true;\n          (adj[next] || []).forEach(function(nb) { if (!visited[nb]) queue.push(nb); });\n        }\n        bestOrder = placed;\n      }\n    }\n\n    var positions = {};\n    bestOrder.forEach(function(ni, i) {\n      var nd = nodes[ni];\n      var angle = (i / n) * Math.PI * 2 - Math.PI / 2;\n      var ws = 0.78 + (1 - nd.w) * 0.22;\n      positions[nd.key] = { x: cx + Math.cos(angle) * rx * ws - 50, y: cy + Math.sin(angle) * ry * ws - 18 };\n    });\n    setPos(positions);\n  }, [nodes, fieldSize]);\n\n  var hasConn = function(a,b){ return conns.some(function(c){ return (c.from===a&&c.to===b)||(c.from===b&&c.to===a); }); };\n  var hasDiscovered = function(a,b){ return discoveredConns.some(function(c){ return (c.from===a&&c.to===b)||(c.from===b&&c.to===a); }); };\n  var anyConn = function(a,b){ return hasConn(a,b) || hasDiscovered(a,b); };\n  var getDiscovered = function(a,b){ return discoveredConns.find(function(c){ return (c.from===a&&c.to===b)||(c.from===b&&c.to===a); }); };\n\n  // AI connection insight generation\n  const makeConn = async (a, b) => {\n    var nodeB = nodes.find(function(n) { return n.key === b; });\n    var col = nodeB ? nodeB.color : \"#7DB7AE\";\n    var temp = { from: a, to: b, label: \"READING\u2026\", insight: \"\u2026\", color: col, discovered: true };\n    setDiscoveredConns(function(prev) { return prev.concat([temp]); });\n    // NO auto-open \u2014 user sees the pill appear and taps it when ready\n    var ctx = rawText ? \"\\nContext: \" + rawText.slice(0, 400) : \"\";\n    var p = \"The user connected two themes on their map: \\\"\" + a + \"\\\" and \\\"\" + b + \"\\\".\" + ctx + \"\\nGenerate a 2-4 word label and 1-2 sentence insight. JSON only: {\\\"label\\\":\\\"...\\\",\\\"insight\\\":\\\"...\\\"}\";\n    try {\n      var raw = await callClaude(p, \"Themes: \" + a + \" + \" + b, 300);\n      var d = parseJSON(raw);\n      if (d && d.label) {\n        var real = { from: a, to: b, label: d.label.toUpperCase(), insight: d.insight || \"\", color: col, discovered: true };\n        setDiscoveredConns(function(prev) { return prev.map(function(c) { return (c.from===a && c.to===b) ? real : c; }); });\n        // Don't auto-open \u2014 user taps the pill\n        return;\n      }\n    } catch (e) {}\n    // Fallback\n    var fb = { from: a, to: b, label: \"LINKED\", insight: a + \" and \" + b + \" \u2014 you see a relationship here. What does one reveal about the other?\", color: col, discovered: true };\n    setDiscoveredConns(function(prev) { return prev.map(function(c) { return (c.from===a && c.to===b) ? fb : c; }); });\n    setTimeout(function() { setActiveConn(fb); }, 900);\n  };\n\n  var handleNodeTap = function(key) {\n    if (dragging) return;\n    if (!selectedNode) { setSelectedNode(key); return; }\n    if (selectedNode === key) { setSelectedNode(null); return; }\n    const a = selectedNode, b = key;\n    if (hasConn(a, b)) {\n      const c = conns.find(c => (c.from===a&&c.to===b)||(c.from===b&&c.to===a));\n      if (c) setActiveConn(c);\n      setSelectedNode(null);\n      return;\n    }\n    if (!anyConn(a, b)) makeConn(a, b);\n    setSelectedNode(null);\n  };\n  var ctr = function(key) { var p=pos[key]; return p ? { x: p.x+50, y: p.y+18 } : {x:0,y:0}; };\n  var mid = function(c) { var a=ctr(c.from),b=ctr(c.to); return {x:(a.x+b.x)/2,y:(a.y+b.y)/2}; };\n  var edgePt = function(from, to) { var a=ctr(from),b=ctr(to); var dx=b.x-a.x, dy=b.y-a.y, d=Math.hypot(dx,dy)||1; const r=40; return { x1: a.x+(dx/d)*r, y1: a.y+(dy/d)*r, x2: b.x-(dx/d)*r, y2: b.y-(dy/d)*r }; };\n  const allConns = [...conns, ...discoveredConns];\n  var K = function(c) { return c.from+\"::\"+c.to; };\n  const explored = Object.keys(responses).length + discoveredConns.length;\n  const didDrag = useRef(false);\n  const snapRef = useRef(null); // track snap target in the effect closure\n  var startDrag = function(key, e) { e.stopPropagation(); e.preventDefault(); didDrag.current = false; snapRef.current = null; const r=fieldRef.current?.getBoundingClientRect(); if(!r)return; const p=pos[key]; setDragging({key,ox:(e.clientX||e.touches?.[0]?.clientX)-r.left-p.x,oy:(e.clientY||e.touches?.[0]?.clientY)-r.top-p.y}); };\n  useEffect(() => {\n    if(!dragging) return;\n    const m = e => {\n      didDrag.current = true;\n      const r = fieldRef.current?.getBoundingClientRect(); if(!r) return;\n      const cx = (e.clientX||e.touches?.[0]?.clientX) - r.left - dragging.ox;\n      const cy = (e.clientY||e.touches?.[0]?.clientY) - r.top - dragging.oy;\n      const newX = Math.max(0, Math.min(cx, r.width - 120));\n      const newY = Math.max(0, Math.min(cy, r.height - 40));\n      setPos(p => ({...p, [dragging.key]: {x: newX, y: newY}}));\n      // Snap detection \u2014 find closest unlinked node within range\n      const dragCtr = { x: newX + 50, y: newY + 18 };\n      let closest = null, closeDist = Infinity;\n      nodes.forEach(n => {\n        if (n.key === dragging.key) return;\n        const np = pos[n.key]; if(!np) return;\n        const nc = { x: np.x + 50, y: np.y + 18 };\n        const dist = Math.hypot(nc.x - dragCtr.x, nc.y - dragCtr.y);\n        if (dist < SNAP_DIST && dist < closeDist && !anyConn(dragging.key, n.key)) {\n          closeDist = dist; closest = n.key;\n        }\n      });\n      snapRef.current = closest;\n      setSnapTarget(closest);\n    };\n    var u = function() {\n      if (!didDrag.current) {\n        handleNodeTap(dragging.key);\n      } else if (snapRef.current) {\n        var sa = dragging.key, sb = snapRef.current;\n        if (!anyConn(sa, sb)) makeConn(sa, sb);\n        // drawer NOT auto-opened \u2014 user taps the label pill to open\n      }\n      setDragging(null);\n      setSnapTarget(null);\n      snapRef.current = null;\n    };\n    window.addEventListener(\"pointermove\", m);\n    window.addEventListener(\"pointerup\", u);\n    return () => { window.removeEventListener(\"pointermove\", m); window.removeEventListener(\"pointerup\", u); };\n  }, [dragging, selectedNode]);\n\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", padding: \"28px 0 6px\", overflow: \"hidden\" }}>\n      <Particles color=\"rgba(107,184,255,0.25)\" count={6}/>\n      <div style={{ textAlign: \"center\", zIndex: 2, marginBottom: 0, flexShrink: 0, padding: \"0 8px\" }}>\n        <div style={{ fontSize: 9, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#6BB8FF\", fontFamily: FB }}>{sd && sd.map_title ? sd.map_title.toUpperCase() : \"YOUR CONSTELLATION\"}</div>\n        <p style={{ fontSize: 10, color: snapTarget?\"#7DB7AE\":selectedNode?\"#6BFFB8\":explored===0?\"rgba(107,184,255,0.8)\":\"rgba(255,255,255,0.35)\", fontFamily: FB, margin: \"1px 0 0\", fontWeight: snapTarget||selectedNode||explored===0?600:400, transition: \"color 0.3s\" }}>\n          {snapTarget ? `Release to connect \u2192 ${snapTarget}` : selectedNode ? `${selectedNode} selected \u2014 tap another node to link` : explored===0 ? \"Tap a connection \u00b7 drag nodes together to link\" : `${explored} connections explored`}\n        </p>\n      </div>\n      <div ref={fieldRef} onClick={function(){setActiveConn(null);setSelectedNode(null);}} style={{ flex: 1, position: \"relative\", zIndex: 1, minHeight: 0 }}>\n        {Object.keys(pos).length > 0 && <><svg style={{ position: \"absolute\", inset: 0, width: \"100%\", height: \"100%\", zIndex: 0 }}>\n          {/* Predefined connection lines */}\n          {conns.map(function(c) {\n            var k=K(c), resp=responses[k], ep=edgePt(c.from,c.to);\n            const isAct = activeConn && K(activeConn)===k;\n            let stroke=\"rgba(255,255,255,0.18)\", sw=2, dash=\"8 5\", op=1;\n            if(resp?.value===\"yes\"){stroke=\"rgba(107,211,198,0.72)\";sw=3;dash=\"none\";}\n            else if(resp?.value===\"partly\"){stroke=\"rgba(165,235,220,0.5)\";sw=2.5;dash=\"none\";}\n            else if(resp?.value===\"no\"){\n              var hasWord=resp.comment&&resp.comment.trim().length>0;\n              stroke=hasWord?\"rgba(214,178,100,0.75)\":\"rgba(214,178,100,0.35)\";\n              sw=hasWord?2.5:1.5; dash=\"5 4\";\n            }\n            if(isAct){stroke=`${c.color}88`;sw=3;dash=\"none\";}\n            return <line key={k} x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2} stroke={stroke} strokeWidth={sw} strokeDasharray={dash} opacity={op} style={{transition:\"all 0.6s ease\"}}/>;\n          })}\n          {/* Discovered connection lines */}\n          {discoveredConns.map(function(c) {\n            var k=K(c), resp=responses[k], ep=edgePt(c.from,c.to);\n            var isAct = activeConn && K(activeConn)===k;\n            return <line key={\"d-\"+k} x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2}\n              stroke={isAct ? `${c.color}88` : `${c.color}55`} strokeWidth={isAct ? 3 : 2}\n              strokeDasharray={isAct ? \"none\" : \"4 8\"} opacity={0.8}\n              style={{transition:\"all 0.6s ease\", animation: \"riseUp 0.6s ease\"}}/>;\n          })}\n          {/* Selection preview line */}\n          {selectedNode && (() => {\n            const sc = ctr(selectedNode);\n            return <circle cx={sc.x} cy={sc.y} r={48} fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"1.5\" opacity=\"0.5\" strokeDasharray=\"4 4\">\n              <animate attributeName=\"r\" values=\"46;52;46\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n              <animate attributeName=\"opacity\" values=\"0.3;0.7;0.3\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n            </circle>;\n          })()}\n          {/* Snap preview line */}\n          {snapTarget && dragging && (() => {\n            const ep = edgePt(dragging.key, snapTarget);\n            return <line x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2} stroke=\"#7DB7AE\" strokeWidth=\"2.5\" strokeDasharray=\"6 4\" opacity=\"0.7\" style={{animation:\"connBlink 1s ease-in-out infinite\"}}/>;\n          })()}\n        </svg>\n        {conns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          const isAct = activeConn && K(activeConn)===k;\n          var isUserDefined = resp && resp.value===\"no\" && resp.comment && resp.comment.trim();\n          var isExp = !!resp; var accent = isUserDefined ? \"#D6B264\" : c.color;\n          return (\n            <div key={k} onClick={function(e){e.stopPropagation();setActiveConn(c);}} style={{\n              position: \"absolute\", left: m.x, top: m.y, transform: \"translate(-50%, -50%)\",\n              padding: \"4px 10px\", borderRadius: 6, fontSize: 9, fontWeight: 700, fontFamily: FB,\n              letterSpacing: \"0.06em\", textTransform: \"uppercase\",\n              color: isAct?\"white\":isUserDefined?\"#D6B264\":isExp?accent+\"cc\":accent,\n              background: isAct?accent+\"33\":isUserDefined?\"rgba(40,30,10,0.9)\":\"rgba(8,10,20,0.85)\",\n              border:\"1.5px solid \"+(isAct?accent:isUserDefined?\"rgba(214,178,100,0.5)\":isExp?accent+\"44\":accent+\"66\"),\n              cursor: \"pointer\", whiteSpace: \"nowrap\", zIndex: isAct ? 15 : 5,\n              transition: \"all 0.3s ease\",\n              animation: !isExp ? \"connBlink 2s ease-in-out infinite\" : \"none\",\n              boxShadow: isAct ? `0 0 20px ${accent}33` : !isExp ? `0 0 12px ${accent}15` : \"none\",\n            }}>\n              {!isExp && <div style={{ position:\"absolute\", inset:-5, borderRadius:10, border:\"1px solid \"+accent+\"44\", animation:\"ringPulse 2s ease-in-out infinite\", pointerEvents:\"none\" }}/>}\n              {isUserDefined\n                ? <span title={\"you: \"+resp.comment}>{resp.comment.trim().split(/\\s+/).slice(0,5).join(\" \")}{resp.comment.trim().split(/\\s+/).length>5?\"\u2026\":\"\"}</span>\n                : c.label\n              }\n            </div>\n          );\n        })}\n        {conns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          if(!resp?.correction) return null;\n          return <div key={\"a-\"+k} style={{ position:\"absolute\",left:m.x,top:m.y+16,transform:\"translate(-50%,0)\",fontSize:10,fontFamily:FD,fontStyle:\"italic\",color:\"rgba(165,235,220,0.65)\",maxWidth:140,textAlign:\"center\",lineHeight:1.3,animation:\"riseUp 0.5s ease\" }}>\"{resp.correction.length>45?resp.correction.slice(0,43)+\"\u2026\":resp.correction}\"</div>;\n        })}\n        {/* Discovered connection labels */}\n        {discoveredConns.map(function(c) {\n          var m=mid(c), k=K(c), resp=responses[k];\n          var isAct = activeConn && K(activeConn)===k;\n          var isExp = !!resp;\n          return (\n            <div key={\"dl-\"+k} onClick={function(e){e.stopPropagation();setActiveConn(c);}} style={{\n              position: \"absolute\", left: m.x, top: m.y, transform: \"translate(-50%, -50%)\",\n              padding: \"4px 10px\", borderRadius: 6, fontSize: 9, fontWeight: 700, fontFamily: FB,\n              letterSpacing: \"0.06em\", textTransform: \"uppercase\",\n              color: isAct ? \"white\" : `${c.color}`,\n              background: isAct ? `${c.color}33` : `rgba(8,10,20,0.85)`,\n              border: `1.5px solid ${isAct ? c.color : `${c.color}66`}`,\n              cursor: \"pointer\", whiteSpace: \"nowrap\", zIndex: isAct ? 15 : 5,\n              transition: \"all 0.3s ease\", animation: \"riseUp 0.5s ease\",\n              boxShadow: isAct ? `0 0 20px ${c.color}33` : `0 0 12px ${c.color}15`,\n            }}>\n              <span style={{ opacity:0.5, marginRight:4, fontSize:8 }}>you</span>{c.label}\n            </div>\n          );\n        })}\n        {nodes.map((n, ni) => {\n          const p=pos[n.key]; if(!p) return null; const isDrag=dragging?.key===n.key;\n          const isSel = selectedNode === n.key;\n          const isSnap = snapTarget === n.key;\n          const canLink = selectedNode && selectedNode !== n.key && !hasConn(selectedNode, n.key) && !hasDiscovered(selectedNode, n.key);\n          return (\n            <div key={n.key} onPointerDown={function(e){startDrag(n.key,e);}} style={{\n              position: \"absolute\", left: p.x, top: p.y,\n              borderRadius: 999, display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n              fontSize: 12, fontWeight: 600, fontFamily: FB, color: \"white\",\n              textAlign: \"center\", lineHeight: 1.2,\n              padding: \"10px 18px\",\n              textTransform: \"uppercase\", letterSpacing: \"0.06em\",\n              whiteSpace: \"normal\", maxWidth: 110,\n              background: isSnap\n                ? \"rgba(125,183,174,0.15)\"\n                : n.w > 0.7 ? `rgba(214,178,109,0.18)` : \"rgba(244,241,234,0.08)\",\n              border: isSnap ? \"1.5px solid rgba(125,183,174,0.7)\"\n                : isSel ? \"1.5px solid #6BFFB8\"\n                : canLink ? `1.5px solid ${n.color}aa`\n                : n.w > 0.7 ? \"1.5px solid rgba(214,178,109,0.45)\"\n                : `1.5px solid rgba(244,241,234,0.22)`,\n              backdropFilter: \"blur(8px)\",\n              cursor: isDrag?\"grabbing\":\"pointer\", zIndex: isDrag?20: isSel||isSnap?10 :3,\n              transition: isDrag?\"none\":\"all 0.4s cubic-bezier(.25,.46,.45,.94)\",\n              transform: isDrag?\"scale(1.12)\": isSnap?\"scale(1.15)\": isSel?\"scale(1.08)\" :\"scale(1)\",\n              boxShadow: isSnap\n                ? \"0 0 20px rgba(125,183,174,0.4)\"\n                : isSel\n                ? \"0 0 20px rgba(107,255,184,0.25)\"\n                : `0 0 ${isDrag?25:12}px ${n.color}${isDrag?\"44\":\"18\"}`,\n              touchAction: \"none\", userSelect: \"none\",\n              animation: isDrag||isSel||isSnap ? \"none\" : \"nodeBreathe 8s ease-in-out infinite\",\n              animationDelay: `${ni*-1.5}s`,\n            }}>{n.display || n.key}</div>\n          );\n        })}\n        {activeConn && <InsightDrawer\n          connection={{nodeA:activeConn.from,nodeB:activeConn.to,label:activeConn.label,insight:activeConn.insight,color:activeConn.color}}\n          position={mid(activeConn)}\n          onClose={function(){setActiveConn(null);}}\n          onRespond={function(v,c,slider,cmt){\n              setResponses(function(prev){\n                var k=K(activeConn);var next=Object.assign({},prev);\n                next[k]={value:v,correction:c,slider:slider,comment:cmt||\"\",from:activeConn.from,to:activeConn.to,insight:activeConn.insight};\n                return next;\n              });\n              if (slider < 50 && cmt && cmt.trim() && onPatchSynthesis && activeConn) {\n                var uw = cmt.trim(), fn = activeConn.from, tn = activeConn.to;\n                onPatchSynthesis({connections:[{from:fn,to:tn,insight:uw,label:activeConn.label,userAuthored:true}]});\n                (async function(){\n                  try{\n                    var pr=\"User corrected an AI connection reading. Their words are PRIMARY \u2014 reflect them back, do not reinterpret.\\n\"\n                    +\"USER SAID the connection between [\"+fn+\"] and [\"+tn+\"] is: \\\"\"+uw+\"\\\"\\n\"\n                    +\"Write ONE sentence (max 18 words) that mirrors their words as the connection insight. JSON: {\\\"insight\\\":\\\"...\\\"}\";\n                    var rw=await callClaude(pr,\"Connection: \"+fn+\" + \"+tn+\"\\nUser said: \"+uw,150);\n                    var dw=parseJSON(rw);\n                    if(dw&&dw.insight) onPatchSynthesis({connections:[{from:fn,to:tn,insight:dw.insight,label:activeConn.label,userAuthored:true}]});\n                  }catch(e){}\n                })();\n              }\n            }}\n        />}\n        </>}\n      </div>\n      {explored>=1&&<button onClick={function(){onComplete(responses);}} style={{ width:\"100%\",maxWidth:360,margin:\"4px auto 0\",background:\"linear-gradient(135deg, #6BB8FF, #3D8BFF)\",border:\"none\",borderRadius:24,padding:\"13px 28px\",color:\"white\",fontSize:14,fontFamily:FB,fontWeight:500,cursor:\"pointer\",zIndex:2,animation:\"riseUp 0.5s ease\",flexShrink:0 }}>Run Session \u2192</button>}\n    </div>\n  );\n}\n\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 4: SESSION \u2014 Full report with reading, guide, descent, clarity, noticing \u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nconst GUIDE_TYPES = {\n  act: { color: \"#6BFFB8\", icon: \"\u2192\" },\n  sit: { color: \"#6BB8FF\", icon: \"\u25ce\" },\n  deepen: { color: \"#FFB86B\", icon: \"\u25c7\" },\n  release: { color: \"#FF6B9D\", icon: \"\u21ba\" },\n  notice: { color: \"#9FB2D8\", icon: \"\u25c8\" },\n};\n\nconst GUIDE_ITEMS = [\n  { type: \"act\", text: \"Write down the one thing you'd build if money were irrelevant. Put it somewhere you'll see it tomorrow.\" },\n  { type: \"sit\", text: \"Sit with the question: when you say 'proof,' who are you proving it to? Don't answer. Just hold it.\" },\n  { type: \"deepen\", text: \"The word 'control' appeared 12 times. Ask yourself \u2014 what am I actually afraid of losing?\" },\n  { type: \"release\", text: \"Name one expectation about SAYCRD you're ready to set down. You don't have to drop it \u2014 just set it down.\" },\n  { type: \"notice\", text: \"This week, notice when you use the word 'should.' Write down what you actually feel instead.\" },\n];\n\n\nfunction SpectrumSlider({ color, poleA, poleB, onSet, value }) {\n  var [p, setP] = useState(value != null ? value : 50);\n  var [d, setD] = useState(false);\n  var [confirmed, setConfirmed] = useState(value != null);\n  var tr = useRef(null);\n  function upd(e) {\n    var r = tr.current ? tr.current.getBoundingClientRect() : null;\n    if (!r) return;\n    var cx = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);\n    setP(Math.max(0, Math.min(100, (cx - r.left) / r.width * 100)));\n  }\n  function hd(e) { e.preventDefault(); setD(true); upd(e); }\n  useEffect(function() {\n    if (!d) return;\n    function m(e) { upd(e); }\n    function u() { setD(false); }\n    window.addEventListener(\"pointermove\", m);\n    window.addEventListener(\"pointerup\", u);\n    return function() { window.removeEventListener(\"pointermove\", m); window.removeEventListener(\"pointerup\", u); };\n  }, [d]);\n  function confirm() {\n    setConfirmed(true);\n    onSet(Math.round(p));\n  }\n  return <div>\n    <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:14 }}>\n      <span style={{ fontSize:13, color: p < 40 ? color : \"rgba(255,255,255,0.35)\", fontFamily:FB, fontWeight:500, transition:\"color 0.3s\" }}>{poleA}</span>\n      <span style={{ fontSize:13, color: p > 60 ? color : \"rgba(255,255,255,0.35)\", fontFamily:FB, fontWeight:500, transition:\"color 0.3s\" }}>{poleB}</span>\n    </div>\n    <div ref={tr} onPointerDown={hd} style={{ position:\"relative\", height:36, display:\"flex\", alignItems:\"center\", cursor:\"pointer\", touchAction:\"none\" }}>\n      <div style={{ position:\"absolute\", left:0, right:0, height:3, background:\"rgba(255,255,255,0.06)\", borderRadius:2 }} />\n      <div style={{ position:\"absolute\", left:0, height:3, width:p+\"%\", background:\"linear-gradient(90deg,\"+color+\"33,\"+color+\"88)\", borderRadius:2, transition:d?\"none\":\"width 0.1s\" }} />\n      <div style={{ position:\"absolute\", left:p+\"%\", transform:\"translateX(-50%)\",\n        width:confirmed?30:26, height:confirmed?30:26, borderRadius:\"50%\",\n        background: confirmed ? color+\"66\" : \"rgba(255,255,255,0.1)\",\n        border:\"2px solid \"+(confirmed ? color : \"rgba(255,255,255,0.2)\"),\n        cursor:d?\"grabbing\":\"grab\",\n        boxShadow: confirmed ? \"0 0 18px \"+color+\"44\" : \"none\",\n        transition:d?\"none\":\"all 0.2s\", zIndex:2 }} />\n    </div>\n    {!confirmed\n      ? <div style={{ textAlign:\"center\", marginTop:14 }}>\n          <button onClick={confirm} style={{ fontSize:13, color:color, fontFamily:FB, fontWeight:600,\n            background:color+\"18\", border:\"1px solid \"+color+\"44\", borderRadius:20,\n            padding:\"8px 28px\", cursor:\"pointer\", letterSpacing:\"0.08em\", transition:\"all 0.2s\" }}>\n            confirm\n          </button>\n        </div>\n      : <div style={{ textAlign:\"center\", marginTop:10, fontSize:11, color:color+\"88\", fontFamily:FB, letterSpacing:\"0.1em\" }}>\n          \u2713 set \u2014 drag to adjust\n        </div>\n    }\n  </div>;\n}\n\nfunction GuideHoldSave({ color, onSave }) {\n  var [prog, setProg] = useState(0);\n  var [holding, setHolding] = useState(false);\n  var ref = useRef(null);\n  var startT = useRef(0);\n  function start(e) {\n    e.stopPropagation(); setHolding(true); startT.current = Date.now();\n    ref.current = setInterval(function() {\n      var p = Math.min((Date.now() - startT.current) / 900, 1);\n      setProg(p);\n      if (p >= 1) { clearInterval(ref.current); setHolding(false); setProg(0); onSave(); }\n    }, 30);\n  }\n  function end() { if (ref.current) clearInterval(ref.current); setHolding(false); setProg(0); }\n  return <div\n    onMouseDown={start} onMouseUp={end} onMouseLeave={end}\n    onTouchStart={start} onTouchEnd={end}\n    style={{ position: \"relative\", padding: \"6px 18px\", borderRadius: 20, background: color + (Math.round(8 + prog * 40)).toString(16).padStart(2, \"0\"), border: \"1px solid \" + color + \"44\", color: color, fontSize: 12, fontFamily: FB, cursor: \"pointer\", userSelect: \"none\", WebkitUserSelect: \"none\", overflow: \"hidden\" }}\n  >\n    <div style={{ position: \"absolute\", bottom: 0, left: 0, width: prog * 100 + \"%\", height: 2, background: color, transition: holding ? \"none\" : \"width 0.2s\" }} />\n    {holding ? \"...\" : \"hold\"}\n  </div>;\n}\n\nfunction GuideItem({ item, index, onPatchSynthesis, allGuide }) {\n  const [expanded, setExpanded] = useState(false);\n  const [response, setResponse] = useState(\"\");\n  const [saved, setSaved] = useState(false);\n  const [echo, setEcho] = useState(null);\n  const gt = GUIDE_TYPES[item.type] || GUIDE_TYPES.act;\n  const submit = async () => {\n    if (!response.trim()) return;\n    setSaved(true);\n    var ur = response.trim();\n    try {\n      var p = \"User responded to a guide suggestion. Their response is primary truth.\\n\"\n        + \"Do not praise. Do not validate. Mirror or sharpen. If they correct or reframe \u2014 honor the correction.\\n\"\n        + \"ONE sentence, max 25 words. JSON: {\\\"echo\\\":\\\"...\\\"}\";\n      var raw = await callClaude(p, \"Suggestion: \\\"\"+item.text+\"\\\"\\nUser said: \\\"\"+ur+\"\\\"\", 180);\n      var d = parseJSON(raw);\n      var echoText = d && d.echo ? d.echo : null;\n      if (echoText) setEcho(echoText);\n      if (onPatchSynthesis && allGuide) {\n        var updatedGuide = allGuide.map(function(g) {\n          if (g.text === item.text && g.type === item.type) {\n            return Object.assign({}, g, { userResponse: ur, echo: echoText, userAuthored: true });\n          }\n          return g;\n        });\n        onPatchSynthesis({ guide: updatedGuide });\n      }\n    } catch (e) {}\n  };\n  return (\n    <div onClick={function(){ if(!expanded && !saved) setExpanded(true); }} style={{\n      padding: \"16px 18px\", borderRadius: 14, background: \"rgba(16,20,26,0.8)\",\n      border: `1px solid ${saved ? `${gt.color}33` : expanded ? `${gt.color}22` : \"rgba(255,255,255,0.06)\"}`,\n      cursor: expanded || saved ? \"default\" : \"pointer\", transition: \"all 0.3s\",\n      animation: `riseUp 0.5s ease ${0.1 + index * 0.15}s both`,\n    }}>\n      <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, marginBottom: 8 }}>\n        <span style={{ fontSize: 14, color: gt.color }}>{gt.icon}</span>\n        <span style={{ fontSize: 10, letterSpacing: \"0.16em\", textTransform: \"uppercase\", fontWeight: 700, color: gt.color, fontFamily: FB }}>{item.type}</span>\n        {saved && <span style={{ fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, marginLeft: \"auto\" }}>responded</span>}\n        {!expanded && !saved && <span style={{ fontSize: 10, color: \"rgba(255,255,255,0.1)\", fontFamily: FB, marginLeft: \"auto\" }}>tap to respond</span>}\n      </div>\n      <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.65)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: 0 }}>{item.text}</p>\n      {expanded && !saved && (\n        <div style={{ marginTop: 14, animation: \"riseUp 0.3s ease\" }}>\n          <textarea value={response} onChange={function(e){ setResponse(e.target.value); }}\n            onKeyDown={function(e){ if (e.key === \"Enter\" && !e.shiftKey && response.trim()) { e.preventDefault(); submit(); } }}\n            placeholder=\"In your words\u2026\" rows={2} autoFocus\n            style={{ width: \"100%\", background: \"rgba(255,255,255,0.03)\", border: `1px solid ${gt.color}33`, borderRadius: 10, color: \"rgba(255,255,255,0.8)\", padding: \"10px 14px\", fontFamily: FB, fontSize: 14, resize: \"none\", outline: \"none\", lineHeight: 1.5 }} />\n          <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginTop: 8 }}>\n            <span style={{ fontSize: 11, color: \"rgba(255,255,255,0.1)\", fontFamily: FB }}>hold to save</span>\n            {response.trim() && <GuideHoldSave color={gt.color} onSave={submit} />}\n          </div>\n        </div>\n      )}\n      {saved && (\n        <div style={{ marginTop: 10 }}>\n          <div style={{ padding:\"12px 14px\", borderRadius:10,\n            background:gt.color+\"0a\", border:\"1px solid \"+gt.color+\"25\",\n            animation:\"riseUp 0.4s ease\" }}>\n            <div style={{ fontSize:9, letterSpacing:\"0.18em\", color:gt.color+\"66\",\n              fontFamily:FB, textTransform:\"uppercase\", marginBottom:6 }}>you said</div>\n            <p style={{ fontSize:15, color:\"rgba(255,255,255,0.88)\", fontFamily:FD,\n              fontStyle:\"italic\", margin:0, lineHeight:1.6 }}>{response}</p>\n          </div>\n          {echo && (\n            <div style={{ marginTop:8, paddingLeft:4, animation:\"riseUp 0.5s ease 0.2s both\" }}>\n              <p style={{ fontSize:13, color:gt.color+\"66\", fontFamily:FD,\n                fontStyle:\"italic\", lineHeight:1.6, margin:0 }}>{echo}</p>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction DescentGame({ cards: propCards, onDone }) {\n  const DESCENT_CARDS = (propCards && propCards.length > 0 ? propCards.slice(0, 4) : [\n    { type: \"energy\", phrase: \"wanting to be seen but not watched\", color: \"#FFB86B\" },\n    { type: \"binary\", prompt: \"right now you're drawn to\", option_a: \"building slowly\", option_b: \"leaping first\", color: \"#FF6B9D\" },\n    { type: \"spectrum\", prompt: \"where does this live?\", pole_a: \"still forming\", pole_b: \"ready to move\", color: \"#6BFFB8\" },\n    { type: \"binary\", prompt: \"the tension feels more like\", option_a: \"two things pulling apart\", option_b: \"one thing trying to split\", color: \"#6BB8FF\" },\n  ]).map(function(c,i){return Object.assign({},c,{color:c.color||NC[i%NC.length]});});\n  const [ci, setCi] = useState(0);\n  const [answers, setAnswers] = useState({});\n  const [showCompletion, setShowCompletion] = useState(false);\n  const c = DESCENT_CARDS[ci], ans = answers[ci] !== undefined;\n  function record(v) {\n    var newAnswers = Object.assign({}, answers, {[ci]: v});\n    setAnswers(newAnswers);\n    if (ci < DESCENT_CARDS.length - 1) {\n      setTimeout(function(){ setCi(ci + 1); }, 1600);\n    } else {\n      setTimeout(function(){ setShowCompletion(true); }, 1200);\n    }\n  }\n  // allDone only when ALL cards answered (fixed off-by-one)\n  const allDone = Object.keys(answers).length >= DESCENT_CARDS.length;\n  useEffect(function() {\n    if (showCompletion) setTimeout(function(){ onDone({ answers: answers, cards: DESCENT_CARDS }); }, 3500);\n  }, [showCompletion]);\n\n  // \u2500\u2500 Swipe state for binary cards \u2500\u2500\n  const [swipeX, setSwipeX] = useState(0);\n  const [swiping, setSwiping] = useState(false);\n  const swipeStart = useRef(0);\n  const swipeThreshold = 80;\n\n  function onTouchStart(e) { swipeStart.current = e.touches[0].clientX; setSwiping(true); setSwipeX(0); }\n  function onTouchMove(e) { if (!swiping) return; var dx = e.touches[0].clientX - swipeStart.current; setSwipeX(dx); }\n  function onTouchEnd() {\n    if (!swiping) return;\n    setSwiping(false);\n    if (swipeX < -swipeThreshold) { record(\"a\"); }\n    else if (swipeX > swipeThreshold) { record(\"b\"); }\n    setSwipeX(0);\n  }\n  function onMouseDown(e) { swipeStart.current = e.clientX; setSwiping(true); setSwipeX(0); }\n  function onMouseMove(e) { if (!swiping) return; setSwipeX(e.clientX - swipeStart.current); }\n  function onMouseUp() { onTouchEnd(); }\n\n  // Reset all interaction state when card changes\n  useEffect(function() {\n    setSwipeX(0); setSwiping(false); setHoldProg(0); setEnergyHolding(false);\n  }, [ci]);\n\n  // \u2500\u2500 Hold state for energy cards \u2500\u2500\n  const [holdProg, setHoldProg] = useState(0);\n  const [energyHolding, setEnergyHolding] = useState(false);\n  const holdRef = useRef(null);\n  const holdStartT = useRef(0);\n\n  function startEnergyHold(e) {\n    if (ans) return;\n    e.stopPropagation();\n    setEnergyHolding(true);\n    holdStartT.current = Date.now();\n    holdRef.current = setInterval(function() {\n      var p = Math.min((Date.now() - holdStartT.current) / 1800, 1);\n      setHoldProg(p);\n      if (p >= 1) { clearInterval(holdRef.current); setEnergyHolding(false); record(5); }\n    }, 30);\n  }\n  function endEnergyHold() {\n    if (holdRef.current) clearInterval(holdRef.current);\n    if (energyHolding) {\n      setEnergyHolding(false);\n      if (holdProg >= 1) return;\n      // Record any intentional press \u2014 even partial\n      if (holdProg > 0.08) {\n        var val = Math.max(1, Math.ceil(holdProg * 5));\n        record(val);\n      }\n      setHoldProg(0);\n    }\n  }\n\n  // Derived visual states\n  var swipeRatio = Math.min(Math.abs(swipeX) / swipeThreshold, 1);\n  var swipeDir = swipeX < 0 ? \"a\" : swipeX > 0 ? \"b\" : null;\n\n  return (\n    <div style={{ padding: \"20px 0\" }}>\n      {/* \u2500\u2500 COMPLETION SCREEN \u2500\u2500 */}\n      {showCompletion && <div style={{ textAlign: \"center\", padding: \"28px 0\", animation: \"riseUp 0.6s ease\" }}>\n        <div style={{ fontSize: 32, marginBottom: 16 }}>\u25c6</div>\n        <div style={{ fontSize: 18, color: \"rgba(214,178,109,0.85)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5, marginBottom: 12 }}>Descent complete.</div>\n        <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, letterSpacing: \"0.1em\" }}>\n          {Object.keys(answers).length} questions, {Object.keys(answers).length} honest answers.\n        </div>\n        <div style={{ marginTop: 20, display: \"flex\", flexDirection: \"column\", gap: 8, alignItems: \"stretch\", maxWidth: 280, margin: \"20px auto 0\" }}>\n          {DESCENT_CARDS.map(function(card, i) {\n            var ans = answers[i];\n            var display;\n            if (ans === undefined || ans === null) { display = \"\u2014\"; }\n            else if (card.type === \"energy\" && typeof ans === \"number\") {\n              var lvl = Math.max(0, Math.min(5, Math.round(ans)));\n              display = \"\u25cf\".repeat(lvl) + \"\u25cb\".repeat(5 - lvl);\n            } else if (card.type === \"spectrum\" && typeof ans === \"number\") {\n              display = ans + \"% \u2192 \" + (ans >= 50 ? (card.pole_b || \"b\") : (card.pole_a || \"a\"));\n            } else if (card.type === \"binary\" && typeof ans === \"string\") {\n              display = ans === \"a\" ? (card.option_a || \"a\") : (card.option_b || \"b\");\n            } else { display = String(ans); }\n            return <div key={i} style={{ display: \"flex\", alignItems: \"center\", gap: 10 }}>\n              <div style={{ width: 6, height: 6, borderRadius: \"50%\", background: card.color, opacity: 0.5, flexShrink: 0 }} />\n              <div style={{ fontSize: 12, color: card.color + \"AA\", fontFamily: FB, letterSpacing: \"0.04em\" }}>{display}</div>\n            </div>;\n          })}\n        </div>\n      </div>}\n\n      {!showCompletion && <><div style={{ display: \"flex\", gap: 8, marginBottom: 20, justifyContent: \"center\" }}>\n        {DESCENT_CARDS.map(function(_, i) { return <div key={i} style={{ width: i === ci ? 12 : 7, height: 7, borderRadius: 4, background: i < ci ? DESCENT_CARDS[i].color + \"88\" : i === ci ? \"white\" : \"rgba(255,255,255,0.1)\", transition: \"all 0.4s\" }} />; })}\n      </div>\n\n      <div key={ci} style={{ animation: \"slideIn 0.4s ease\" }}>\n        {/* \u2500\u2500 ENERGY: Hold to fill \u2500\u2500 */}\n        {c.type === \"energy\" && <div\n          onMouseDown={startEnergyHold} onMouseUp={endEnergyHold} onMouseLeave={endEnergyHold}\n          onTouchStart={startEnergyHold} onTouchEnd={endEnergyHold}\n          style={{ borderRadius: 22, padding: \"40px 24px\", background: \"linear-gradient(160deg,\" + c.color + \"12,rgba(10,10,30,0.9),\" + c.color + \"08)\", border: \"1px solid \" + c.color + \"22\", textAlign: \"center\", cursor: \"pointer\", userSelect: \"none\", WebkitUserSelect: \"none\", position: \"relative\", overflow: \"hidden\" }}\n        >\n          {/* Fill bar */}\n          <div style={{ position:\"absolute\", bottom:0, left:0, width:(ans ? 100 : holdProg * 100)+\"%\", height:4, background:c.color, transition:energyHolding?\"none\":\"width 0.3s ease\", opacity:0.7, borderRadius:\"0 0 22px 22px\" }} />\n          {/* Energy level \u2014 tappable dots */}\n          <div style={{ display:\"flex\", gap:12, justifyContent:\"center\", marginBottom:20 }}>\n            {[1,2,3,4,5].map(function(dot) {\n              var lit = ans ? (answers[ci] || 0) >= dot : holdProg * 5 >= dot;\n              return <div key={dot}\n                onClick={function(e){ if(!ans){ e.stopPropagation(); record(dot); } }}\n                style={{ width:18, height:18, borderRadius:\"50%\",\n                  background: lit ? c.color : \"rgba(255,255,255,0.08)\",\n                  boxShadow: lit ? \"0 0 12px \"+c.color+\"88\" : \"none\",\n                  border:\"1px solid \"+(lit ? c.color+\"88\" : \"rgba(255,255,255,0.12)\"),\n                  cursor: ans ? \"default\" : \"pointer\",\n                  transition:\"all 0.2s\" }} />;\n            })}\n          </div>\n          {!ans && <div style={{ fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.08em\", marginBottom:8 }}>tap a dot or hold to fill</div>}\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, marginBottom: 20 }}>{c.phrase}</div>\n          {!ans && <div style={{ fontSize: 11, color: \"rgba(255,255,255,0.15)\", fontFamily: FB, letterSpacing: \"0.12em\" }}>\n            {energyHolding ? \"hold longer = stronger...\" : \"hold to mark how much this matters\"}\n          </div>}\n          {ans && <div style={{ fontSize: 11, color: c.color + \"88\", fontFamily: FB, letterSpacing: \"0.12em\", animation: \"riseUp 0.3s ease\" }}>\n            {\"\u25cf\".repeat(answers[ci])}{\"\u25cb\".repeat(5 - answers[ci])} marked\n          </div>}\n        </div>}\n\n        {/* \u2500\u2500 BINARY: Swipe to choose \u2500\u2500 */}\n        {c.type === \"binary\" && <div\n          onTouchStart={!ans ? onTouchStart : undefined}\n          onTouchMove={!ans ? onTouchMove : undefined}\n          onTouchEnd={!ans ? onTouchEnd : undefined}\n          onMouseDown={!ans ? onMouseDown : undefined}\n          onMouseMove={!ans ? onMouseMove : undefined}\n          onMouseUp={!ans ? onMouseUp : undefined}\n          onMouseLeave={!ans ? onMouseUp : undefined}\n          style={{ borderRadius: 22, padding: \"36px 24px\", background: \"linear-gradient(160deg,\" + c.color + \"12,rgba(10,10,30,0.9),\" + c.color + \"08)\", border: \"1px solid \" + c.color + \"22\", textAlign: \"center\", userSelect: \"none\", WebkitUserSelect: \"none\", cursor: ans ? \"default\" : \"grab\", position: \"relative\", overflow: \"hidden\", transform: ans ? \"none\" : \"translateX(\" + swipeX * 0.3 + \"px) rotate(\" + swipeX * 0.02 + \"deg)\", transition: swiping ? \"none\" : \"transform 0.3s ease\" }}\n        >\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, marginBottom: 24 }}>{c.prompt}</div>\n\n          {!ans && <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <div style={{ fontSize: 14, fontFamily: FB, fontWeight: 600, color: swipeDir === \"a\" ? c.color : \"rgba(255,255,255,0.25)\", opacity: swipeDir === \"a\" ? 0.3 + swipeRatio * 0.7 : 0.4, transition: swiping ? \"none\" : \"all 0.3s\", transform: \"scale(\" + (swipeDir === \"a\" ? 1 + swipeRatio * 0.15 : 1) + \")\" }}>\u2190 {c.option_a}</div>\n            <div style={{ fontSize: 14, fontFamily: FB, fontWeight: 600, color: swipeDir === \"b\" ? c.color : \"rgba(255,255,255,0.25)\", opacity: swipeDir === \"b\" ? 0.3 + swipeRatio * 0.7 : 0.4, transition: swiping ? \"none\" : \"all 0.3s\", transform: \"scale(\" + (swipeDir === \"b\" ? 1 + swipeRatio * 0.15 : 1) + \")\" }}>{c.option_b} \u2192</div>\n          </div>}\n          {!ans && <div style={{ marginTop: 18, display: \"flex\", gap: 10 }}>\n            <button onClick={function(e){ e.stopPropagation(); record(\"a\"); }}\n              style={{ flex:1, padding:\"12px 8px\", borderRadius:14,\n                background: swipeDir===\"a\" ? c.color+\"22\" : \"rgba(255,255,255,0.04)\",\n                border:\"1px solid \"+(swipeDir===\"a\" ? c.color+\"66\" : \"rgba(255,255,255,0.1)\"),\n                color: swipeDir===\"a\" ? c.color : \"rgba(255,255,255,0.55)\",\n                fontSize:13, fontFamily:FB, fontWeight:600, cursor:\"pointer\",\n                transition:\"all 0.2s\" }}>{c.option_a}</button>\n            <button onClick={function(e){ e.stopPropagation(); record(\"b\"); }}\n              style={{ flex:1, padding:\"12px 8px\", borderRadius:14,\n                background: swipeDir===\"b\" ? c.color+\"22\" : \"rgba(255,255,255,0.04)\",\n                border:\"1px solid \"+(swipeDir===\"b\" ? c.color+\"66\" : \"rgba(255,255,255,0.1)\"),\n                color: swipeDir===\"b\" ? c.color : \"rgba(255,255,255,0.55)\",\n                fontSize:13, fontFamily:FB, fontWeight:600, cursor:\"pointer\",\n                transition:\"all 0.2s\" }}>{c.option_b}</button>\n          </div>}\n          {!ans && <div style={{ fontSize:10, color:\"rgba(255,255,255,0.12)\", fontFamily:FB, letterSpacing:\"0.1em\", marginTop:10, textAlign:\"center\" }}>tap or swipe</div>}\n\n          {ans && <div style={{ animation: \"riseUp 0.4s ease\" }}>\n            <div style={{ fontSize: 16, fontFamily: FB, fontWeight: 600, color: c.color }}>{answers[ci] === \"a\" ? c.option_a : c.option_b}</div>\n          </div>}\n        </div>}\n\n        {/* \u2500\u2500 SPECTRUM: Keep existing slider \u2500\u2500 */}\n        {c.type === \"spectrum\" && <div style={{ borderRadius: 22, padding: \"32px 24px\", background: \"linear-gradient(160deg,\" + c.color + \"12,rgba(10,10,30,0.9),\" + c.color + \"08)\", border: \"1px solid \" + c.color + \"22\", position: \"relative\", overflow: \"hidden\" }}>\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, textAlign: \"center\", marginBottom: 24 }}>{c.prompt}</div>\n          <SpectrumSlider color={c.color} poleA={c.pole_a} poleB={c.pole_b} onSet={function(v){ record(v); }} value={answers[ci] !== undefined ? answers[ci] : null} />\n        </div>}\n      </div>\n\n      <div style={{ display: \"flex\", gap: 12, marginTop: 14, justifyContent: \"space-between\" }}>\n        {ci > 0 && <button onClick={function() { setCi(ci - 1); }} style={{ padding: \"8px 16px\", borderRadius: 20, border: \"1px solid rgba(255,255,255,0.06)\", background: \"transparent\", color: \"rgba(255,255,255,0.25)\", fontSize: 12, fontFamily: FB, cursor: \"pointer\" }}>\u2190</button>}\n        <div style={{ flex: 1 }} />\n        {ans && ci < DESCENT_CARDS.length - 1 && <button onClick={function() { setCi(ci + 1); }} style={{ padding: \"8px 20px\", borderRadius: 20, border: \"none\", background: c.color + \"22\", color: c.color + \"cc\", fontSize: 12, fontFamily: FB, fontWeight: 500, cursor: \"pointer\" }}>\u2192</button>}\n      </div>\n      </>}\n    </div>\n  );\n}\n\n// \u2500\u2500 Tappable Sentence \u2014 tap any line in the reading to respond \u2500\u2500\n\nfunction TappableSentence({ text, synthesisData, onReact }) {\n  var [state, setState] = useState(\"idle\"); // idle|active|landed|resisted|held\n  var [swipeX, setSwipeX] = useState(0);\n  var [swiping, setSwiping] = useState(false);\n  var swipeStart = useRef(0);\n  var holdTimer = useRef(null);\n  var holdStartT = useRef(0);\n  var [holdProg, setHoldProg] = useState(0);\n  // Note hooks must be here \u2014 before any early returns\n  var [noteOpen, setNoteOpen] = React.useState(false);\n  var [noteDraft, setNoteDraft] = React.useState(\"\");\n  var [noteSaved, setNoteSaved] = React.useState(\"\");\n  var threshold = 60;\n\n  function onStart(clientX, e) {\n    if (state !== \"idle\") return;\n    e.stopPropagation();\n    setState(\"active\");\n    swipeStart.current = clientX;\n    setSwiping(true);\n    setSwipeX(0);\n    // Start hold timer\n    holdStartT.current = Date.now();\n    holdTimer.current = setInterval(function() {\n      var p = Math.min((Date.now() - holdStartT.current) / 1200, 1);\n      setHoldProg(p);\n      if (p >= 1) { clearInterval(holdTimer.current); setState(\"held\"); setSwiping(false); setSwipeX(0); setHoldProg(0); if (onReact) onReact(text, \"held\"); }\n    }, 30);\n  }\n  function onMove(clientX) {\n    if (!swiping || state !== \"active\") return;\n    var dx = clientX - swipeStart.current;\n    setSwipeX(dx);\n    // If moving, cancel hold\n    if (Math.abs(dx) > 10 && holdTimer.current) { clearInterval(holdTimer.current); setHoldProg(0); }\n  }\n  function onEnd() {\n    if (holdTimer.current) clearInterval(holdTimer.current);\n    setHoldProg(0);\n    if (!swiping) return;\n    setSwiping(false);\n    if (state === \"held\") return;\n    if (swipeX < -threshold) { setState(\"landed\"); if (onReact) onReact(text, \"landed\"); }\n    else if (swipeX > threshold) { setState(\"resisted\"); if (onReact) onReact(text, \"resisted\"); }\n    else { setState(\"idle\"); } // didn't commit\n    setSwipeX(0);\n  }\n\n  var ratio = Math.min(Math.abs(swipeX) / threshold, 1);\n  var dir = swipeX < 0 ? \"land\" : swipeX > 0 ? \"resist\" : null;\n\n  if (state === \"idle\") {\n    return <span\n      onTouchStart={function(e) { onStart(e.touches[0].clientX, e); }}\n      onTouchMove={function(e) { onMove(e.touches[0].clientX); }}\n      onTouchEnd={onEnd}\n      onMouseDown={function(e) { onStart(e.clientX, e); }}\n      onMouseMove={function(e) { onMove(e.clientX); }}\n      onMouseUp={onEnd}\n      onMouseLeave={onEnd}\n      style={{ cursor: \"pointer\", color: \"inherit\", borderBottom: \"1px dotted rgba(214,178,109,0.15)\", paddingBottom: 1, transition: \"color 0.2s\" }}\n    >{text} </span>;\n  }\n\n  if (state === \"active\") {\n    return <span\n      onTouchMove={function(e) { onMove(e.touches[0].clientX); }}\n      onTouchEnd={onEnd}\n      onMouseMove={function(e) { onMove(e.clientX); }}\n      onMouseUp={onEnd}\n      onMouseLeave={onEnd}\n      style={{\n        display: \"inline-block\", cursor: \"grabbing\",\n        transform: \"translateX(\" + swipeX * 0.4 + \"px)\",\n        color: dir === \"land\" ? \"#7DB7AE\" : dir === \"resist\" ? \"#ff6090\" : holdProg > 0.3 ? \"#D6B26D\" : \"inherit\",\n        transition: swiping ? \"none\" : \"all 0.3s\",\n        background: holdProg > 0 ? \"rgba(214,178,109,\" + holdProg * 0.08 + \")\" : dir === \"land\" ? \"rgba(125,183,174,\" + ratio * 0.08 + \")\" : dir === \"resist\" ? \"rgba(255,96,144,\" + ratio * 0.08 + \")\" : \"transparent\",\n        borderRadius: 4, padding: \"0 2px\",\n      }}\n    >{text} {holdProg > 0.3 && <span style={{ fontSize: 9, color: \"#D6B26D88\", fontFamily: FB }}>holding...</span>}</span>;\n  }\n\n  // \u2500\u2500 Final states: every reaction can take a note \u2500\u2500\n\n  function saveNote() {\n    var n = noteDraft.trim();\n    if (n) {\n      setNoteSaved(n);\n      if (onReact) onReact(text, state, n);\n    }\n    setNoteOpen(false);\n    setNoteDraft(\"\");\n  }\n\n  var stateColor = state === \"landed\" ? \"#6BFFB8\"\n    : state === \"held\" ? \"#D6B26D\"\n    : state === \"resisted\" ? \"rgba(255,96,144,0.55)\" : \"inherit\";\n  var stateMark = state === \"landed\" ? \" \u2713\" : state === \"held\" ? \" \u25cf\" : state === \"resisted\" ? \" \u2715\" : \"\";\n  var stateLabel = state === \"landed\" ? \"resonates\" : state === \"held\" ? \"marked\" : state === \"resisted\" ? \"not quite\" : \"\";\n  var notePrompt = state === \"landed\" ? \"Add signal\"\n    : state === \"held\" ? \"Add signal\"\n    : \"Add signal \u2014 what's different?\";\n  var notePlaceholder = \"type anything \u2014 this won't be shown back to you\";\n\n  return (\n    <span style={{ display:\"inline\" }}>\n      <span style={{ color: stateColor, transition:\"color 0.3s\" }}>\n        {text}<span style={{ fontSize:9, fontFamily:FB, opacity:0.6, letterSpacing:\"0.05em\" }}>{stateMark}</span>{\" \"}\n      </span>\n      {!noteSaved && !noteOpen && (\n        <span onClick={function(e){e.stopPropagation(); setNoteOpen(true);}}\n          style={{ display:\"inline-block\", fontSize:10, color: stateColor, fontFamily:FB,\n            background:\"rgba(255,255,255,0.04)\", border:\"1px solid rgba(255,255,255,0.1)\",\n            borderRadius:10, padding:\"2px 10px\", cursor:\"pointer\", marginLeft:4,\n            letterSpacing:\"0.05em\", verticalAlign:\"middle\", opacity:0.75 }}>\n          + note\n        </span>\n      )}\n      {noteSaved && (\n        <span style={{ display:\"inline-block\", marginLeft:6, fontSize:10,\n          color:stateColor, fontFamily:FB, letterSpacing:\"0.08em\", opacity:0.7 }}>\n          incorporated\n        </span>\n      )}\n      {noteOpen && (\n        <span onClick={function(e){e.stopPropagation();}} style={{ display:\"block\", marginTop:8 }}>\n          <div style={{ fontSize:11, color:\"rgba(255,255,255,0.45)\", fontFamily:FB,\n            letterSpacing:\"0.08em\", marginBottom:6 }}>{notePrompt}</div>\n          <textarea value={noteDraft} onChange={function(e){setNoteDraft(e.target.value);}}\n            onKeyDown={function(e){ if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();saveNote();}\n              if(e.key===\"Escape\"){setNoteOpen(false);setNoteDraft(\"\");} }}\n            placeholder={notePlaceholder} autoFocus\n            style={{ width:\"100%\", minHeight:56, background:\"rgba(255,255,255,0.04)\",\n              border:\"1px solid \"+stateColor+\"44\", borderRadius:8,\n              color:\"rgba(255,255,255,0.88)\", fontFamily:FD, fontSize:14,\n              padding:\"9px 12px\", resize:\"none\", outline:\"none\", lineHeight:1.55,\n              boxSizing:\"border-box\" }} />\n          <div style={{ display:\"flex\", justifyContent:\"space-between\", marginTop:5 }}>\n            <button onClick={function(){setNoteOpen(false);setNoteDraft(\"\");}}\n              style={{ fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB,\n                background:\"transparent\", border:\"none\", cursor:\"pointer\" }}>cancel</button>\n            <button onClick={saveNote}\n              style={{ fontSize:11, color:stateColor, fontFamily:FB,\n                background:\"rgba(255,255,255,0.04)\", border:\"1px solid \"+stateColor+\"44\",\n                borderRadius:12, padding:\"4px 14px\", cursor:\"pointer\" }}>save note</button>\n          </div>\n        </span>\n      )}\n    </span>\n  );\n}\n\nfunction TappableReading({ text, synthesisData, onReact }) {\n  if (!text || text.trim().length === 0) return <span>{text}</span>;\n  var sentences = text.match(/[^.!?]+[.!?]+[\\u201D\\u201C\\u2019\\u2018\"']?\\s*/g);\n  if (!sentences || sentences.length === 0) {\n    return <TappableSentence text={text.trim()} synthesisData={synthesisData} onReact={onReact} />;\n  }\n  return <span>{sentences.map(function(s, i) {\n    return <TappableSentence key={i} text={s.trim()} synthesisData={synthesisData} onReact={onReact} />;\n  })}</span>;\n}\n\n// \u2500\u2500 Clarity Hold-to-Save \u2500\u2500\nfunction ClarityHoldInput({ value, onChange, onSave }) {\n  var [holdProg, setHoldProg] = useState(0);\n  var [holding, setHolding] = useState(false);\n  var holdRef = useRef(null);\n  var holdStartT = useRef(0);\n\n  function startHold(e) {\n    if (!value.trim()) return;\n    e.stopPropagation();\n    setHolding(true);\n    holdStartT.current = Date.now();\n    holdRef.current = setInterval(function() {\n      var p = Math.min((Date.now() - holdStartT.current) / 1200, 1);\n      setHoldProg(p);\n      if (p >= 1) { clearInterval(holdRef.current); setHolding(false); setHoldProg(0); onSave(); }\n    }, 30);\n  }\n  function endHold() {\n    if (holdRef.current) clearInterval(holdRef.current);\n    setHolding(false);\n    setHoldProg(0);\n  }\n\n  return <div>\n    <input type=\"text\" value={value} onChange={function(e) { onChange(e.target.value); }}\n      placeholder=\"Name it plainly\\u2026\" maxLength={140}\n      style={{ width: \"100%\", background: \"transparent\", border: \"none\", borderBottom: \"1px solid rgba(214,178,109,0.15)\", borderRadius: 0, color: \"rgba(255,255,255,0.9)\", padding: \"12px 0\", fontFamily: FB, fontSize: 16, outline: \"none\", letterSpacing: \"0.02em\" }} />\n    {value.trim() && <div style={{ marginTop: 16, position: \"relative\" }}>\n      <div\n        onMouseDown={startHold} onMouseUp={endHold} onMouseLeave={endHold}\n        onTouchStart={startHold} onTouchEnd={endHold}\n        style={{\n          padding: \"14px 24px\", borderRadius: 20, textAlign: \"center\", cursor: \"pointer\",\n          background: \"rgba(214,178,109,\" + (0.04 + holdProg * 0.12) + \")\",\n          border: \"1px solid rgba(214,178,109,\" + (0.15 + holdProg * 0.35) + \")\",\n          color: \"#D6B26D\", fontSize: 13, fontFamily: FB, userSelect: \"none\", WebkitUserSelect: \"none\",\n          transition: holding ? \"none\" : \"all 0.3s\",\n          transform: \"scale(\" + (1 + holdProg * 0.04) + \")\",\n        }}\n      >\n        {holding ? \"locking in\\u2026\" : \"hold to keep this\"}\n      </div>\n      <div style={{ position: \"absolute\", bottom: 0, left: 0, width: holdProg * 100 + \"%\", height: 2, borderRadius: 1, background: \"#D6B26D\", transition: holding ? \"none\" : \"width 0.2s ease\", opacity: 0.6 }} />\n    </div>}\n  </div>;\n}\n\nfunction SessionPhase({ onComplete, synthesisData, onPatchSynthesis }) {\n  const [descentOpen, setDescentOpen] = useState(false);\n  const [descentDone, setDescentDone] = useState(false);\n  const [descentResult, setDescentResult] = useState(null);\n  const [clarity, setClarity] = useState(\"\");\n  const [claritySaved, setClaritySaved] = useState(false);\n  const [showNoticing, setShowNoticing] = useState(false);\n  const scrollRef = useRef(null);\n\n  // \u2500\u2500 Reaction tracking \u2500\u2500\n  // reactions: { [sectionId_or_sentence]: \"landed\"|\"resisted\"|\"held\" }\n  // corrections: { [sectionId]: string } \u2014 user's own words when they push back\n  const [reactions, setReactions] = useState({});\n  // signals: derived features only \u2014 raw text is NEVER stored or shown\n  // { resisted_count, held_count, landed_count, counter_topics: [], shifted_tension: bool }\n  const [signals, setSignals] = useState({ resisted_count:0, held_count:0, landed_count:0, counter_topics:[], shifted_tension:false });\n  const [revisedSynthesis, setRevisedSynthesis] = useState(null);\n  const [isRevising, setIsRevising] = useState(false);\n  const [signalStatus, setSignalStatus] = useState(null); // \"recomputing\"|\"new_connection\"|null\n\n  // Extract topic keywords from a note \u2014 used as counter-evidence, never shown\n  function extractTopics(note) {\n    if (!note) return [];\n    // Simple keyword extraction: words 4+ chars, not stopwords\n    var stop = new Set([\"that\",\"this\",\"with\",\"have\",\"from\",\"they\",\"been\",\"were\",\"what\",\"when\",\"about\",\"just\",\"also\",\"into\",\"more\",\"some\",\"than\",\"them\",\"then\",\"very\",\"will\",\"your\",\"their\",\"which\",\"would\",\"could\",\"there\"]);\n    return note.toLowerCase().replace(/[^a-z\\s]/g,\"\").split(/\\s+/).filter(function(w){ return w.length >= 4 && !stop.has(w); }).slice(0,4);\n  }\n\n  function handleReact(sentenceOrId, reaction, note) {\n    setReactions(function(prev) { return Object.assign({}, prev, { [sentenceOrId]: reaction }); });\n    // Update derived signals \u2014 not raw text\n    setSignals(function(prev) {\n      var s = Object.assign({}, prev);\n      if (reaction === \"resisted\") s.resisted_count = (s.resisted_count||0) + 1;\n      if (reaction === \"held\") s.held_count = (s.held_count||0) + 1;\n      if (reaction === \"landed\") s.landed_count = (s.landed_count||0) + 1;\n      if (note) {\n        var topics = extractTopics(note);\n        s.counter_topics = Array.from(new Set((s.counter_topics||[]).concat(topics))).slice(0,10);\n        if (reaction === \"resisted\") s.shifted_tension = true;\n      }\n      return s;\n    });\n    // If they pushed back with a note, fire revision using note as silent evidence\n    if (reaction === \"resisted\" && note && note.trim()) {\n      fireRevision(note.trim(), sentenceOrId);\n    }\n  }\n\n  async function fireRevision(counterEvidence, originalSentence) {\n    setIsRevising(true);\n    setSignalStatus(\"recomputing\");\n    try {\n      var themes = (sd.themes||[]).map(function(t){return t.label;}).join(\", \");\n      var tension = sd.tension ? sd.tension.a + \" vs \" + sd.tension.b : \"none\";\n      var raw = await callClaude(\n        \"The user has pushed back on part of your reading. Their pushback is the truth \u2014 not counter-evidence to be managed, but correction to be honored.\\n\"\n        + \"RULE: The resisted sentence was YOUR interpretation. The user knows their experience better than you do.\\n\"\n        + \"RULE: Do not defend or reframe the original reading. Update it.\\n\"\n        + \"RULE: The new synthesis should INCORPORATE what they said, not find a clever way around it.\\n\"\n        + \"RULE: If they gave words, their words are the new truth for that area. Reflect them back.\\n\"\n        + \"Return ONLY JSON: {\\\"synthesis\\\": \\\"1-2 sentences that honor both the original patterns AND the user's correction\\\", \\\"new_connection\\\": \\\"one link that emerges from THEIR words (or null)\\\", \\\"tension_text\\\": \\\"...\\\"}\",\n        \"Original reading: \\\"\" + (sd.synthesis||\"\") + \"\\\"\\n\"\n        + \"Resisted sentence: \\\"\" + originalSentence + \"\\\"\\n\"\n        + \"Counter-evidence topics (do not quote): \" + extractTopics(counterEvidence).join(\", \") + \"\\n\"\n        + \"Themes: \" + themes + \"\\n\"\n        + \"Tension: \" + tension,\n        280\n      );\n      var d = parseJSON(raw);\n      if (d && d.synthesis) {\n        setRevisedSynthesis({ synthesis: d.synthesis, new_connection: d.new_connection||null, tension_text: d.tension_text||null });\n        setSignalStatus(d.new_connection ? \"new_connection\" : null);\n        if (onPatchSynthesis) {\n          var lp = { synthesis: d.synthesis };\n          if (d.tension_text) lp.tension = { text: d.tension_text };\n          onPatchSynthesis(lp);\n        }\n      }\n    } catch(e) { setSignalStatus(null); }\n    setIsRevising(false);\n  }\n\n  // Has the user resisted anything in a given section?\n  function sectionResisted(sentencePrefix) {\n    return Object.keys(reactions).some(function(k) {\n      return k.startsWith(sentencePrefix) && reactions[k] === \"resisted\";\n    });\n  }\n  var saveClarity = function() {\n    if (clarity.trim()) {\n      setClaritySaved(true);\n      setTimeout(function() { setShowNoticing(true); }, 1200);\n    }\n  };\n\n  const sd = synthesisData || {};\n  var archData = sd.archetype || (sd.archetypes && sd.archetypes[0]) || null;\n  var sessions = []; try { sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\"); } catch(e) {}\n  var sessionNum = sessions.length + 1;\n  const THEMES = (sd.themes || []).map(function(t, i) { return { name: t.label, color: t.color || NC[i % NC.length], weight: Math.min((t.weight || 1) / 5, 1) }; });\n  const GUIDE_ITEMS = (sd.guide || []).map(function(g) { return { type: g.type || \"notice\", text: g.text || \"\" }; });\n  // \u2500\u2500 All content conditional \u2014 never use hardcoded fallbacks \u2500\u2500\n  const synthesis = sd.synthesis || null;\n  const underneath = sd.underneath || [];\n  var tension = sd.tension || null;\n  var opening = sd.opening || null;\n  var noticing = sd.noticing || null;\n  var mapTitle = sd.map_title || \"\";\n  var descentCards = (sd.descent_cards && sd.descent_cards.length > 0) ? sd.descent_cards : null;\n\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", overflow: \"auto\", WebkitOverflowScrolling: \"touch\" }} ref={scrollRef}>\n      <Particles color=\"rgba(214,178,109,0.15)\" count={8} />\n      <div style={{ maxWidth: 380, margin: \"0 auto\", padding: \"60px 20px 40px\", position: \"relative\", zIndex: 1 }}>\n\n        {/* \u2500\u2500 Session header \u2500\u2500 */}\n        <div style={{ marginBottom: archData ? 18 : 28, animation: \"riseUp 0.5s ease\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.2em\", textTransform: \"uppercase\", color: \"rgba(255,255,255,0.38)\", fontFamily: FB }}>\n            SESSION {sessionNum} \u00b7 {new Date().toLocaleDateString(\"en-US\", { month: \"long\", day: \"numeric\" }).toUpperCase()}\n          </div>\n        </div>\n\n        {/* \u2500\u2500 ARCHETYPE HERO \u2014 if AI provided it \u2500\u2500 */}\n        {archData && <div style={{ marginBottom: 36, animation: \"riseUp 0.7s ease 0.05s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", color: \"rgba(232,67,147,0.75)\", fontFamily: FB, marginBottom: 10, textTransform: \"uppercase\" }}>your pattern</div>\n          <div style={{ fontSize: 34, color: \"white\", fontFamily: FB, fontWeight: 900, letterSpacing: \"0.01em\", lineHeight: 1.1, marginBottom: 8 }}>{archData.name}</div>\n          {archData.line && <div style={{ fontSize: 17, color: \"rgba(255,255,255,0.72)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.55 }}>{archData.line}</div>}\n        </div>}\n\n        {/* \u2500\u2500 WHAT EMERGED \u2014 Wrapped chip style \u2500\u2500 */}\n        {THEMES.length > 0 && <div style={{ marginBottom: 32, animation: \"riseUp 0.5s ease 0.08s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#E84393\", marginBottom: 14, fontFamily: FB, textTransform: \"uppercase\", opacity: 0.75 }}>\n            {THEMES.length} forces\n          </div>\n          <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: 9 }}>\n            {THEMES.map(function(t, i) {\n              var sz = Math.round(11 + t.weight * 10);\n              var pad = t.weight > 0.7 ? \"11px 22px\" : \"8px 16px\";\n              return <div key={t.name} style={{ padding: pad, borderRadius: 24, background: t.color + \"18\", border: \"1px solid \" + t.color + \"40\", fontSize: sz, color: t.color, fontFamily: FB, fontWeight: 700, letterSpacing: \"0.04em\", animation: \"riseUp 0.5s ease \" + (i * 0.07) + \"s both\", lineHeight: 1 }}>{t.name}</div>;\n            })}\n          </div>\n        </div>}\n\n        {/* \u2500\u2500 THE READING \u2014 only if AI provided synthesis \u2500\u2500 */}\n        {synthesis && <div style={{ marginBottom: 32, animation: \"riseUp 0.6s ease 0.12s both\" }}>\n          <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", marginBottom: 14 }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#D6B26D\", fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>the reading</div>\n            {isRevising && <div style={{ fontSize:10, color:\"rgba(214,178,109,0.6)\", fontFamily:FB, letterSpacing:\"0.14em\", animation:\"pulse 1.5s ease infinite\" }}>recomputing...</div>}\n            {!isRevising && signalStatus === \"new_connection\" && <div style={{ fontSize:10, color:\"rgba(107,184,255,0.65)\", fontFamily:FB, letterSpacing:\"0.12em\" }}>new connection found \u2193</div>}\n            {!isRevising && signals.resisted_count > 0 && signalStatus !== \"new_connection\" && <div style={{ fontSize:10, color:\"rgba(255,255,255,0.25)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>incorporated</div>}\n          </div>\n\n          {mapTitle && <div style={{ fontSize: 12, color: \"rgba(214,178,109,0.3)\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 10 }}>{mapTitle}</div>}\n\n          {revisedSynthesis\n            ? <div style={{ animation: \"riseUp 0.6s ease\" }}>\n                <p style={{ fontSize: 20, color: \"rgba(255,255,255,0.9)\", fontFamily: FD, lineHeight: 1.75, margin: 0 }}>\n                  <TappableReading text={revisedSynthesis.synthesis} synthesisData={sd} onReact={handleReact} />\n                </p>\n                {revisedSynthesis.new_connection && <div style={{ marginTop:16, padding:\"12px 16px\", borderRadius:10,\n                  background:\"rgba(107,184,255,0.06)\", border:\"1px solid rgba(107,184,255,0.15)\", animation:\"riseUp 0.5s ease both\" }}>\n                  <div style={{ fontSize:10, color:\"rgba(107,184,255,0.6)\", fontFamily:FB, letterSpacing:\"0.2em\", textTransform:\"uppercase\", marginBottom:6 }}>new connection</div>\n                  <div style={{ fontSize:16, color:\"rgba(107,184,255,0.85)\", fontFamily:FD, lineHeight:1.6 }}>{revisedSynthesis.new_connection}</div>\n                </div>}\n              </div>\n            : <p style={{ fontSize: 20, color: \"rgba(255,255,255,0.88)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.75, margin: 0 }}>\n                <TappableReading text={synthesis} synthesisData={sd} onReact={handleReact} />\n              </p>\n          }\n        </div>}\n\n        {/* \u2500\u2500 WHAT'S UNDERNEATH \u2014 only if AI provided it \u2500\u2500 */}\n        {underneath.length > 0 && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.2s both\" }}>\n          <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", marginBottom: 14 }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#B86BFF\", fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>what{\"'\"}s underneath</div>\n            <div style={{ fontSize: 10, color: \"rgba(183,107,255,0.38)\", fontFamily: FB, letterSpacing: \"0.05em\" }}>swipe right to push back</div>\n          </div>\n          {underneath.map(function(t, i) {\n            var uKey = \"underneath_\" + i;\n            var uReaction = reactions[uKey];\n            return <div key={i} style={{ padding: \"12px 14px 12px 20px\", borderRadius: 12,\n              background: uReaction === \"resisted\" ? \"rgba(255,96,144,0.03)\" : \"rgba(183,107,255,0.04)\",\n              border: \"1px solid \" + (uReaction === \"landed\" ? \"rgba(107,255,184,0.15)\" : uReaction === \"resisted\" ? \"rgba(255,96,144,0.12)\" : \"rgba(183,107,255,0.08)\"),\n              marginBottom: 8, position: \"relative\", animation: \"riseUp 0.5s ease \" + (0.3 + i * 0.1) + \"s both\", transition: \"all 0.3s\" }}>\n              <div style={{ position: \"absolute\", left: 10, top: 16, width: 3, height: 3, borderRadius: \"50%\",\n                background: uReaction === \"landed\" ? \"#6BFFB8\" : uReaction === \"resisted\" ? \"rgba(255,96,144,0.6)\" : \"#B86BFF\", opacity: 0.5 }} />\n              <p style={{ fontSize: 15, color: uReaction === \"resisted\" ? \"rgba(255,255,255,0.2)\" : \"rgba(255,255,255,0.55)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.65, margin: \"0 0 6px\" }}>\n                <TappableSentence text={t} onReact={function(_, r) { handleReact(uKey, r); }} />\n              </p>\n              {uReaction === \"landed\" && <div style={{ fontSize: 10, color: \"rgba(107,255,184,0.4)\", fontFamily: FB, letterSpacing: \"0.12em\" }}>\u2190 yes</div>}\n\n            </div>;\n          })}\n        </div>}\n\n        {/* \u2500\u2500 THE TENSION \u2014 only if AI provided it \u2500\u2500 */}\n        {tension && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.3s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#FFB86B\", marginBottom: 14, fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>the tension</div>\n          <div style={{ display: \"flex\", alignItems: \"center\", gap: 10, marginBottom: tension.text ? 12 : 0 }}>\n            <div style={{ flex: 1, padding: \"14px 18px\", borderRadius: 12, background: \"rgba(255,184,107,0.07)\", border: \"1px solid rgba(255,184,107,0.18)\", textAlign: \"center\" }}>\n              <div style={{ fontSize: 19, color: \"#FFB86B\", fontFamily: FB, fontWeight: 900 }}>{tension.a}</div>\n            </div>\n            <div style={{ fontSize: 15, color: \"rgba(255,255,255,0.12)\", fontFamily: FB, flexShrink: 0 }}>\u2194</div>\n            <div style={{ flex: 1, padding: \"14px 18px\", borderRadius: 12, background: \"rgba(107,184,255,0.07)\", border: \"1px solid rgba(107,184,255,0.18)\", textAlign: \"center\" }}>\n              <div style={{ fontSize: 19, color: \"#6BB8FF\", fontFamily: FB, fontWeight: 900 }}>{tension.b}</div>\n            </div>\n          </div>\n          {(revisedSynthesis && revisedSynthesis.tension_text\n            ? <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.72)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: \"0 0 4px\" }}>\n                {revisedSynthesis.tension_text}\n                <span style={{ fontSize: 9, color: \"rgba(255,96,144,0.4)\", fontFamily: FB, letterSpacing: \"0.2em\", marginLeft: 8 }}>revised</span>\n              </p>\n            : tension.text && <p style={{ fontSize: 15, color: reactions[\"tension\"] === \"resisted\" ? \"rgba(255,255,255,0.2)\" : \"rgba(255,255,255,0.62)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: \"0 0 12px\" }}>{tension.text}</p>\n          )}\n          {/* \u2500\u2500 Tension reaction \u2500\u2500 */}\n          {!reactions[\"tension\"] && <div style={{ display: \"flex\", gap: 8 }}>\n            <button onClick={function() { handleReact(\"tension\", \"landed\"); }} style={{ flex: 1, fontSize: 11, color: \"rgba(107,255,184,0.45)\", fontFamily: FB, background: \"rgba(107,255,184,0.04)\", border: \"1px solid rgba(107,255,184,0.1)\", borderRadius: 16, padding: \"8px 0\", cursor: \"pointer\", letterSpacing: \"0.06em\" }}>this lands \u2190</button>\n            <button onClick={function() { handleReact(\"tension\", \"resisted\"); }} style={{ flex: 1, fontSize: 11, color: \"rgba(255,96,144,0.45)\", fontFamily: FB, background: \"rgba(255,96,144,0.04)\", border: \"1px solid rgba(255,96,144,0.1)\", borderRadius: 16, padding: \"8px 0\", cursor: \"pointer\", letterSpacing: \"0.06em\" }}>\u2192 not right</button>\n          </div>}\n          {reactions[\"tension\"] === \"landed\" && <div style={{ fontSize: 10, color: \"rgba(107,255,184,0.4)\", fontFamily: FB, letterSpacing: \"0.15em\", animation: \"riseUp 0.3s ease\" }}>\u2190 noted</div>}\n          {reactions[\"tension\"] === \"resisted\" && <div style={{ fontSize:10, color:\"rgba(255,255,255,0.3)\", fontFamily:FB, letterSpacing:\"0.12em\", animation:\"riseUp 0.3s ease\" }}>signal incorporated</div>}\n        </div>}\n\n        {/* \u2500\u2500 WHAT'S OPENING \u2014 only if AI provided it \u2500\u2500 */}\n        {opening && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.35s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#6BFFB8\", marginBottom: 14, fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>what{\"'\"}s opening</div>\n          <p style={{ fontSize: 19, color: \"rgba(107,255,184,0.88)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.65, margin: 0 }}>{opening}</p>\n        </div>}\n\n        {/* \u2500\u2500 YOUR GUIDE \u2014 only if AI provided it \u2500\u2500 */}\n        {GUIDE_ITEMS.length > 0 && <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.4s both\" }}>\n          <div style={{ fontSize: 9, letterSpacing: \"0.45em\", fontWeight: 600, color: \"#7DB7AE\", marginBottom: 14, fontFamily: FB, opacity: 0.6, textTransform: \"uppercase\" }}>your guide</div>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 10 }}>\n            {GUIDE_ITEMS.map(function(item, i) { return <GuideItem key={i} item={item} index={i} onPatchSynthesis={onPatchSynthesis} allGuide={sd.guide||[]} />; })}\n          </div>\n        </div>}\n\n        {/* \u2500\u2500 DESCENT \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\" }}>\n          {!descentOpen && !descentDone && (\n            <div onClick={function(){ setDescentOpen(true); }} style={{\n              display: \"flex\", alignItems: \"center\", justifyContent: \"center\", gap: 8,\n              fontFamily: FB, fontSize: 15, color: \"rgba(214,178,109,0.7)\", textAlign: \"center\",\n              cursor: \"pointer\", padding: \"18px 20px\", borderRadius: 14,\n              border: \"1px solid rgba(214,178,109,0.08)\", background: \"rgba(214,178,109,0.015)\",\n              transition: \"all 0.3s\", fontWeight: 600, letterSpacing: \"0.03em\",\n              animation: \"riseUp 0.5s ease 0.6s both\",\n            }}>\n              <span style={{ fontSize: 16 }}>\u25c6</span> See what's underneath\n            </div>\n          )}\n          {descentOpen && !descentDone && (\n            <div style={{ animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#D6B26D\", marginBottom: 8, fontFamily: FB, textAlign: \"center\" }}>THE DESCENT</div>\n              <DescentGame cards={descentCards} onDone={function(data) { setDescentResult(data); setDescentDone(true); }} />\n            </div>\n          )}\n          {descentDone && <div style={{ textAlign: \"center\", padding: \"20px 0\", animation: \"riseUp 0.5s ease\" }}>\n            <div style={{ fontSize: 11, color: \"rgba(214,178,109,0.5)\", fontFamily: FB, letterSpacing: \"0.2em\" }}>\u25c6 DESCENT COMPLETE \u25c6</div>\n            {descentResult && descentResult.cards && <div style={{ display: \"flex\", gap: 8, justifyContent: \"center\", marginTop: 12, flexWrap: \"wrap\" }}>\n              {descentResult.cards.map(function(card, i) {\n                var ans = descentResult.answers ? descentResult.answers[i] : null;\n                if (ans === null || ans === undefined) return null;\n                var display;\n                if (card.type === \"energy\" && typeof ans === \"number\") {\n                  var lvl2 = Math.max(0, Math.min(5, Math.round(ans)));\n                  display = \"\u25cf\".repeat(lvl2) + \"\u25cb\".repeat(5 - lvl2);\n                } else if (card.type === \"spectrum\" && typeof ans === \"number\") {\n                  display = Math.round(ans) + \"%\";\n                } else if (card.type === \"binary\") { display = String(ans); }\n                else { display = String(ans); }\n                return <div key={i} style={{ padding: \"6px 12px\", borderRadius: 16, background: (card.color || \"#D6B26D\") + \"15\", border: \"1px solid \" + (card.color || \"#D6B26D\") + \"30\", fontSize: 10, color: (card.color || \"#D6B26D\") + \"88\", fontFamily: FB, letterSpacing: \"0.08em\" }}>{display}</div>;\n              })}\n            </div>}\n          </div>}\n        </div>\n\n        {/* \u2500\u2500 CLARITY \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"rgba(214,178,109,0.35)\", marginBottom: 14, fontFamily: FB }}>WHAT ARE YOU TAKING WITH YOU?</div>\n          {!claritySaved ? (\n            <ClarityHoldInput value={clarity} onChange={setClarity} onSave={saveClarity} />\n          ) : (\n            <div style={{ animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 16, color: \"#D6B26D\", fontFamily: FB, lineHeight: 1.55, letterSpacing: \"0.02em\" }}>{clarity}</div>\n              <div style={{ fontSize: 9, letterSpacing: \"0.25em\", textTransform: \"uppercase\", color: \"#7DB7AE\", marginTop: 8, opacity: 0.4 }}>SAVED</div>\n            </div>\n          )}\n        </div>\n\n        {/* \u2500\u2500 AI NOTICING \u2014 conditional + styled \u2500\u2500 */}\n        {showNoticing && noticing && (\n          <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 1s ease\" }}>\n            <div style={{ fontSize: 9, letterSpacing: \"0.35em\", color: \"rgba(214,178,109,0.35)\", fontFamily: FB, marginBottom: 8, textTransform: \"uppercase\" }}>the system notices</div>\n            <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.38)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.7 }}>\n              \u2726 {noticing}\n            </div>\n          </div>\n        )}\n\n        {/* \u2500\u2500 CONTINUE \u2500\u2500 */}\n        <button onClick={function(){ onComplete({ descent: descentResult, clarity: clarity, claritySaved: claritySaved, reactions: reactions, signals: signals, revisedSynthesis: revisedSynthesis }); }} style={{\n          width: \"100%\", background: claritySaved ? \"linear-gradient(135deg, #6BFFB8, #3DFFAA)\" : \"rgba(107,255,184,0.08)\",\n          border: claritySaved ? \"none\" : \"1px solid rgba(107,255,184,0.15)\",\n          borderRadius: 24, padding: \"14px 28px\",\n          color: claritySaved ? \"#0A2E1A\" : \"rgba(107,255,184,0.3)\",\n          fontSize: 15, fontFamily: FB, fontWeight: claritySaved ? 600 : 400,\n          cursor: \"pointer\", transition: \"all 0.4s\",\n        }}>\n          {claritySaved ? \"See Your Field \u2192\" : \"Continue to What's Growing \u2192\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PHASE 5: THE FIELD v5.1\n// 16 cards. Each its own universe.\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n// \u2500\u2500 Field SVG Illustrations \u2500\u2500\n\nfunction ChrysalisButterfly({ phase }) {\n  // phase: consuming | dissolving | clustering | emergence\n  var stg = phase || \"dissolving\";\n  var isEmerged = stg === \"emergence\";\n  var isDissolved = stg === \"dissolving\";\n  var isClustering = stg === \"clustering\";\n  // Cocoon size grows with stage\n  var cocoonRx = isDissolved ? 20 : isClustering ? 26 : isEmerged ? 30 : 18;\n  var cocoonRy = isDissolved ? 38 : isClustering ? 50 : isEmerged ? 54 : 34;\n  var glowStr = isDissolved ? 0.12 : isClustering ? 0.22 : isEmerged ? 0 : 0.06;\n  return (\n    <svg viewBox=\"0 0 280 240\" style={{ width:\"100%\", maxWidth:240 }}>\n      <defs>\n        <radialGradient id=\"cocoon2\">\n          <stop offset=\"0%\" stopColor={isClustering?\"#7B5BE0\":isDissolved?\"#6B5B4B\":\"#8B7B5B\"} />\n          <stop offset=\"100%\" stopColor={isClustering?\"#3B1A7A\":isDissolved?\"#3B2B25\":\"#5B4B35\"} />\n        </radialGradient>\n        <radialGradient id=\"cGlow\" cx=\"50%\" cy=\"50%\" r=\"50%\">\n          <stop offset=\"0%\" stopColor=\"#9060E0\" stopOpacity={glowStr} />\n          <stop offset=\"100%\" stopColor=\"#9060E0\" stopOpacity=\"0\" />\n        </radialGradient>\n        <linearGradient id=\"wL2\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\"><stop offset=\"0%\" stopColor=\"#E8A0D4\" /><stop offset=\"50%\" stopColor=\"#C470E8\" /><stop offset=\"100%\" stopColor=\"#7744CC\" /></linearGradient>\n        <linearGradient id=\"wR2\" x1=\"1\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"0%\" stopColor=\"#E8A0D4\" /><stop offset=\"50%\" stopColor=\"#C470E8\" /><stop offset=\"100%\" stopColor=\"#7744CC\" /></linearGradient>\n      </defs>\n\n      {!isEmerged ? (\n        <g>\n          {/* Ambient glow */}\n          <ellipse cx=\"140\" cy=\"120\" rx={60} ry={70} fill=\"url(#cGlow)\" />\n          {/* Silk thread */}\n          <path d=\"M 140 42 Q 143 55 138 68\" stroke=\"#A09070\" strokeWidth=\"2\" fill=\"none\" />\n          {/* Main cocoon */}\n          <ellipse cx=\"138\" cy=\"115\" rx={cocoonRx} ry={cocoonRy} fill=\"url(#cocoon2)\" opacity=\"0.9\">\n            <animate attributeName=\"ry\" values={cocoonRy+\";\"+( cocoonRy+4)+\";\"+cocoonRy} dur=\"4s\" repeatCount=\"indefinite\" />\n          </ellipse>\n          {/* Wrapping lines */}\n          {[0,1,2,3].map(function(i) {\n            var cy = 92 + i*16;\n            return <path key={i} d={\"M \"+(138-cocoonRx*0.7)+\" \"+cy+\" Q 138 \"+(cy-5)+\" \"+(138+cocoonRx*0.7)+\" \"+cy}\n              stroke={isClustering?\"rgba(180,120,255,0.25)\":\"rgba(200,180,140,0.18)\"} strokeWidth=\"1\" fill=\"none\" />;\n          })}\n          {/* Interior light \u2014 pulses stronger when clustering */}\n          <ellipse cx=\"138\" cy=\"108\" rx={cocoonRx*0.4} ry={cocoonRy*0.3}\n            fill={isClustering?\"rgba(180,120,255,0.2)\":\"rgba(255,255,255,0.06)\"}>\n            <animate attributeName=\"opacity\" values=\"0.4;1;0.4\" dur={isClustering?\"1.8s\":\"3s\"} repeatCount=\"indefinite\" />\n          </ellipse>\n          {/* Stage indicator dots */}\n          {isClustering && [[-30,10],[30,-15],[0,30],[-20,-20]].map(function(xy,i) {\n            return <circle key={i} cx={138+xy[0]} cy={115+xy[1]} r=\"2\"\n              fill=\"rgba(180,120,255,0.5)\" opacity=\"0.6\">\n              <animate attributeName=\"opacity\" values=\"0.2;0.8;0.2\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n            </circle>;\n          })}\n        </g>\n      ) : (\n        <g style={{ animation:\"riseUp 1.2s ease\" }}>\n          {/* Wings \u2014 only at emergence */}\n          <path d=\"M 140 118 Q 68 62 50 100 Q 30 138 66 168 Q 96 188 140 144\" fill=\"url(#wL2)\" opacity=\"0.88\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" values=\"-3 140 120;3 140 120;-3 140 120\" dur=\"2.4s\" repeatCount=\"indefinite\" />\n          </path>\n          <path d=\"M 140 118 Q 212 62 230 100 Q 250 138 214 168 Q 184 188 140 144\" fill=\"url(#wR2)\" opacity=\"0.88\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" values=\"3 140 120;-3 140 120;3 140 120\" dur=\"2.4s\" repeatCount=\"indefinite\" />\n          </path>\n          {[[96,116,9],[184,116,9],[78,140,6],[202,140,6]].map(function(spot,i) {\n            return <circle key={i} cx={spot[0]} cy={spot[1]} r={spot[2]} fill=\"rgba(255,255,255,0.22)\" />;\n          })}\n          <ellipse cx=\"140\" cy=\"130\" rx=\"3\" ry=\"16\" fill=\"#1A0A2A\" />\n          <path d=\"M 138 114 Q 124 94 118 88\" stroke=\"#1A0A2A\" strokeWidth=\"1.5\" fill=\"none\" />\n          <path d=\"M 142 114 Q 156 94 162 88\" stroke=\"#1A0A2A\" strokeWidth=\"1.5\" fill=\"none\" />\n          <circle cx=\"118\" cy=\"88\" r=\"2.5\" fill=\"#FFE060\" />\n          <circle cx=\"162\" cy=\"88\" r=\"2.5\" fill=\"#FFE060\" />\n        </g>\n      )}\n    </svg>\n  );\n}\n\nfunction TensionPull({ clicked }) {\n  return (\n    <svg viewBox=\"0 0 320 180\" style={{ width: \"100%\", maxWidth: 320 }}>\n      {[80,60,40].map((r,i) => (\n        <ellipse key={i} cx=\"160\" cy=\"90\" rx={clicked ? r+60 : r} ry={clicked ? r*0.45+10 : r*0.45}\n          fill=\"none\" stroke=\"url(#tf)\" strokeWidth=\"0.8\" opacity={0.15-i*0.04}\n          style={{ transition: \"all 0.8s ease\" }} />\n      ))}\n      <g style={{ transform: `translateX(${clicked ? -35 : 0}px)`, transition: \"transform 0.8s ease\" }}>\n        <circle cx=\"75\" cy=\"90\" r=\"28\" fill=\"url(#pL)\" />\n        <circle cx=\"75\" cy=\"90\" r=\"34\" fill=\"none\" stroke=\"#FF6B6B\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"34;40;34\" dur=\"2s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>\n      <g style={{ transform: `translateX(${clicked ? 35 : 0}px)`, transition: \"transform 0.8s ease\" }}>\n        <circle cx=\"245\" cy=\"90\" r=\"28\" fill=\"url(#pR)\" />\n        <circle cx=\"245\" cy=\"90\" r=\"34\" fill=\"none\" stroke=\"#6BC5FF\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"34;40;34\" dur=\"2.3s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>\n      {clicked && (\n        <g style={{ animation: \"riseUp 0.6s ease\" }}>\n          <circle cx=\"160\" cy=\"50\" r=\"22\" fill=\"url(#gG)\" />\n          <text x=\"160\" y=\"56\" textAnchor=\"middle\" fontSize=\"18\" fill=\"#FFD700\" fontFamily=\"serif\">\u2726</text>\n        </g>\n      )}\n      {clicked && [0,1,2].map(i => (\n        <line key={i} x1={120+i*20} y1={75+i*5} x2={135+i*18} y2={80+i*3}\n          stroke=\"#FFD700\" strokeWidth=\"1.5\" opacity=\"0.5\" fill=\"none\">\n          <animate attributeName=\"opacity\" values=\"0.3;0.7;0.3\" dur={`${0.6+i*0.2}s`} repeatCount=\"indefinite\" />\n        </line>\n      ))}\n      <defs>\n        <linearGradient id=\"tf\"><stop offset=\"0%\" stopColor=\"#FF6B6B\" /><stop offset=\"50%\" stopColor=\"#FFD700\" /><stop offset=\"100%\" stopColor=\"#6BC5FF\" /></linearGradient>\n        <radialGradient id=\"pL\"><stop offset=\"0%\" stopColor=\"#FF8888\" /><stop offset=\"100%\" stopColor=\"#CC3333\" /></radialGradient>\n        <radialGradient id=\"pR\"><stop offset=\"0%\" stopColor=\"#88CCFF\" /><stop offset=\"100%\" stopColor=\"#3388CC\" /></radialGradient>\n        <radialGradient id=\"gG\"><stop offset=\"0%\" stopColor=\"rgba(255,215,0,0.4)\" /><stop offset=\"100%\" stopColor=\"rgba(255,215,0,0)\" /></radialGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction SessionPortrait() {\n  const rings = [\n    { r: 100, color: \"#FF6B9D\", width: 4, dash: \"8 4\", speed: 60 },\n    { r: 78, color: \"#FFB86B\", width: 3, dash: \"12 8\", speed: 45 },\n    { r: 56, color: \"#6BFFB8\", width: 2.5, dash: \"4 12\", speed: 80 },\n    { r: 38, color: \"#B86BFF\", width: 2, dash: \"20 4\", speed: 35 },\n    { r: 22, color: \"#FFD700\", width: 6, dash: \"2 6\", speed: 50 },\n  ];\n  return (\n    <svg viewBox=\"0 0 260 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n      {rings.map((ring, i) => (\n        <circle key={i} cx=\"130\" cy=\"130\" r={ring.r} fill=\"none\"\n          stroke={ring.color} strokeWidth={ring.width}\n          strokeDasharray={ring.dash} strokeLinecap=\"round\" opacity=\"0.7\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\"\n            from={`0 130 130`} to={`${i%2===0?360:-360} 130 130`} dur={`${ring.speed}s`} repeatCount=\"indefinite\" />\n        </circle>\n      ))}\n      <circle cx=\"130\" cy=\"130\" r=\"6\" fill=\"white\" opacity=\"0.8\" />\n      <circle cx=\"130\" cy=\"130\" r=\"12\" fill=\"none\" stroke=\"white\" strokeWidth=\"0.5\" opacity=\"0.3\">\n        <animate attributeName=\"r\" values=\"12;18;12\" dur=\"3s\" repeatCount=\"indefinite\" />\n      </circle>\n    </svg>\n  );\n}\n\nfunction ThreadTimeline() {\n  const points = [\n    { s: 3, strength: 0.2 }, { s: 7, strength: 0.3 }, { s: 12, strength: 0.1 },\n    { s: 18, strength: 0.15 }, { s: 28, strength: 0.6 }, { s: 29, strength: 0.7 },\n    { s: 30, strength: 0.8 }, { s: 32, strength: 0.9 },\n  ];\n  const w = 300, h = 100;\n  return (\n    <svg viewBox={`0 0 ${w} ${h}`} style={{ width: \"100%\", maxWidth: 300 }}>\n      <line x1=\"0\" y1={h-10} x2={w} y2={h-10} stroke=\"rgba(255,255,255,0.06)\" strokeWidth=\"1\" />\n      <path d={points.map((p, i) => {\n        const x = (p.s / 32) * w; const y = h - 10 - (p.strength * (h - 20));\n        return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;\n      }).join(' ')} fill=\"none\" stroke=\"url(#threadG)\" strokeWidth=\"2.5\" strokeLinecap=\"round\" />\n      {points.map((p, i) => {\n        const x = (p.s / 32) * w; const y = h - 10 - (p.strength * (h - 20));\n        return <circle key={i} cx={x} cy={y} r={3 + p.strength * 4} fill=\"#FFB86B\" opacity={0.4 + p.strength * 0.6} />;\n      })}\n      <text x=\"0\" y={h} fontSize=\"10\" fill=\"rgba(255,255,255,0.3)\" fontFamily={FB}>1</text>\n      <text x={w-10} y={h} fontSize=\"10\" fill=\"#FFB86B\" fontFamily={FB}>32</text>\n      <defs>\n        <linearGradient id=\"threadG\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\">\n          <stop offset=\"0%\" stopColor=\"rgba(255,184,107,0.3)\" /><stop offset=\"100%\" stopColor=\"#FFB86B\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction SeedToTree({ morphed }) {\n  return (\n    <svg viewBox=\"0 0 280 300\" style={{ width: \"100%\", maxWidth: 260 }}>\n      <ellipse cx=\"140\" cy=\"260\" rx={morphed ? 100 : 40} ry=\"8\" fill=\"rgba(107,255,184,0.1)\" style={{ transition: \"all 1.2s ease\" }} />\n      {!morphed ? (\n        <g>\n          <ellipse cx=\"140\" cy=\"240\" rx=\"14\" ry=\"10\" fill=\"#8B7B5B\" />\n          <ellipse cx=\"140\" cy=\"238\" rx=\"10\" ry=\"6\" fill=\"#A09070\" opacity=\"0.5\" />\n          <path d=\"M 140 230 Q 140 222 142 218\" stroke=\"#6BFFB8\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n          <ellipse cx=\"140\" cy=\"240\" rx=\"24\" ry=\"18\" fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"0.5\" opacity=\"0.2\">\n            <animate attributeName=\"rx\" values=\"24;30;24\" dur=\"3s\" repeatCount=\"indefinite\" />\n          </ellipse>\n        </g>\n      ) : (\n        <g style={{ animation: \"riseUp 1.2s ease\" }}>\n          <path d=\"M 140 258 Q 138 200 140 140\" stroke=\"#6B8B5B\" strokeWidth=\"5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 180 Q 110 160 90 150\" stroke=\"#6B8B5B\" strokeWidth=\"3\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 180 Q 170 155 195 148\" stroke=\"#6B8B5B\" strokeWidth=\"3\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 155 Q 120 135 100 128\" stroke=\"#6B8B5B\" strokeWidth=\"2.5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 155 Q 165 130 180 125\" stroke=\"#6B8B5B\" strokeWidth=\"2.5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 140 Q 130 120 125 108\" stroke=\"#6B8B5B\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 140 Q 155 118 162 108\" stroke=\"#6B8B5B\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n          {[[90,145,22],[195,143,20],[100,122,18],[180,120,18],[125,102,16],[162,102,16],[140,90,20]].map(([cx,cy,r],i) => (\n            <circle key={i} cx={cx} cy={cy} r={r} fill={`rgba(107,255,184,${0.12+i*0.02})`}>\n              <animate attributeName=\"r\" values={`${r};${r+2};${r}`} dur={`${2.5+i*0.3}s`} repeatCount=\"indefinite\" />\n            </circle>\n          ))}\n          {[[95,140],[188,138],[105,118],[175,116],[130,98],[155,98],[140,85]].map(([x,y],i) => (\n            <circle key={i} cx={x} cy={y} r=\"2\" fill=\"#6BFFB8\" opacity=\"0.6\">\n              <animate attributeName=\"opacity\" values=\"0.3;0.8;0.3\" dur={`${1.5+i*0.4}s`} repeatCount=\"indefinite\" />\n            </circle>\n          ))}\n          <path d=\"M 136 258 Q 120 268 105 272\" stroke=\"#5B7B4B\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n          <path d=\"M 144 258 Q 160 268 175 272\" stroke=\"#5B7B4B\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n        </g>\n      )}\n    </svg>\n  );\n}\n\nfunction SunriseViz() {\n  return (\n    <svg viewBox=\"0 0 320 200\" style={{ width: \"100%\", maxWidth: 320 }}>\n      <rect x=\"0\" y=\"0\" width=\"320\" height=\"200\" fill=\"url(#sky)\" rx=\"8\" />\n      <circle cx=\"160\" cy=\"110\" r=\"35\" fill=\"url(#sun)\">\n        <animate attributeName=\"cy\" values=\"110;95;110\" dur=\"6s\" repeatCount=\"indefinite\" />\n      </circle>\n      {[0,30,60,90,120,150,180,210,240,270,300,330].map((angle, i) => {\n        const rad = (angle * Math.PI) / 180;\n        const x1 = 160 + 42 * Math.cos(rad), y1 = 105 + 42 * Math.sin(rad);\n        const x2 = 160 + (55 + i%3*8) * Math.cos(rad), y2 = 105 + (55 + i%3*8) * Math.sin(rad);\n        return <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke=\"#FFD700\" strokeWidth=\"1.5\" opacity=\"0.3\" strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values=\"0.15;0.4;0.15\" dur={`${2+i*0.2}s`} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <line x1=\"0\" y1=\"145\" x2=\"320\" y2=\"145\" stroke=\"rgba(255,215,0,0.2)\" strokeWidth=\"1\" />\n      <ellipse cx=\"160\" cy=\"170\" rx=\"60\" ry=\"8\" fill=\"rgba(255,215,0,0.08)\" />\n      <defs>\n        <linearGradient id=\"sky\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n          <stop offset=\"0%\" stopColor=\"rgba(30,20,60,0.8)\" /><stop offset=\"50%\" stopColor=\"rgba(80,40,20,0.4)\" /><stop offset=\"100%\" stopColor=\"rgba(255,180,80,0.15)\" />\n        </linearGradient>\n        <radialGradient id=\"sun\"><stop offset=\"0%\" stopColor=\"#FFE44D\" /><stop offset=\"60%\" stopColor=\"#FFB830\" /><stop offset=\"100%\" stopColor=\"#FF8800\" /></radialGradient>\n      </defs>\n    </svg>\n  );\n}\n\n// \u2500\u2500 Archetype SVG Illustrations (all with morphed before/after) \u2500\u2500\n\nfunction ArchSisyphus({ morphed, color }) {\n  var c = color || \"#FFB86B\";\n  return <svg viewBox=\"0 0 280 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs>\n      <radialGradient id=\"bld\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.5\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.15\" /></radialGradient>\n      <linearGradient id=\"hill\" x1=\"0\" y1=\"1\" x2=\"1\" y2=\"0\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.05\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.15\" /></linearGradient>\n    </defs>\n    <path d=\"M 20 240 Q 140 60 260 240\" fill=\"url(#hill)\" stroke={c} strokeWidth=\"1\" opacity=\"0.3\" />\n    {!morphed ? (<g>\n      <circle cx=\"100\" cy=\"195\" r=\"30\" fill=\"url(#bld)\" stroke={c} strokeWidth=\"2\" opacity=\"0.7\">\n        <animate attributeName=\"cx\" values=\"100;105;100\" dur=\"2s\" repeatCount=\"indefinite\" />\n      </circle>\n      <line x1=\"100\" y1=\"210\" x2=\"85\" y2=\"230\" stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.4\" />\n      <line x1=\"100\" y1=\"210\" x2=\"115\" y2=\"232\" stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.4\" />\n      <circle cx=\"100\" cy=\"200\" r=\"7\" fill={c} opacity=\"0.2\" />\n      {[0,1,2].map(function(i) { return <circle key={i} cx={100} cy={195} r={38+i*8} fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity={0.08}>\n        <animate attributeName=\"r\" values={(38+i*8)+\";\"+(42+i*8)+\";\"+(38+i*8)} dur={(3+i)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      <circle cx=\"140\" cy=\"80\" r=\"30\" fill=\"url(#bld)\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.9\">\n        <animate attributeName=\"cy\" values=\"80;75;80\" dur=\"3s\" repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"140\" cy=\"80\" r=\"12\" fill={c} opacity=\"0.15\"><animate attributeName=\"r\" values=\"12;18;12\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      {[0,1,2,3,4,5].map(function(i) {\n        var a = i * 60 * Math.PI / 180; var x = 140 + Math.cos(a) * 45; var y = 80 + Math.sin(a) * 45;\n        return <circle key={i} cx={x} cy={y} r=\"3\" fill={c} opacity=\"0.5\">\n          <animate attributeName=\"opacity\" values=\"0.2;0.7;0.2\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <text x=\"140\" y=\"250\" textAnchor=\"middle\" fontSize=\"11\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.5\" letterSpacing=\"0.15em\">IT REACHED THE TOP</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchMagician({ morphed, color }) {\n  var c = color || \"#B86BFF\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><radialGradient id=\"mglow\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.4\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient></defs>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"140\" r=\"40\" fill=\"url(#mglow)\" opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"5\" fill={c} opacity=\"0.4\"><animate attributeName=\"r\" values=\"4;7;4\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,72,144,216,288].map(function(a,i) {\n        var rad = a * Math.PI / 180; var x = 140 + Math.cos(rad) * 55; var y = 140 + Math.sin(rad) * 55;\n        return <circle key={i} cx={x} cy={y} r=\"3\" fill={c} opacity=\"0.25\">\n          <animate attributeName=\"opacity\" values=\"0.1;0.4;0.1\" dur={(2+i*0.4)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <circle cx=\"140\" cy=\"140\" r=\"55\" fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity=\"0.1\" strokeDasharray=\"4 8\" />\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <circle cx=\"140\" cy=\"130\" r=\"65\" fill=\"url(#mglow)\"><animate attributeName=\"r\" values=\"60;70;60\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,45,90,135,180,225,270,315].map(function(a,i) {\n        var rad = a * Math.PI / 180; var r1 = 30; var r2 = 70;\n        return <line key={i} x1={140+Math.cos(rad)*r1} y1={130+Math.sin(rad)*r1} x2={140+Math.cos(rad)*r2} y2={130+Math.sin(rad)*r2}\n          stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.6\">\n          <animate attributeName=\"opacity\" values=\"0.3;0.8;0.3\" dur={(1.2+i*0.2)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      {[0,60,120,180,240,300].map(function(a,i) {\n        var rad = a * Math.PI / 180; var x = 140 + Math.cos(rad) * 50; var y = 130 + Math.sin(rad) * 50;\n        return <circle key={\"o\"+i} cx={x} cy={y} r=\"6\" fill={c} opacity=\"0.6\">\n          <animate attributeName=\"r\" values=\"4;8;4\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n          <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 140 130\" to=\"360 140 130\" dur=\"20s\" repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <circle cx=\"140\" cy=\"130\" r=\"12\" fill={c} opacity=\"0.7\"><animate attributeName=\"r\" values=\"10;15;10\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchThreshold({ morphed, color }) {\n  var c = color || \"#FFD700\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      <rect x=\"90\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.2\" />\n      <rect x=\"178\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.2\" />\n      <path d=\"M 96 46 Q 140 22 184 46\" fill=\"none\" stroke={c} strokeWidth=\"1.5\" opacity=\"0.2\" />\n      <rect x=\"102\" y=\"46\" width=\"76\" height=\"184\" rx=\"2\" fill={c} opacity=\"0.03\" stroke={c} strokeWidth=\"0.5\" strokeOpacity=\"0.08\" />\n      <circle cx=\"170\" cy=\"140\" r=\"4\" fill={c} opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"3\" fill={c} opacity=\"0.15\"><animate attributeName=\"opacity\" values=\"0.1;0.3;0.1\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <rect x=\"70\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.3\" />\n      <rect x=\"198\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.3\" />\n      <path d=\"M 76 46 Q 140 22 204 46\" fill=\"none\" stroke={c} strokeWidth=\"2\" opacity=\"0.4\" />\n      <rect x=\"82\" y=\"46\" width=\"116\" height=\"184\" rx=\"2\" fill={c} opacity=\"0.06\" />\n      {[0,1,2,3,4,5,6].map(function(i) {\n        return <line key={i} x1=\"140\" y1={60+i*22} x2={140+(i%2===0?-1:1)*((i+1)*6)} y2={55+i*22} stroke={c} strokeWidth=\"1.5\" opacity={0.15+i*0.06} strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values={(0.1+i*0.05)+\";\"+(0.4+i*0.05)+\";\"+(0.1+i*0.05)} dur={(1+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <circle cx=\"140\" cy=\"140\" r=\"20\" fill={c} opacity=\"0.08\"><animate attributeName=\"r\" values=\"18;25;18\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.6\"><animate attributeName=\"opacity\" values=\"0.4;0.9;0.4\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <text x=\"140\" y=\"260\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">THE DOOR IS OPEN</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchTower({ morphed, color }) {\n  var c = color || \"#E84393\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><linearGradient id=\"twr\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.3\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.05\" /></linearGradient></defs>\n    {!morphed ? (<g>\n      <rect x=\"115\" y=\"40\" width=\"50\" height=\"180\" rx=\"4\" fill=\"url(#twr)\" stroke={c} strokeWidth=\"1\" opacity=\"0.6\" />\n      {[0,1,2,3,4,5].map(function(i) { return <line key={i} x1=\"120\" y1={55+i*28} x2=\"160\" y2={55+i*28} stroke={c} strokeWidth=\"0.7\" opacity=\"0.15\" />; })}\n      <line x1=\"130\" y1=\"38\" x2=\"150\" y2=\"38\" stroke={c} strokeWidth=\"2\" opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.15\"><animate attributeName=\"opacity\" values=\"0.1;0.25;0.1\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 0.6s ease\" }}>\n      <rect x=\"115\" y=\"40\" width=\"50\" height=\"180\" rx=\"4\" fill=\"url(#twr)\" opacity=\"0.2\" />\n      {[0,1,2,3,4,5,6,7].map(function(i) {\n        var x = 110 + Math.random() * 60; var y = 50 + i * 22; var rot = -30 + Math.random() * 60; var dx = (Math.random()-0.5)*40;\n        return <rect key={\"f\"+i} x={x} y={y} width={6+Math.random()*8} height={4+Math.random()*6} rx=\"1\" fill={c} opacity=\"0.25\"\n          transform={\"rotate(\"+rot+\" \"+x+\" \"+y+\")\"}>\n          <animate attributeName=\"x\" values={x+\";\"+String(x+dx)+\";\"+(x+dx*1.5)} dur={(2+i*0.3)+\"s\"} fill=\"freeze\" />\n          <animate attributeName=\"opacity\" values=\"0.3;0.15;0.05\" dur={(2+i*0.3)+\"s\"} fill=\"freeze\" />\n        </rect>;\n      })}\n      {[0,1,2].map(function(i) { return <circle key={\"sp\"+i} cx={120+i*20} cy={230-i*10} r=\"3\" fill={c} opacity=\"0.4\">\n        <animate attributeName=\"cy\" values={(230-i*10)+\";\"+(240-i*10)+\";\"+(230-i*10)} dur={(2+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <line x1=\"115\" y1=\"220\" x2=\"165\" y2=\"220\" stroke={c} strokeWidth=\"1\" opacity=\"0.2\" />\n      <circle cx=\"140\" cy=\"240\" r=\"8\" fill={c} opacity=\"0.2\"><animate attributeName=\"r\" values=\"6;12;6\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"240\" r=\"3\" fill={c} opacity=\"0.6\"><animate attributeName=\"opacity\" values=\"0.4;0.8;0.4\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <text x=\"140\" y=\"270\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">WHAT REMAINS IS REAL</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchDescent({ morphed, color }) {\n  var c = color || \"#6BB8FF\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><radialGradient id=\"cave\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.02\" /><stop offset=\"80%\" stopColor={c} stopOpacity=\"0.08\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient></defs>\n    <path d=\"M 60 80 Q 70 180 140 230 Q 210 180 220 80\" fill=\"url(#cave)\" stroke={c} strokeWidth=\"1\" opacity=\"0.15\" />\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"50\" r=\"6\" fill={c} opacity=\"0.5\" />\n      <circle cx=\"140\" cy=\"50\" r=\"12\" fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity=\"0.2\" />\n      {[0,1,2].map(function(i) { return <circle key={i} cx={140} cy={80+i*35} r=\"2\" fill={c} opacity={0.3-i*0.08}>\n        <animate attributeName=\"opacity\" values={(0.15-i*0.04)+\";\"+(0.35-i*0.04)+\";\"+(0.15-i*0.04)} dur={(2+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <text x=\"140\" y=\"270\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.25\" letterSpacing=\"0.15em\">GOING DOWN</text>\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      {[0,1,2,3,4].map(function(i) { return <circle key={i} cx={140} cy={60+i*35} r=\"2\" fill={c} opacity={0.1+i*0.05}>\n        <animate attributeName=\"opacity\" values={(0.05+i*0.03)+\";\"+(0.2+i*0.05)+\";\"+(0.05+i*0.03)} dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <circle cx=\"140\" cy=\"210\" r=\"25\" fill={c} opacity=\"0.06\"><animate attributeName=\"r\" values=\"22;30;22\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"210\" r=\"10\" fill={c} opacity=\"0.15\"><animate attributeName=\"r\" values=\"8;14;8\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"210\" r=\"4\" fill={c} opacity=\"0.7\"><animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,1,2,3,4,5].map(function(i) {\n        var a = i * 60 * Math.PI / 180; return <line key={\"r\"+i} x1={140+Math.cos(a)*15} y1={210+Math.sin(a)*15} x2={140+Math.cos(a)*35} y2={210+Math.sin(a)*35}\n          stroke={c} strokeWidth=\"1\" opacity=\"0.2\" strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values=\"0.1;0.35;0.1\" dur={(1.8+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <text x=\"140\" y=\"268\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.5\" letterSpacing=\"0.15em\">FOUND SOMETHING</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchWeaver({ morphed, color }) {\n  var c = color || \"#7DB7AE\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      {[0,1,2,3,4,5].map(function(i) {\n        var y = 50 + i * 35;\n        return <path key={i} d={\"M 50 \"+y+\" Q \"+(100+(i%2===0?-20:20))+\" \"+(y+15)+\" 140 \"+y+\" Q \"+(180+(i%2===0?20:-20))+\" \"+(y+15)+\" 230 \"+y}\n          fill=\"none\" stroke={c} strokeWidth=\"1\" opacity=\"0.15\" strokeLinecap=\"round\" />;\n      })}\n      {[0,1,2].map(function(i) { return <circle key={i} cx={90+i*50} cy={100+i*25} r=\"2\" fill={c} opacity=\"0.2\" />; })}\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      {[0,1,2,3,4,5,6].map(function(i) {\n        var y = 40 + i * 30;\n        return <path key={i} d={\"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y}\n          fill=\"none\" stroke={c} strokeWidth={1.5+i*0.15} opacity={0.15+i*0.06} strokeLinecap=\"round\">\n          <animate attributeName=\"d\" values={\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y+\";\"+\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-20:20))+\" \"+(y+(i%2===0?-16:16))+\" 140 \"+(y+2)+\" Q \"+(185+(i%2===0?20:-20))+\" \"+(y+(i%2===0?16:-16))+\" 230 \"+y+\";\"+\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y\n          } dur={(4+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n        </path>;\n      })}\n      {[0,1,2,3,4].map(function(i) {\n        return <circle key={\"kn\"+i} cx={70+i*40} cy={60+i*35+(i%2===0?0:15)} r={3+i*0.5} fill={c} opacity={0.3+i*0.08}>\n          <animate attributeName=\"opacity\" values={(0.2+i*0.05)+\";\"+(0.6+i*0.05)+\";\"+(0.2+i*0.05)} dur={(1.5+i*0.4)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <text x=\"140\" y=\"268\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">THE PATTERN HOLDS</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchPlanets({ morphed, color }) {\n  var c = color || \"#FFD700\";\n  var orbits = [{r:35,s:8,d:10,col:c},{r:60,s:5,d:16,col:\"#6BB8FF\"},{r:85,s:6,d:24,col:\"#FF6B9D\"},{r:110,s:4,d:35,col:\"#6BFFB8\"}];\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.3\" />\n      {orbits.map(function(o,i) { return <g key={i}>\n        <circle cx=\"140\" cy=\"140\" r={o.r} fill=\"none\" stroke={o.col} strokeWidth=\"0.5\" opacity=\"0.08\" strokeDasharray=\"4 8\" />\n        <circle cx={140+o.r} cy=\"140\" r={o.s*0.6} fill={o.col} opacity=\"0.2\" />\n      </g>; })}\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <circle cx=\"140\" cy=\"140\" r=\"10\" fill={c} opacity=\"0.6\"><animate attributeName=\"r\" values=\"8;12;8\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"140\" r=\"20\" fill={c} opacity=\"0.08\"><animate attributeName=\"r\" values=\"18;25;18\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      {orbits.map(function(o,i) { return <g key={i}>\n        <circle cx=\"140\" cy=\"140\" r={o.r} fill=\"none\" stroke={o.col} strokeWidth=\"0.8\" opacity=\"0.15\" />\n        <circle cx={140+o.r} cy=\"140\" r={o.s} fill={o.col} opacity=\"0.6\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 140 140\" to=\"360 140 140\" dur={o.d+\"s\"} repeatCount=\"indefinite\" />\n          <animate attributeName=\"r\" values={o.s+\";\"+(o.s+2)+\";\"+o.s} dur=\"2s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>; })}\n    </g>)}\n  </svg>;\n}\n\nfunction ArchPhoenix({ morphed, color }) {\n  var c = color || \"#E84393\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs>\n      <radialGradient id=\"pfire\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.4\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient>\n      <linearGradient id=\"pfeath\" x1=\"0\" y1=\"1\" x2=\"0\" y2=\"0\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.1\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.5\" /></linearGradient>\n    </defs>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"210\" r=\"25\" fill=\"url(#pfire)\" opacity=\"0.3\" />\n      {[0,1,2,3,4].map(function(i) { var x = 120 + i * 10; return <line key={i} x1={x} y1=\"210\" x2={x} y2={200-i*2} stroke={c} strokeWidth=\"1\" opacity={0.1+i*0.03}>\n        <animate attributeName=\"y2\" values={(200-i*2)+\";\"+(195-i*3)+\";\"+(200-i*2)} dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </line>; })}\n      <circle cx=\"140\" cy=\"210\" r=\"8\" fill={c} opacity=\"0.15\" />\n      <circle cx=\"140\" cy=\"210\" r=\"3\" fill={c} opacity=\"0.3\"><animate attributeName=\"opacity\" values=\"0.2;0.5;0.2\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      <circle cx=\"140\" cy=\"180\" r=\"45\" fill=\"url(#pfire)\"><animate attributeName=\"r\" values=\"40;50;40\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <path d=\"M 140 170 Q 80 120 60 80\" fill=\"none\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.6\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 140 170 Q 80 120 60 80;M 140 160 Q 75 105 50 60;M 140 170 Q 80 120 60 80\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      <path d=\"M 140 170 Q 200 120 220 80\" fill=\"none\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.6\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 140 170 Q 200 120 220 80;M 140 160 Q 205 105 230 60;M 140 170 Q 200 120 220 80\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      <path d=\"M 110 130 Q 125 80 140 50 Q 155 80 170 130\" fill=\"url(#pfeath)\" stroke={c} strokeWidth=\"1.5\" opacity=\"0.7\">\n        <animate attributeName=\"d\" values=\"M 110 130 Q 125 80 140 50 Q 155 80 170 130;M 105 125 Q 122 70 140 40 Q 158 70 175 125;M 110 130 Q 125 80 140 50 Q 155 80 170 130\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      {[0,1,2,3].map(function(i) { var x = 125+i*10; return <circle key={i} cx={x} cy={100+i*15} r={2+i} fill={c} opacity={0.3+i*0.1}>\n        <animate attributeName=\"opacity\" values={(0.2+i*0.1)+\";\"+(0.6+i*0.1)+\";\"+(0.2+i*0.1)} dur={(1+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <circle cx=\"140\" cy=\"65\" r=\"6\" fill={c} opacity=\"0.8\"><animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.2s\" repeatCount=\"indefinite\" /></circle>\n    </g>)}\n  </svg>;\n}\n\n// Archetype registry \u2014 Viz components all take { morphed, color }\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 GENERATIVE ARCHETYPE GLYPH \u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Creates a unique living visual from any archetype name + properties.\n// Deterministic: same name always generates same glyph.\nfunction ArchetypeGlyph({ name, sourceNodes, energy, morphed, size }) {\n  var sz = size || 260;\n  var cx = sz / 2, cy = sz / 2;\n\n  // Hash name \u2192 deterministic seed\n  var hash = 0;\n  var nm = (name || \"pattern\").toLowerCase();\n  for (var i = 0; i < nm.length; i++) { hash = ((hash << 5) - hash) + nm.charCodeAt(i); hash = hash & hash; }\n  hash = Math.abs(hash);\n\n  // Visual parameters from hash\n  var sides = 3 + (hash % 5); // 3-7 base shape\n  var layers = 2 + (hash % 3); // 2-4 rings\n  var baseRotation = (hash % 60) - 30; // slight tilt\n  var pulseSpeed = 4 + (hash % 3);\n\n  // Colors from SAYCRD palette\n  var palette = [\"#E84393\",\"#6BFFB8\",\"#B86BFF\",\"#6BB8FF\",\"#ff6090\",\"#FFB86B\",\"#50c0ff\",\"#f0c860\",\"#c070f0\",\"#4ae88a\"];\n  var c1 = palette[hash % palette.length];\n  var c2 = palette[(hash + 3) % palette.length];\n  var c3 = palette[(hash + 7) % palette.length];\n\n  // Energy affects animation\n  var energyMap = { heavy: 8, electric: 1.5, shattered: 2, still: 10, quiet: 7, warm: 5, grounded: 6, restless: 2, tender: 6, fierce: 1.8 };\n  var animSpeed = energyMap[energy] || pulseSpeed;\n\n  // Generate geometry\n  var rings = [];\n  for (var L = 0; L < layers; L++) {\n    var r = 30 + L * 28;\n    var pts = [];\n    var n = sides + L; // outer rings get more points\n    for (var p = 0; p < n; p++) {\n      var angle = (p / n) * Math.PI * 2 + (baseRotation * Math.PI / 180) + (L * 0.2);\n      pts.push({ x: cx + Math.cos(angle) * r, y: cy + Math.sin(angle) * r, angle: angle });\n    }\n    rings.push({ r: r, points: pts, color: L === 0 ? c1 : L === 1 ? c2 : c3 });\n  }\n\n  // Source node positions (placed at inner ring vertices)\n  var nodePositions = (sourceNodes || []).slice(0, sides).map(function(label, i) {\n    var angle = (i / Math.max(sides, 1)) * Math.PI * 2 + (baseRotation * Math.PI / 180);\n    var r = 30 + (layers - 1) * 28 + 22;\n    return { label: label, x: cx + Math.cos(angle) * r, y: cy + Math.sin(angle) * r };\n  });\n\n  var uid = \"g\" + hash;\n\n  return (\n    <svg viewBox={\"0 0 \" + sz + \" \" + sz} style={{ width: \"100%\", maxWidth: sz }}>\n      <defs>\n        <radialGradient id={uid + \"glow\"}>\n          <stop offset=\"0%\" stopColor={c1} stopOpacity={morphed ? \"0.35\" : \"0.2\"} />\n          <stop offset=\"100%\" stopColor={c1} stopOpacity=\"0\" />\n        </radialGradient>\n        <filter id={uid + \"blur\"}><feGaussianBlur stdDeviation=\"3\" /></filter>\n      </defs>\n\n      {/* Background glow */}\n      <circle cx={cx} cy={cy} r={morphed ? 90 : 65} fill={\"url(#\" + uid + \"glow)\"}>\n        <animate attributeName=\"r\" values={(morphed ? \"85;95;85\" : \"60;70;60\")} dur={animSpeed + \"s\"} repeatCount=\"indefinite\" />\n      </circle>\n\n      {/* Rings */}\n      {rings.map(function(ring, ri) {\n        return <g key={ri}>\n          {/* Ring outline */}\n          <circle cx={cx} cy={cy} r={ring.r} fill=\"none\" stroke={ring.color} strokeWidth={ri === 0 ? \"1.5\" : \"0.5\"} opacity={morphed ? 0.25 : 0.1} strokeDasharray={ri > 0 ? \"3 6\" : \"none\"}>\n            <animate attributeName=\"r\" values={(ring.r - 2) + \";\" + (ring.r + 2) + \";\" + (ring.r - 2)} dur={(animSpeed + ri) + \"s\"} repeatCount=\"indefinite\" />\n          </circle>\n\n          {/* Points on ring */}\n          {ring.points.map(function(pt, pi) {\n            var dotSize = ri === 0 ? 4 : 2.5;\n            return <circle key={pi} cx={pt.x} cy={pt.y} r={dotSize} fill={ring.color} opacity={morphed ? 0.7 : 0.35}>\n              <animate attributeName=\"opacity\" values={(morphed ? \"0.5;0.9;0.5\" : \"0.2;0.5;0.2\")} dur={(animSpeed * 0.7 + pi * 0.3) + \"s\"} repeatCount=\"indefinite\" />\n              <animate attributeName=\"r\" values={(dotSize - 0.5) + \";\" + (dotSize + 1) + \";\" + (dotSize - 0.5)} dur={(animSpeed + pi * 0.2) + \"s\"} repeatCount=\"indefinite\" />\n            </circle>;\n          })}\n\n          {/* Connection lines within ring */}\n          {ring.points.map(function(pt, pi) {\n            var next = ring.points[(pi + 1) % ring.points.length];\n            return <line key={\"l\" + pi} x1={pt.x} y1={pt.y} x2={next.x} y2={next.y} stroke={ring.color} strokeWidth=\"0.8\" opacity={morphed ? 0.2 : 0.08}>\n              <animate attributeName=\"opacity\" values={(morphed ? \"0.1;0.3;0.1\" : \"0.04;0.12;0.04\")} dur={(animSpeed + 1) + \"s\"} repeatCount=\"indefinite\" />\n            </line>;\n          })}\n        </g>;\n      })}\n\n      {/* Cross-ring connections (inner to outer) */}\n      {rings.length >= 2 && rings[0].points.map(function(pt, pi) {\n        var outerRing = rings[rings.length - 1];\n        var oi = pi % outerRing.points.length;\n        var opt = outerRing.points[oi];\n        return <line key={\"cr\" + pi} x1={pt.x} y1={pt.y} x2={opt.x} y2={opt.y} stroke={c1} strokeWidth=\"0.5\" opacity={morphed ? 0.12 : 0.04} strokeDasharray=\"2 4\">\n          <animate attributeName=\"opacity\" values={(morphed ? \"0.06;0.18;0.06\" : \"0.02;0.08;0.02\")} dur={(animSpeed + 2) + \"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n\n      {/* Central core */}\n      <circle cx={cx} cy={cy} r={morphed ? 8 : 5} fill={c1} opacity={morphed ? 0.6 : 0.3}>\n        <animate attributeName=\"r\" values={(morphed ? \"6;10;6\" : \"4;7;4\")} dur={animSpeed + \"s\"} repeatCount=\"indefinite\" />\n        <animate attributeName=\"opacity\" values={(morphed ? \"0.4;0.8;0.4\" : \"0.2;0.4;0.2\")} dur={animSpeed + \"s\"} repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx={cx} cy={cy} r={morphed ? 3 : 2} fill=\"#fff\" opacity=\"0.6\" />\n\n      {/* Source node labels */}\n      {morphed && nodePositions.map(function(np, ni) {\n        return <text key={ni} x={np.x} y={np.y + 4} textAnchor=\"middle\" fontSize=\"9\" fill={c2} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.08em\">\n          {np.label}\n        </text>;\n      })}\n    </svg>\n  );\n}\n\nvar ARCH_REGISTRY = {\n  chrysalis: { name: \"Imaginal Cells\", icon: \"\ud83e\udd8b\", color: \"#4ae88a\", bg: \"linear-gradient(160deg, #0D1A12 0%, #1a3a2a 40%, #4ae88a44 100%)\",\n    phases: { consuming: \"Still building mass. The hunger is the work.\", dissolving: \"The old form can't hold. Dissolution IS the work.\", clustering: \"Imaginal cells found each other. Something coherent forming.\", emergence: \"Wings taking shape. The caterpillar wouldn't recognize what's coming.\" },\n    Viz: ChrysalisButterfly },\n  tower: { name: \"The Tower\", icon: \"\ud83d\uddfc\", color: \"#ff8a3a\", bg: \"linear-gradient(160deg, #1A0D06 0%, #3a1a08 40%, #ff8a3a44 100%)\",\n    phases: { trembling: \"Cracks showing. Something isn't as solid as you believed.\", falling: \"Coming down. Let it fall. Can't hold what wasn't real.\", rubble: \"Standing in the aftermath. Clearest view you've had.\", clearing: \"Ground is bare. Now you can build on what's real.\" },\n    Viz: ArchTower },\n  kintsugi: { name: \"Kintsugi\", icon: \"\u2726\", color: \"#e8b830\", bg: \"linear-gradient(160deg, #1A1408 0%, #2a2010 40%, #e8b83044 100%)\",\n    phases: { breaking: \"Something broke. The instinct is to hide the crack. Don't.\", holding: \"Looking at the pieces. Not fixing yet \u2014 just seeing.\", filling: \"Gold poured into the break. The repair is the art.\", whole: \"More beautiful than before it shattered. The scar shines.\" },\n    Viz: ArchMagician },\n  dark_night: { name: \"Dark Night\", icon: \"\ud83c\udf11\", color: \"#9070d0\", bg: \"linear-gradient(160deg, #0D0A18 0%, #14102a 40%, #9070d044 100%)\",\n    phases: { trigger: \"Old framework shattered. What made sense doesn't anymore.\", crisis: \"Everything questioned. Who are you if not what you believed?\", transformation: \"In the wreckage, a different way of seeing emerges.\", emergence: \"Old meaning gone. Something deeper replaced it.\" },\n    Viz: ArchMagician },\n  persephone: { name: \"Persephone\", icon: \"\ud83c\udf3a\", color: \"#c070f0\", bg: \"linear-gradient(160deg, #0D0618 0%, #2a1040 40%, #c070f044 100%)\",\n    phases: { descending: \"Something pulled you under. Not punishment \u2014 initiation.\", underworld: \"Learning the rules of a realm you didn't choose.\", pomegranate: \"Ate the seeds. Can't unknow it. The wound became wisdom.\", returning: \"Not the maiden anymore. The queen.\" },\n    Viz: ArchThreshold },\n  phoenix: { name: \"The Phoenix\", icon: \"\ud83d\udd25\", color: \"#ff5030\", bg: \"linear-gradient(160deg, #1A0606 0%, #3a0a08 40%, #ff503044 100%)\",\n    phases: { burning: \"Let it burn. Not everything survives this version of you.\", ash: \"What's left is what was always real.\", stirring: \"Movement in the ash. Not repetition \u2014 reinvention.\", rising: \"Airborne again. Same matter, utterly reconfigured.\" },\n    Viz: ArchTower },\n  hermit: { name: \"The Hermit\", icon: \"\ud83c\udfee\", color: \"#f0c860\", bg: \"linear-gradient(160deg, #0D0C10 0%, #1a1820 40%, #f0c86044 100%)\",\n    phases: { withdrawing: \"Stepped away. Something needs quiet.\", listening: \"A signal getting clearer.\", seeing: \"The lamp illuminates what was always there.\", returning: \"Carrying the light back.\" },\n    Viz: SeedToTree },\n  sisyphus: { name: \"Sisyphus\", icon: \"\ud83e\udea8\", color: \"#c0a078\", bg: \"linear-gradient(160deg, #0D0B08 0%, #201c18 40%, #c0a07844 100%)\",\n    phases: { pushing: \"Same weight. Same hill. Something in your grip changed.\", rolling_back: \"Came down again. What do you notice on the walk back?\", pausing: \"Stopped mid-slope. Choosing to feel it.\", meaning: \"Boulder didn't get lighter. You got stronger.\" },\n    Viz: ArchSisyphus },\n  magician: { name: \"The Magician\", icon: \"\u2727\", color: \"#a060ff\", bg: \"linear-gradient(160deg, #0D0818 0%, #1c1030 40%, #a060ff44 100%)\",\n    phases: { awakening: \"Realizing you have the tools. Always there.\", practicing: \"Testing what transforms.\", transforming: \"The transmutation is happening.\", mastery: \"Seeing what's possible in what already exists.\" },\n    Viz: ArchMagician },\n  lover: { name: \"The Lover\", icon: \"\ud83d\udc97\", color: \"#ff6090\", bg: \"linear-gradient(160deg, #1A0810 0%, #2a1020 40%, #ff609044 100%)\",\n    phases: { guarding: \"Walls keeping out more than danger.\", opening: \"A crack in the armor. The bravest thing.\", feeling: \"Letting it all in.\", merging: \"Connection isn't losing yourself.\" },\n    Viz: ChrysalisButterfly },\n  star: { name: \"The Star\", icon: \"\u2b50\", color: \"#50c0ff\", bg: \"linear-gradient(160deg, #060C18 0%, #0c1830 40%, #50c0ff44 100%)\",\n    phases: { darkness: \"Dark. But a point of light you haven't noticed.\", glimmer: \"Hope isn't optimism. It's stubbornness.\", pouring: \"Quietly tending what's left.\", shining: \"Effortless, steady, real.\" },\n    Viz: SeedToTree },\n  threshold: { name: \"The Threshold\", icon: \"\ud83d\udeaa\", color: \"#b8a880\", bg: \"linear-gradient(160deg, #0D0D0A 0%, #181814 40%, #b8a88044 100%)\",\n    phases: { approaching: \"Edge of something. The old room shrinking.\", standing: \"At the door. Not through yet.\", crossing: \"One foot on each side.\", arrived: \"Other side. The room is bigger.\" },\n    Viz: ArchThreshold },\n  weaver: { name: \"The Weaver\", icon: \"\ud83d\udd78\", color: \"#a080c0\", bg: \"linear-gradient(160deg, #0D0A10 0%, #1a1420 40%, #a080c044 100%)\",\n    phases: { gathering: \"Threads from different parts collecting.\", seeing: \"A pattern emerging.\", weaving: \"Actively connecting them.\", wearing: \"The pattern is complete enough to wear.\" },\n    Viz: ArchMagician },\n  tree: { name: \"The Tree\", icon: \"\ud83c\udf33\", color: \"#6BFFB8\", bg: \"linear-gradient(160deg, #0A1A12 0%, #0D2E1A 40%, #6BFFB844 100%)\",\n    phases: { seed: \"Something planted.\", roots: \"Going deep before going up.\", growing: \"Slow, steady expansion.\", canopy: \"The patience paid off.\" },\n    Viz: SeedToTree },\n  descent: { name: \"The Descent\", icon: \"\u2b07\", color: \"#6BB8FF\", bg: \"linear-gradient(160deg, #060C1A 0%, #0D1A2E 40%, #6BB8FF44 100%)\",\n    phases: { approaching: \"Edge of the underworld.\", entering: \"Going under.\", depths: \"In the deepest place.\", returning: \"Rising with what you found.\" },\n    Viz: ArchThreshold },\n  planets: { name: \"Forces in Orbit\", icon: \"\ud83e\ude90\", color: \"#FFB86B\", bg: \"linear-gradient(160deg, #1A120A 0%, #2E1A0D 40%, #FFB86B44 100%)\",\n    phases: { approaching: \"Forces circling.\", conjunction: \"Aligned.\", opposition: \"Pulling apart.\", integration: \"New orbit.\" },\n    Viz: ArchSisyphus },\n};\n\n// \u2500\u2500 Field Tiny Components \u2500\u2500\n\nfunction FC({ children }) {\n  return <div style={{ display:\"flex\", flexDirection:\"column\", justifyContent:\"center\", alignItems:\"center\", height:\"100%\", padding:\"60px 28px\", textAlign:\"center\", position:\"relative\" }}>{children}</div>;\n}\nfunction FLabel({ color, children }) {\n  return <div style={{ fontSize:14, letterSpacing:\"0.18em\", fontWeight:700, color, marginBottom:20, fontFamily:FB, zIndex:1, textTransform:\"uppercase\" }}>{children}</div>;\n}\nfunction FHero({ size=42, color=\"white\", children }) {\n  return <h1 style={{ fontSize:size, fontWeight:400, lineHeight:1.2, margin:0, color, fontFamily:FD, zIndex:1 }}>{children}</h1>;\n}\nfunction FBody({ color, style={}, children }) {\n  return <p style={{ fontSize:19, margin:0, lineHeight:1.6, fontFamily:FD, color, zIndex:1, ...style }}>{children}</p>;\n}\nfunction FTap({ color, children }) {\n  return <div style={{ fontSize:15, marginTop:24, fontFamily:FB, color, opacity:0.7, zIndex:1 }}>{children}</div>;\n}\nfunction FOrb({ color, children }) {\n  return <div style={{ width:72, height:72, borderRadius:\"50%\", background:`${color}22`, border:`2px solid ${color}55`, display:\"flex\", alignItems:\"center\", justifyContent:\"center\", fontSize:14, color, fontFamily:FB, fontWeight:500 }}>{children}</div>;\n}\n\nfunction DataPortrait({ themes }) {\n  var [active, setActive] = useState(null);\n  var rings = (themes || []).slice(0, 7).map(function(t, i) {\n    var base = 110 - i * 16;\n    return {\n      r: Math.max(16, base),\n      color: t.color || NC[i % NC.length],\n      width: 2 + (t.weight || 1) * 0.8,\n      dash: [8, 12, 4, 20, 6, 14][i % 6] + \" \" + [4, 8, 12, 4, 10, 6][i % 6],\n      speed: 30 + i * 12,\n      label: t.label || t.name || \"\",\n      weight: t.weight || 1,\n    };\n  });\n  var activeRing = active !== null ? rings[active] : null;\n  return (\n    <div data-noadvance=\"true\" style={{ position:\"relative\", width:\"100%\", maxWidth:240 }}>\n      <svg viewBox=\"0 0 260 260\" style={{ width:\"100%\", cursor:\"pointer\" }}\n        onClick={function(e){ e.stopPropagation(); setActive(null); }}>\n        {rings.map(function(ring, i) {\n          var isActive = active === i;\n          return <circle key={i} cx=\"130\" cy=\"130\" r={ring.r} fill=\"none\"\n            stroke={ring.color} strokeWidth={isActive ? ring.width + 2 : ring.width}\n            strokeDasharray={ring.dash} strokeLinecap=\"round\"\n            opacity={isActive ? 1 : 0.65}\n            style={{ cursor:\"pointer\" }}\n            onClick={function(e){ e.stopPropagation(); setActive(active === i ? null : i); }}>\n            <animateTransform attributeName=\"transform\" type=\"rotate\"\n              from=\"0 130 130\" to={(i%2===0?\"360\":\"-360\")+\" 130 130\"}\n              dur={ring.speed+\"s\"} repeatCount=\"indefinite\" />\n          </circle>;\n        })}\n        <circle cx=\"130\" cy=\"130\" r=\"6\" fill=\"white\" opacity=\"0.8\" />\n        <circle cx=\"130\" cy=\"130\" r=\"12\" fill=\"none\" stroke=\"white\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"12;18;12\" dur=\"3s\" repeatCount=\"indefinite\" />\n        </circle>\n      </svg>\n      {/* Ring info panel */}\n      {activeRing\n        ? <div onClick={function(e){e.stopPropagation();setActive(null);}}\n            style={{ marginTop:14, padding:\"14px 20px\", borderRadius:14,\n              background:\"rgba(8,10,20,0.92)\",\n              border:\"1.5px solid \"+activeRing.color+\"55\",\n              boxShadow:\"0 0 28px \"+activeRing.color+\"22\",\n              animation:\"riseUp 0.3s ease both\", cursor:\"pointer\" }}>\n            <div style={{ fontSize:18, color:activeRing.color, fontFamily:FB, fontWeight:700, marginBottom:8 }}>{activeRing.label}</div>\n            <div style={{ height:4, borderRadius:2, background:\"rgba(255,255,255,0.06)\", marginBottom:8 }}>\n              <div style={{ height:\"100%\", width:Math.min(100,activeRing.weight/5*100)+\"%\", background:activeRing.color, borderRadius:2, transition:\"width 0.4s ease\" }} />\n            </div>\n            <div style={{ display:\"flex\", justifyContent:\"space-between\" }}>\n              <div style={{ fontSize:12, color:\"rgba(255,255,255,0.45)\", fontFamily:FB }}>weight {activeRing.weight.toFixed(1)}</div>\n              <div style={{ fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB }}>tap to close</div>\n            </div>\n          </div>\n        : <div style={{ textAlign:\"center\", marginTop:8, fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.1em\" }}>\n            tap any ring\n          </div>\n      }\n    </div>\n  );\n}\n\n// \u2500\u2500 Session Storage (Enhanced for cross-session tracking) \u2500\u2500\nfunction saveSession(data) {\n  try {\n    var sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n    var themes = (data.themes || []).slice(0, 5).map(function(t) { return { label: t.label, weight: t.weight || 1 }; });\n    var avgWeight = themes.length > 0 ? themes.reduce(function(s, t) { return s + t.weight; }, 0) / themes.length : 0;\n    sessions.push({\n      date: new Date().toISOString(),\n      archetypes: (data.archetypes || []).map(function(a) {\n        return {\n          name: a.name || a.key || \"\",\n          line: a.line || \"\",\n          key: a.classical_resonance || a.key || \"\",\n          source_nodes: a.source_nodes || [],\n          evolution_from: a.evolution_from || null,\n        };\n      }),\n      themes: themes,\n      mapTitle: data.map_title || \"\",\n      synthesis: (data.synthesis || \"\").slice(0, 200),\n      tension: data.tension ? { a: data.tension.a, b: data.tension.b, text: (data.tension.text || \"\").slice(0, 120) } : null,\n      intensity: Math.round(avgWeight * 20) / 10,\n      // \u2500\u2500 y-axis enrichment \u2500\u2500\n      arrival: data.arrival || null,\n      alchemy: data.alchemy ? { stage: data.alchemy.stage, evidence: (data.alchemy.evidence || \"\").slice(0, 120) } : null,\n      underneath: (data.underneath || []).slice(0, 2).map(function(u) { return (typeof u === \"string\" ? u : u.observation || \"\").slice(0, 120); }),\n      blind_spot: (data.blind_spot || \"\").slice(0, 150),\n      opening: (typeof data.opening === \"string\" ? data.opening : (data.opening || {}).text || \"\").slice(0, 150),\n      mapResponses: data.mapResponses || {},\n      clarity: data.clarity || \"\",\n      reactions: data.reactions || {},\n      corrections: data.corrections || {},\n      revisedSynthesis: data.revisedSynthesis || null,\n    });\n    if (sessions.length > 50) sessions = sessions.slice(-50);\n    localStorage.setItem(_sessionKey(), JSON.stringify(sessions));\n    console.log(\"[SAYCRD] Session saved. Total sessions:\", sessions.length);\n  } catch (e) { console.error(\"[SAYCRD] Save error:\", e); }\n}\nfunction _sessionKey() {\n  var uid = (window.currentUser && window.currentUser.id) ? window.currentUser.id : \"anon\";\n  return \"saycrd-sessions-\" + uid;\n}\nfunction loadSessions() {\n  try {\n    var key = _sessionKey();\n    var data = JSON.parse(localStorage.getItem(key) || \"[]\");\n    // Migrate old flat key if present and we have nothing user-specific\n    if (data.length === 0) {\n      var legacy = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n      if (legacy.length > 0) {\n        localStorage.setItem(key, JSON.stringify(legacy));\n        return legacy;\n      }\n    }\n    return data;\n  } catch(e) { return []; }\n}\nfunction getArchetypeHistory() {\n  var sessions = loadSessions(); var counts = {};\n  sessions.forEach(function(s) {\n    (s.archetypes || []).forEach(function(a) {\n      var key = typeof a === \"string\" ? a : a.key;\n      counts[key] = (counts[key] || 0) + 1;\n    });\n  });\n  return counts;\n}\nfunction getThemeHistory() {\n  var sessions = loadSessions();\n  var themeMap = {};\n  sessions.forEach(function(s, si) {\n    (s.themes || []).forEach(function(t) {\n      var k = (t.label || \"\").toLowerCase().trim();\n      if (!k) return;\n      if (!themeMap[k]) themeMap[k] = { label: t.label, appearances: [] };\n      themeMap[k].appearances.push({ session: si, weight: t.weight || 1, date: s.date });\n    });\n  });\n  return themeMap;\n}\nfunction getSessionTimeline() {\n  var sessions = loadSessions();\n  return sessions.map(function(s, i) {\n    var archs = (s.archetypes || []).map(function(a) { return typeof a === \"string\" ? a : a.key; });\n    return { index: i, date: s.date, archetypes: archs, intensity: s.intensity || 0, mapTitle: s.mapTitle || \"\", themes: s.themes || [] };\n  });\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 THE FIELD STATE ENGINE \u2014 7 Living Signals \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nvar PHASE_ORDER = {\n  chrysalis: [\"consuming\",\"dissolving\",\"clustering\",\"emergence\"],\n  tower: [\"trembling\",\"falling\",\"rubble\",\"clearing\"],\n  kintsugi: [\"breaking\",\"holding\",\"filling\",\"whole\"],\n  dark_night: [\"trigger\",\"crisis\",\"transformation\",\"emergence\"],\n  persephone: [\"descending\",\"underworld\",\"pomegranate\",\"returning\"],\n  phoenix: [\"burning\",\"ash\",\"stirring\",\"rising\"],\n  hermit: [\"withdrawing\",\"listening\",\"seeing\",\"returning\"],\n  sisyphus: [\"pushing\",\"rolling_back\",\"pausing\",\"meaning\"],\n  magician: [\"awakening\",\"practicing\",\"transforming\",\"mastery\"],\n  lover: [\"guarding\",\"opening\",\"feeling\",\"merging\"],\n  star: [\"darkness\",\"glimmer\",\"pouring\",\"shining\"],\n  threshold: [\"approaching\",\"standing\",\"crossing\",\"arrived\"],\n  weaver: [\"gathering\",\"seeing\",\"weaving\",\"wearing\"],\n  tree: [\"seed\",\"roots\",\"growing\",\"canopy\"],\n};\nvar ALCHEMY_ORDER = [\"nigredo\",\"albedo\",\"citrinitas\",\"rubedo\"];\n\nfunction computeFieldState() {\n  var sessions = loadSessions();\n  var n = sessions.length;\n  if (n === 0) return null;\n\n  var now = Date.now();\n  var firstDate = new Date(sessions[0].date).getTime();\n  var daysActive = Math.max(1, Math.round((now - firstDate) / 86400000));\n  var gaps = [];\n  for (var i = 1; i < n; i++) {\n    gaps.push(Math.round((new Date(sessions[i].date).getTime() - new Date(sessions[i-1].date).getTime()) / 86400000));\n  }\n  var avgGap = gaps.length > 0 ? Math.round(gaps.reduce(function(a,b){return a+b;},0) / gaps.length * 10) / 10 : 0;\n\n  // \u2500\u2500 1. THEME DRIFT \u2500\u2500\n  var themeTrack = {};\n  sessions.forEach(function(s, si) {\n    (s.themes || []).forEach(function(t) {\n      var k = (t.label || \"\").toLowerCase().trim();\n      if (!k) return;\n      if (!themeTrack[k]) themeTrack[k] = { label: t.label, weights: [], sessions: [] };\n      themeTrack[k].weights.push(t.weight || 1);\n      themeTrack[k].sessions.push(si);\n    });\n  });\n\n  var rising = [], fading = [], chronic = [], absent = [];\n  Object.keys(themeTrack).forEach(function(k) {\n    var t = themeTrack[k];\n    var w = t.weights;\n    if (w.length >= 2) {\n      var recent = w.slice(-2);\n      var delta = recent[recent.length - 1] - recent[0];\n      if (delta >= 1.5) rising.push({ label: t.label, delta: delta });\n      if (delta <= -1.5) fading.push({ label: t.label, delta: delta });\n      if (w.length >= 3 && t.sessions[t.sessions.length - 1] >= n - 1) chronic.push(t.label);\n    }\n    // Absent: was in 2+ sessions but not in last 2\n    if (t.sessions.length >= 2 && t.sessions[t.sessions.length - 1] < n - 2) {\n      absent.push(t.label);\n    }\n  });\n\n  // \u2500\u2500 2. ARCHETYPE VELOCITY \u2500\u2500\n  var archTrack = {};\n  sessions.forEach(function(s, si) {\n    (s.archetypes || []).forEach(function(a) {\n      var key = typeof a === \"string\" ? a : a.key;\n      var phase = a.phase || \"\";\n      var resp = s.archetypeResponse && s.archetypeResponse.key === key ? s.archetypeResponse.response : \"\";\n      if (!archTrack[key]) archTrack[key] = { appearances: [], phases: [], responses: [] };\n      archTrack[key].appearances.push(si);\n      archTrack[key].phases.push(phase);\n      archTrack[key].responses.push(resp);\n    });\n  });\n\n  var anchor = null, anchorCount = 0;\n  var archSignals = {};\n  Object.keys(archTrack).forEach(function(key) {\n    var a = archTrack[key];\n    if (a.appearances.length > anchorCount) { anchor = key; anchorCount = a.appearances.length; }\n\n    var order = PHASE_ORDER[key] || [];\n    var indices = a.phases.map(function(p) { return order.indexOf(p); }).filter(function(x) { return x >= 0; });\n\n    var velocity = \"stable\";\n    if (indices.length >= 2) {\n      var last2 = indices.slice(-2);\n      if (last2[1] > last2[0]) velocity = \"advancing\";\n      else if (last2[1] < last2[0]) velocity = \"regressing\";\n      else if (indices.length >= 3 && indices[indices.length-1] === indices[indices.length-2] && indices[indices.length-2] === indices[indices.length-3]) velocity = \"stuck\";\n    }\n\n    archSignals[key] = {\n      count: a.appearances.length,\n      currentPhase: a.phases[a.phases.length - 1] || \"\",\n      velocity: velocity,\n      phaseHistory: a.phases.join(\" \\u2192 \"),\n      lastResponse: a.responses.filter(Boolean).pop() || \"\",\n    };\n  });\n\n  // \u2500\u2500 3. TENSION EVOLUTION \u2500\u2500\n  var tensions = sessions.map(function(s) { return s.tension; }).filter(Boolean);\n  var tensionAge = 0;\n  var tensionShape = null;\n  if (tensions.length >= 2) {\n    var last = tensions[tensions.length - 1];\n    tensionShape = last.a + \" vs \" + last.b;\n    // Count how many consecutive sessions have similar tension\n    for (var ti = tensions.length - 1; ti >= 0; ti--) {\n      var t = tensions[ti];\n      if (t.a === last.a || t.b === last.b || t.a === last.b || t.b === last.a) tensionAge++;\n      else break;\n    }\n  }\n\n  // \u2500\u2500 4. ENERGY SIGNATURES \u2500\u2500\n  var energies = sessions.map(function(s) { return s.arrival ? s.arrival.energy : null; }).filter(Boolean);\n  var energyTrend = \"unknown\";\n  if (energies.length >= 2) {\n    var last = energies[energies.length - 1];\n    var prev = energies[energies.length - 2];\n    if (last === prev) {\n      energyTrend = energies.length >= 3 && energies[energies.length - 3] === last ? \"sustained\" : \"holding\";\n    } else {\n      var heavy = [\"heavy\",\"shattered\",\"restless\"];\n      var light = [\"warm\",\"tender\",\"still\",\"quiet\",\"grounded\"];\n      var lastH = heavy.indexOf(last) >= 0, prevH = heavy.indexOf(prev) >= 0;\n      var lastL = light.indexOf(last) >= 0, prevL = light.indexOf(prev) >= 0;\n      if (prevH && lastL) energyTrend = \"softening\";\n      else if (prevL && lastH) energyTrend = \"intensifying\";\n      else energyTrend = \"shifting\";\n    }\n  }\n\n  // \u2500\u2500 5. ALCHEMY VELOCITY \u2500\u2500\n  var alchemies = sessions.map(function(s) { return s.alchemy ? s.alchemy.stage : null; }).filter(Boolean);\n  var alchemyStage = alchemies.length > 0 ? alchemies[alchemies.length - 1] : null;\n  var alchemyVelocity = \"stable\";\n  if (alchemies.length >= 2) {\n    var ai1 = ALCHEMY_ORDER.indexOf(alchemies[alchemies.length - 2]);\n    var ai2 = ALCHEMY_ORDER.indexOf(alchemies[alchemies.length - 1]);\n    if (ai2 > ai1) alchemyVelocity = \"advancing\";\n    else if (ai2 < ai1) alchemyVelocity = \"regressing\";\n  }\n\n  // \u2500\u2500 6. BLIND SPOT ECHOES \u2500\u2500\n  var blindSpots = sessions.map(function(s) { return s.blind_spot || \"\"; }).filter(Boolean);\n  var lastBlindSpot = blindSpots.length > 0 ? blindSpots[blindSpots.length - 1] : \"\";\n\n  // \u2500\u2500 7. CONSTELLATIONS \u2500\u2500\n  var pairCounts = {};\n  sessions.forEach(function(s) {\n    var archs = (s.archetypes || []).map(function(a) { return typeof a === \"string\" ? a : a.key; });\n    for (var i = 0; i < archs.length; i++) {\n      for (var j = i + 1; j < archs.length; j++) {\n        var pair = [archs[i], archs[j]].sort().join(\"+\");\n        pairCounts[pair] = (pairCounts[pair] || 0) + 1;\n      }\n    }\n  });\n  var constellations = Object.keys(pairCounts).filter(function(k) { return pairCounts[k] >= 2; }).map(function(k) { return { pair: k, count: pairCounts[k] }; });\n\n  var state = {\n    sessionCount: n,\n    daysActive: daysActive,\n    avgGapDays: avgGap,\n    // themes\n    rising: rising.slice(0, 3),\n    fading: fading.slice(0, 3),\n    absent: absent.slice(0, 3),\n    chronic: chronic.slice(0, 3),\n    // archetypes\n    anchor: anchor,\n    anchorCount: anchorCount,\n    archSignals: archSignals,\n    // tension\n    tensionShape: tensionShape,\n    tensionAge: tensionAge,\n    // energy\n    energies: energies.slice(-5),\n    energyTrend: energyTrend,\n    // alchemy\n    alchemyStage: alchemyStage,\n    alchemyVelocity: alchemyVelocity,\n    // blind spots\n    lastBlindSpot: lastBlindSpot,\n    // constellations\n    constellations: constellations,\n  };\n\n  try { localStorage.setItem(\"saycrd-field-state\", JSON.stringify(state)); } catch(e) {}\n  return state;\n}\n\n// Archetype evolution messages \u2014 what to say on 1st, 2nd, 3rd+ visits\nvar ARCH_EVOLUTION = {\n  chrysalis: [\"Something is dissolving. You're in the space between.\", \"The chrysalis recognizes you. Deeper this time.\", \"You keep returning to transformation. The dissolving IS the work.\"],\n  tower: [\"Something is falling apart. Look at what's revealed.\", \"The tower visits again. What's built on false ground?\", \"You keep outgrowing structures. The collapse is graduation.\"],\n  kintsugi: [\"Something broke. The gold is coming.\", \"You've broken before. The repairs keep getting more beautiful.\", \"The cracks are your signature now.\"],\n  dark_night: [\"The old meaning dissolved. Stay in the dark.\", \"This darkness knows you. It's deeper this time.\", \"Each dark night strips another false floor.\"],\n  persephone: [\"Descending. Not punishment \u2014 initiation.\", \"The underworld recognizes you. You've been here.\", \"Queen of both worlds now. The descent is home.\"],\n  phoenix: [\"Burning. What survives is real.\", \"You've burned before. The rising gets faster.\", \"Fire is your element. Each version is truer.\"],\n  hermit: [\"Withdrew to hear something. Listen.\", \"The lamp is brighter. You've been here before.\", \"Solitude is your workshop now.\"],\n  sisyphus: [\"Same weight. Your grip is changing.\", \"The boulder knows your hands. What's different this time?\", \"You and the weight have an understanding now.\"],\n  magician: [\"Tools awakening. Watch what transforms.\", \"Your transmutation skills are growing.\", \"Lead into gold. You make it look easy now.\"],\n  lover: [\"The armor cracked. Let it.\", \"Opening wider. The terror and tenderness together.\", \"Vulnerability became your superpower.\"],\n  star: [\"Light in the dark. Notice it.\", \"You keep finding light. That's not luck.\", \"You ARE the light now. Steady, real.\"],\n  threshold: [\"Standing at the door.\", \"You've crossed thresholds before. This one's familiar.\", \"Doorways are your natural habitat.\"],\n  weaver: [\"Threads connecting.\", \"The pattern is getting clearer with each session.\", \"Master weaver. Seeing what others can't.\"],\n  tree: [\"Growth happening underground.\", \"Roots before branches \u2014 the tree grows in you.\", \"The patience IS the power.\"],\n  descent: [\"Going under. Treasure is down there.\", \"You've descended before. Faster each time.\", \"The underworld gives up its secrets to you.\"],\n  planets: [\"Forces in orbit around you.\", \"The cycles are getting familiar.\", \"You ride these forces now.\"],\n};\n\nvar FIELD_ALCHEMY = {\n  nigredo: { label: \"Nigredo\", sub: \"The Blackening\", season: \"Autumn\", color: \"#888\", bg: \"linear-gradient(160deg, #0D0A10 0%, #1a1018 40%, #44405030 100%)\" },\n  albedo: { label: \"Albedo\", sub: \"The Whitening\", season: \"Winter\", color: \"#e0e8f0\", bg: \"linear-gradient(160deg, #101418 0%, #1c2028 40%, #c0c8d030 100%)\" },\n  citrinitas: { label: \"Citrinitas\", sub: \"The Yellowing\", season: \"Spring\", color: \"#f0c840\", bg: \"linear-gradient(160deg, #141008 0%, #2a2010 40%, #d4a83030 100%)\" },\n  rubedo: { label: \"Rubedo\", sub: \"The Reddening\", season: \"Summer\", color: \"#ff5040\", bg: \"linear-gradient(160deg, #1A0608 0%, #2a0c10 40%, #cc303030 100%)\" },\n};\n\n\n// \u2500\u2500 Cross-Session Visualizations \u2500\u2500\n\nfunction JourneyRiver({ timeline, currentArchetypes }) {\n  // Shows archetype appearances across sessions as a flowing river\n  var sessions = timeline || [];\n  var totalSessions = sessions.length;\n  if (totalSessions < 2) return null;\n\n  var w = 300, h = 200, pad = 20;\n  var usable = w - pad * 2;\n  var maxShow = Math.min(totalSessions, 12);\n  var recent = sessions.slice(-maxShow);\n  var step = usable / Math.max(maxShow - 1, 1);\n\n  // Build river path from intensity\n  var points = recent.map(function(s, i) {\n    var x = pad + i * step;\n    var y = h * 0.5 - (s.intensity || 3) * 8;\n    return { x: x, y: Math.max(30, Math.min(h - 40, y)), archetypes: s.archetypes || [], intensity: s.intensity || 0 };\n  });\n\n  // Smooth curve path\n  var pathD = points.map(function(p, i) {\n    if (i === 0) return \"M \" + p.x + \" \" + p.y;\n    var prev = points[i - 1];\n    var cx = (prev.x + p.x) / 2;\n    return \"C \" + cx + \" \" + prev.y + \" \" + cx + \" \" + p.y + \" \" + p.x + \" \" + p.y;\n  }).join(\" \");\n\n  // Width river (thicker = more intense)\n  var pathD2 = points.map(function(p, i) {\n    var y2 = p.y + 12 + (p.intensity || 0) * 3;\n    if (i === 0) return \"M \" + p.x + \" \" + y2;\n    var prev = points[i - 1];\n    var prevY2 = prev.y + 12 + (prev.intensity || 0) * 3;\n    var cx = (prev.x + p.x) / 2;\n    return \"C \" + cx + \" \" + prevY2 + \" \" + cx + \" \" + y2 + \" \" + p.x + \" \" + y2;\n  }).join(\" \");\n\n  return React.createElement(\"svg\", { viewBox: \"0 0 \" + w + \" \" + h, style: { width: \"100%\", maxWidth: 300 } }, [\n    React.createElement(\"defs\", { key: \"defs\" }, [\n      React.createElement(\"linearGradient\", { key: \"rg\", id: \"riverGrad\", x1: \"0\", y1: \"0\", x2: \"1\", y2: \"0\" }, [\n        React.createElement(\"stop\", { key: \"s0\", offset: \"0%\", stopColor: \"rgba(107,255,184,0.1)\" }),\n        React.createElement(\"stop\", { key: \"s1\", offset: \"100%\", stopColor: \"#6BFFB8\" })\n      ])\n    ]),\n    // River body\n    React.createElement(\"path\", { key: \"river-top\", d: pathD, fill: \"none\", stroke: \"url(#riverGrad)\", strokeWidth: \"2.5\", strokeLinecap: \"round\", opacity: \"0.8\" }),\n    React.createElement(\"path\", { key: \"river-bot\", d: pathD2, fill: \"none\", stroke: \"url(#riverGrad)\", strokeWidth: \"1\", strokeLinecap: \"round\", opacity: \"0.3\" }),\n    // Fill between\n    React.createElement(\"path\", { key: \"river-fill\", d: pathD + \" \" + points.slice().reverse().map(function(p, i) {\n      var y2 = p.y + 12 + (p.intensity || 0) * 3;\n      return (i === 0 ? \"L \" : \"L \") + p.x + \" \" + y2;\n    }).join(\" \") + \" Z\", fill: \"rgba(107,255,184,0.04)\", stroke: \"none\" }),\n    // Session dots with archetype colors\n  ].concat(points.map(function(p, i) {\n    var archs = p.archetypes || [];\n    var isLast = i === points.length - 1;\n    var mainColor = \"#6BFFB8\";\n    if (archs.length > 0 && ARCH_REGISTRY[archs[0]]) mainColor = ARCH_REGISTRY[archs[0]].color;\n    return React.createElement(\"g\", { key: \"dot-\" + i }, [\n      React.createElement(\"circle\", { key: \"c\", cx: p.x, cy: p.y, r: isLast ? 6 : 3.5, fill: mainColor, opacity: isLast ? 0.9 : 0.4 + i * 0.04 }),\n      isLast ? React.createElement(\"circle\", { key: \"pulse\", cx: p.x, cy: p.y, r: \"10\", fill: \"none\", stroke: mainColor, strokeWidth: \"1\", opacity: \"0.3\", children: [\n        React.createElement(\"animate\", { key: \"a\", attributeName: \"r\", values: \"8;14;8\", dur: \"2s\", repeatCount: \"indefinite\" }),\n        React.createElement(\"animate\", { key: \"b\", attributeName: \"opacity\", values: \"0.3;0.1;0.3\", dur: \"2s\", repeatCount: \"indefinite\" })\n      ]}) : null,\n      archs.length > 1 && ARCH_REGISTRY[archs[1]] ? React.createElement(\"circle\", { key: \"c2\", cx: p.x + 6, cy: p.y - 5, r: 2.5, fill: ARCH_REGISTRY[archs[1]].color, opacity: 0.5 }) : null,\n    ]);\n  })).concat([\n    // Labels\n    React.createElement(\"text\", { key: \"lbl-start\", x: pad, y: h - 8, fontSize: \"9\", fill: \"rgba(255,255,255,0.2)\", fontFamily: FB }, totalSessions > maxShow ? \"...\" + (totalSessions - maxShow + 1) : \"1\"),\n    React.createElement(\"text\", { key: \"lbl-end\", x: w - pad, y: h - 8, fontSize: \"9\", fill: \"#6BFFB8\", fontFamily: FB, textAnchor: \"end\" }, \"now\"),\n    React.createElement(\"text\", { key: \"lbl-title\", x: w / 2, y: h - 8, fontSize: \"9\", fill: \"rgba(255,255,255,0.15)\", fontFamily: FB, textAnchor: \"middle\", letterSpacing: \"0.15em\" }, totalSessions + \" SESSIONS\")\n  ]));\n}\n\nfunction PatternWeave({ themeHistory, sessionCount }) {\n  // Shows recurring themes as horizontal threads with weight-based thickness\n  if (!themeHistory) return null;\n  var keys = Object.keys(themeHistory);\n  // Find themes that appeared in 2+ sessions\n  var recurring = keys.filter(function(k) { return themeHistory[k].appearances.length >= 2; })\n    .sort(function(a, b) { return themeHistory[b].appearances.length - themeHistory[a].appearances.length; })\n    .slice(0, 5);\n  if (recurring.length === 0) return null;\n\n  return React.createElement(\"div\", { style: { display: \"flex\", flexDirection: \"column\", gap: 12, width: \"100%\", maxWidth: 300 } },\n    recurring.map(function(key, i) {\n      var theme = themeHistory[key];\n      var apps = theme.appearances;\n      var latest = apps[apps.length - 1];\n      var first = apps[0];\n      var weightShift = latest.weight - first.weight;\n      var color = NC[i % NC.length];\n      var direction = weightShift > 0 ? \"\u2191\" : weightShift < 0 ? \"\u2193\" : \"\u2192\";\n      var dirColor = weightShift > 0 ? \"#FF6B9D\" : weightShift < 0 ? \"#6BFFB8\" : \"rgba(255,255,255,0.3)\";\n      return React.createElement(\"div\", { key: key, style: { display: \"flex\", alignItems: \"center\", gap: 12, animation: \"riseUp 0.5s ease \" + (i * 0.1) + \"s both\" } }, [\n        React.createElement(\"div\", { key: \"dot\", style: { width: 8, height: 8, borderRadius: \"50%\", background: color, opacity: 0.6, flexShrink: 0 } }),\n        React.createElement(\"div\", { key: \"info\", style: { flex: 1 } }, [\n          React.createElement(\"div\", { key: \"label\", style: { fontSize: 15, color: \"white\", fontFamily: FD, fontStyle: \"italic\" } }, theme.label),\n          React.createElement(\"div\", { key: \"meta\", style: { fontSize: 11, color: \"rgba(255,255,255,0.55)\", fontFamily: FB, marginTop: 2 } },\n            apps.length + \" sessions\" + (apps.length >= 3 ? \" \u2014 this keeps returning\" : \"\"))\n        ]),\n        React.createElement(\"div\", { key: \"shift\", style: { fontSize: 18, color: dirColor, fontFamily: FD, flexShrink: 0 } }, direction)\n      ]);\n    })\n  );\n}\n\n// \u2500\u2500 Field Phase \u2500\u2500\n\n// \u2500\u2500 Interactive Tension Card \u2014 tap a pole to see it react \u2500\u2500\nfunction TensionCard({ poleA, poleB, subText, whisper, color, userFragment }) {\n  var c = color || \"#6BB8FF\";\n  var [active, setActive] = useState(null); // null | \"a\" | \"b\"\n  var [pulseA, setPulseA] = useState(1);\n  var [pulseB, setPulseB] = useState(1);\n\n  function tapA(e) {\n    e.stopPropagation();\n    setActive(\"a\");\n    setPulseA(1.35);\n    setPulseB(0.7);\n    setTimeout(function() { setPulseA(1.15); setPulseB(0.85); }, 600);\n  }\n  function tapB(e) {\n    e.stopPropagation();\n    setActive(\"b\");\n    setPulseB(1.35);\n    setPulseA(0.7);\n    setTimeout(function() { setPulseB(1.15); setPulseA(0.85); }, 600);\n  }\n\n  var lineOpacity = active ? 0.35 : 0.15;\n  return <div style={{ position: \"absolute\", inset: 0, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", justifyContent: \"center\", overflow: \"hidden\" }}>\n    {/* Animated energy field */}\n    <svg style={{ position: \"absolute\", width: \"100%\", height: \"100%\", opacity: lineOpacity, transition: \"opacity 0.6s\" }}>\n      <line x1=\"12%\" y1=\"50%\" x2=\"88%\" y2=\"50%\" stroke={c} strokeWidth={active ? 2 : 1} strokeDasharray=\"6 10\"><animate attributeName=\"strokeDashoffset\" values=\"0;32\" dur=\"2s\" repeatCount=\"indefinite\"/></line>\n      {[0.35,0.42,0.5,0.58,0.65].map(function(y,i) {\n        return <line key={i} x1=\"18%\" y1={y*100+\"%\"} x2=\"82%\" y2={y*100+\"%\"} stroke={c} strokeWidth={0.5} opacity={0.8-Math.abs(y-0.5)*3} strokeDasharray=\"3 14\"><animate attributeName=\"strokeDashoffset\" values={\"0;\"+(16+i*4)} dur={(1.8+i*0.4)+\"s\"} repeatCount=\"indefinite\"/></line>;\n      })}\n    </svg>\n\n    <div style={{ fontSize: 10, color: c + \"55\", fontFamily: FB, letterSpacing: \"0.3em\", marginBottom: 24, zIndex: 1, animation: \"riseUp 0.6s ease both\" }}>TAP A SIDE</div>\n\n    <div style={{ display: \"flex\", alignItems: \"center\", width: \"100%\", padding: \"0 24px\", zIndex: 1 }}>\n      {/* Pole A */}\n      <div onClick={tapA} style={{ flex: 1, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", cursor: \"pointer\", animation: \"riseUp 0.7s ease 0.1s both\" }}>\n        <div style={{\n          width: 100, height: 100, borderRadius: \"50%\",\n          background: \"radial-gradient(circle at 40% 40%, \" + c + (active === \"a\" ? \"55\" : \"25\") + \", \" + c + \"08)\",\n          border: \"2px solid \" + c + (active === \"a\" ? \"88\" : \"44\"),\n          display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n          boxShadow: \"0 0 \" + (active === \"a\" ? 60 : 25) + \"px \" + c + (active === \"a\" ? \"44\" : \"15\"),\n          transform: \"scale(\" + pulseA + \")\",\n          transition: \"all 0.5s cubic-bezier(.34,1.56,.64,1)\",\n        }}>\n          <span style={{ fontFamily: FB, fontSize: 16, fontWeight: 800, color: active === \"a\" ? \"white\" : c, textAlign: \"center\", lineHeight: 1.2, padding: 8 }}>{poleA}</span>\n        </div>\n      </div>\n\n      {/* Center pulse */}\n      <div style={{ width: 14, height: 14, borderRadius: \"50%\", background: c, flexShrink: 0, opacity: active ? 0.6 : 0.25, transform: \"scale(\" + (active ? 1.3 : 1) + \")\", transition: \"all 0.5s\", boxShadow: active ? \"0 0 20px \" + c + \"66\" : \"none\" }} />\n\n      {/* Pole B */}\n      <div onClick={tapB} style={{ flex: 1, display: \"flex\", flexDirection: \"column\", alignItems: \"center\", cursor: \"pointer\", animation: \"riseUp 0.7s ease 0.2s both\" }}>\n        <div style={{\n          width: 100, height: 100, borderRadius: \"50%\",\n          background: \"radial-gradient(circle at 60% 40%, \" + c + (active === \"b\" ? \"55\" : \"25\") + \", \" + c + \"08)\",\n          border: \"2px solid \" + c + (active === \"b\" ? \"88\" : \"44\"),\n          display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n          boxShadow: \"0 0 \" + (active === \"b\" ? 60 : 25) + \"px \" + c + (active === \"b\" ? \"44\" : \"15\"),\n          transform: \"scale(\" + pulseB + \")\",\n          transition: \"all 0.5s cubic-bezier(.34,1.56,.64,1)\",\n        }}>\n          <span style={{ fontFamily: FB, fontSize: 16, fontWeight: 800, color: active === \"b\" ? \"white\" : c, textAlign: \"center\", lineHeight: 1.2, padding: 8 }}>{poleB}</span>\n        </div>\n      </div>\n    </div>\n\n    {subText && <div style={{ fontFamily: FD, fontSize: 17, fontStyle: \"italic\", color: \"rgba(255,255,255,\" + (active ? \"0.65\" : \"0.5\") + \")\", maxWidth: 320, textAlign: \"center\", lineHeight: 1.7, marginTop: 28, zIndex: 1, transition: \"color 0.4s\", animation: \"riseUp 0.8s ease 0.4s both\" }}>{subText}</div>}\n    {userFragment && <div style={{ position: \"absolute\", bottom: 52, left: 28, right: 28, textAlign: \"center\", zIndex: 1, animation: \"riseUp 0.8s ease 0.6s both\" }}>\n      <div style={{ fontSize: 9, color: \"rgba(255,255,255,0.45)\", fontFamily: FB, letterSpacing: \"0.15em\", marginBottom: 5, textTransform: \"uppercase\" }}>you wrote</div>\n      <div style={{ fontSize: 15, color: \"rgba(255,255,255,0.68)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5 }}>{\"\\u201C\"}{userFragment}{\"\\u201D\"}</div>\n    </div>}\n    {whisper && <div style={{ position: \"absolute\", bottom: 28, fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.25em\" }}>{whisper}</div>}\n  </div>;\n}\n\n// \u2500\u2500 AccuracySlider: drag/tap to rate how well something lands \u2500\u2500\n// value 0-100. onSlide(v). leftLabel / rightLabel. color.\nfunction AccuracySlider({ value, onSlide, color = \"#D6B26D\", leftLabel = \"not quite\", rightLabel = \"exactly this\" }) {\n  var trackRef = React.useRef(null);\n  var [dragging, setDragging] = React.useState(false);\n  function posToValue(clientX) {\n    var r = trackRef.current ? trackRef.current.getBoundingClientRect() : null;\n    if (!r) return value || 50;\n    return Math.round(Math.max(0, Math.min(1, (clientX - r.left) / r.width)) * 100);\n  }\n  function onDown(e) {\n    e.preventDefault(); e.stopPropagation();\n    setDragging(true);\n    var cx = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);\n    onSlide(posToValue(cx));\n  }\n  React.useEffect(function() {\n    if (!dragging) return;\n    function onMove(e) {\n      var cx = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);\n      onSlide(posToValue(cx));\n    }\n    function onUp() { setDragging(false); }\n    window.addEventListener(\"pointermove\", onMove, { passive: true });\n    window.addEventListener(\"pointerup\", onUp);\n    window.addEventListener(\"touchmove\", onMove, { passive: true });\n    window.addEventListener(\"touchend\", onUp);\n    return function() {\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      window.removeEventListener(\"touchmove\", onMove);\n      window.removeEventListener(\"touchend\", onUp);\n    };\n  }, [dragging]);\n  function onUp() { setDragging(false); }\n  var pct = value;\n  var alive = pct >= 68;\n  var away  = pct <= 32;\n  // Guard: if no real data, show error state instead of blank canvas\n  if (!sd || !sd.themes || sd.themes.length === 0) {\n    return (\n      <div style={{ width:\"100%\", height:\"100%\", display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", gap:20, padding:40 }}>\n        <div style={{ fontSize:13, color:\"rgba(255,107,107,0.6)\", fontFamily:FB, textAlign:\"center\", lineHeight:1.8 }}>\n          Your map could not be built \u2014 the session did not complete.<br/>\n          Go back and try again.\n        </div>\n        <button onClick={function(){ window.location.reload(); }} style={{ padding:\"10px 24px\", borderRadius:999, border:\"1px solid rgba(255,107,107,0.3)\", background:\"transparent\", color:\"rgba(255,107,107,0.7)\", fontFamily:FB, fontSize:13, cursor:\"pointer\" }}>start over</button>\n      </div>\n    );\n  }\n\n  return (\n    <div onClick={function(e){ e.stopPropagation(); }} style={{ width:\"100%\", maxWidth:300, marginTop:22, animation:\"riseUp 0.6s ease 1.4s both\" }}>\n      <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:10 }}>\n        <span style={{ fontSize:11, color: away ? \"rgba(255,255,255,0.75)\" : \"rgba(255,255,255,0.35)\", fontFamily:FB, letterSpacing:\"0.05em\", transition:\"color 0.3s\" }}>{leftLabel}</span>\n        <span style={{ fontSize:11, color: alive ? color : \"rgba(255,255,255,0.35)\", fontFamily:FB, letterSpacing:\"0.05em\", transition:\"color 0.3s\" }}>{rightLabel}</span>\n      </div>\n      <div ref={trackRef}\n        onPointerDown={onDown} onTouchStart={onDown}\n        style={{ position:\"relative\", height:6, borderRadius:3, background:\"rgba(255,255,255,0.1)\", cursor:\"pointer\", userSelect:\"none\" }}>\n        <div style={{ position:\"absolute\", left:0, top:0, height:\"100%\", width:pct+\"%\", borderRadius:3,\n          background: alive ? \"linear-gradient(90deg,\"+color+\"66,\"+color+\")\" : away ? \"rgba(255,255,255,0.2)\" : \"linear-gradient(90deg,rgba(255,255,255,0.15),rgba(255,255,255,0.4))\",\n          transition:\"background 0.3s\", boxShadow: alive ? \"0 0 10px \"+color+\"55\" : \"none\" }} />\n        <div style={{ position:\"absolute\", top:\"50%\", left:pct+\"%\", transform:\"translate(-50%,-50%)\",\n          width:18, height:18, borderRadius:\"50%\", background: alive ? color : \"rgba(255,255,255,0.7)\",\n          boxShadow: alive ? \"0 0 14px \"+color+\"88\" : \"0 1px 4px rgba(0,0,0,0.4)\",\n          transition:\"background 0.3s, box-shadow 0.3s\", cursor:\"grab\" }} />\n      </div>\n    </div>\n  );\n}\n\n\n// \u2500\u2500 BookmarkableCard: wraps any card content, adds hold-to-bookmark \u2500\u2500\nfunction BookmarkableCard({ text, label, color, children }) {\n  var holdTimer = React.useRef(null);\n  var [holding, setHolding] = React.useState(false);\n  var [saved, setSaved] = React.useState(false);\n  function start(e) {\n    if (saved) return;\n    setHolding(true);\n    holdTimer.current = setTimeout(function() {\n      try {\n        var bm = JSON.parse(localStorage.getItem(\"saycrd-bookmarks\") || \"[]\");\n        bm.push({ text, label, date: new Date().toISOString() });\n        localStorage.setItem(\"saycrd-bookmarks\", JSON.stringify(bm));\n      } catch(e2) {}\n      setSaved(true); setHolding(false);\n      setTimeout(function() { setSaved(false); }, 2500);\n    }, 1200);\n  }\n  function cancel() { clearTimeout(holdTimer.current); setHolding(false); }\n  return (\n    <div onMouseDown={start} onMouseUp={cancel} onMouseLeave={cancel}\n      onTouchStart={start} onTouchEnd={cancel} style={{ position:\"absolute\", inset:0 }}>\n      {children}\n      <div style={{ position:\"absolute\", bottom:28, right:24, fontSize:10, fontFamily:FB,\n        letterSpacing:\"0.1em\", color: saved ? \"#6BFFB8\" : holding ? \"rgba(255,255,255,0.55)\" : \"rgba(255,255,255,0.2)\",\n        transition:\"color 0.25s\", pointerEvents:\"none\", textTransform:\"uppercase\" }}>\n        {saved ? \"\u2713 bookmarked\" : holding ? \"hold...\" : \"hold to bookmark\"}\n      </div>\n    </div>\n  );\n}\n\n// \u2500\u2500 UnderneathItem: single item with hold-bookmark, used in map \u2500\u2500\nfunction UnderneathItem({ text, index }) {\n  var holdTimer = React.useRef(null);\n  var [holding, setHolding] = React.useState(false);\n  var [saved, setSaved] = React.useState(false);\n  var [swipeX, setSwipeX] = React.useState(0);\n  var [swiping, setSwiping] = React.useState(false);\n  var swipeStart = React.useRef(0);\n  var [reaction, setReaction] = React.useState(null);\n  var [noteOpen, setNoteOpen] = React.useState(false);\n  var [noteDraft, setNoteDraft] = React.useState(\"\");\n  var [noteSaved, setNoteSaved] = React.useState(false);\n  var HOLD_MS = 1100; var SWIPE_T = 60;\n\n  function startInteract(clientX, e) {\n    if (reaction) return;\n    e.stopPropagation();\n    swipeStart.current = clientX;\n    setSwiping(true); setSwipeX(0); setHolding(true);\n    holdTimer.current = setTimeout(function() {\n      try {\n        var bm = JSON.parse(localStorage.getItem(\"saycrd-bookmarks\") || \"[]\");\n        bm.push({ text: text, label:\"Underneath\", date:new Date().toISOString() });\n        localStorage.setItem(\"saycrd-bookmarks\", JSON.stringify(bm));\n      } catch(e2) {}\n      setSaved(true); setHolding(false); setSwiping(false);\n    }, HOLD_MS);\n  }\n  function moveInteract(clientX) {\n    if (!swiping || reaction) return;\n    var dx = clientX - swipeStart.current;\n    setSwipeX(dx);\n    if (Math.abs(dx) > 8) { clearTimeout(holdTimer.current); setHolding(false); }\n  }\n  function endInteract() {\n    clearTimeout(holdTimer.current); setHolding(false);\n    if (!swiping) return;\n    setSwiping(false);\n    var dx = swipeX; setSwipeX(0);\n    if (dx < -SWIPE_T) { setReaction(\"landed\"); }\n    else if (dx > SWIPE_T) { setReaction(\"pushed\"); setNoteOpen(true); }\n  }\n\n  var dir = swipeX < -8 ? \"land\" : swipeX > 8 ? \"push\" : null;\n  var bg = saved ? \"rgba(107,255,184,0.1)\"\n    : reaction === \"landed\" ? \"rgba(107,255,184,0.07)\"\n    : reaction === \"pushed\" ? \"rgba(255,96,144,0.07)\"\n    : holding ? \"rgba(184,107,255,0.18)\"\n    : \"rgba(184,107,255,0.07)\";\n  var bord = saved ? \"1px solid rgba(107,255,184,0.3)\"\n    : reaction === \"landed\" ? \"1px solid rgba(107,255,184,0.2)\"\n    : reaction === \"pushed\" ? \"1px solid rgba(255,96,144,0.2)\"\n    : holding ? \"1px solid rgba(184,107,255,0.45)\"\n    : \"1px solid rgba(184,107,255,0.14)\";\n\n  return (\n    <div style={{ animation:\"riseUp 0.5s ease \"+(index*0.15)+\"s both\" }}>\n      <div\n        onMouseDown={function(e){ startInteract(e.clientX,e); }}\n        onMouseMove={function(e){ moveInteract(e.clientX); }}\n        onMouseUp={endInteract} onMouseLeave={endInteract}\n        onTouchStart={function(e){ startInteract(e.touches[0].clientX,e); }}\n        onTouchMove={function(e){ moveInteract(e.touches[0].clientX); }}\n        onTouchEnd={endInteract}\n        onClick={function(e){ e.stopPropagation(); }}\n        style={{ padding:\"14px 18px\", borderRadius:14, background:bg, border:bord,\n          cursor:reaction?\"default\":\"grab\", transition:\"background 0.2s, border 0.2s\",\n          transform:swiping?\"translateX(\"+(swipeX*0.35)+\"px)\":\"none\",\n          userSelect:\"none\", WebkitUserSelect:\"none\" }}>\n        <p style={{ fontSize:17, fontFamily:FD, lineHeight:1.6, margin:\"0 0 6px\",\n          color: reaction===\"landed\" ? \"#6BFFB8\"\n            : reaction===\"pushed\" ? \"rgba(255,255,255,0.3)\"\n            : \"rgba(255,255,255,0.88)\" }}>{text}</p>\n        <div style={{ fontSize:10, fontFamily:FB, letterSpacing:\"0.08em\",\n          color: saved ? \"rgba(107,255,184,0.7)\"\n            : holding ? \"rgba(184,107,255,0.7)\"\n            : reaction===\"landed\" ? \"rgba(107,255,184,0.5)\"\n            : reaction===\"pushed\" ? \"rgba(255,96,144,0.5)\"\n            : dir===\"land\" ? \"rgba(107,255,184,0.4)\"\n            : dir===\"push\" ? \"rgba(255,96,144,0.4)\"\n            : \"rgba(255,255,255,0.18)\" }}>\n          {saved?\"\u2713 bookmarked\":holding?\"hold...\":reaction===\"landed\"?\"resonates \u2190\":reaction===\"pushed\"?\"pushed back \u2192\":dir===\"land\"?\"\u2190 resonates\":dir===\"push\"?\"push back \u2192\":\"hold to save \u00b7 swipe to react\"}\n        </div>\n      </div>\n      {noteOpen && !noteSaved && (\n        <div onClick={function(e){e.stopPropagation();}}\n          style={{ marginTop:8, padding:\"12px 14px\", borderRadius:12,\n            background:\"rgba(255,96,144,0.05)\", border:\"1px solid rgba(255,96,144,0.2)\",\n            animation:\"riseUp 0.3s ease both\" }}>\n          <div style={{ fontSize:11, color:\"rgba(255,96,144,0.65)\", fontFamily:FB,\n            letterSpacing:\"0.1em\", marginBottom:8 }}>what doesn't fit?</div>\n          <textarea value={noteDraft} onChange={function(e){setNoteDraft(e.target.value);}}\n            onKeyDown={function(e){\n              if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();setNoteSaved(true);setNoteOpen(false);}\n              if(e.key===\"Escape\"){setNoteOpen(false);setReaction(null);}\n            }}\n            placeholder=\"type anything \u2014 used as signal, not shown back\"\n            autoFocus\n            style={{ width:\"100%\", minHeight:52, background:\"rgba(255,255,255,0.03)\",\n              border:\"1px solid rgba(255,96,144,0.2)\", borderRadius:8,\n              color:\"rgba(255,255,255,0.85)\", fontFamily:FD, fontSize:14,\n              padding:\"8px 12px\", resize:\"none\", outline:\"none\",\n              lineHeight:1.55, boxSizing:\"border-box\" }} />\n          <div style={{ display:\"flex\", justifyContent:\"space-between\", marginTop:6 }}>\n            <button onClick={function(){setNoteOpen(false);setReaction(null);setNoteDraft(\"\");}}\n              style={{ fontSize:11, color:\"rgba(255,255,255,0.2)\", fontFamily:FB,\n                background:\"transparent\", border:\"none\", cursor:\"pointer\" }}>cancel</button>\n            <button onClick={function(){setNoteSaved(true);setNoteOpen(false);}}\n              style={{ fontSize:12, fontFamily:FB, background:\"transparent\",\n                border:\"1px solid rgba(255,96,144,0.25)\", borderRadius:12,\n                padding:\"4px 16px\", cursor:\"pointer\",\n                color:noteDraft.trim()?\"rgba(255,96,144,0.8)\":\"rgba(255,96,144,0.3)\"\n              }}>signal sent</button>\n          </div>\n        </div>\n      )}\n      {noteSaved && (\n        <div style={{ marginTop:4, fontSize:11, color:\"rgba(255,255,255,0.25)\", fontFamily:FB,\n          paddingLeft:4 }}>incorporated</div>\n      )}\n    </div>\n  );\n}\n\nfunction FieldPhase({ synthesisData, rawText }) {\n  var sd = synthesisData || {};\n  var themes = (sd.themes || []).map(function(t, i) { return { label: t.label, weight: t.weight || 1, color: t.color || NC[i % NC.length] }; });\n  var conns = sd.connections || [];\n  var tension = sd.tension || null;\n  var synthesis = sd.synthesis || \"\";\n  var underneath = sd.underneath || [];\n  var opening = sd.opening || \"\";\n  var archetypes = sd.archetypes || [];\n  var arrival = sd.arrival || null;\n  var alchemyData = sd.alchemy || null;\n  var blindSpot = sd.blind_spot || null;\n  var noticing = sd.noticing || \"\";\n\n  // Smart fallback archetypes\n  if (archetypes.length === 0 && themes.length > 0) {\n    var allText = (synthesis + \" \" + opening + \" \" + (underneath||[]).join(\" \") + \" \" + (tension ? tension.text : \"\") + \" \" + (rawText||\"\").slice(0,500)).toLowerCase();\n    var archScores = [\n      { key: \"chrysalis\", words: [\"transform\",\"change\",\"becoming\",\"dissolving\",\"letting go\",\"shift\",\"shed\",\"release\"], title: \"Something is dissolving\", line: \"What you were is making room for what you're becoming.\" },\n      { key: \"sisyphus\", words: [\"again\",\"loop\",\"repeat\",\"cycle\",\"stuck\",\"same\",\"keep\",\"pattern\",\"tired\",\"push\"], title: \"The beautiful repetition\", line: \"What looks like going nowhere might be building the strength you need.\" },\n      { key: \"tower\", words: [\"fall\",\"break\",\"collapse\",\"end\",\"fail\",\"shatter\",\"crumble\",\"lose\",\"wrong\"], title: \"The necessary collapse\", line: \"What's falling apart was supposed to fall apart.\" },\n      { key: \"phoenix\", words: [\"fire\",\"burn\",\"rise\",\"rebirth\",\"ash\",\"new\",\"emerge\",\"born\",\"start over\"], title: \"Rising from the heat\", line: \"Something had to burn before this could exist.\" },\n      { key: \"hermit\", words: [\"alone\",\"quiet\",\"silence\",\"solitude\",\"withdraw\",\"space\",\"retreat\",\"still\"], title: \"The lamp in the dark\", line: \"You stepped away to hear something.\" },\n      { key: \"threshold\", words: [\"door\",\"choice\",\"decide\",\"leave\",\"enter\",\"between\",\"edge\",\"ready\",\"step\",\"next\"], title: \"Standing at the door\", line: \"You already know which side you belong on.\" },\n      { key: \"weaver\", words: [\"connect\",\"thread\",\"pattern\",\"link\",\"weave\",\"together\",\"relate\",\"between\",\"across\"], title: \"The threads are connecting\", line: \"What seemed separate is revealing itself as one pattern.\" },\n      { key: \"star\", words: [\"hope\",\"light\",\"small\",\"gentle\",\"quiet\",\"tender\",\"soft\",\"okay\",\"fine\"], title: \"Light after collapse\", line: \"Something survived that wasn't supposed to.\" },\n    ];\n    archScores.forEach(function(arch) {\n      arch.score = 0;\n      arch.words.forEach(function(w) { if (allText.indexOf(w) >= 0) arch.score++; });\n    });\n    archScores.sort(function(a, b) { return b.score - a.score; });\n    archetypes = archScores[0].score > 0 ? [archScores[0]] : [{ key: \"chrysalis\", title: \"Something is dissolving\", line: \"What you were is making room for what you're becoming.\" }];\n  }\n\n  var savedRef = useRef(false);\n  useEffect(function() { if (!savedRef.current && sd.themes) { savedRef.current = true; saveSession(Object.assign({}, sd, { archetypes: archetypes })); } }, []);\n  var history = useMemo(function() { return getArchetypeHistory(); }, []);\n  var timeline = useMemo(function() { return getSessionTimeline(); }, []);\n  var sessionCount = timeline.length;\n\n  // Raw text stats \u2014 the \"Wrapped data moments\"\n  var words = (rawText || \"\").split(/\\s+/).filter(Boolean);\n  var wordCount = words.length;\n  var uniqueWords = [...new Set(words.map(function(w) { return w.toLowerCase().replace(/[^a-z]/g, \"\"); }))].filter(function(w) { return w.length > 0; });\n  var firstWord = words[0] || \"\u2014\";\n  var lastWord = words[words.length - 1] || \"\u2014\";\n  var freq = {};\n  words.forEach(function(w) { var k = w.toLowerCase().replace(/[^a-z]/g, \"\"); if (k.length >= 4) freq[k] = (freq[k] || 0) + 1; });\n  var topWord = Object.keys(freq).sort(function(a, b) { return freq[b] - freq[a]; })[0] || \"this\";\n  var topWordCount = freq[topWord] || 0;\n  var strongConn = conns[0] || null;\n\n  // Archetype cards\n  var primaryArch = archetypes[0] || null;\n  var archReg = primaryArch ? (ARCH_REGISTRY[primaryArch.key] || ARCH_REGISTRY.chrysalis) : null;\n  var alchStage = alchemyData ? (alchemyData.stage || \"nigredo\") : \"nigredo\";\n  var alchInfo = FIELD_ALCHEMY[alchStage] || FIELD_ALCHEMY.nigredo;\n  var alchColor = alchInfo.color || \"#888\";\n\n  var [archResponse, setArchResponse] = useState(null);\n  var [current, setCurrent] = useState(0);\n  var [clicked, setClicked] = useState(false);\n  var containerRef = useRef(null);\n  // Per-card accuracy sliders\n  var [sliderValues, setSliderValues] = useState({});\n  function setSlider(key, v) { setSliderValues(function(prev) { return Object.assign({}, prev, {[key]: v}); }); }\n  // Bookmarks\n  var [bookmarks, setBookmarks] = useState(function() { try { return JSON.parse(localStorage.getItem(\"saycrd-bookmarks\")||\"[]\"); } catch(e) { return []; } });\n\n  function handleArchResponse(response) {\n    setArchResponse(response);\n    setClicked(true);\n    try {\n      var sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n      var last = sessions[sessions.length - 1];\n      if (last && primaryArch) { last.archetypeResponse = { key: primaryArch.key, response: response }; localStorage.setItem(\"saycrd-sessions\", JSON.stringify(sessions)); }\n    } catch(e) {}\n  }\n\n  // \u2550\u2550\u2550 BUILD CARDS \u2550\u2550\u2550\n  var CARDS = useMemo(function() {\n    var c = [];\n\n    // 1. ARRIVAL \u2014 deep purple \u2192 hot magenta. Session opens.\n    c.push({ type: \"arrival\", bg: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, #E84393 100%)\" });\n\n    // 2. WORDS \u2014 concrete stat. How much they poured.\n    c.push({ type: \"words\", bg: \"linear-gradient(160deg, #081A10 0%, #143028 40%, #6BFFB8 100%)\" });\n\n    // 3. TOP THEMES \u2014 ranked forces with animated bars\n    if (themes.length > 0) c.push({ type: \"top_themes\", bg: \"linear-gradient(160deg, #2E0A18 0%, #6B1D3D 40%, #FF6B9D 100%)\" });\n\n    // 4. THE READING \u2014 synthesis. Warm amber.\n    c.push({ type: \"synthesis\", bg: \"linear-gradient(160deg, #2E1A08 0%, #6B3D1D 40%, #D6B26D 100%)\" });\n\n    // 5. BIG WORD \u2014 hidden pattern. Most repeated word.\n    if (topWordCount > 1) c.push({ type: \"bigword\", bg: \"linear-gradient(160deg, #081E1E 0%, #14383A 40%, #7ECABA 100%)\" });\n\n    // 6. THE LINK \u2014 strongest connection\n    if (strongConn) c.push({ type: \"connection\", bg: \"linear-gradient(160deg, #080A1A 0%, #14213D 40%, #6BB8FF 100%)\" });\n\n    // 7. TENSION \u2014 interactive reveal\n    if (tension) c.push({ type: \"tension\", bg: \"linear-gradient(160deg, #080A1A 0%, #14213D 40%, #6BB8FF 100%)\", interactive: true });\n\n    // 8. UNDERNEATH \u2014 what lives below\n    if (underneath.length > 0) c.push({ type: \"underneath\", bg: \"linear-gradient(160deg, #1A0A2E 0%, #2D1B4B 40%, #B86BFF 100%)\" });\n\n    // 9. BLIND SPOT \u2014 the shadow card. Near-black.\n    if (blindSpot) c.push({ type: \"blind_spot\", bg: \"linear-gradient(160deg, #060608 0%, #0E0E16 50%, #2A2A36 100%)\" });\n\n    // 10. ARCHETYPE \u2014 the identity reveal. Interactive.\n    if (primaryArch && archReg) {\n      c.push({ type: \"archetype\", bg: archReg.bg, interactive: true });\n    }\n\n    // 11. SESSION PORTRAIT \u2014 DataPortrait visual\n    if (themes.length > 1) c.push({ type: \"portrait\", bg: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, #E84393 100%)\" });\n\n    // 12. OPENING \u2014 what's trying to emerge. First word / last word.\n    c.push({ type: \"opening\", bg: \"linear-gradient(160deg, #081A12 0%, #1B4B3D 40%, #6BFFB8 100%)\" });\n\n    // 13. CLOSING \u2014 landing. Theme rings. \"You named what you're carrying.\"\n    c.push({ type: \"closing\", bg: \"linear-gradient(160deg, #081A12 0%, #1B6B3D 40%, #6BFFB8 100%)\" });\n\n    return c;\n  }, [archResponse, tension, underneath.length, primaryArch, blindSpot, strongConn, topWordCount, themes.length]);\n\n  var card = CARDS[current];\n\n  var advance = function() {\n    if (card.interactive && !clicked) { setClicked(true); return; }\n    if (current < CARDS.length - 1) { setCurrent(function(c) { return c + 1; }); setClicked(false); }\n  };\n  var goBack = function() { if (current > 0) { setCurrent(function(c) { return c - 1; }); setClicked(false); } };\n  var handleClick = function(e) {\n    if (e.target.closest && (e.target.closest(\"button\") || e.target.closest(\"[data-noadvance]\") || e.target.tagName === \"circle\" || e.target.tagName === \"svg\")) return;\n    var rect = containerRef.current ? containerRef.current.getBoundingClientRect() : null;\n    if (!rect) return;\n    var x = (e.clientX || (e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientX : 0)) - rect.left;\n    x < rect.width * 0.25 ? goBack() : advance();\n  };\n  useEffect(function() {\n    var handler = function(e) { if (e.key === \"ArrowRight\" || e.key === \" \") advance(); else if (e.key === \"ArrowLeft\") goBack(); };\n    window.addEventListener(\"keydown\", handler);\n    return function() { window.removeEventListener(\"keydown\", handler); };\n  }, [current, clicked, CARDS.length]);\n\n  var renderCard = function() {\n    switch (card.type) {\n\n      // \u2500\u2500 ARRIVAL \u2500\u2500\n      case \"arrival\": return (\n        <FC><FieldParticles color=\"#E84393\" count={28} />\n          <div style={{ fontSize: 11, letterSpacing: \"0.4em\", color: \"rgba(255,255,255,0.2)\", fontFamily: FB, marginBottom: 40, animation: \"riseUp 0.8s ease both\" }}>\n            {sessionCount > 1 ? \"SESSION \" + sessionCount : \"THIS SESSION\"}\n          </div>\n          <FHero size={48} color=\"white\">{arrival ? arrival.line : \"Your\\nField\"}</FHero>\n          {arrival && arrival.energy && <div style={{ marginTop: 28, display: \"flex\", alignItems: \"center\", gap: 10, animation: \"riseUp 1s ease 0.5s both\" }}>\n            <div style={{ width: 8, height: 8, borderRadius: \"50%\", background: \"#E84393\", boxShadow: \"0 0 14px rgba(232,67,147,0.5)\" }} />\n            <span style={{ fontSize: 12, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, letterSpacing: \"0.2em\", textTransform: \"uppercase\" }}>{arrival.energy}</span>\n          </div>}\n          {archetypes.length > 0 && archReg && <div style={{ display: \"flex\", gap: 10, marginTop: 36, flexWrap: \"wrap\", justifyContent: \"center\", animation: \"riseUp 0.8s ease 0.8s both\" }}>\n            <div style={{ padding: \"6px 16px\", borderRadius: 20, background: archReg.color + \"14\", border: \"1px solid \" + archReg.color + \"30\", fontSize: 12, color: archReg.color + \"cc\", fontFamily: FB }}>{archReg.icon} {archReg.name}</div>\n          </div>}\n          <div style={{ marginTop: 48, fontSize: 12, color: \"rgba(255,255,255,0.15)\", fontFamily: FB }}>tap to begin \u2192</div>\n        </FC>\n      );\n\n      // \u2500\u2500 WORDS \u2014 the Wrapped stat moment \u2500\u2500\n      case \"words\": {\n        // Detect emotional tones from text\n        var txt = (rawText || \"\").toLowerCase();\n        var tones = [\n          { key:\"doubt\",       label:\"Doubt\",       color:\"#6BB8FF\", words:[\"maybe\",\"unsure\",\"wonder\",\"question\",\"not sure\",\"unclear\",\"confused\",\"doubt\",\"uncertain\",\"hesit\"] },\n          { key:\"clarity\",     label:\"Clarity\",     color:\"#6BFFB8\", words:[\"clear\",\"understand\",\"realize\",\"see now\",\"know\",\"certain\",\"obvious\",\"makes sense\",\"finally\"] },\n          { key:\"optimism\",    label:\"Optimism\",    color:\"#FFD700\", words:[\"hope\",\"better\",\"possible\",\"excited\",\"looking forward\",\"believe\",\"will\",\"can\",\"going to\",\"good\"] },\n          { key:\"frustration\", label:\"Frustration\", color:\"#FF6B9D\", words:[\"frustrated\",\"stuck\",\"again\",\"why\",\"tired\",\"enough\",\"over it\",\"annoyed\",\"keeps\",\"always\",\"never\"] },\n          { key:\"curiosity\",   label:\"Curiosity\",   color:\"#B86BFF\", words:[\"curious\",\"wonder\",\"what if\",\"interesting\",\"explore\",\"discover\",\"notice\",\"find\",\"question\",\"how\"] },\n          { key:\"urgency\",     label:\"Urgency\",     color:\"#FFB86B\", words:[\"need\",\"must\",\"now\",\"urgent\",\"soon\",\"time\",\"quickly\",\"asap\",\"before\",\"deadline\",\"running out\"] },\n        ];\n        var scored = tones.map(function(t) {\n          var score = 0; t.words.forEach(function(w) { var re = new RegExp(w,\"g\"); var m = txt.match(re); if(m) score += m.length; }); return Object.assign({},t,{score});\n        }).filter(function(t) { return t.score > 0; }).sort(function(a,b) { return b.score-a.score; }).slice(0,4);\n        // Fallback if nothing detected\n        if (scored.length === 0) {\n          var energy = (arrival && arrival.energy) || \"restless\";\n          var energyMap = { heavy:\"frustration\", electric:\"urgency\", shattered:\"doubt\", still:\"clarity\", quiet:\"clarity\", warm:\"optimism\", grounded:\"clarity\", restless:\"urgency\", tender:\"curiosity\", fierce:\"urgency\" };\n          var fallbackKey = energyMap[energy] || \"curiosity\";\n          scored = [tones.find(function(t){return t.key===fallbackKey;})||tones[4]];\n        }\n        var maxScore = scored[0].score || 1;\n        return (\n          <FC><FieldParticles color=\"#6BFFB8\" count={20} />\n            <FLabel color=\"#6BFFB8\">YOU POURED</FLabel>\n            <div style={{ fontSize: wordCount > 999 ? 90 : 116, fontWeight: 300, color: \"white\", lineHeight: 1, fontFamily: FD, letterSpacing: \"-0.04em\", animation: \"riseUp 0.6s ease both\" }}>{wordCount.toLocaleString()}</div>\n            <div style={{ fontSize: 18, color: \"rgba(255,255,255,0.6)\", fontFamily: FB, marginBottom: 32, animation: \"riseUp 0.6s ease 0.2s both\" }}>words</div>\n            <div style={{ width:\"100%\", maxWidth:290, display:\"flex\", flexDirection:\"column\", gap:10, animation:\"riseUp 0.7s ease 0.4s both\" }}>\n              <div style={{ fontSize:11, color:\"rgba(255,255,255,0.45)\", fontFamily:FB, letterSpacing:\"0.18em\", textTransform:\"uppercase\", marginBottom:4 }}>What came through</div>\n              {scored.map(function(t, i) {\n                var pct = Math.min(100, Math.round((t.score / maxScore) * 100));\n                return <div key={t.key} style={{ animation:\"riseUp 0.5s ease \"+(0.45+i*0.12)+\"s both\" }}>\n                  <div style={{ display:\"flex\", justifyContent:\"space-between\", marginBottom:5 }}>\n                    <span style={{ fontSize:16, color:\"rgba(255,255,255,0.88)\", fontFamily:FB, fontWeight:600 }}>{t.label}</span>\n                    <span style={{ fontSize:13, color:t.color, fontFamily:FB }}>{pct}%</span>\n                  </div>\n                  <div style={{ height:6, background:\"rgba(255,255,255,0.07)\", borderRadius:3, overflow:\"hidden\" }}>\n                    <div style={{ width:pct+\"%\", height:\"100%\", background:\"linear-gradient(90deg,\"+t.color+\"55,\"+t.color+\")\", borderRadius:3, animation:\"growWidth 0.9s ease \"+(0.5+i*0.15)+\"s both\", boxShadow:\"0 0 8px \"+t.color+\"44\" }} />\n                  </div>\n                </div>;\n              })}\n            </div>\n          </FC>\n        );\n      }\n\n      // \u2500\u2500 TOP THEMES \u2014 ranked forces \u2500\u2500\n      case \"top_themes\": return (\n        <FC><FieldParticles color=\"#FF6B9D\" count={14} />\n          <FLabel color=\"#FF6B9D\">YOUR FORCES</FLabel>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 14, width: \"100%\", maxWidth: 310 }}>\n            {themes.slice(0, 5).map(function(t, i) {\n              var pct = Math.min(100, Math.round((t.weight / 5) * 100));\n              return <div key={i} style={{ display: \"flex\", alignItems: \"center\", gap: 14, animation: \"riseUp 0.5s ease \" + (i * 0.12) + \"s both\" }}>\n                <span style={{ fontSize: 26, color: t.color, fontFamily: FD, fontWeight: 700, width: 28, textAlign: \"right\" }}>{i + 1}</span>\n                <div style={{ flex: 1 }}>\n                  <span style={{ fontSize: 21, color: \"white\", fontFamily: FB, fontWeight: 600 }}>{t.label}</span>\n                  <div style={{ height: 5, background: \"rgba(255,255,255,0.06)\", borderRadius: 3, overflow: \"hidden\", marginTop: 6 }}>\n                    <div style={{ width: pct + \"%\", height: \"100%\", background: \"linear-gradient(90deg, \" + t.color + \"55, \" + t.color + \")\", borderRadius: 3, animation: \"growWidth 1s ease \" + (i * 0.15) + \"s both\" }} />\n                  </div>\n                </div>\n              </div>;\n            })}\n          </div>\n        </FC>\n      );\n\n      // \u2500\u2500 SYNTHESIS / THE READING \u2500\u2500\n      case \"synthesis\": {\n        var sv = sliderValues.synthesis !== undefined ? sliderValues.synthesis : 50;\n        var alive = sv >= 68; var away = sv <= 32;\n        return (\n          <BookmarkableCard text={synthesis} label=\"The Reading\" color=\"#D6B26D\">\n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\",\n              alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px 80px\",\n              transition:\"opacity 0.5s\", opacity: away ? 0.55 : 1 }}>\n              <FieldParticles color={alive ? \"#E8B84E\" : \"#D6B26D\"} count={alive ? 20 : 8} />\n              <FLabel color=\"#D6B26D\">THE READING</FLabel>\n              <div style={{ fontSize:22, color: alive ? \"white\" : \"rgba(255,255,255,0.85)\",\n                fontFamily:FD, lineHeight:1.65, textAlign:\"center\", maxWidth:320,\n                animation:\"riseUp 0.8s ease both\",\n                textShadow: alive ? \"0 0 40px rgba(232,184,78,0.25)\" : \"none\",\n                transition:\"text-shadow 0.5s, color 0.3s\" }}>\n                {synthesis || \"Something is moving underneath your words.\"}\n              </div>\n              {alive && <div style={{ position:\"absolute\", inset:20, borderRadius:20,\n                border:\"1px solid rgba(232,184,78,0.18)\", pointerEvents:\"none\",\n                animation:\"riseUp 0.4s ease both\" }} />}\n              {noticing && !away && <div style={{ marginTop:24, padding:\"12px 18px\", borderRadius:12,\n                background:\"rgba(214,178,109,0.07)\", border:\"1px solid rgba(214,178,109,0.15)\",\n                maxWidth:290, animation:\"riseUp 0.8s ease 0.5s both\" }}>\n                <div style={{ fontSize:14, color:\"rgba(255,200,120,0.8)\", fontFamily:FB, lineHeight:1.65 }}>\u2726 {noticing}</div>\n              </div>}\n              {away && <div style={{ marginTop:24, fontSize:14, color:\"rgba(255,255,255,0.55)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>didn't land \u2014 keep moving</div>}\n              <AccuracySlider value={sv} onSlide={function(v){setSlider(\"synthesis\",v);}} color=\"#D6B26D\" leftLabel=\"doesn't fit\" rightLabel=\"exactly this\" />\n            </div>\n          </BookmarkableCard>\n        );\n      }\n\n      // \u2500\u2500 BIGWORD \u2014 hidden pattern \u2500\u2500\n      case \"bigword\": {\n        var bwSv = sliderValues.bigword !== undefined ? sliderValues.bigword : 50;\n        var bwAlive = bwSv >= 68;\n        // Curious question based on frequency\n        var bwQuestions = [\n          \"What does \"+topWord+\" want from you right now?\",\n          \"Every time you wrote \"+topWord+\", something needed to be named. What is it?\",\n          \"You reached for \"+topWord+\" \"+topWordCount+\" times. What does it carry?\",\n          \"The word \"+topWord+\" showed up repeatedly. Is it a craving, or a weight?\",\n        ];\n        var bwQ = bwQuestions[topWordCount % bwQuestions.length];\n        return (\n          <FC><FieldParticles color={bwAlive ? \"#A8E8DA\" : \"#7ECABA\"} count={bwAlive ? 24 : 14} />\n            <FLabel color=\"#7ECABA\">HIDDEN PATTERN</FLabel>\n            <div style={{ fontSize:14, color:\"rgba(255,255,255,0.65)\", fontFamily:FB, marginBottom:8, animation:\"riseUp 0.6s ease both\" }}>you wrote the word</div>\n            <div style={{ fontSize:52, color: bwAlive ? \"#A8E8DA\" : \"#7ECABA\", fontFamily:FD, animation:\"riseUp 0.7s ease 0.2s both\", letterSpacing:\"-0.01em\",\n              textShadow: bwAlive ? \"0 0 50px rgba(126,202,186,0.5)\" : \"none\", transition:\"all 0.4s\" }}>{topWord}</div>\n            <div style={{ fontSize:100, fontWeight:300, color:\"white\", lineHeight:1, fontFamily:FD, animation:\"riseUp 0.8s ease 0.3s both\" }}>{topWordCount}</div>\n            <div style={{ fontSize:16, color:\"rgba(255,255,255,0.55)\", fontFamily:FB, animation:\"riseUp 0.6s ease 0.45s both\", marginBottom:4 }}>times</div>\n            <div style={{ marginTop:16, fontSize:15, color:\"rgba(126,202,186,0.8)\", fontFamily:FD, maxWidth:280, textAlign:\"center\", lineHeight:1.65, animation:\"riseUp 0.8s ease 0.9s both\" }}>\n              {bwQ}\n            </div>\n            <AccuracySlider value={bwSv} onSlide={function(v){setSlider(\"bigword\",v);}} color=\"#7ECABA\" leftLabel=\"coincidence\" rightLabel=\"significant\" />\n          </FC>\n        );\n      }\n\n      // \u2500\u2500 CONNECTION \u2014 the link \u2500\u2500\n      case \"connection\": {\n        var cSv = sliderValues.connection !== undefined ? sliderValues.connection : 50;\n        var cAlive = cSv >= 68; var cAway = cSv <= 32;\n        var fromColor = (themes.find(function(t){return t.label===strongConn?.from;}))||{color:\"#FFB86B\"};\n        var toColor   = (themes.find(function(t){return t.label===strongConn?.to;}))||{color:\"#6BB8FF\"};\n        return (\n          <FC><FieldParticles color={cAlive ? \"#9DCFFF\" : \"#6BB8FF\"} count={cAlive ? 22 : 12} />\n            <FLabel color=\"#6BB8FF\">THE LINK</FLabel>\n            {strongConn && <>\n              <div style={{ display:\"flex\", alignItems:\"center\", gap:14, margin:\"16px 0\", animation:\"riseUp 0.7s ease 0.1s both\",\n                filter: cAway ? \"opacity(0.4)\" : \"none\", transition:\"filter 0.4s\" }}>\n                <FOrb color={fromColor.color}>{(strongConn.from||\"\").length>10?strongConn.from.slice(0,9)+\"\u2026\":strongConn.from}</FOrb>\n                <div style={{ display:\"flex\", flexDirection:\"column\", alignItems:\"center\", gap:5 }}>\n                  <div style={{ width: cAlive ? 64 : 44, height: cAlive ? 3 : 2, background:\"linear-gradient(90deg,\"+fromColor.color+\",\"+toColor.color+\")\",\n                    boxShadow: cAlive ? \"0 0 12px rgba(107,184,255,0.4)\" : \"none\", transition:\"all 0.4s\" }} />\n                  <span style={{ fontSize:11, color:\"rgba(255,255,255,0.55)\", fontFamily:FB, fontWeight:700, textTransform:\"uppercase\", letterSpacing:\"0.1em\" }}>{strongConn.label}</span>\n                </div>\n                <FOrb color={toColor.color}>{(strongConn.to||\"\").length>10?strongConn.to.slice(0,9)+\"\u2026\":strongConn.to}</FOrb>\n              </div>\n              <div style={{ fontSize:19, color: cAlive ? \"rgba(255,255,255,0.95)\" : \"rgba(255,255,255,0.72)\", fontFamily:FD, maxWidth:290, lineHeight:1.65, animation:\"riseUp 0.8s ease 0.35s both\",\n                textShadow: cAlive ? \"0 0 30px rgba(107,184,255,0.3)\" : \"none\", transition:\"all 0.4s\" }}>{strongConn.insight}</div>\n              {cAlive && <div style={{ marginTop:12, fontSize:14, color:\"rgba(107,184,255,0.7)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>What does this connection ask of you?</div>}\n              {cAway && <div style={{ marginTop:12, fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>Not quite \u2014 explore the map to find the link that does fit.</div>}\n            </>}\n            <AccuracySlider value={cSv} onSlide={function(v){setSlider(\"connection\",v);}} color=\"#6BB8FF\" leftLabel=\"forced\" rightLabel=\"I see it\" />\n          </FC>\n        );\n      }\n\n      // \u2500\u2500 TENSION \u2014 interactive \u2500\u2500\n      case \"tension\": {\n        var tA = tension ? tension.a : \"one force\";\n        var tB = tension ? tension.b : \"another\";\n        var tText = tension ? tension.text : \"\";\n        var tSv = sliderValues.tension !== undefined ? sliderValues.tension : 50;\n        var tAlive = tSv >= 68; var tAway = tSv <= 32;\n        var tQuestions = [\n          \"What would it cost you to stop managing this tension?\",\n          \"Which side are you secretly on?\",\n          \"What if the tension IS the answer \u2014 not a problem to solve?\",\n          \"Who taught you these two things couldn't coexist?\",\n        ];\n        var tQ = tQuestions[(tA+tB).length % tQuestions.length];\n        return <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px\" }}>\n          <FLabel color=\"#6BB8FF\">YOUR TENSION</FLabel>\n          <div style={{ display:\"flex\", justifyContent:\"space-between\", width:\"100%\", maxWidth:300, marginBottom:4, animation:\"riseUp 0.6s ease both\" }}>\n            <span style={{ fontSize:24, color:\"#FF8080\", fontFamily:FD, fontWeight:600 }}>{tA}</span>\n            <span style={{ fontSize:24, color:\"#6BC5FF\", fontFamily:FD, fontWeight:600 }}>{tB}</span>\n          </div>\n          <TensionPull clicked={clicked} />\n          {!clicked\n            ? <div onClick={function(e){e.stopPropagation();setClicked(true);}} style={{ marginTop:8, fontSize:14, color:\"rgba(107,184,255,0.8)\", fontFamily:FB, letterSpacing:\"0.08em\", cursor:\"pointer\", padding:\"10px 20px\", border:\"1px solid rgba(107,184,255,0.2)\", borderRadius:20 }}>tap to see what lives here</div>\n            : <div style={{ animation:\"riseUp 0.6s ease\", textAlign:\"center\", width:\"100%\" }}>\n                <div style={{ fontSize:19, color: tAlive ? \"rgba(255,255,255,0.95)\" : \"rgba(255,255,255,0.78)\", fontFamily:FD, maxWidth:290, lineHeight:1.65,\n                  transition:\"color 0.3s\", textShadow: tAlive ? \"0 0 30px rgba(107,184,255,0.25)\" : \"none\" }}>{tText}</div>\n                {tAlive && <div style={{ marginTop:18, fontSize:15, color:\"rgba(107,197,255,0.75)\", fontFamily:FD, maxWidth:280, lineHeight:1.6, animation:\"riseUp 0.5s ease both\" }}>{tQ}</div>}\n                {tAway && <div style={{ marginTop:18, fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\" }}>This doesn't fit \u2014 bring your real tension into the map.</div>}\n                <AccuracySlider value={tSv} onSlide={function(v){setSlider(\"tension\",v);}} color=\"#6BB8FF\" leftLabel=\"not quite\" rightLabel=\"that's the one\" />\n              </div>}\n        </div>;\n      }\n\n      // \u2500\u2500 UNDERNEATH \u2500\u2500\n      case \"underneath\": {\n        var uSv = sliderValues.underneath !== undefined ? sliderValues.underneath : 50;\n        var uAlive = uSv >= 68;\n        return (\n          <FC><FieldParticles color={uAlive ? \"#D08BFF\" : \"#B86BFF\"} count={uAlive ? 20 : 10} />\n            <FLabel color=\"#B86BFF\">WHAT'S UNDERNEATH</FLabel>\n            <div style={{ fontSize:11, color:\"rgba(255,255,255,0.3)\", fontFamily:FB, letterSpacing:\"0.1em\", marginBottom:16 }}>hold to save \u00b7 swipe to react</div>\n            <div style={{ display:\"flex\", flexDirection:\"column\", gap:12, maxWidth:320, width:\"100%\" }}>\n              {underneath.slice(0,3).map(function(t, idx) {\n                var text = typeof t === \"string\" ? t : t.observation || \"\";\n                return <UnderneathItem key={idx} text={text} index={idx} />;\n              })}\n            </div>\n          </FC>\n        );\n      }\n\n      // \u2500\u2500 BLIND SPOT \u2014 the shadow card \u2500\u2500\n      case \"blind_spot\": {\n        var bsSv = sliderValues.blind_spot !== undefined ? sliderValues.blind_spot : 50;\n        var bsAlive = bsSv >= 68; var bsAway = bsSv <= 32;\n        var bsWords = (blindSpot||\"\").split(\" \");\n        return (\n          <div style={{ position:\"absolute\", inset:0, overflow:\"hidden\",\n            background:\"linear-gradient(185deg, #010508 0%, #030C14 40%, #041020 70%, #071828 100%)\" }}>\n            {/* Ocean light from below */}\n            <div style={{ position:\"absolute\", bottom:0, left:\"50%\", transform:\"translateX(-50%)\",\n              width:500, height:320,\n              background:\"radial-gradient(ellipse at 50% 100%, rgba(30,80,160,0.18) 0%, rgba(20,50,120,0.08) 45%, transparent 70%)\",\n              pointerEvents:\"none\" }} />\n            {/* Shimmer lines */}\n            {bsAlive && [0,1,2].map(function(_,i) {\n              return <div key={i} style={{ position:\"absolute\", left: (20+i*30)+\"%\", top:0, bottom:0, width:1,\n                background:\"linear-gradient(180deg,transparent,rgba(80,140,255,0.06),transparent)\",\n                animation:\"sweep \"+(4+i*1.5)+\"s ease-in-out infinite\", animationDelay:i*0.8+\"s\", pointerEvents:\"none\" }} />;\n            })}\n            <div style={{ position:\"absolute\", inset:0, display:\"flex\", flexDirection:\"column\", alignItems:\"center\", justifyContent:\"center\", padding:\"60px 28px\" }}>\n              {/* VISIBLE TITLE */}\n              <div style={{ fontSize:13, color:\"rgba(80,140,255,0.9)\", fontFamily:FB, letterSpacing:\"0.22em\", fontWeight:700, textTransform:\"uppercase\", marginBottom:28, animation:\"riseUp 0.8s ease both\" }}>WHAT YOU MIGHT NOT SEE</div>\n              {/* Text rains down word by word */}\n              <div style={{ textAlign:\"center\", maxWidth:320, marginBottom:16 }}>\n                {bsWords.map(function(w, i) {\n                  return <span key={i} style={{ fontFamily:FD, fontSize:22, fontWeight:400,\n                    color: bsAlive ? \"rgba(180,210,255,0.95)\" : bsAway ? \"rgba(255,255,255,0.35)\" : \"rgba(255,255,255,0.78)\",\n                    animation:\"fallIn 0.7s ease \"+(0.3+i*0.12)+\"s both\",\n                    display:\"inline-block\", marginRight:7, marginBottom:4, transition:\"color 0.4s\",\n                    textShadow: bsAlive ? \"0 0 20px rgba(80,140,255,0.4)\" : \"none\" }}>{w}</span>;\n                })}\n              </div>\n              {bsAlive && <div style={{ fontSize:15, color:\"rgba(80,160,255,0.75)\", fontFamily:FD, maxWidth:280, textAlign:\"center\", lineHeight:1.65, animation:\"riseUp 0.5s ease both\", marginBottom:8 }}>\n                What becomes possible when you can finally see this?\n              </div>}\n              {bsAway && <div style={{ fontSize:14, color:\"rgba(255,255,255,0.5)\", fontFamily:FB, animation:\"riseUp 0.5s ease both\", marginBottom:8 }}>\n                Not the right angle \u2014 keep exploring.\n              </div>}\n              <AccuracySlider value={bsSv} onSlide={function(v){setSlider(\"blind_spot\",v);}} color=\"#5090FF\" leftLabel=\"way off\" rightLabel=\"that's the gap\" />\n            </div>\n          </div>\n        );\n      }\n\n      // \u2500\u2500 ARCHETYPE \u2014 identity reveal \u2500\u2500\n      case \"archetype\": {\n        if (!primaryArch || !archReg) return null;\n        var Viz = archReg.Viz;\n        var c = archReg.color;\n        var timesAppeared = history[primaryArch.key] || 0;\n        var vizEl = null;\n        var archPhase = primaryArch ? primaryArch.phase : null;\n        try { vizEl = <Viz phase={archPhase} color={c} />; } catch(e) { vizEl = <div style={{fontSize:52}}>{archReg.icon}</div>; }\n\n        if (!clicked) return (\n          <FC><FieldParticles color={c} count={20} />\n            <FLabel color={c}>{archReg.name.toUpperCase()}</FLabel>\n            <FHero size={26} color=\"rgba(255,255,255,0.6)\">{primaryArch.title || archReg.name}</FHero>\n            <div style={{ margin: \"16px 0\" }}>{vizEl}</div>\n            <FTap color={c}>tap to see what's emerging \u2192</FTap>\n          </FC>\n        );\n        return (\n          <FC><FieldParticles color={c} count={28} />\n            <FLabel color={c}>{archReg.name.toUpperCase()}</FLabel>\n            {primaryArch.phase && archReg.phases && archReg.phases[primaryArch.phase] && <div style={{ fontSize: 11, color: c, opacity: 0.5, fontFamily: FB, letterSpacing: \"0.2em\", textTransform: \"uppercase\", marginBottom: 14, animation: \"riseUp 0.5s ease both\" }}>{primaryArch.phase.replace(/_/g,\" \")}</div>}\n            <div style={{ margin: \"8px 0 14px\" }}>{vizEl}</div>\n            <div style={{ fontSize: 18, color: \"rgba(255,255,255,0.7)\", fontFamily: FD, fontStyle: \"italic\", maxWidth: 300, lineHeight: 1.65, animation: \"riseUp 0.8s ease 0.3s both\" }}>{primaryArch.reading || primaryArch.line || archReg.phases?.dissolving || \"\"}</div>\n            {timesAppeared > 1 && <div style={{ marginTop: 16, fontSize: 12, color: c + \"77\", fontFamily: FB, animation: \"riseUp 0.6s ease 0.6s both\" }}>This pattern has visited you {timesAppeared} times.</div>}\n            {alchemyData && alchemyData.stage && <div style={{ marginTop: 22, padding: \"10px 18px\", borderRadius: 12, background: \"rgba(255,255,255,0.03)\", border: \"1px solid rgba(255,255,255,0.07)\", animation: \"riseUp 0.7s ease 0.7s both\" }}>\n              <div style={{ fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.2em\", marginBottom: 5 }}>{(FIELD_ALCHEMY[alchemyData.stage]||{}).label || alchemyData.stage}</div>\n              {alchemyData.evidence && <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.38)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6 }}>{alchemyData.evidence}</div>}\n            </div>}\n          </FC>\n        );\n      }\n\n      // \u2500\u2500 SESSION PORTRAIT \u2500\u2500\n      case \"portrait\": return (\n        <FC><FieldParticles color=\"#E84393\" count={14} />\n          <FLabel color=\"#E84393\">SESSION PORTRAIT</FLabel>\n          <DataPortrait themes={themes} />\n        </FC>\n      );\n\n      // \u2500\u2500 OPENING \u2500\u2500\n      case \"opening\": return (\n        <FC><FieldParticles color=\"#6BFFB8\" count={18} />\n          <FLabel color=\"#6BFFB8\">WHAT'S OPENING</FLabel>\n          <div style={{ fontSize: 26, color: \"#6BFFB8\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5, textAlign: \"center\", maxWidth: 300, animation: \"riseUp 0.8s ease both\" }}>\n            {opening || \"Something is trying to emerge.\"}\n          </div>\n          <div style={{ marginTop: 40, textAlign: \"center\", animation: \"riseUp 0.8s ease 0.5s both\" }}>\n            <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, marginBottom: 8 }}>Your first word</div>\n            <div style={{ fontSize: 28, color: \"rgba(255,255,255,0.3)\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 24 }}>{firstWord}</div>\n            <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, marginBottom: 8 }}>Your last word</div>\n            <div style={{ fontSize: 36, color: \"#6BFFB8\", fontFamily: FD, fontStyle: \"italic\" }}>{lastWord}</div>\n          </div>\n        </FC>\n      );\n\n      // \u2500\u2500 CLOSING \u2500\u2500\n      case \"closing\": return (\n        <FC><FieldParticles color=\"#6BFFB8\" count={35} />\n          <div style={{ marginBottom: 28 }}>\n            <svg viewBox=\"0 0 160 160\" style={{ width: 110, height: 110 }}>\n              {[50,40,30,20].map(function(r, i) {\n                var col = themes[i] ? themes[i].color : \"#6BFFB8\";\n                return <circle key={i} cx=\"80\" cy=\"80\" r={r} fill=\"none\" stroke={col} strokeWidth={i===3?2.5:1} opacity={0.12+i*0.1}>\n                  <animate attributeName=\"r\" values={r+\";\"+(r+7)+\";\"+r} dur={(3+i*0.6)+\"s\"} repeatCount=\"indefinite\" />\n                  <animate attributeName=\"opacity\" values={(0.1+i*0.08)+\";\"+(0.2+i*0.1)+\";\"+(0.1+i*0.08)} dur={(3+i*0.6)+\"s\"} repeatCount=\"indefinite\" />\n                </circle>;\n              })}\n              <circle cx=\"80\" cy=\"80\" r=\"7\" fill={themes[0] ? themes[0].color : \"#6BFFB8\"} opacity=\"0.9\">\n                <animate attributeName=\"r\" values=\"7;9;7\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n              </circle>\n            </svg>\n          </div>\n          <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.25)\", fontFamily: FB, letterSpacing: \"0.35em\", marginBottom: 28 }}>THE FIELD</div>\n          <FHero size={38} color=\"white\">You named<br/>what you're<br/>carrying</FHero>\n          {primaryArch && archReg && <div style={{ marginTop: 28, padding: \"8px 18px\", borderRadius: 20, background: archReg.color + \"14\", border: \"1px solid \" + archReg.color + \"28\", fontSize: 13, color: archReg.color, fontFamily: FB }}>\n            {archReg.icon} {archReg.name}\n          </div>}\n          <div style={{ marginTop: 32, fontSize: 14, color: \"rgba(255,255,255,0.2)\", fontFamily: FB }}>Next session whenever you're ready.</div>\n        </FC>\n      );\n\n      default: return null;\n    }\n  };\n\n  return (\n    <div ref={containerRef} onClick={handleClick} style={{ width: \"100%\", height: \"100%\", background: card.bg, position: \"absolute\", inset: 0, cursor: \"pointer\", userSelect: \"none\", transition: \"background 0.7s ease\" }}>\n      {/* Progress bars \u2014 tap to navigate */}\n      <div style={{ display:\"flex\", gap:3, padding:\"14px 16px 0\", position:\"absolute\", top:0, left:0, right:0, zIndex:10 }}>\n        {CARDS.map(function(_, i) {\n          var visited = i < current;\n          var isCurrent = i === current;\n          return <div key={i}\n            onClick={function(e){ e.stopPropagation(); if (i <= current) { setCurrent(i); setClicked(false); } }}\n            style={{ flex:1, height: isCurrent ? 3 : 2.5, borderRadius:2,\n              background: visited ? \"rgba(255,255,255,0.6)\" : isCurrent ? \"rgba(255,255,255,0.9)\" : \"rgba(255,255,255,0.12)\",\n              transition:\"all 0.3s\",\n              cursor: visited ? \"pointer\" : \"default\",\n              transform: visited ? \"scaleY(1)\" : \"scaleY(1)\" }} />;\n        })}\n      </div>\n      <div key={current + \"-\" + clicked} style={{ width: \"100%\", height: \"100%\", animation: clicked ? \"morphIn 0.5s ease\" : \"slideIn 0.35s ease-out\" }}>\n        {renderCard()}\n      </div>\n    </div>\n  );\n}\n\n// \u2500\u2500 User Profile system (localStorage) \u2500\u2500\nfunction useUserProfile() {\n  function get() {\n    try { return JSON.parse(localStorage.getItem(\"saycrd-profile\") || \"null\"); } catch(e) { return null; }\n  }\n  function set(p) {\n    try { localStorage.setItem(\"saycrd-profile\", JSON.stringify(p)); } catch(e) {}\n  }\n  function getSessions() {\n    try { return JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\"); } catch(e) { return []; }\n  }\n  function addSession(s) {\n    try {\n      var ss = getSessions();\n      ss.push(Object.assign({ id: Date.now(), ts: new Date().toISOString() }, s));\n      localStorage.setItem(\"saycrd-sessions\", JSON.stringify(ss.slice(-50)));\n    } catch(e) {}\n  }\n  return { get, set, getSessions, addSession };\n}\n\n// \u2500\u2500 Session Album \u2014 compact history strip \u2500\u2500\nfunction SessionAlbum({ sessions, color }) {\n  if (!sessions || sessions.length === 0) return null;\n  var last8 = sessions.slice(-8);\n  return (\n    <div style={{ display:\"flex\", gap:6, justifyContent:\"center\", flexWrap:\"wrap\", marginTop:12 }}>\n      {last8.map(function(s, i) {\n        var arch = (s.arch || \"\").slice(0,1).toUpperCase();\n        var archColor = s.archColor || color || \"#888\";\n        return (\n          <div key={i} title={\"Session \"+(i+1)+\": \"+new Date(s.ts||s.id).toLocaleDateString()}\n            style={{ width:28, height:28, borderRadius:\"50%\",\n              background:\"rgba(255,255,255,0.04)\",\n              border:\"1.5px solid \"+archColor+\"44\",\n              display:\"flex\", alignItems:\"center\", justifyContent:\"center\",\n              fontSize:11, color:archColor, fontFamily:\"Space Grotesk, sans-serif\",\n              fontWeight:600, cursor:\"default\",\n              boxShadow: i===last8.length-1 ? \"0 0 10px \"+archColor+\"44\" : \"none\" }}>\n            {arch || \"\u25c6\"}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nfunction LandingPhase({ onStart }) {\n  var [show, setShow] = useState(false);\n  var [sessions, setSessions] = useState([]);\n  var [userName, setUserName] = useState(\"\");\n  var SG = \"Space Grotesk, \" + FB;\n\n  useEffect(function() {\n    setTimeout(function() { setShow(true); }, 120);\n    // Wait for auth to resolve before loading sessions \u2014 currentUser must be set first\n    function loadAfterAuth() {\n      var s = loadSessions();\n      setSessions(s);\n      var cu = window.currentUser;\n      if (cu && cu.email && cu.email !== \"local@saycrd\") {\n        setUserName(cu.email.split(\"@\")[0]);\n      } else {\n        try {\n          var prof = JSON.parse(localStorage.getItem(\"saycrd-profile\") || \"null\");\n          if (prof && prof.name) setUserName(prof.name);\n        } catch(e) {}\n      }\n    }\n    var ap = window._authReady;\n    if (ap && typeof ap.then === \"function\") { ap.then(loadAfterAuth); }\n    else { loadAfterAuth(); }\n  }, []);\n\n  var returning = sessions.length > 0;\n  var lastSession = returning ? sessions[sessions.length - 1] : null;\n\n  return (\n    <div style={{ width:\"100%\", height:\"100%\", overflow:\"auto\", WebkitOverflowScrolling:\"touch\", background:\"#050508\" }}>\n\n      {/* ambient */}\n      <div style={{ position:\"fixed\", inset:0, pointerEvents:\"none\", zIndex:0, overflow:\"hidden\" }}>\n        <div style={{ position:\"absolute\", top:\"-15%\", right:\"-10%\", width:500, height:500, borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(232,67,147,0.12), transparent 65%)\", filter:\"blur(80px)\", animation:\"floatWord 20s ease-in-out infinite\" }} />\n        <div style={{ position:\"absolute\", bottom:\"-10%\", left:\"-8%\", width:450, height:450, borderRadius:\"50%\", background:\"radial-gradient(circle, rgba(107,255,184,0.08), transparent 65%)\", filter:\"blur(70px)\", animation:\"floatWord 24s ease-in-out infinite\", animationDelay:\"-8s\" }} />\n      </div>\n\n      {/* nav */}\n      <nav style={{ position:\"sticky\", top:0, zIndex:20, display:\"flex\", justifyContent:\"space-between\", alignItems:\"center\", padding:\"20px 6vw\", backdropFilter:\"blur(16px)\", background:\"linear-gradient(180deg, rgba(5,5,8,0.9), transparent)\" }}>\n        <div style={{ fontFamily:SG, fontSize:18, fontWeight:700, letterSpacing:\"0.25em\", color:\"rgba(255,255,255,0.7)\" }}>SAYCRD</div>\n        {userName && <div style={{ fontFamily:FB, fontSize:12, color:\"rgba(255,255,255,0.25)\", letterSpacing:\"0.08em\" }}>{userName}</div>}\n        <button onClick={onStart} style={{ padding:\"8px 20px\", borderRadius:999, border:\"1px solid rgba(232,67,147,0.3)\", background:\"rgba(232,67,147,0.07)\", color:\"#E84393\", fontFamily:FB, fontSize:13, fontWeight:600, cursor:\"pointer\", letterSpacing:\"0.05em\" }}>\n          {returning ? \"new session\" : \"begin\"}\n        </button>\n      </nav>\n\n      <div style={{ position:\"relative\", zIndex:1, maxWidth:520, margin:\"0 auto\", padding:\"60px 6vw 80px\" }}>\n\n        {/* hero */}\n        <div style={{ marginBottom:60, opacity:show?1:0, transform:show?\"translateY(0)\":\"translateY(20px)\", transition:\"all 1s cubic-bezier(.25,.46,.45,.94)\" }}>\n          {returning && lastSession ? (\n            <div>\n              <div style={{ fontSize:10, letterSpacing:\"0.35em\", textTransform:\"uppercase\", color:\"rgba(232,67,147,0.4)\", fontFamily:FB, marginBottom:16 }}>\n                session {sessions.length}\n              </div>\n              <h1 style={{ fontFamily:FD, fontSize:\"clamp(28px,5vw,42px)\", fontWeight:300, lineHeight:1.2, color:\"rgba(255,255,255,0.88)\", marginBottom:16 }}>\n                {userName ? \"Welcome back, \" + userName + \".\" : \"Welcome back.\"}\n              </h1>\n              {lastSession.synthesis && (\n                <p style={{ fontFamily:FD, fontSize:16, fontStyle:\"italic\", color:\"rgba(255,255,255,0.4)\", lineHeight:1.7, marginBottom:0 }}>\n                  Last time: \u201c{lastSession.synthesis.slice(0,120)}{lastSession.synthesis.length>120?\"\u2026\":\"\"}\u201d\n                </p>\n              )}\n            </div>\n          ) : (\n            <div>\n              <div style={{ fontSize:10, letterSpacing:\"0.35em\", textTransform:\"uppercase\", color:\"rgba(232,67,147,0.4)\", fontFamily:FB, marginBottom:16 }}>\n                a place to go in the moment\n              </div>\n              <h1 style={{ fontFamily:FD, fontSize:\"clamp(28px,5vw,46px)\", fontWeight:300, lineHeight:1.15, color:\"rgba(255,255,255,0.9)\", marginBottom:20 }}>\n                The space between your inner world and the next true move.\n              </h1>\n              <p style={{ fontFamily:FD, fontSize:17, fontWeight:300, fontStyle:\"italic\", color:\"rgba(255,255,255,0.45)\", lineHeight:1.7 }}>\n                SAYCRD listens, shapes what you say into a living map, and remembers your patterns over time.\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* session history */}\n        {returning && (\n          <div style={{ marginBottom:48, opacity:show?1:0, transition:\"opacity 1s ease 0.3s\" }}>\n            <div style={{ fontSize:9, letterSpacing:\"0.3em\", textTransform:\"uppercase\", color:\"rgba(255,255,255,0.15)\", fontFamily:FB, marginBottom:14 }}>\n              {sessions.length} session{sessions.length!==1?\"s\":\"\"} recorded\n            </div>\n            <div style={{ display:\"flex\", gap:8, flexWrap:\"wrap\" }}>\n              {sessions.slice(-12).map(function(s, i) {\n                var arch = s.archetypes && s.archetypes[0];\n                var col = arch ? (arch.color || \"#888\") : \"#888\";\n                var label = arch ? (arch.name || arch.key || \"\").split(\" \").pop().slice(0,1).toUpperCase() : String(i+1);\n                var daysAgo = Math.round((Date.now() - new Date(s.date).getTime()) / 86400000);\n                var when = daysAgo===0?\"today\":daysAgo===1?\"yesterday\":daysAgo<7?daysAgo+\"d ago\":Math.round(daysAgo/7)+\"w ago\";\n                return (\n                  <div key={i} title={when + (s.mapTitle ? \" \u00b7 \" + s.mapTitle : \"\")} style={{\n                    width:34, height:34, borderRadius:\"50%\",\n                    background:\"rgba(255,255,255,0.03)\",\n                    border:\"1.5px solid \"+col+\"44\",\n                    display:\"flex\", alignItems:\"center\", justifyContent:\"center\",\n                    fontSize:11, color:col, fontFamily:FB, fontWeight:700,\n                    cursor:\"default\",\n                    boxShadow: i===sessions.slice(-12).length-1 ? \"0 0 14px \"+col+\"44\" : \"none\"\n                  }}>{label}</div>\n                );\n              })}\n            </div>\n            {lastSession && lastSession.mapTitle && (\n              <div style={{ marginTop:10, fontSize:12, color:\"rgba(255,255,255,0.2)\", fontFamily:FB, letterSpacing:\"0.05em\" }}>\n                last map: {lastSession.mapTitle}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* cta */}\n        <div style={{ opacity:show?1:0, transition:\"opacity 1s ease 0.5s\" }}>\n          <button onClick={onStart} style={{\n            width:\"100%\", padding:\"16px 0\", borderRadius:14,\n            background:\"linear-gradient(135deg, #E84393, #B86BFF)\",\n            border:\"none\", color:\"#fff\",\n            fontFamily:FB, fontSize:15, fontWeight:600, letterSpacing:\"0.06em\",\n            cursor:\"pointer\", boxShadow:\"0 12px 40px rgba(232,67,147,0.2)\"\n          }}>\n            {returning ? \"start a new session\" : \"begin your first session\"}\n          </button>\n          <div style={{ marginTop:14, textAlign:\"center\", fontSize:11, color:\"rgba(255,255,255,0.15)\", fontFamily:FB, letterSpacing:\"0.08em\" }}>\n            {returning ? \"your history carries forward\" : \"your words shape what emerges\"}\n          </div>\n        </div>\n\n      </div>\n    </div>\n  );\n}\n\nfunction SAYCRDFlow() {\n  const [authReady, setAuthReady] = useState(false);\n  const [phase, setPhase] = useState(0);\n\n  // Wait for Supabase auth to resolve before showing anything\n  useEffect(function() {\n    var p = window._authReady;\n    if (p && typeof p.then === \"function\") {\n      p.then(function() { setAuthReady(true); });\n    } else {\n      setAuthReady(true);\n    }\n  }, []);\n  const [rawText, setRawText] = useState(\"\");\n  const [synthesisData, setSynthesisData] = useState(null);\n  const [mapResponses, setMapResponses] = useState({});\n  const [sessionData, setSessionData] = useState({});\n  const [fieldTransition, setFieldTransition] = useState(false);\n\n  // \u2500\u2500 LIVE PATCH \u2500\u2500 user feedback immediately rewrites the source data\n  function onPatchSynthesis(patch) {\n    setSynthesisData(function(prev) {\n      if (!prev) return prev;\n      var next = Object.assign({}, prev);\n      if (patch.synthesis) next.synthesis = patch.synthesis;\n      if (patch.tension) next.tension = Object.assign({}, prev.tension || {}, patch.tension);\n      if (patch.connections) {\n        var existing = prev.connections || [];\n        var updated = existing.map(function(c) {\n          var m = patch.connections.find(function(pc){ return pc.from===c.from && pc.to===c.to; });\n          return m ? Object.assign({}, c, m) : c;\n        });\n        patch.connections.forEach(function(pc) {\n          if (!updated.find(function(c){ return c.from===pc.from && c.to===pc.to; })) updated.push(pc);\n        });\n        next.connections = updated;\n      }\n      if (patch.guide) next.guide = patch.guide;\n      return next;\n    });\n  }\n\n  const cp = PHASES[phase];\n\n  if (!authReady) return (\n    <div style={{width:\"100%\",height:\"100vh\",background:\"#050508\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\"}}>\n      <div style={{width:6,height:6,borderRadius:\"50%\",background:\"rgba(232,67,147,0.4)\",animation:\"connBlink 1.5s ease infinite\"}} />\n    </div>\n  );\n\n  function enterField() {\n    setFieldTransition(true);\n    setTimeout(function() { setPhase(5); setFieldTransition(false); }, 1200);\n  }\n  return (\n    <div style={{width:\"100%\",height:\"100vh\",background:\"#000\",display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}}>\n      <link href=\"https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Space+Grotesk:wght@300;400;500;600&display=swap\" rel=\"stylesheet\"/>\n      <div style={{width:\"100%\",maxWidth: cp === \"landing\" ? \"100%\" : 420,height:\"100vh\",maxHeight: cp === \"landing\" ? \"100%\" : 860,background:GRADIENTS[cp],position:\"relative\",overflow:\"hidden\",transition:\"background 0.8s ease\"}}>\n        {phase>=1&&phase<5&&<PhaseIndicator current={phase-1} phases={PHASES.slice(1,5)}/>}\n        <div key={phase} style={{width:\"100%\",height:\"100%\",animation:\"slideIn 0.4s ease-out\"}}>\n          {cp===\"landing\"&&<LandingPhase onStart={function(){setPhase(1);}}/>}\n          {cp===\"pour\"&&<PourPhase onComplete={function(t){setRawText(t);setPhase(2);}}/>}\n          {cp===\"synthesize\"&&<SynthesizePhase rawText={rawText} onComplete={function(){setPhase(3);}} onSynthesis={setSynthesisData}/>}\n          {cp===\"map\"&&<MapPhase onComplete={function(mapData){setMapResponses(mapData||{});setPhase(4);}} synthesisData={synthesisData} rawText={rawText} onPatchSynthesis={onPatchSynthesis}/>}\n          {cp===\"session\"&&<SessionPhase onComplete={function(sData){setSessionData(sData||{});enterField();}} synthesisData={synthesisData} onPatchSynthesis={onPatchSynthesis}/>}\n          {cp===\"field\"&&<FieldPhase synthesisData={synthesisData} rawText={rawText} mapResponses={mapResponses} sessionData={sessionData}/>}\n          {fieldTransition && <div style={{ position: \"fixed\", inset: 0, zIndex: 999, background: \"#000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", animation: \"morphIn 0.4s ease both\" }}>\n            <div style={{ fontFamily: FB, fontSize: 11, letterSpacing: \"0.4em\", color: \"rgba(255,255,255,0.2)\", textTransform: \"uppercase\", animation: \"pulse 1.5s ease infinite\" }}>entering the field</div>\n          </div>}\n        </div>\n      </div>\n      <style>{`\n        @keyframes slideIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}\n        @keyframes morphIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}\n        @keyframes riseUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}\n        @keyframes pulse{0%,100%{opacity:0.7}50%{opacity:1}}\n        @keyframes spin{to{transform:rotate(360deg)}}\n        @keyframes growWidth{from{width:0%}}\n        @keyframes floatParticle{0%,100%{transform:translateY(0) translateX(0)}33%{transform:translateY(-10px) translateX(5px)}66%{transform:translateY(5px) translateX(-7px)}}\n        @keyframes fieldFloat{0%,100%{transform:translateY(0) translateX(0)}33%{transform:translateY(-12px) translateX(6px)}66%{transform:translateY(6px) translateX(-8px)}}\n        @keyframes floatWord{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}\n        @keyframes connBlink{0%,100%{opacity:0.65;filter:brightness(1)}50%{opacity:1;filter:brightness(1.4)}}\n        @keyframes ringPulse{0%,100%{opacity:0.3;transform:scale(1)}50%{opacity:0.7;transform:scale(1.15)}}\n        @keyframes nodeBreathe{0%,100%{filter:brightness(1)}50%{filter:brightness(1.12)}}\n        @keyframes breathe{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.7}50%{transform:translate(-50%,-50%) scale(1.15);opacity:1}}\n        @keyframes drawerIn{from{opacity:0;transform:translate(-50%,24px) scale(0.95)}to{opacity:1;transform:translate(-50%,0) scale(1)}}\n        @keyframes sweep{0%,100%{transform:translateX(-100%)}50%{transform:translateX(100%)}}\n        @keyframes fallIn{from{opacity:0;transform:translateY(-18px)}to{opacity:1;transform:translateY(0)}}\n        *{box-sizing:border-box;-webkit-font-smoothing:antialiased}\n        body{margin:0;background:#000;overflow:hidden}\n        textarea::placeholder{color:rgba(255,255,255,0.15)}\n        textarea{caret-color:#6BB8FF}\n        button:active{transform:scale(0.97)}\n        ::-webkit-scrollbar{width:3px}\n        ::-webkit-scrollbar-track{background:transparent}\n        ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}\n      `}</style>\n      <div style={{ position: \"fixed\", bottom: 4, right: 8, fontSize: 9, color: \"rgba(255,255,255,0.18)\", fontFamily: FB, zIndex: 9999, pointerEvents: \"none\" }}>v5.2</div>\n    </div>\n  );\n}\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(React.createElement(SAYCRDFlow));\n";
try {
  var compiled = Babel.transform(jsxCode, { presets: ['react'] }).code;
  var s = document.createElement('script');
  s.textContent = compiled;
  document.body.appendChild(s);
} catch(e) {
  document.getElementById('root').innerHTML = '<pre style="color:#ff6b6b;padding:20px;font-size:13px;white-space:pre-wrap">BABEL ERROR:\n' + e.message + '</pre>';
}
</script>
</body>
</html>