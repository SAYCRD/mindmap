<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SAYCRD</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body,#root{width:100%;height:100%;overflow:hidden;background:#000}</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script>
var jsxCode = "const { useState, useEffect, useRef, useCallback, useMemo } = React;\n\n// AI helpers\nvar _lastCallTime = 0;\nvar _CLAUDE_KEY = \"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\";\nasync function callClaude(sys, usr, max) {\n  try {\n    var now = Date.now(), gap = now - _lastCallTime;\n    if (gap < 800) await new Promise(function(r) { setTimeout(r, 800 - gap); });\n    _lastCallTime = Date.now();\n\n    var maxInput = 18000;\n    if ((sys.length + (usr||\"\").length) > maxInput) usr = (usr||\"\").slice(0, maxInput - sys.length);\n\n    var body = JSON.stringify({ model: \"claude-sonnet-4-20250514\", max_tokens: max || 1000,\n      messages: [{ role: \"user\", content: sys + \"\\n\\n---\\n\\nUser text:\\n\\n\" + (usr || \"\") }] });\n\n    console.log(\"[SAYCRD] API call:\", body.length, \"chars\");\n\n    // Try /api/claude proxy first, then direct with key\n    var r;\n    try {\n      r = await fetch(\"/api/claude\", { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: body });\n      if (!r.ok && r.status !== 429) throw new Error(\"proxy \" + r.status);\n    } catch (e) {\n      console.log(\"[SAYCRD] Proxy unavailable, using direct API\");\n      r = await fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-api-key\": _CLAUDE_KEY,\n          \"anthropic-version\": \"2023-06-01\",\n          \"anthropic-dangerous-direct-browser-access\": \"true\"\n        },\n        body: body\n      });\n    }\n\n    if (r.status === 429) {\n      console.log(\"[SAYCRD] Rate limited, retry in 3s\");\n      await new Promise(function(w) { setTimeout(w, 3000); });\n      r = await fetch(\"https://api.anthropic.com/v1/messages\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-api-key\": _CLAUDE_KEY,\n          \"anthropic-version\": \"2023-06-01\",\n          \"anthropic-dangerous-direct-browser-access\": \"true\"\n        },\n        body: body\n      });\n    }\n\n    if (!r.ok) {\n      var errText = await r.text().catch(function() { return \"\"; });\n      console.error(\"[SAYCRD] API error:\", r.status, errText.slice(0, 200));\n      return \"\";\n    }\n\n    var d = await r.json();\n    var result = (d.content || []).map(function(b) { return b.text || \"\"; }).join(\"\\n\");\n    console.log(\"[SAYCRD] Response:\", result.length, \"chars\");\n    return result;\n  } catch (e) { console.error(\"[SAYCRD] API error:\", e); return \"\"; }\n}\nfunction parseJSON(raw) {\n  if (!raw) return null;\n  try { var c = raw.replace(/```json|```/g, \"\").trim(); var m = c.match(/\\{[\\s\\S]*\\}/) || c.match(/\\[[\\s\\S]*\\]/); return m ? JSON.parse(m[0]) : null; } catch (e) { return null; }\n}\nvar NC = [\"#FF6B9D\",\"#FFB86B\",\"#6BFFB8\",\"#6BB8FF\",\"#B86BFF\",\"#FFD700\",\"#E84393\",\"#7DB7AE\"];\n\nconst FD = \"'DM Serif Display', Georgia, serif\";\nconst FB = \"'DM Sans', sans-serif\";\nconst PHASES = [\"pour\", \"synthesize\", \"map\", \"session\", \"field\"];\nconst GRADIENTS = {\n  pour: \"linear-gradient(160deg, #0A0A2E 0%, #1A1A4B 40%, #2D1B6B 100%)\",\n  synthesize: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, #E84393 100%)\",\n  map: \"linear-gradient(160deg, #060810 0%, #0B1020 40%, #111830 100%)\",\n  session: \"linear-gradient(160deg, #0A0A1E 0%, #1A1A3B 40%, #2D1B5B 100%)\",\n  field: \"#000\",\n};\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 SHARED COMPONENTS \u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nfunction FloatingWords({ words, color = \"#6BB8FF\" }) {\n  const v = [...new Set(words.filter(w => w.length > 4))].slice(-12);\n  if (!v.length) return null;\n  return <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\", zIndex: 0 }}>\n    {v.map((w, i) => <span key={`${w}-${i}`} style={{ position: \"absolute\", left: `${10+(i/Math.max(v.length-1,1))*80}%`, top: `${45+(Math.sin(i*0.8)*15+(i%3)*10)}%`, fontSize: 13+(i%3)*2, color, opacity: 0.04+(i/v.length)*0.08, fontFamily: FD, fontStyle: \"italic\", animation: `floatWord ${18+(i%4)*3}s ease-in-out infinite`, animationDelay: `${-i*1.5}s`, whiteSpace: \"nowrap\" }}>{w}</span>)}\n  </div>;\n}\n\nfunction Particles({ color, count = 20 }) {\n  return <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\" }}>\n    {Array.from({length:count}).map((_,i) => { const s=(i*37+13)%100; return <div key={i} style={{ position: \"absolute\", left: `${s}%`, top: `${(s*53)%100}%`, width: 2+(s%4), height: 2+(s%4), borderRadius: \"50%\", background: color, opacity: 0.12+(s%20)*0.015, animation: `floatParticle ${5+s%6}s ease-in-out infinite`, animationDelay: `${-(s%5)}s` }}/>; })}\n  </div>;\n}\n\nfunction FieldParticles({ color, count = 20 }) {\n  const particles = useMemo(() =>\n    Array.from({ length: count }).map(() => ({\n      left: Math.random() * 100,\n      top: Math.random() * 100,\n      size: 2 + Math.random() * 3,\n      opacity: 0.15 + Math.random() * 0.25,\n      dur: 4 + Math.random() * 6,\n      delay: Math.random() * 5,\n    })), [count]);\n  return (\n    <div style={{ position: \"absolute\", inset: 0, overflow: \"hidden\", pointerEvents: \"none\" }}>\n      {particles.map((p, i) => (\n        <div key={i} style={{\n          position: \"absolute\", left: `${p.left}%`, top: `${p.top}%`,\n          width: p.size, height: p.size, borderRadius: \"50%\",\n          background: color, opacity: p.opacity,\n          animation: `fieldFloat ${p.dur}s ease-in-out infinite`,\n          animationDelay: `${p.delay}s`,\n        }} />\n      ))}\n    </div>\n  );\n}\n\nfunction BreathingOrb({ color, size = 80 }) {\n  return <svg viewBox=\"0 0 160 160\" style={{ width: size, height: size }}>\n    {[50,40,30,20].map((r,i) => <circle key={i} cx=\"80\" cy=\"80\" r={r} fill=\"none\" stroke={color} strokeWidth={i===3?2:0.8} opacity={0.08+i*0.06}><animate attributeName=\"r\" values={`${r};${r+5};${r}`} dur={`${3+i*0.4}s`} repeatCount=\"indefinite\"/></circle>)}\n    <circle cx=\"80\" cy=\"80\" r=\"6\" fill={color} opacity=\"0.7\"><animate attributeName=\"r\" values=\"6;8;6\" dur=\"2.5s\" repeatCount=\"indefinite\"/></circle>\n  </svg>;\n}\n\nfunction PhaseIndicator({ current, phases }) {\n  return <div style={{ display: \"flex\", gap: 3, padding: \"14px 20px 0\", position: \"absolute\", top: 0, left: 0, right: 0, zIndex: 20 }}>\n    {phases.map((p, i) => <div key={p} style={{ flex: 1, height: 3, borderRadius: 2, background: i<current?\"rgba(255,255,255,0.6)\":i===current?\"rgba(255,255,255,0.85)\":\"rgba(255,255,255,0.1)\" }}/>)}\n  </div>;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 1: POUR \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction PourPhase({ onComplete }) {\n  const [text, setText] = useState(\"\");\n  const [words, setWords] = useState([]);\n  const [focused, setFocused] = useState(false);\n  useEffect(() => { setWords(text.split(/\\s+/).filter(x => x.length > 3)); }, [text]);\n  const wc = text.split(/\\s+/).filter(Boolean).length;\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\", padding: \"80px 24px 40px\", overflow: \"hidden\" }}>\n      <FloatingWords words={words} color=\"#6BB8FF\"/><Particles color=\"#6BB8FF\" count={15}/>\n      <div style={{ fontSize: 11, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#6BB8FF\", marginBottom: 16, fontFamily: FB, zIndex: 1 }}>POUR</div>\n      <h1 style={{ fontSize: 36, fontFamily: FD, fontStyle: \"italic\", color: \"white\", margin: \"0 0 8px\", textAlign: \"center\", zIndex: 1, fontWeight: 400, lineHeight: 1.15 }}>What's alive<br/>in you right now?</h1>\n      <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.35)\", fontFamily: FB, margin: \"0 0 32px\", textAlign: \"center\", zIndex: 1 }}>Don't think. Just pour.</p>\n      <div style={{ width: \"100%\", maxWidth: 380, flex: 1, zIndex: 1, borderRadius: 16, background: focused?\"rgba(107,184,255,0.06)\":\"rgba(255,255,255,0.03)\", border: `1px solid ${focused?\"rgba(107,184,255,0.2)\":\"rgba(255,255,255,0.06)\"}`, transition: \"all 0.4s\", padding: 2 }}>\n        <textarea value={text} onChange={e=>setText(e.target.value)} onFocus={()=>setFocused(true)} onBlur={()=>setFocused(false)} placeholder=\"Start writing...\" style={{ width: \"100%\", height: \"100%\", background: \"transparent\", border: \"none\", outline: \"none\", resize: \"none\", color: \"rgba(255,255,255,0.85)\", fontSize: 17, fontFamily: FD, fontStyle: \"italic\", padding: 20, lineHeight: 1.7 }}/>\n      </div>\n      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", width: \"100%\", maxWidth: 380, marginTop: 16, zIndex: 1 }}>\n        <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.25)\", fontFamily: FB }}>{wc} words{wc>0&&wc<20&&<span style={{color:\"rgba(107,184,255,0.4)\"}}> \u00b7 keep going</span>}</div>\n        {wc>=20&&<button onClick={() => onComplete(text)} style={{ background: \"linear-gradient(135deg, #6BB8FF, #3D8BFF)\", border: \"none\", borderRadius: 24, padding: \"10px 28px\", color: \"white\", fontSize: 14, fontFamily: FB, fontWeight: 500, cursor: \"pointer\", animation: \"riseUp 0.4s ease\" }}>Synthesize \u2192</button>}\n      </div>\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 2: SYNTHESIZE \u2014 calls AI, auto-advances \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction SynthesizePhase({ rawText, onComplete, onSynthesis }) {\n  const [step, setStep] = useState(0);\n  const [err, setErr] = useState(null);\n  const ran = useRef(false);\n  useEffect(() => {\n    if (ran.current) return; ran.current = true;\n    var t1 = setTimeout(function() { setStep(1); }, 800);\n\n    /* \u2500\u2500 Build temporal context from previous sessions \u2500\u2500 */\n    var prevSessions = [];\n    try { prevSessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\"); } catch(e) {}\n    var temporalContext = \"\";\n    if (prevSessions.length > 0) {\n      var now = Date.now();\n      temporalContext = \"\\n\\nPREVIOUS SESSIONS (for temporal awareness):\\n\";\n      prevSessions.slice(-6).forEach(function(s) {\n        var d = new Date(s.date);\n        var daysAgo = Math.round((now - d.getTime()) / 86400000);\n        var when = daysAgo === 0 ? \"today\" : daysAgo === 1 ? \"yesterday\" : daysAgo < 7 ? daysAgo + \" days ago\" : daysAgo < 30 ? Math.round(daysAgo / 7) + \" weeks ago\" : Math.round(daysAgo / 30) + \" months ago\";\n        var themes = (s.themes || []).map(function(t) { return t.label; }).join(\", \");\n        temporalContext += \"- \" + when + \": \" + (themes || \"no themes\") + (s.synthesis ? \" \u2014 \" + s.synthesis : \"\") + \"\\n\";\n      });\n    }\n\n    var prompt = \"You are the AI engine behind SAYCRD, a reflective clarity tool. The user has written a stream-of-consciousness dump. Do ALL of the following:\\n\\n\" +\n      \"TEMPORAL AWARENESS \u2014 CRITICAL:\\n\" +\n      \"- Below you may see previous sessions with timestamps. RESPECT THE TIME GAPS.\\n\" +\n      \"- Something from 3 weeks ago is NOT the same as something from today. Do not collapse time.\\n\" +\n      \"- If a theme appeared weeks/months ago but NOT in the current session, it is HISTORICAL \u2014 do not treat it as currently active.\\n\" +\n      \"- Only reference old themes if the current session ALSO touches them, and note the time distance: 'something that was present weeks ago is surfacing again' NOT 'you are dealing with X' as if it just happened.\\n\" +\n      \"- The current dump is the PRIMARY source. Previous sessions are CONTEXT, not content.\\n\\n\" +\n      \"1. THEMES: Extract 3-7 core themes. Labels should CAPTURE THE ESSENCE in 1-3 words max (e.g. 'control', 'proving myself', 'the weight'). Do NOT quote them verbatim \u2014 distill. Weight 1-5.\\n\" +\n      \"2. CONNECTIONS: 3-5 connections between themes. Every theme connects to at least one other. Each has a 1-word label and one-sentence insight naming the deeper pattern.\\n\" +\n      \"3. SYNTHESIS: 1-2 sentences naming something they might not see. Not a summary \u2014 an INSIGHT.\\n\" +\n      \"4. GUIDE: 3-5 items. Types: act, notice, deepen, release. Max 15 words each. Psychologically activating.\\n\" +\n      \"5. MAP_TITLE: Poetic name, 3-8 words.\\n\" +\n      \"6. NOTICING: One structural observation. Spare, clinical. Observe structure not meaning.\\n\" +\n      \"7. UNDERNEATH: Array of 2-3 strings about what lives below the surface.\\n\" +\n      \"8. TENSION: Primary tension \u2014 {\\\"a\\\":\\\"force1\\\",\\\"b\\\":\\\"force2\\\",\\\"text\\\":\\\"1 sentence\\\"}.\\n\" +\n      \"9. OPENING: 1-2 sentences about what is trying to emerge.\\n\" +\n      \"10. DESCENT_CARDS: Array of 6 cards. Types: energy {\\\"type\\\":\\\"energy\\\",\\\"phrase\\\":\\\"4-8 words\\\"}, binary {\\\"type\\\":\\\"binary\\\",\\\"option_a\\\":\\\"3-6 words\\\",\\\"option_b\\\":\\\"3-6 words\\\",\\\"prompt\\\":\\\"under 8 words\\\"}, spectrum {\\\"type\\\":\\\"spectrum\\\",\\\"prompt\\\":\\\"under 8 words\\\",\\\"pole_a\\\":\\\"2-4 words\\\",\\\"pole_b\\\":\\\"2-4 words\\\"}. Mix 2+ energy, 2 binary, 1-2 spectrum.\\n\" +\n      \"11. ARCHETYPES: Pick 1-2 archetypes that FIT THIS SESSION from: chrysalis (transformation/dissolving/becoming), tower (structures falling/collapse), kintsugi (broken and repaired with gold), dark_night (ego dissolving/meaning lost), persephone (descent/underworld/return), phoenix (burning/ash/rising), hermit (solitude/lamp in dark), sisyphus (repetition/weight/meaning in push), magician (transmutation/wielding forces), lover (opening/vulnerability/courage), star (hope after collapse/light), threshold (doorway/between), weaver (threads connecting across time). For each: key, phase, title (3-6 words), line (1 sentence), reading (1-2 sentences weaving archetype into THEIR story).\\n\" +\n      \"PHASES: chrysalis: consuming|dissolving|clustering|emergence. tower: trembling|falling|rubble|clearing. kintsugi: breaking|holding|filling|whole. dark_night: trigger|crisis|transformation|emergence. persephone: descending|underworld|pomegranate|returning. phoenix: burning|ash|stirring|rising. hermit: withdrawing|listening|seeing|returning. sisyphus: pushing|rolling_back|pausing|meaning. magician: awakening|practicing|transforming|mastery. lover: guarding|opening|feeling|merging. star: darkness|glimmer|pouring|shining. threshold: approaching|standing|crossing|arrived. weaver: gathering|seeing|weaving|wearing.\\n\\n\" +\n      \"12. ARRIVAL: One evocative line (max 10 words) capturing core energy. Plus energy word: heavy|electric|shattered|still|quiet|warm|grounded|restless|tender|fierce.\\n\" +\n      \"13. ALCHEMY: Which stage? nigredo (decomposition/darkness), albedo (purification/clarity), citrinitas (integration/dawn), rubedo (wholeness/embodiment). Plus 1 sentence evidence.\\n\" +\n      \"14. BLIND_SPOT: What they cannot see from inside. 1-2 sentences. Outside perspective, not criticism.\\n\\n\" +\n      \"BANNED WORDS: navigating, intentional, sacred, container, grounding, healing, inner work, your journey.\\n\" +\n      \"CRITICAL: the FROM and TO fields in connections must EXACTLY match a theme label.\\n\" +\n      'Respond with ONLY valid JSON, no markdown:\\n{\"themes\":[{\"label\":\"...\",\"weight\":1}],\"connections\":[{\"from\":\"exact label\",\"to\":\"exact label\",\"label\":\"...\",\"insight\":\"...\"}],\"synthesis\":\"...\",\"guide\":[{\"type\":\"act\",\"text\":\"...\"}],\"map_title\":\"...\",\"noticing\":\"...\",\"underneath\":[\"...\",\"...\"],\"tension\":{\"a\":\"...\",\"b\":\"...\",\"text\":\"...\"},\"opening\":\"...\",\"descent_cards\":[],\"archetypes\":[{\"key\":\"chrysalis\",\"phase\":\"dissolving\",\"title\":\"...\",\"line\":\"...\",\"reading\":\"...\"}],\"arrival\":{\"line\":\"...\",\"energy\":\"warm\"},\"alchemy\":{\"stage\":\"nigredo\",\"evidence\":\"...\"},\"blind_spot\":\"...\"}';\n    console.log(\"[SAYCRD] Synthesizing dump:\", (rawText||\"\").slice(0,80) + \"...\");\n    (async function() {\n      try {\n        var raw = await callClaude(prompt, (rawText || \"\") + temporalContext, 3500);\n        console.log(\"[SAYCRD] AI raw response:\", (raw||\"\").slice(0, 200));\n        setStep(2);\n        var data = parseJSON(raw);\n        console.log(\"[SAYCRD] Parsed data:\", data ? \"OK - \" + (data.themes||[]).length + \" themes, \" + (data.archetypes||[]).length + \" archetypes\" : \"FAILED\");\n        if (data && data.themes && data.themes.length > 0) {\n          data.themes = data.themes.map(function(t, i) { return Object.assign({}, t, { color: NC[i % NC.length] }); });\n          if (data.connections) data.connections = data.connections.map(function(c) {\n            var ft = (data.themes || []).find(function(t) { return t.label === c.from; });\n            return Object.assign({}, c, { color: ft ? ft.color : NC[0] });\n          });\n          onSynthesis(data);\n          setTimeout(onComplete, 1200);\n        } else { throw new Error(\"No themes parsed from AI response\"); }\n      } catch (e) {\n        console.error(\"[SAYCRD] Synthesis error:\", e);\n        setErr(e.message || \"API error\");\n        setStep(2);\n        onSynthesis(null);\n        setTimeout(onComplete, 2500);\n      }\n    })();\n    return function() { clearTimeout(t1); };\n  }, []);\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\", overflow: \"hidden\" }}>\n      <Particles color=\"#E84393\" count={25}/>\n      <div style={{ flex: 1, display: \"flex\", alignItems: \"center\", justifyContent: \"center\", zIndex: 1 }}>\n        <div style={{ textAlign: \"center\" }}>\n          <BreathingOrb color=\"#E84393\" size={100}/>\n          <div style={{ marginTop: 28, fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"white\", animation: \"pulse 2s ease infinite\" }}>\n            {step===0&&\"Reading your words...\"}\n            {step===1&&\"Finding what's underneath...\"}\n            {step===2&&(err?\"Using demo map\u2026\":\"Building your map...\")}\n          </div>\n          <div style={{ marginTop: 16, fontSize: 13, color: err?\"rgba(255,107,107,0.5)\":\"rgba(255,255,255,0.25)\", fontFamily: FB }}>\n            {err ? err.slice(0,60) : step < 2 ? \"analyzing patterns\u2026\" : \"themes found\"}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 INSIGHT DRAWER \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction InsightDrawer({ connection, position, onClose, onRespond }) {\n  const [response, setResponse] = useState(null);\n  const [correction, setCorrection] = useState(\"\");\n  const [showCorr, setShowCorr] = useState(false);\n  const [done, setDone] = useState(false);\n  const ref = useRef(null);\n  const [dragOff, setDragOff] = useState(null);\n  const [dragPos, setDragPos] = useState(null);\n  const handlePD = (e) => { if(e.target.tagName===\"BUTTON\"||e.target.tagName===\"TEXTAREA\")return; const r=ref.current?.getBoundingClientRect(); if(!r)return; setDragOff({x:e.clientX-r.left,y:e.clientY-r.top}); };\n  useEffect(() => { if(!dragOff)return; const m=e=>setDragPos({x:e.clientX-dragOff.x,y:e.clientY-dragOff.y}); const u=()=>setDragOff(null); window.addEventListener(\"pointermove\",m); window.addEventListener(\"pointerup\",u); return()=>{window.removeEventListener(\"pointermove\",m);window.removeEventListener(\"pointerup\",u);}; }, [dragOff]);\n  const handleChoice = (v) => { setResponse(v); if(v===\"no\"||v===\"partly\"){setShowCorr(true);}else{onRespond(v,null);setDone(true);setTimeout(()=>onClose(),2200);} };\n  const submit = () => { if(correction.trim()){onRespond(response,correction.trim());setDone(true);setTimeout(()=>onClose(),2200);} };\n  const accent = connection.color || \"#6BB8FF\";\n  const s = dragPos ? { left: dragPos.x, top: dragPos.y, transform: \"none\" }\n    : { left: \"50%\", top: Math.max(10, Math.min(position.y - 60, 240)), transform: \"translate(-50%, 0)\" };\n  return (\n    <div ref={ref} onPointerDown={handlePD} onClick={e=>e.stopPropagation()} style={{\n      position: \"absolute\", ...s, width: 320, maxWidth: \"94%\",\n      background: `linear-gradient(160deg, rgba(10,12,20,0.98), rgba(20,15,35,0.96))`,\n      border: `1.5px solid ${accent}55`, borderRadius: 18, backdropFilter: \"blur(20px)\",\n      zIndex: 30, cursor: dragOff?\"grabbing\":\"grab\",\n      animation: \"drawerIn 0.4s cubic-bezier(.25,.46,.45,.94) forwards\",\n      touchAction: \"none\", boxShadow: `0 0 50px ${accent}20, 0 20px 60px rgba(0,0,0,0.6)`,\n    }}>\n      <div style={{ position: \"absolute\", top: 0, left: \"15%\", right: \"15%\", height: 2, background: `linear-gradient(90deg, transparent, ${accent}88, transparent)`, borderRadius: 1 }}/>\n      <button onClick={e=>{e.stopPropagation();onClose();}} style={{ position: \"absolute\", top: 12, right: 14, width: 26, height: 26, borderRadius: \"50%\", border: \"none\", background: \"rgba(255,255,255,0.06)\", color: \"rgba(255,255,255,0.4)\", fontSize: 12, cursor: \"pointer\", display: \"grid\", placeItems: \"center\" }}>\u2715</button>\n      <div style={{ padding: \"22px 22px 18px\" }}>\n        <div style={{ fontSize: 10, letterSpacing: \"0.2em\", color: `${accent}99`, fontFamily: FB, textTransform: \"uppercase\", marginBottom: 10, fontWeight: 600 }}>{connection.nodeA} \u2194 {connection.nodeB}</div>\n        <div style={{ fontSize: 18, color: \"rgba(255,255,255,0.9)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.55, marginBottom: 18 }}>{connection.insight}</div>\n        {!done&&!showCorr&&<>\n          <div style={{ fontSize: 12, textTransform: \"uppercase\", letterSpacing: \"0.15em\", color: accent, fontFamily: FB, fontWeight: 600, marginBottom: 12 }}>Does this land?</div>\n          <div style={{ display: \"flex\", gap: 8 }}>\n            {[{icon:\"\u2726\",label:\"Yes\",value:\"yes\"},{icon:\"\u25c7\",label:\"Partly\",value:\"partly\"},{icon:\"\u2014\",label:\"Not quite\",value:\"no\"}].map(o=>(\n              <button key={o.value} onClick={e=>{e.stopPropagation();handleChoice(o.value);}} style={{ flex:1,padding:\"12px 8px\",borderRadius:12, border:`1px solid ${response===o.value?`${accent}66`:\"rgba(255,255,255,0.08)\"}`, background:response===o.value?`${accent}18`:\"rgba(255,255,255,0.03)\", color:response===o.value?accent:\"rgba(255,255,255,0.6)\", fontFamily:FB,fontSize:14,cursor:\"pointer\",transition:\"all 0.25s\",textAlign:\"center\" }}>\n                <span style={{display:\"block\",fontSize:16,marginBottom:3}}>{o.icon}</span>{o.label}\n              </button>))}\n          </div>\n        </>}\n        {showCorr&&!done&&<div style={{animation:\"riseUp 0.4s ease\"}}>\n          <div style={{fontSize:15,color:\"rgba(255,255,255,0.65)\",fontFamily:FB,marginBottom:10}}>{response===\"no\"?\"What's more accurate?\":\"What would make it closer?\"}</div>\n          <textarea value={correction} onChange={e=>setCorrection(e.target.value)} onKeyDown={e=>{if(e.key===\"Enter\"&&!e.shiftKey&&correction.trim()){e.preventDefault();submit();}}} placeholder=\"In your words\u2026\" rows={2} autoFocus style={{width:\"100%\",background:\"rgba(255,255,255,0.04)\",border:`1px solid ${accent}33`,borderRadius:10,color:\"rgba(255,255,255,0.8)\",padding:\"10px 14px\",fontFamily:FB,fontSize:14,resize:\"none\",outline:\"none\",lineHeight:1.5}}/>\n          <div style={{fontSize:12,color:\"rgba(255,255,255,0.2)\",fontFamily:FB,marginTop:6}}>Enter to save \u00b7 This sharpens future readings</div>\n        </div>}\n        {done&&<div style={{textAlign:\"center\",padding:\"8px 0\",fontSize:15,fontFamily:FB,color:accent,animation:\"riseUp 0.5s ease\"}}>{response===\"yes\"?\"Noted. The system is learning you.\":`Heard. \\u201C${correction.slice(0,60)}${correction.length>60?\"\\u2026\":\"\"}\\u201D \\u2014 saved.`}</div>}\n      </div>\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 3: MAP \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction MapPhase({ onComplete, synthesisData, rawText }) {\n  const [activeConn, setActiveConn] = useState(null);\n  const [responses, setResponses] = useState({});\n  const [dragging, setDragging] = useState(null);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [discoveredConns, setDiscoveredConns] = useState([]);\n  const [snapTarget, setSnapTarget] = useState(null);\n  const SNAP_DIST = 130;\n\n  // Use AI data or demo fallback\n  const sd = synthesisData;\n  const nodes = useMemo(() => {\n    if (sd && sd.themes) return sd.themes.map(function(t, i) {\n      var label = t.label || \"\";\n      var display = label.length > 18 ? label.slice(0, 16).trim() + \"\\u2026\" : label;\n      return { key: t.label, display: display, color: t.color || NC[i % NC.length], w: Math.min(t.weight / 5, 1) };\n    });\n    return [\n      { key: \"SAYCRD\", color: \"#FF6B9D\", w: 0.94 }, { key: \"Money\", color: \"#FFB86B\", w: 0.78 },\n      { key: \"Making\", color: \"#6BFFB8\", w: 0.72 }, { key: \"Trust\", color: \"#6BB8FF\", w: 0.52 },\n      { key: \"Control\", color: \"#B86BFF\", w: 0.65 }, { key: \"Proof\", color: \"#FFD700\", w: 0.45 },\n    ];\n  }, [sd]);\n\n  const conns = useMemo(() => {\n    if (sd && sd.connections) return sd.connections.map(function(c) { return { from: c.from, to: c.to, label: (c.label || \"linked\").toUpperCase(), insight: c.insight || \"\", color: c.color || NC[0] }; });\n    return [\n      { from: \"SAYCRD\", to: \"Money\", label: \"SURVIVAL \u2194 CREATION\", insight: \"SAYCRD is your attempt to solve the money question through creation.\", color: \"#FF6B9D\" },\n      { from: \"SAYCRD\", to: \"Making\", label: \"THE SAME FORCE\", insight: \"Building SAYCRD IS the making \u2014 they're not two things.\", color: \"#6BFFB8\" },\n      { from: \"SAYCRD\", to: \"Proof\", label: \"LEGITIMACY\", insight: \"You need SAYCRD to work as proof that you can do this.\", color: \"#FFD700\" },\n      { from: \"Money\", to: \"Proof\", label: \"THE PROXY\", insight: \"Money is the proof you're looking for. Or is proof the real money?\", color: \"#FFB86B\" },\n      { from: \"Making\", to: \"Control\", label: \"THE GRIP\", insight: \"Your need to control the making might be limiting what gets made.\", color: \"#B86BFF\" },\n      { from: \"Trust\", to: \"Control\", label: \"CORE TENSION\", insight: \"Trust and control are in direct tension \u2014 one grows as the other shrinks.\", color: \"#6BB8FF\" },\n      { from: \"Money\", to: \"Trust\", label: \"THE LEAP\", insight: \"Can you trust that the money will follow?\", color: \"#6BB8FF\" },\n    ];\n  }, [sd]);\n\n  // Auto-layout positions \u2014 fills available space\n  const [pos, setPos] = useState({});\n  const [fieldSize, setFieldSize] = useState({ w: 380, h: 520 });\n  const fieldRef = useRef(null);\n  const NR = 50;\n\n  // Measure field container\n  useEffect(() => {\n    if (!fieldRef.current) return;\n    const r = fieldRef.current.getBoundingClientRect();\n    if (r.width > 0 && r.height > 0) setFieldSize({ w: r.width, h: r.height });\n  }, []);\n\n  useEffect(() => {\n    if (nodes.length === 0) return;\n    var n = nodes.length;\n    var cx = fieldSize.w / 2;\n    var cy = fieldSize.h / 2;\n    var rx = (fieldSize.w / 2) - NR - 8;\n    var ry = (fieldSize.h / 2) - NR - 8;\n\n    // Build edge list as index pairs\n    var edges = [];\n    var allConns = (sd && sd.connections) ? sd.connections : [];\n    allConns.forEach(function(c) {\n      var ai = -1, bi = -1;\n      nodes.forEach(function(nd, i) { if (nd.key === c.from) ai = i; if (nd.key === c.to) bi = i; });\n      if (ai >= 0 && bi >= 0 && ai !== bi) edges.push([ai, bi]);\n    });\n\n    // Count crossings for a given ordering of node indices around the circle\n    function countCrossings(order) {\n      var cross = 0;\n      for (var i = 0; i < edges.length; i++) {\n        for (var j = i + 1; j < edges.length; j++) {\n          var a = order.indexOf(edges[i][0]), b = order.indexOf(edges[i][1]);\n          var c2 = order.indexOf(edges[j][0]), d = order.indexOf(edges[j][1]);\n          if (a > b) { var t = a; a = b; b = t; }\n          if (c2 > d) { var t2 = c2; c2 = d; d = t2; }\n          // Edges cross if one endpoint of each is between the other's endpoints\n          if (a < c2 && c2 < b && b < d) cross++;\n          if (c2 < a && a < d && d < b) cross++;\n        }\n      }\n      return cross;\n    }\n\n    // For <=7 nodes, try permutations (fix first node, permute rest)\n    var bestOrder = nodes.map(function(_, i) { return i; });\n    var bestCross = countCrossings(bestOrder);\n\n    if (n <= 8 && edges.length > 0) {\n      var rest = [];\n      for (var i = 1; i < n; i++) rest.push(i);\n\n      // Generate permutations of rest (max 720 for 7 nodes)\n      function permute(arr, l, r) {\n        if (l === r) {\n          var order = [0].concat(arr);\n          var c = countCrossings(order);\n          if (c < bestCross) { bestCross = c; bestOrder = order.slice(); }\n          return;\n        }\n        for (var i = l; i <= r; i++) {\n          var t = arr[l]; arr[l] = arr[i]; arr[i] = t;\n          permute(arr, l + 1, r);\n          var t2 = arr[l]; arr[l] = arr[i]; arr[i] = t2;\n        }\n      }\n      if (rest.length <= 6) {\n        permute(rest, 0, rest.length - 1);\n      } else {\n        // >7 nodes: greedy BFS placement\n        var adj = {};\n        nodes.forEach(function(_, i) { adj[i] = []; });\n        edges.forEach(function(e) { adj[e[0]].push(e[1]); adj[e[1]].push(e[0]); });\n        var placed = [0];\n        var visited = {}; visited[0] = true;\n        var queue = adj[0].slice();\n        while (placed.length < n) {\n          var next = -1;\n          for (var qi = 0; qi < queue.length; qi++) {\n            if (!visited[queue[qi]]) { next = queue[qi]; break; }\n          }\n          if (next === -1) {\n            for (var fi = 0; fi < n; fi++) { if (!visited[fi]) { next = fi; break; } }\n          }\n          if (next === -1) break;\n          placed.push(next);\n          visited[next] = true;\n          (adj[next] || []).forEach(function(nb) { if (!visited[nb]) queue.push(nb); });\n        }\n        bestOrder = placed;\n      }\n    }\n\n    var positions = {};\n    bestOrder.forEach(function(ni, i) {\n      var nd = nodes[ni];\n      var angle = (i / n) * Math.PI * 2 - Math.PI / 2;\n      var ws = 0.78 + (1 - nd.w) * 0.22;\n      positions[nd.key] = { x: cx + Math.cos(angle) * rx * ws - 50, y: cy + Math.sin(angle) * ry * ws - 18 };\n    });\n    setPos(positions);\n  }, [nodes, fieldSize]);\n\n  const hasConn = (a, b) => conns.some(c => (c.from===a&&c.to===b)||(c.from===b&&c.to===a));\n  const hasDiscovered = (a, b) => discoveredConns.some(c => (c.from===a&&c.to===b)||(c.from===b&&c.to===a));\n  const anyConn = (a, b) => hasConn(a, b) || hasDiscovered(a, b);\n  const getDiscovered = (a, b) => discoveredConns.find(c => (c.from===a&&c.to===b)||(c.from===b&&c.to===a));\n\n  // AI connection insight generation\n  const makeConn = async (a, b) => {\n    var nodeB = nodes.find(function(n) { return n.key === b; });\n    var col = nodeB ? nodeB.color : \"#7DB7AE\";\n    var temp = { from: a, to: b, label: \"READING\u2026\", insight: \"\u2026\", color: col, discovered: true };\n    setDiscoveredConns(function(prev) { return prev.concat([temp]); });\n    setActiveConn(temp);\n    var ctx = rawText ? \"\\nContext: \" + rawText.slice(0, 400) : \"\";\n    var p = \"The user connected two themes on their map: \\\"\" + a + \"\\\" and \\\"\" + b + \"\\\".\" + ctx + \"\\nGenerate a 2-4 word label and 1-2 sentence insight. JSON only: {\\\"label\\\":\\\"...\\\",\\\"insight\\\":\\\"...\\\"}\";\n    try {\n      var raw = await callClaude(p, \"Themes: \" + a + \" + \" + b, 300);\n      var d = parseJSON(raw);\n      if (d && d.label) {\n        var real = { from: a, to: b, label: d.label.toUpperCase(), insight: d.insight || \"\", color: col, discovered: true };\n        setDiscoveredConns(function(prev) { return prev.map(function(c) { return (c.from===a && c.to===b) ? real : c; }); });\n        setActiveConn(real);\n        return;\n      }\n    } catch (e) {}\n    // Fallback\n    var fb = { from: a, to: b, label: \"LINKED\", insight: a + \" and \" + b + \" \u2014 you see a relationship here. What does one reveal about the other?\", color: col, discovered: true };\n    setDiscoveredConns(function(prev) { return prev.map(function(c) { return (c.from===a && c.to===b) ? fb : c; }); });\n    setActiveConn(fb);\n  };\n\n  const handleNodeTap = (key) => {\n    if (dragging) return;\n    if (!selectedNode) { setSelectedNode(key); return; }\n    if (selectedNode === key) { setSelectedNode(null); return; }\n    const a = selectedNode, b = key;\n    if (hasConn(a, b)) {\n      const c = conns.find(c => (c.from===a&&c.to===b)||(c.from===b&&c.to===a));\n      if (c) setActiveConn(c);\n      setSelectedNode(null);\n      return;\n    }\n    if (!anyConn(a, b)) makeConn(a, b);\n    setSelectedNode(null);\n  };\n  const ctr = (key) => { const p=pos[key]; return p ? { x: p.x+50, y: p.y+18 } : {x:0,y:0}; };\n  const mid = (c) => { const a=ctr(c.from),b=ctr(c.to); return {x:(a.x+b.x)/2,y:(a.y+b.y)/2}; };\n  const edgePt = (from, to) => { const a=ctr(from),b=ctr(to); const dx=b.x-a.x, dy=b.y-a.y, d=Math.hypot(dx,dy)||1; const r=40; return { x1: a.x+(dx/d)*r, y1: a.y+(dy/d)*r, x2: b.x-(dx/d)*r, y2: b.y-(dy/d)*r }; };\n  const allConns = [...conns, ...discoveredConns];\n  const K = (c) => `${c.from}::${c.to}`;\n  const explored = Object.keys(responses).length + discoveredConns.length;\n  const didDrag = useRef(false);\n  const snapRef = useRef(null); // track snap target in the effect closure\n  const startDrag = (key, e) => { e.stopPropagation(); e.preventDefault(); didDrag.current = false; snapRef.current = null; const r=fieldRef.current?.getBoundingClientRect(); if(!r)return; const p=pos[key]; setDragging({key,ox:(e.clientX||e.touches?.[0]?.clientX)-r.left-p.x,oy:(e.clientY||e.touches?.[0]?.clientY)-r.top-p.y}); };\n  useEffect(() => {\n    if(!dragging) return;\n    const m = e => {\n      didDrag.current = true;\n      const r = fieldRef.current?.getBoundingClientRect(); if(!r) return;\n      const cx = (e.clientX||e.touches?.[0]?.clientX) - r.left - dragging.ox;\n      const cy = (e.clientY||e.touches?.[0]?.clientY) - r.top - dragging.oy;\n      const newX = Math.max(0, Math.min(cx, r.width - 120));\n      const newY = Math.max(0, Math.min(cy, r.height - 40));\n      setPos(p => ({...p, [dragging.key]: {x: newX, y: newY}}));\n      // Snap detection \u2014 find closest unlinked node within range\n      const dragCtr = { x: newX + 50, y: newY + 18 };\n      let closest = null, closeDist = Infinity;\n      nodes.forEach(n => {\n        if (n.key === dragging.key) return;\n        const np = pos[n.key]; if(!np) return;\n        const nc = { x: np.x + 50, y: np.y + 18 };\n        const dist = Math.hypot(nc.x - dragCtr.x, nc.y - dragCtr.y);\n        if (dist < SNAP_DIST && dist < closeDist && !anyConn(dragging.key, n.key)) {\n          closeDist = dist; closest = n.key;\n        }\n      });\n      snapRef.current = closest;\n      setSnapTarget(closest);\n    };\n    const u = () => {\n      if (!didDrag.current) {\n        handleNodeTap(dragging.key);\n      } else if (snapRef.current) {\n        // Snap-to-connect: AI-generated insight\n        const a = dragging.key, b = snapRef.current;\n        if (!anyConn(a, b)) makeConn(a, b);\n      }\n      setDragging(null);\n      setSnapTarget(null);\n      snapRef.current = null;\n    };\n    window.addEventListener(\"pointermove\", m);\n    window.addEventListener(\"pointerup\", u);\n    return () => { window.removeEventListener(\"pointermove\", m); window.removeEventListener(\"pointerup\", u); };\n  }, [dragging, selectedNode]);\n\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", display: \"flex\", flexDirection: \"column\", padding: \"28px 0 6px\", overflow: \"hidden\" }}>\n      <Particles color=\"rgba(107,184,255,0.25)\" count={6}/>\n      <div style={{ textAlign: \"center\", zIndex: 2, marginBottom: 0, flexShrink: 0, padding: \"0 8px\" }}>\n        <div style={{ fontSize: 9, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#6BB8FF\", fontFamily: FB }}>{sd && sd.map_title ? sd.map_title.toUpperCase() : \"YOUR CONSTELLATION\"}</div>\n        <p style={{ fontSize: 10, color: snapTarget?\"#7DB7AE\":selectedNode?\"#6BFFB8\":explored===0?\"rgba(107,184,255,0.8)\":\"rgba(255,255,255,0.35)\", fontFamily: FB, margin: \"1px 0 0\", fontWeight: snapTarget||selectedNode||explored===0?600:400, transition: \"color 0.3s\" }}>\n          {snapTarget ? `Release to connect \u2192 ${snapTarget}` : selectedNode ? `${selectedNode} selected \u2014 tap another node to link` : explored===0 ? \"Tap a connection \u00b7 drag nodes together to link\" : `${explored} connections explored`}\n        </p>\n      </div>\n      <div ref={fieldRef} onClick={()=>{setActiveConn(null);setSelectedNode(null);}} style={{ flex: 1, position: \"relative\", zIndex: 1, minHeight: 0 }}>\n        {Object.keys(pos).length > 0 && <><svg style={{ position: \"absolute\", inset: 0, width: \"100%\", height: \"100%\", zIndex: 0 }}>\n          {/* Predefined connection lines */}\n          {conns.map(c => {\n            const k=K(c), resp=responses[k], ep=edgePt(c.from,c.to);\n            const isAct = activeConn && K(activeConn)===k;\n            let stroke=\"rgba(255,255,255,0.18)\", sw=2, dash=\"8 5\", op=1;\n            if(resp?.value===\"yes\"){stroke=\"rgba(107,211,198,0.7)\";sw=3;dash=\"none\";}\n            else if(resp?.value===\"partly\"){stroke=\"rgba(165,235,220,0.5)\";sw=2.5;dash=\"none\";}\n            else if(resp?.value===\"no\"){stroke=\"rgba(255,255,255,0.04)\";sw=0.5;dash=\"4 6\";op=0.2;}\n            if(isAct){stroke=`${c.color}88`;sw=3;dash=\"none\";}\n            return <line key={k} x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2} stroke={stroke} strokeWidth={sw} strokeDasharray={dash} opacity={op} style={{transition:\"all 0.6s ease\"}}/>;\n          })}\n          {/* Discovered connection lines */}\n          {discoveredConns.map(c => {\n            const k=K(c), resp=responses[k], ep=edgePt(c.from,c.to);\n            const isAct = activeConn && K(activeConn)===k;\n            return <line key={`d-${k}`} x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2}\n              stroke={isAct ? `${c.color}88` : `${c.color}55`} strokeWidth={isAct ? 3 : 2}\n              strokeDasharray={isAct ? \"none\" : \"4 8\"} opacity={0.8}\n              style={{transition:\"all 0.6s ease\", animation: \"riseUp 0.6s ease\"}}/>;\n          })}\n          {/* Selection preview line */}\n          {selectedNode && (() => {\n            const sc = ctr(selectedNode);\n            return <circle cx={sc.x} cy={sc.y} r={48} fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"1.5\" opacity=\"0.5\" strokeDasharray=\"4 4\">\n              <animate attributeName=\"r\" values=\"46;52;46\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n              <animate attributeName=\"opacity\" values=\"0.3;0.7;0.3\" dur=\"1.5s\" repeatCount=\"indefinite\" />\n            </circle>;\n          })()}\n          {/* Snap preview line */}\n          {snapTarget && dragging && (() => {\n            const ep = edgePt(dragging.key, snapTarget);\n            return <line x1={ep.x1} y1={ep.y1} x2={ep.x2} y2={ep.y2} stroke=\"#7DB7AE\" strokeWidth=\"2.5\" strokeDasharray=\"6 4\" opacity=\"0.7\" style={{animation:\"connBlink 1s ease-in-out infinite\"}}/>;\n          })()}\n        </svg>\n        {conns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          const isAct = activeConn && K(activeConn)===k;\n          if(resp?.value===\"no\") return null;\n          const isExp = !!resp; const accent = c.color;\n          return (\n            <div key={k} onClick={e=>{e.stopPropagation();setActiveConn(c);}} style={{\n              position: \"absolute\", left: m.x, top: m.y, transform: \"translate(-50%, -50%)\",\n              padding: \"4px 10px\", borderRadius: 6, fontSize: 9, fontWeight: 700, fontFamily: FB,\n              letterSpacing: \"0.06em\", textTransform: \"uppercase\",\n              color: isAct ? \"white\" : isExp ? `${accent}cc` : accent,\n              background: isAct ? `${accent}33` : `rgba(8,10,20,0.85)`,\n              border: `1.5px solid ${isAct ? accent : isExp ? `${accent}44` : `${accent}66`}`,\n              cursor: \"pointer\", whiteSpace: \"nowrap\", zIndex: isAct ? 15 : 5,\n              transition: \"all 0.3s ease\",\n              animation: !isExp ? \"connBlink 2s ease-in-out infinite\" : \"none\",\n              boxShadow: isAct ? `0 0 20px ${accent}33` : !isExp ? `0 0 12px ${accent}15` : \"none\",\n            }}>\n              {!isExp && <div style={{ position: \"absolute\", inset: -5, borderRadius: 10, border: `1px solid ${accent}44`, animation: \"ringPulse 2s ease-in-out infinite\", pointerEvents: \"none\" }}/>}\n              {c.label}\n            </div>\n          );\n        })}\n        {conns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          if(!resp?.correction) return null;\n          return <div key={`a-${k}`} style={{ position:\"absolute\",left:m.x,top:m.y+16,transform:\"translate(-50%,0)\",fontSize:10,fontFamily:FD,fontStyle:\"italic\",color:\"rgba(165,235,220,0.65)\",maxWidth:140,textAlign:\"center\",lineHeight:1.3,animation:\"riseUp 0.5s ease\" }}>\"{resp.correction.length>45?resp.correction.slice(0,43)+\"\u2026\":resp.correction}\"</div>;\n        })}\n        {/* Discovered connection labels */}\n        {discoveredConns.map(c => {\n          const m=mid(c), k=K(c), resp=responses[k];\n          const isAct = activeConn && K(activeConn)===k;\n          const isExp = !!resp;\n          return (\n            <div key={`dl-${k}`} onClick={e=>{e.stopPropagation();setActiveConn(c);}} style={{\n              position: \"absolute\", left: m.x, top: m.y, transform: \"translate(-50%, -50%)\",\n              padding: \"4px 10px\", borderRadius: 6, fontSize: 9, fontWeight: 700, fontFamily: FB,\n              letterSpacing: \"0.06em\", textTransform: \"uppercase\",\n              color: isAct ? \"white\" : `${c.color}`,\n              background: isAct ? `${c.color}33` : `rgba(8,10,20,0.85)`,\n              border: `1.5px solid ${isAct ? c.color : `${c.color}66`}`,\n              cursor: \"pointer\", whiteSpace: \"nowrap\", zIndex: isAct ? 15 : 5,\n              transition: \"all 0.3s ease\", animation: \"riseUp 0.5s ease\",\n              boxShadow: isAct ? `0 0 20px ${c.color}33` : `0 0 12px ${c.color}15`,\n            }}>\n              <div style={{ position: \"absolute\", left: -3, top: \"50%\", transform: \"translateY(-50%)\", width: 6, height: 6, borderRadius: \"50%\", background: c.color, opacity: 0.6 }}/>\n              \u2726 {c.label}\n            </div>\n          );\n        })}\n        {nodes.map((n, ni) => {\n          const p=pos[n.key]; if(!p) return null; const isDrag=dragging?.key===n.key;\n          const isSel = selectedNode === n.key;\n          const isSnap = snapTarget === n.key;\n          const canLink = selectedNode && selectedNode !== n.key && !hasConn(selectedNode, n.key) && !hasDiscovered(selectedNode, n.key);\n          return (\n            <div key={n.key} onPointerDown={e=>startDrag(n.key,e)} style={{\n              position: \"absolute\", left: p.x, top: p.y,\n              borderRadius: 999, display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n              fontSize: 12, fontWeight: 600, fontFamily: FB, color: \"white\",\n              textAlign: \"center\", lineHeight: 1.2,\n              padding: \"10px 18px\",\n              textTransform: \"uppercase\", letterSpacing: \"0.06em\",\n              whiteSpace: \"normal\", maxWidth: 110,\n              background: isSnap\n                ? \"rgba(125,183,174,0.15)\"\n                : n.w > 0.7 ? `rgba(214,178,109,0.18)` : \"rgba(244,241,234,0.08)\",\n              border: isSnap ? \"1.5px solid rgba(125,183,174,0.7)\"\n                : isSel ? \"1.5px solid #6BFFB8\"\n                : canLink ? `1.5px solid ${n.color}aa`\n                : n.w > 0.7 ? \"1.5px solid rgba(214,178,109,0.45)\"\n                : `1.5px solid rgba(244,241,234,0.22)`,\n              backdropFilter: \"blur(8px)\",\n              cursor: isDrag?\"grabbing\":\"pointer\", zIndex: isDrag?20: isSel||isSnap?10 :3,\n              transition: isDrag?\"none\":\"all 0.4s cubic-bezier(.25,.46,.45,.94)\",\n              transform: isDrag?\"scale(1.12)\": isSnap?\"scale(1.15)\": isSel?\"scale(1.08)\" :\"scale(1)\",\n              boxShadow: isSnap\n                ? \"0 0 20px rgba(125,183,174,0.4)\"\n                : isSel\n                ? \"0 0 20px rgba(107,255,184,0.25)\"\n                : `0 0 ${isDrag?25:12}px ${n.color}${isDrag?\"44\":\"18\"}`,\n              touchAction: \"none\", userSelect: \"none\",\n              animation: isDrag||isSel||isSnap ? \"none\" : \"nodeBreathe 8s ease-in-out infinite\",\n              animationDelay: `${ni*-1.5}s`,\n            }}>{n.display || n.key}</div>\n          );\n        })}\n        {activeConn && <InsightDrawer\n          connection={{nodeA:activeConn.from,nodeB:activeConn.to,label:activeConn.label,insight:activeConn.insight,color:activeConn.color}}\n          position={mid(activeConn)}\n          onClose={()=>setActiveConn(null)}\n          onRespond={(v,c)=>setResponses(prev=>({...prev,[K(activeConn)]:{value:v,correction:c}}))}\n        />}\n        </>}\n      </div>\n      {explored>=3&&<button onClick={onComplete} style={{ width:\"100%\",maxWidth:360,margin:\"4px auto 0\",background:\"linear-gradient(135deg, #6BB8FF, #3D8BFF)\",border:\"none\",borderRadius:24,padding:\"13px 28px\",color:\"white\",fontSize:14,fontFamily:FB,fontWeight:500,cursor:\"pointer\",zIndex:2,animation:\"riseUp 0.5s ease\",flexShrink:0 }}>Run Session \u2192</button>}\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 PHASE 4: SESSION \u2014 Full report with reading, guide, descent, clarity, noticing \u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nconst GUIDE_TYPES = {\n  act: { color: \"#6BFFB8\", icon: \"\u2192\" },\n  sit: { color: \"#6BB8FF\", icon: \"\u25ce\" },\n  deepen: { color: \"#FFB86B\", icon: \"\u25c7\" },\n  release: { color: \"#FF6B9D\", icon: \"\u21ba\" },\n  notice: { color: \"#9FB2D8\", icon: \"\u25c8\" },\n};\n\nconst GUIDE_ITEMS = [\n  { type: \"act\", text: \"Write down the one thing you'd build if money were irrelevant. Put it somewhere you'll see it tomorrow.\" },\n  { type: \"sit\", text: \"Sit with the question: when you say 'proof,' who are you proving it to? Don't answer. Just hold it.\" },\n  { type: \"deepen\", text: \"The word 'control' appeared 12 times. Ask yourself \u2014 what am I actually afraid of losing?\" },\n  { type: \"release\", text: \"Name one expectation about SAYCRD you're ready to set down. You don't have to drop it \u2014 just set it down.\" },\n  { type: \"notice\", text: \"This week, notice when you use the word 'should.' Write down what you actually feel instead.\" },\n];\n\n\nfunction SpectrumSlider({ color, poleA, poleB, onSet, value }) {\n  const [p, setP] = useState(value != null ? value : 50);\n  const tr = useRef(null);\n  const [d, setD] = useState(false);\n  const upd = (e) => { const r = tr.current?.getBoundingClientRect(); if (!r) return; setP(Math.max(0, Math.min(100, ((e.clientX || e.touches?.[0]?.clientX) - r.left) / r.width * 100))); };\n  const hd = (e) => { e.preventDefault(); setD(true); upd(e); };\n  useEffect(() => { if (!d) return; const m = e => upd(e); const u = e => { setD(false); upd(e); onSet(Math.round(p)); }; window.addEventListener(\"pointermove\", m); window.addEventListener(\"pointerup\", u); return () => { window.removeEventListener(\"pointermove\", m); window.removeEventListener(\"pointerup\", u); }; }, [d, p]);\n  return <div>\n    <div style={{ display: \"flex\", justifyContent: \"space-between\", marginBottom: 14 }}>\n      <span style={{ fontSize: 13, color: p < 40 ? color : \"rgba(255,255,255,0.35)\", fontFamily: FB, fontWeight: 500, transition: \"color 0.3s\" }}>{poleA}</span>\n      <span style={{ fontSize: 13, color: p > 60 ? color : \"rgba(255,255,255,0.35)\", fontFamily: FB, fontWeight: 500, transition: \"color 0.3s\" }}>{poleB}</span>\n    </div>\n    <div ref={tr} onPointerDown={hd} style={{ position: \"relative\", height: 32, display: \"flex\", alignItems: \"center\", cursor: \"pointer\", touchAction: \"none\" }}>\n      <div style={{ position: \"absolute\", left: 0, right: 0, height: 3, background: \"rgba(255,255,255,0.06)\", borderRadius: 2 }} />\n      <div style={{ position: \"absolute\", left: 0, height: 3, width: `${p}%`, background: `linear-gradient(90deg,${color}33,${color}88)`, borderRadius: 2, transition: d ? \"none\" : \"width 0.15s\" }} />\n      <div style={{ position: \"absolute\", left: `${p}%`, transform: \"translateX(-50%)\", width: 26, height: 26, borderRadius: \"50%\", background: value !== undefined ? `${color}44` : \"rgba(255,255,255,0.08)\", border: `2px solid ${value !== undefined ? `${color}88` : \"rgba(255,255,255,0.15)\"}`, cursor: d ? \"grabbing\" : \"grab\", boxShadow: value !== undefined ? `0 0 16px ${color}22` : \"none\", transition: d ? \"none\" : \"left 0.15s, background 0.3s\", zIndex: 2 }} />\n    </div>\n    {value !== undefined && <div style={{ textAlign: \"center\", marginTop: 10, fontSize: 11, color: `${color}66`, fontFamily: FB, letterSpacing: \"0.1em\" }}>SET</div>}\n  </div>;\n}\n\nfunction GuideItem({ item, index }) {\n  const [expanded, setExpanded] = useState(false);\n  const [response, setResponse] = useState(\"\");\n  const [saved, setSaved] = useState(false);\n  const [echo, setEcho] = useState(null);\n  const gt = GUIDE_TYPES[item.type] || GUIDE_TYPES.act;\n  const submit = async () => {\n    if (!response.trim()) return;\n    setSaved(true);\n    try {\n      var p = \"You are the reflective voice of SAYCRD. The user responded to a guide prompt. Return ONE mirror, tension, or question. Max 30 words. No praise. JSON: {\\\"echo\\\":\\\"...\\\"}\";\n      var raw = await callClaude(p, \"Guide: \\\"\" + item.text + \"\\\"\\nResponse: \\\"\" + response.trim() + \"\\\"\", 200);\n      var d = parseJSON(raw);\n      if (d && d.echo) setEcho(d.echo);\n    } catch (e) {}\n  };\n  return (\n    <div onClick={() => !expanded && !saved && setExpanded(true)} style={{\n      padding: \"16px 18px\", borderRadius: 14, background: \"rgba(16,20,26,0.8)\",\n      border: `1px solid ${saved ? `${gt.color}33` : expanded ? `${gt.color}22` : \"rgba(255,255,255,0.06)\"}`,\n      cursor: expanded || saved ? \"default\" : \"pointer\", transition: \"all 0.3s\",\n      animation: `riseUp 0.5s ease ${0.1 + index * 0.15}s both`,\n    }}>\n      <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, marginBottom: 8 }}>\n        <span style={{ fontSize: 14, color: gt.color }}>{gt.icon}</span>\n        <span style={{ fontSize: 10, letterSpacing: \"0.16em\", textTransform: \"uppercase\", fontWeight: 700, color: gt.color, fontFamily: FB }}>{item.type}</span>\n        {saved && <span style={{ fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, marginLeft: \"auto\" }}>responded</span>}\n        {!expanded && !saved && <span style={{ fontSize: 10, color: \"rgba(255,255,255,0.1)\", fontFamily: FB, marginLeft: \"auto\" }}>tap to respond</span>}\n      </div>\n      <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.65)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: 0 }}>{item.text}</p>\n      {expanded && !saved && (\n        <div style={{ marginTop: 14, animation: \"riseUp 0.3s ease\" }}>\n          <textarea value={response} onChange={e => setResponse(e.target.value)}\n            onKeyDown={e => { if (e.key === \"Enter\" && !e.shiftKey && response.trim()) { e.preventDefault(); submit(); } }}\n            placeholder=\"In your words\u2026\" rows={2} autoFocus\n            style={{ width: \"100%\", background: \"rgba(255,255,255,0.03)\", border: `1px solid ${gt.color}33`, borderRadius: 10, color: \"rgba(255,255,255,0.8)\", padding: \"10px 14px\", fontFamily: FB, fontSize: 14, resize: \"none\", outline: \"none\", lineHeight: 1.5 }} />\n          <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginTop: 8 }}>\n            <span style={{ fontSize: 11, color: \"rgba(255,255,255,0.15)\", fontFamily: FB }}>Enter to save</span>\n            {response.trim() && <button onClick={submit} style={{ background: `${gt.color}33`, border: `1px solid ${gt.color}55`, borderRadius: 20, padding: \"6px 16px\", color: gt.color, fontSize: 12, fontFamily: FB, cursor: \"pointer\" }}>Save</button>}\n          </div>\n        </div>\n      )}\n      {saved && (\n        <div style={{ marginTop: 10 }}>\n          <div style={{ padding: \"10px 14px\", borderRadius: 10, background: `${gt.color}08`, border: `1px solid ${gt.color}15`, animation: \"riseUp 0.4s ease\" }}>\n            <p style={{ fontSize: 14, color: `${gt.color}cc`, fontFamily: FB, margin: 0, lineHeight: 1.5 }}>{response}</p>\n            <div style={{ fontSize: 10, color: \"rgba(255,255,255,0.15)\", fontFamily: FB, marginTop: 6 }}>This carries forward.</div>\n          </div>\n          {echo && (\n            <div style={{ marginTop: 10, paddingTop: 10, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.5s ease\" }}>\n              <p style={{ fontSize: 14, color: \"rgba(125,183,174,0.6)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: 0 }}>{echo}</p>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction DescentGame({ cards: propCards, onDone }) {\n  const DESCENT_CARDS = (propCards || [\n    { type: \"energy\", phrase: \"wanting to be seen but not watched\", color: \"#FFB86B\" },\n    { type: \"binary\", prompt: \"lately you seem drawn to\", option_a: \"building slowly\", option_b: \"leaping first\", color: \"#FF6B9D\" },\n    { type: \"spectrum\", prompt: \"where does this live?\", pole_a: \"still forming\", pole_b: \"ready to move\", color: \"#6BFFB8\" },\n    { type: \"energy\", phrase: \"proving it to yourself before anyone else\", color: \"#B86BFF\" },\n    { type: \"binary\", prompt: \"the tension feels more like\", option_a: \"two things pulling apart\", option_b: \"one thing trying to split\", color: \"#6BB8FF\" },\n    { type: \"spectrum\", prompt: \"right now you're closer to\", pole_a: \"holding on\", pole_b: \"letting go\", color: \"#FFD700\" },\n  ]).map(function(c,i){return Object.assign({},c,{color:c.color||NC[i%NC.length]});});\n  const [ci, setCi] = useState(0);\n  const [answers, setAnswers] = useState({});\n  const c = DESCENT_CARDS[ci], ans = answers[ci] !== undefined;\n  const record = (v) => { setAnswers(p => ({ ...p, [ci]: v })); setTimeout(() => { if (ci < DESCENT_CARDS.length - 1) setCi(ci + 1); }, 800); };\n  const allDone = Object.keys(answers).length >= DESCENT_CARDS.length - 1 && ans;\n  useEffect(() => { if (allDone) setTimeout(() => onDone(), 1200); }, [allDone]);\n\n  return (\n    <div style={{ padding: \"20px 0\" }}>\n      <div style={{ display: \"flex\", gap: 8, marginBottom: 20, justifyContent: \"center\" }}>\n        {DESCENT_CARDS.map((_, i) => <div key={i} style={{ width: i === ci ? 12 : 7, height: 7, borderRadius: 4, background: i < ci ? `${DESCENT_CARDS[i].color}88` : i === ci ? \"white\" : \"rgba(255,255,255,0.1)\", transition: \"all 0.4s\" }} />)}\n      </div>\n      <div style={{ fontSize: 10, letterSpacing: \"0.2em\", color: `${c.color}88`, fontFamily: FB, textTransform: \"uppercase\", marginBottom: 12, textAlign: \"center\", fontWeight: 600 }}>\n        {c.type === \"energy\" ? \"how alive is this\" : c.type === \"binary\" ? \"which pulls more\" : \"place yourself\"}\n      </div>\n      <div key={ci} style={{ animation: \"slideIn 0.4s ease\" }}>\n        <div style={{ borderRadius: 22, padding: \"32px 24px\", background: `linear-gradient(160deg,${c.color}12,rgba(10,10,30,0.9),${c.color}08)`, border: `1px solid ${c.color}22`, boxShadow: `0 0 40px ${c.color}08`, position: \"relative\", overflow: \"hidden\" }}>\n          <div style={{ position: \"absolute\", top: 0, left: \"15%\", right: \"15%\", height: 1, background: `linear-gradient(90deg,transparent,${c.color}55,transparent)`, animation: \"sweep 3.5s ease-in-out infinite\" }} />\n          <div style={{ fontSize: 22, fontFamily: FD, fontStyle: \"italic\", color: \"rgba(255,255,255,0.92)\", lineHeight: 1.45, textAlign: \"center\", marginBottom: 24 }}>{c.phrase || c.prompt}</div>\n          {c.type === \"energy\" && <div style={{ display: \"flex\", flexDirection: \"column\", alignItems: \"center\", gap: 10 }}>\n            <div style={{ fontSize: 10, letterSpacing: \"0.15em\", textTransform: \"uppercase\", color: \"rgba(255,255,255,0.3)\", fontFamily: FB }}>how much does this resonate?</div>\n            <div style={{ display: \"flex\", gap: 12 }}>{[1, 2, 3, 4, 5].map(n => <div key={n} onClick={() => record(n)} style={{ width: 36, height: 36, borderRadius: \"50%\", border: `2px solid ${answers[ci] >= n ? `${c.color}88` : \"rgba(255,255,255,0.1)\"}`, background: answers[ci] >= n ? `${c.color}25` : \"rgba(255,255,255,0.02)\", cursor: \"pointer\", transition: \"all 0.3s\", display: \"grid\", placeItems: \"center\", boxShadow: answers[ci] >= n ? `0 0 12px ${c.color}22` : \"none\", transform: answers[ci] >= n ? \"scale(1.1)\" : \"scale(1)\" }}><div style={{ width: answers[ci] >= n ? 12 : 5, height: answers[ci] >= n ? 12 : 5, borderRadius: \"50%\", background: answers[ci] >= n ? c.color : \"rgba(255,255,255,0.15)\", transition: \"all 0.3s\" }} /></div>)}</div>\n          </div>}\n          {c.type === \"binary\" && <div>\n            <div style={{ display: \"flex\", gap: 12 }}>{[\"a\", \"b\"].map(s => { const t = s === \"a\" ? c.option_a : c.option_b; const ch = answers[ci] === s; const fd = answers[ci] && answers[ci] !== s && answers[ci] !== \"neither\"; return <div key={s} onClick={() => record(s)} style={{ flex: 1, padding: \"18px 12px\", borderRadius: 14, border: `1px solid ${ch ? `${c.color}44` : \"rgba(255,255,255,0.08)\"}`, background: ch ? `${c.color}12` : \"rgba(255,255,255,0.015)\", cursor: \"pointer\", textAlign: \"center\", transition: \"all 0.3s\", opacity: fd ? 0.25 : 1, transform: ch ? \"scale(1.03)\" : fd ? \"scale(0.96)\" : \"scale(1)\" }}><div style={{ fontSize: 15, fontWeight: 600, color: ch ? c.color : \"rgba(255,255,255,0.75)\", fontFamily: FB, lineHeight: 1.4 }}>{t}</div></div>; })}</div>\n            <div onClick={() => record(\"neither\")} style={{ textAlign: \"center\", marginTop: 14, fontSize: 12, fontFamily: FB, color: answers[ci] === \"neither\" ? c.color : \"rgba(255,255,255,0.2)\", cursor: \"pointer\", letterSpacing: \"0.06em\", transition: \"color 0.3s\" }}>neither quite fits</div>\n          </div>}\n          {c.type === \"spectrum\" && <SpectrumSlider color={c.color} poleA={c.pole_a} poleB={c.pole_b} onSet={v => record(v)} value={answers[ci]} />}\n        </div>\n      </div>\n      <div style={{ display: \"flex\", gap: 12, marginTop: 14, justifyContent: \"space-between\" }}>\n        {ci > 0 && <button onClick={() => setCi(ci - 1)} style={{ padding: \"8px 16px\", borderRadius: 20, border: \"1px solid rgba(255,255,255,0.1)\", background: \"transparent\", color: \"rgba(255,255,255,0.4)\", fontSize: 12, fontFamily: FB, cursor: \"pointer\" }}>\u2190 Back</button>}\n        <div style={{ flex: 1 }} />\n        {ans && ci < DESCENT_CARDS.length - 1 && <button onClick={() => setCi(ci + 1)} style={{ padding: \"8px 20px\", borderRadius: 20, border: \"none\", background: `${c.color}33`, color: \"white\", fontSize: 12, fontFamily: FB, fontWeight: 500, cursor: \"pointer\" }}>Next \u2192</button>}\n      </div>\n    </div>\n  );\n}\n\n// \u2500\u2500 Tappable Sentence \u2014 tap any line in the reading to respond \u2500\u2500\n\nfunction TappableSentence({ text, synthesisData }) {\n  var [hover, setHover] = useState(false);\n  var [choice, setChoice] = useState(null);\n  var [correction, setCorrection] = useState(\"\");\n  var [aiResp, setAiResp] = useState(null);\n  var [saving, setSaving] = useState(false);\n\n  var handleChoice = function(v) {\n    setChoice(v);\n    if (v === \"yes\") {\n      setSaving(true);\n      setTimeout(function() { setSaving(false); }, 800);\n    }\n  };\n\n  var submitCorrection = async function() {\n    if (!correction.trim()) return;\n    setSaving(true);\n    var sd = synthesisData || {};\n    var ctx = \"\";\n    if (sd.themes) ctx += \"Themes: \" + sd.themes.map(function(t) { return t.label; }).join(\", \") + \". \";\n    if (sd.synthesis) ctx += \"Reading: \" + sd.synthesis + \". \";\n    var p = \"You are the AI behind SAYCRD. The user tapped a specific line in their reading and wrote something in response.\\n\\n\" +\n      \"Current session: \" + ctx + \"\\n\" +\n      \"The line they tapped: \\\"\" + text + \"\\\"\\n\" +\n      \"What they said: \\\"\" + correction + \"\\\"\\n\" +\n      \"Their response type: \" + choice + \"\\n\\n\" +\n      \"Read what they said. It might be confusion, resonance, correction, discovery, or treasure.\\n\" +\n      \"Respond in 1-2 sentences. Warm. Direct. No hedging.\\n\" +\n      \"JSON only: {\\\"response\\\":\\\"...\\\",\\\"type\\\":\\\"clarify|resonance|correction|discovery|treasure\\\"}\";\n    try {\n      var raw = await callClaude(p, \"Line: \\\"\" + text + \"\\\"\\nTheir words: \\\"\" + correction + \"\\\"\", 400);\n      var d = parseJSON(raw);\n      if (d && d.response) setAiResp(d); else setAiResp({ response: \"I hear you.\", type: \"held\" });\n    } catch (e) { setAiResp({ response: \"Noted.\", type: \"held\" }); }\n    setSaving(false);\n  };\n\n  // Not yet tapped \u2014 show with hover underline\n  if (!choice) {\n    return <span\n      onClick={function(e) { e.stopPropagation(); setChoice(\"pending\"); }}\n      onMouseEnter={function() { setHover(true); }}\n      onMouseLeave={function() { setHover(false); }}\n      style={{\n        cursor: \"pointer\",\n        color: hover ? \"#D6B26D\" : \"inherit\",\n        textDecorationLine: hover ? \"underline\" : \"none\",\n        textDecorationStyle: \"dotted\",\n        textDecorationColor: \"rgba(214,178,109,0.4)\",\n        textUnderlineOffset: \"4px\",\n        transition: \"color 0.2s\",\n      }}\n    >{text} </span>;\n  }\n\n  // Confirmed\n  if (choice === \"yes\") {\n    return <span>\n      <span style={{ color: \"#7DB7AE\", transition: \"color 0.4s\" }}>{text} </span>\n      <span style={{ fontSize: 10, color: \"#7DB7AE\", fontFamily: FB, letterSpacing: \"0.08em\" }}>{\"\\u2713\"} </span>\n    </span>;\n  }\n\n  // Pending \u2014 show option buttons\n  if (choice === \"pending\") {\n    return <div style={{ display: \"block\", margin: \"8px 0\", padding: \"12px 16px\", borderRadius: 14, background: \"rgba(214,178,109,0.04)\", border: \"1px solid rgba(214,178,109,0.12)\", animation: \"riseUp 0.3s ease\" }}>\n      <div style={{ color: \"#D6B26D\", marginBottom: 10, fontFamily: FD, fontStyle: \"italic\", fontSize: \"inherit\", lineHeight: 1.5 }}>{text}</div>\n      <div style={{ display: \"flex\", gap: 8 }}>\n        {[{icon:\"\\u2726\",label:\"Yes\",v:\"yes\"},{icon:\"\\u25C7\",label:\"Partly\",v:\"partly\"},{icon:\"\\u2014\",label:\"Not quite\",v:\"no\"}].map(function(o) {\n          return <button key={o.v} onClick={function(e) { e.stopPropagation(); handleChoice(o.v); }} style={{\n            flex: 1, padding: \"10px 8px\", borderRadius: 12, fontSize: 13, fontFamily: FB, fontWeight: 500,\n            border: \"1px solid rgba(214,178,109,0.2)\", background: \"rgba(214,178,109,0.06)\",\n            color: \"#D6B26D\", cursor: \"pointer\", transition: \"all 0.2s\", textAlign: \"center\",\n          }}>{o.icon} {o.label}</button>;\n        })}\n      </div>\n    </div>;\n  }\n\n  // \"partly\" or \"no\" \u2014 correction input + AI response\n  return <div style={{ display: \"block\", margin: \"8px 0\" }}>\n    <div style={{ color: choice === \"partly\" ? \"#D6B26Daa\" : \"rgba(255,255,255,0.35)\", marginBottom: 6, fontFamily: FD, fontStyle: \"italic\", fontSize: \"inherit\", lineHeight: 1.5 }}>{text}</div>\n    {!aiResp && <div onClick={function(e) { e.stopPropagation(); }} style={{ padding: \"12px 14px\", borderRadius: 12, background: \"rgba(214,178,109,0.04)\", borderLeft: \"3px solid rgba(214,178,109,0.25)\", animation: \"riseUp 0.3s ease\" }}>\n      <div style={{ fontSize: 12, color: \"rgba(214,178,109,0.6)\", fontFamily: FB, marginBottom: 8, fontWeight: 500 }}>\n        {choice === \"no\" ? \"What\\u2019s more true?\" : \"What would sharpen it?\"}\n      </div>\n      <textarea value={correction} onChange={function(e) { setCorrection(e.target.value); }}\n        onKeyDown={function(e) { if (e.key === \"Enter\" && !e.shiftKey && correction.trim()) { e.preventDefault(); submitCorrection(); } }}\n        onClick={function(e) { e.stopPropagation(); }}\n        placeholder=\"In your words\\u2026\" rows={2} autoFocus\n        style={{ width: \"100%\", background: \"rgba(255,255,255,0.04)\", border: \"1px solid rgba(214,178,109,0.18)\", borderRadius: 10, color: \"rgba(255,255,255,0.8)\", padding: \"10px 12px\", fontFamily: FB, fontSize: 14, resize: \"none\", outline: \"none\", lineHeight: 1.5 }}\n      />\n      {saving && <div style={{ fontSize: 12, color: \"#D6B26D88\", fontFamily: FB, marginTop: 6 }}>reading{\"\\u2026\"}</div>}\n    </div>}\n    {aiResp && <div style={{ padding: \"12px 14px\", borderRadius: 12, background: \"rgba(214,178,109,0.05)\", borderLeft: \"3px solid rgba(214,178,109,0.3)\", animation: \"riseUp 0.4s ease\" }}>\n      <div style={{ fontSize: 14, color: \"#D6B26D\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 6 }}>{\"\\u201C\"}{correction}{\"\\u201D\"}</div>\n      <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.7)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6 }}>{aiResp.response}</div>\n      <div style={{ fontSize: 9, color: \"#7DB7AE77\", fontFamily: FB, marginTop: 8, letterSpacing: \"0.12em\", textTransform: \"uppercase\" }}>\n        {aiResp.type === \"correction\" ? \"correction noted\" : aiResp.type === \"treasure\" ? \"\\u2661 kept\" : \"held\"}\n      </div>\n    </div>}\n  </div>;\n}\n\nfunction TappableReading({ text, synthesisData }) {\n  if (!text || text.trim().length === 0) return <span>{text}</span>;\n  // Split on sentence-ending punctuation\n  var sentences = text.match(/[^.!?]+[.!?]+[\\u201D\\u201C\\u2019\\u2018\"']?\\s*/g);\n  if (!sentences || sentences.length === 0) {\n    // No punctuation \u2014 whole block is one tappable unit\n    return <TappableSentence text={text.trim()} synthesisData={synthesisData} />;\n  }\n  return <span>{sentences.map(function(s, i) {\n    return <TappableSentence key={i} text={s.trim()} synthesisData={synthesisData} />;\n  })}</span>;\n}\n\nfunction SessionPhase({ onComplete, synthesisData }) {\n  const [descentOpen, setDescentOpen] = useState(false);\n  const [descentDone, setDescentDone] = useState(false);\n  const [clarity, setClarity] = useState(\"\");\n  const [claritySaved, setClaritySaved] = useState(false);\n  const [showNoticing, setShowNoticing] = useState(false);\n  const scrollRef = useRef(null);\n\n  const saveClarity = () => {\n    if (clarity.trim()) {\n      setClaritySaved(true);\n      setTimeout(() => setShowNoticing(true), 1200);\n    }\n  };\n\n  const sd = synthesisData || {};\n  const THEMES = (sd.themes || [\n    { label: \"SAYCRD\", weight: 5, color: \"#FF6B9D\" }, { label: \"Money\", weight: 4, color: \"#FFB86B\" },\n    { label: \"Making\", weight: 3.5, color: \"#6BFFB8\" }, { label: \"Control\", weight: 3, color: \"#B86BFF\" },\n    { label: \"Trust\", weight: 2.5, color: \"#6BB8FF\" },\n  ]).map(function(t, i) { return { name: t.label, color: t.color || NC[i % NC.length], weight: Math.min((t.weight || 1) / 5, 1) }; });\n  const GUIDE_ITEMS = (sd.guide || [\n    { type: \"act\", text: \"Write down the one thing you'd build if money were irrelevant.\" },\n    { type: \"deepen\", text: \"Sit with the question: when you say 'proof,' who are you proving it to?\" },\n    { type: \"deepen\", text: \"What am I actually afraid of losing if I let go of control?\" },\n    { type: \"release\", text: \"Name one expectation you're ready to set down.\" },\n    { type: \"notice\", text: \"Notice when you use the word 'should.' Write what you actually feel.\" },\n  ]).map(function(g) { return { type: g.type || \"notice\", text: g.text || \"\" }; });\n  const synthesis = sd.synthesis || \"You're building something that matters \u2014 but the question underneath isn't \\\"will it work?\\\" It's \\\"will it prove I can do this?\\\"\";\n  const underneath = sd.underneath || [\n    \"Trust is the quietest force but it touches everything\",\n    \"Money and Proof are almost interchangeable in your language\",\n    \"There's a version of this where SAYCRD isn't the proof \u2014 it's just what you made because you had to\",\n  ];\n  var tension = sd.tension || { a: \"Control\", b: \"Trust\", text: \"These two are pulling in opposite directions. One grows as the other shrinks.\" };\n  var opening = sd.opening || \"What changes if you let go of what it needs to prove?\";\n  var noticing = sd.noticing || \"you named what you're carrying in fewer words than before. That's not simplification \u2014 that's distillation.\";\n  var mapTitle = sd.map_title || \"\";\n  var descentCards = sd.descent_cards || null;\n\n  return (\n    <div style={{ width: \"100%\", height: \"100%\", position: \"relative\", overflow: \"auto\", WebkitOverflowScrolling: \"touch\" }} ref={scrollRef}>\n      <Particles color=\"rgba(214,178,109,0.15)\" count={8} />\n      <div style={{ maxWidth: 380, margin: \"0 auto\", padding: \"60px 20px 40px\", position: \"relative\", zIndex: 1 }}>\n\n        {/* Session header */}\n        <div style={{ marginBottom: 28, animation: \"riseUp 0.5s ease\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.2em\", textTransform: \"uppercase\", color: \"rgba(255,255,255,0.2)\", fontFamily: FB, marginBottom: 4 }}>SESSION \u00b7 {new Date().toLocaleDateString(\"en-US\", { month: \"long\", day: \"numeric\" }).toUpperCase()}</div>\n        </div>\n\n        {/* \u2500\u2500 WHAT EMERGED \u2014 themes from the map \u2500\u2500 */}\n        <div style={{ marginBottom: 32, animation: \"riseUp 0.5s ease 0.05s both\" }}>\n          <div style={{ fontSize: 11, letterSpacing: \"0.4em\", fontWeight: 600, color: \"#E84393\", marginBottom: 8, fontFamily: FB }}>WHAT EMERGED</div>\n          <h2 style={{ fontSize: 26, fontFamily: FD, fontStyle: \"italic\", color: \"white\", margin: \"0 0 20px\", fontWeight: 400 }}>{THEMES.length} forces found</h2>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 10, marginBottom: 0 }}>\n            {THEMES.map((t, i) => (\n              <div key={t.name} style={{ display: \"flex\", alignItems: \"center\", gap: 12, animation: `riseUp 0.5s ease ${i * 0.08}s both` }}>\n                <div style={{ width: 36, height: 36, borderRadius: \"50%\", background: `${t.color}18`, border: `2px solid ${t.color}33`, display: \"flex\", alignItems: \"center\", justifyContent: \"center\", flexShrink: 0 }}>\n                  <div style={{ width: 5 + t.weight * 12, height: 5 + t.weight * 12, borderRadius: \"50%\", background: t.color, opacity: 0.6 + t.weight * 0.4 }} />\n                </div>\n                <div style={{ flex: 1 }}>\n                  <div style={{ fontSize: 16, color: \"white\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 3 }}>{t.name}</div>\n                  <div style={{ height: 3, background: \"rgba(255,255,255,0.04)\", borderRadius: 2, overflow: \"hidden\" }}>\n                    <div style={{ width: `${t.weight * 100}%`, height: \"100%\", background: `linear-gradient(90deg, ${t.color}44, ${t.color})`, borderRadius: 2, animation: `growWidth 1s ease ${0.3 + i * 0.1}s both` }} />\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* \u2500\u2500 THE READING \u2500\u2500 */}\n        <div style={{ marginBottom: 32, animation: \"riseUp 0.6s ease 0.1s both\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#D6B26D\", marginBottom: 14, fontFamily: FB }}>THE READING</div>\n          <div style={{ fontSize: 11, color: \"rgba(214,178,109,0.3)\", fontFamily: FB, marginBottom: 8, letterSpacing: \"0.05em\" }}>tap any sentence to respond</div>\n          {mapTitle && <div style={{ fontSize: 13, color: \"rgba(214,178,109,0.4)\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 10 }}>{mapTitle}</div>}\n          <p style={{ fontSize: 19, color: \"rgba(255,255,255,0.85)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.7, margin: 0 }}>\n            <TappableReading text={synthesis} synthesisData={sd} />\n          </p>\n        </div>\n\n        {/* \u2500\u2500 WHAT'S UNDERNEATH \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.2s both\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#B86BFF\", marginBottom: 14, fontFamily: FB }}>WHAT'S UNDERNEATH</div>\n          {underneath.map((t, i) => (\n            <div key={i} style={{ padding: \"12px 14px 12px 20px\", borderRadius: 12, background: \"rgba(183,107,255,0.03)\", border: \"1px solid rgba(183,107,255,0.06)\", marginBottom: 8, position: \"relative\", animation: `riseUp 0.5s ease ${0.3 + i * 0.1}s both` }}>\n              <div style={{ position: \"absolute\", left: 10, top: 16, width: 4, height: 4, borderRadius: \"50%\", background: \"#B86BFF\", opacity: 0.4 }} />\n              <p style={{ fontSize: 14, color: \"rgba(255,255,255,0.5)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: 0 }}><TappableReading text={t} synthesisData={sd} /></p>\n            </div>\n          ))}\n        </div>\n\n        {/* \u2500\u2500 THE TENSION \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.3s both\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#FFB86B\", marginBottom: 14, fontFamily: FB }}>THE TENSION</div>\n          <div style={{ display: \"flex\", alignItems: \"center\", gap: 14, padding: \"14px 16px\", borderRadius: 12, background: \"rgba(255,184,107,0.04)\", border: \"1px solid rgba(255,184,107,0.08)\" }}>\n            <span style={{ fontSize: 15, color: \"#FFB86B\", fontFamily: FB, fontWeight: 600 }}>{tension.a}</span>\n            <div style={{ flex: 1, height: 1, background: \"linear-gradient(90deg, #FFB86B44, #6BB8FF44)\" }} />\n            <span style={{ fontSize: 15, color: \"#6BB8FF\", fontFamily: FB, fontWeight: 600 }}>{tension.b}</span>\n          </div>\n          <p style={{ fontSize: 15, color: \"rgba(255,255,255,0.45)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.5, margin: \"10px 0 0\" }}>\n            <TappableReading text={tension.text} synthesisData={sd} />\n          </p>\n        </div>\n\n        {/* \u2500\u2500 WHAT'S OPENING \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.35s both\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#6BFFB8\", marginBottom: 14, fontFamily: FB }}>WHAT'S OPENING</div>\n          <p style={{ fontSize: 17, color: \"rgba(107,255,184,0.7)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6, margin: 0 }}>\n            <TappableReading text={opening} synthesisData={sd} />\n          </p>\n        </div>\n\n        {/* \u2500\u2500 YOUR GUIDE \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 0.6s ease 0.4s both\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#7DB7AE\", marginBottom: 14, fontFamily: FB }}>YOUR GUIDE</div>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 10 }}>\n            {GUIDE_ITEMS.map((item, i) => <GuideItem key={i} item={item} index={i} />)}\n          </div>\n        </div>\n\n        {/* \u2500\u2500 DESCENT \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\" }}>\n          {!descentOpen && !descentDone && (\n            <div onClick={() => setDescentOpen(true)} style={{\n              display: \"flex\", alignItems: \"center\", justifyContent: \"center\", gap: 8,\n              fontFamily: FB, fontSize: 15, color: \"rgba(214,178,109,0.7)\", textAlign: \"center\",\n              cursor: \"pointer\", padding: \"18px 20px\", borderRadius: 14,\n              border: \"1px solid rgba(214,178,109,0.08)\", background: \"rgba(214,178,109,0.015)\",\n              transition: \"all 0.3s\", fontWeight: 600, letterSpacing: \"0.03em\",\n              animation: \"riseUp 0.5s ease 0.6s both\",\n            }}>\n              <span style={{ fontSize: 16 }}>\u25c6</span> See what's underneath\n            </div>\n          )}\n          {descentOpen && !descentDone && (\n            <div style={{ animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"#D6B26D\", marginBottom: 8, fontFamily: FB, textAlign: \"center\" }}>THE DESCENT</div>\n              <DescentGame cards={descentCards} onDone={() => setDescentDone(true)} />\n            </div>\n          )}\n          {descentDone && (\n            <div style={{ textAlign: \"center\", padding: \"16px 0\", animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 13, color: \"rgba(214,178,109,0.5)\", fontFamily: FB }}>\u25c6 Descent complete</div>\n            </div>\n          )}\n        </div>\n\n        {/* \u2500\u2500 CLARITY \u2500\u2500 */}\n        <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\" }}>\n          <div style={{ fontSize: 10, letterSpacing: \"0.3em\", fontWeight: 600, color: \"rgba(214,178,109,0.35)\", marginBottom: 14, fontFamily: FB }}>WHAT ARE YOU TAKING WITH YOU?</div>\n          {!claritySaved ? (\n            <div>\n              <input type=\"text\" value={clarity} onChange={e => setClarity(e.target.value)}\n                onKeyDown={e => { if (e.key === \"Enter\" && clarity.trim()) saveClarity(); }}\n                placeholder=\"Name it plainly\u2026\" maxLength={140}\n                style={{ width: \"100%\", background: \"transparent\", border: \"none\", borderBottom: \"1px solid rgba(214,178,109,0.15)\", borderRadius: 0, color: \"rgba(255,255,255,0.9)\", padding: \"12px 0\", fontFamily: FB, fontSize: 16, outline: \"none\", letterSpacing: \"0.02em\" }} />\n              {clarity.trim() && <button onClick={saveClarity} style={{ marginTop: 12, background: \"rgba(214,178,109,0.12)\", border: \"1px solid rgba(214,178,109,0.25)\", borderRadius: 20, padding: \"8px 20px\", color: \"#D6B26D\", fontSize: 13, fontFamily: FB, cursor: \"pointer\" }}>Save</button>}\n            </div>\n          ) : (\n            <div style={{ animation: \"riseUp 0.5s ease\" }}>\n              <div style={{ fontSize: 16, color: \"#D6B26D\", fontFamily: FB, lineHeight: 1.55, letterSpacing: \"0.02em\" }}>{clarity}</div>\n              <div style={{ fontSize: 9, letterSpacing: \"0.25em\", textTransform: \"uppercase\", color: \"#7DB7AE\", marginTop: 8, opacity: 0.4 }}>SAVED</div>\n            </div>\n          )}\n        </div>\n\n        {/* \u2500\u2500 AI NOTICING \u2500\u2500 */}\n        {showNoticing && (\n          <div style={{ marginBottom: 32, paddingTop: 20, borderTop: \"1px solid rgba(255,255,255,0.04)\", animation: \"riseUp 1s ease\" }}>\n            <div style={{ fontSize: 12, color: \"rgba(255,255,255,0.35)\", fontFamily: FB, lineHeight: 1.7, opacity: 0.5 }}>\n              \u2726 The system notices: {noticing}\n            </div>\n          </div>\n        )}\n\n        {/* \u2500\u2500 CONTINUE \u2500\u2500 */}\n        <button onClick={onComplete} style={{\n          width: \"100%\", background: claritySaved ? \"linear-gradient(135deg, #6BFFB8, #3DFFAA)\" : \"rgba(107,255,184,0.08)\",\n          border: claritySaved ? \"none\" : \"1px solid rgba(107,255,184,0.15)\",\n          borderRadius: 24, padding: \"14px 28px\",\n          color: claritySaved ? \"#0A2E1A\" : \"rgba(107,255,184,0.3)\",\n          fontSize: 15, fontFamily: FB, fontWeight: claritySaved ? 600 : 400,\n          cursor: \"pointer\", transition: \"all 0.4s\",\n        }}>\n          {claritySaved ? \"See Your Field \u2192\" : \"Continue to What's Growing \u2192\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PHASE 5: THE FIELD v5.1\n// 16 cards. Each its own universe.\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n// \u2500\u2500 Field SVG Illustrations \u2500\u2500\n\nfunction ChrysalisButterfly({ morphed }) {\n  return (\n    <svg viewBox=\"0 0 280 240\" style={{ width: \"100%\", maxWidth: 260 }}>\n      {!morphed ? (\n        <g>\n          <path d=\"M 140 30 Q 143 50 138 70\" stroke=\"#8B7355\" strokeWidth=\"2.5\" fill=\"none\" />\n          <ellipse cx=\"138\" cy=\"115\" rx=\"24\" ry=\"44\" fill=\"url(#cocoon)\" />\n          <path d=\"M 138 70 Q 135 82 138 92\" stroke=\"#A09070\" strokeWidth=\"1.5\" fill=\"none\" />\n          {[0,1,2].map(i => (\n            <ellipse key={i} cx=\"138\" cy=\"115\" rx={28+i*6} ry={48+i*6} fill=\"none\"\n              stroke=\"rgba(196,160,232,0.1)\" strokeWidth=\"0.5\">\n              <animate attributeName=\"rx\" values={`${28+i*6};${32+i*6};${28+i*6}`} dur={`${3+i}s`} repeatCount=\"indefinite\" />\n            </ellipse>\n          ))}\n        </g>\n      ) : (\n        <g style={{ animation: \"riseUp 1s ease\" }}>\n          <path d=\"M 140 120 Q 65 65 50 100 Q 30 135 65 165 Q 95 185 140 145\" fill=\"url(#wL)\" opacity=\"0.9\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" values=\"-4 140 120;4 140 120;-4 140 120\" dur=\"2.2s\" repeatCount=\"indefinite\" />\n          </path>\n          <path d=\"M 140 120 Q 215 65 230 100 Q 250 135 215 165 Q 185 185 140 145\" fill=\"url(#wR)\" opacity=\"0.9\">\n            <animateTransform attributeName=\"transform\" type=\"rotate\" values=\"4 140 120;-4 140 120;4 140 120\" dur=\"2.2s\" repeatCount=\"indefinite\" />\n          </path>\n          {[[95,118,10],[185,118,10],[80,140,7],[200,140,7]].map(([cx,cy,r],i) => (\n            <circle key={i} cx={cx} cy={cy} r={r} fill=\"rgba(255,255,255,0.2)\" />\n          ))}\n          <ellipse cx=\"140\" cy=\"132\" rx=\"3.5\" ry=\"18\" fill=\"#2A1A3A\" />\n          <path d=\"M 138 115 Q 125 95 120 90\" stroke=\"#2A1A3A\" strokeWidth=\"1.5\" fill=\"none\" />\n          <path d=\"M 142 115 Q 155 95 160 90\" stroke=\"#2A1A3A\" strokeWidth=\"1.5\" fill=\"none\" />\n          <circle cx=\"120\" cy=\"90\" r=\"2.5\" fill=\"#FFD700\" />\n          <circle cx=\"160\" cy=\"90\" r=\"2.5\" fill=\"#FFD700\" />\n        </g>\n      )}\n      <defs>\n        <radialGradient id=\"cocoon\"><stop offset=\"0%\" stopColor=\"#8B7B5B\" /><stop offset=\"100%\" stopColor=\"#5B4B35\" /></radialGradient>\n        <linearGradient id=\"wL\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\"><stop offset=\"0%\" stopColor=\"#E8A0D4\" /><stop offset=\"50%\" stopColor=\"#C470E8\" /><stop offset=\"100%\" stopColor=\"#8844CC\" /></linearGradient>\n        <linearGradient id=\"wR\" x1=\"1\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"0%\" stopColor=\"#E8A0D4\" /><stop offset=\"50%\" stopColor=\"#C470E8\" /><stop offset=\"100%\" stopColor=\"#8844CC\" /></linearGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction TensionPull({ clicked }) {\n  return (\n    <svg viewBox=\"0 0 320 180\" style={{ width: \"100%\", maxWidth: 320 }}>\n      {[80,60,40].map((r,i) => (\n        <ellipse key={i} cx=\"160\" cy=\"90\" rx={clicked ? r+60 : r} ry={clicked ? r*0.45+10 : r*0.45}\n          fill=\"none\" stroke=\"url(#tf)\" strokeWidth=\"0.8\" opacity={0.15-i*0.04}\n          style={{ transition: \"all 0.8s ease\" }} />\n      ))}\n      <g style={{ transform: `translateX(${clicked ? -35 : 0}px)`, transition: \"transform 0.8s ease\" }}>\n        <circle cx=\"75\" cy=\"90\" r=\"28\" fill=\"url(#pL)\" />\n        <circle cx=\"75\" cy=\"90\" r=\"34\" fill=\"none\" stroke=\"#FF6B6B\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"34;40;34\" dur=\"2s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>\n      <g style={{ transform: `translateX(${clicked ? 35 : 0}px)`, transition: \"transform 0.8s ease\" }}>\n        <circle cx=\"245\" cy=\"90\" r=\"28\" fill=\"url(#pR)\" />\n        <circle cx=\"245\" cy=\"90\" r=\"34\" fill=\"none\" stroke=\"#6BC5FF\" strokeWidth=\"0.5\" opacity=\"0.3\">\n          <animate attributeName=\"r\" values=\"34;40;34\" dur=\"2.3s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>\n      {clicked && (\n        <g style={{ animation: \"riseUp 0.6s ease\" }}>\n          <circle cx=\"160\" cy=\"50\" r=\"22\" fill=\"url(#gG)\" />\n          <text x=\"160\" y=\"56\" textAnchor=\"middle\" fontSize=\"18\" fill=\"#FFD700\" fontFamily=\"serif\">\u2726</text>\n        </g>\n      )}\n      {clicked && [0,1,2].map(i => (\n        <line key={i} x1={120+i*20} y1={75+i*5} x2={135+i*18} y2={80+i*3}\n          stroke=\"#FFD700\" strokeWidth=\"1.5\" opacity=\"0.5\" fill=\"none\">\n          <animate attributeName=\"opacity\" values=\"0.3;0.7;0.3\" dur={`${0.6+i*0.2}s`} repeatCount=\"indefinite\" />\n        </line>\n      ))}\n      <defs>\n        <linearGradient id=\"tf\"><stop offset=\"0%\" stopColor=\"#FF6B6B\" /><stop offset=\"50%\" stopColor=\"#FFD700\" /><stop offset=\"100%\" stopColor=\"#6BC5FF\" /></linearGradient>\n        <radialGradient id=\"pL\"><stop offset=\"0%\" stopColor=\"#FF8888\" /><stop offset=\"100%\" stopColor=\"#CC3333\" /></radialGradient>\n        <radialGradient id=\"pR\"><stop offset=\"0%\" stopColor=\"#88CCFF\" /><stop offset=\"100%\" stopColor=\"#3388CC\" /></radialGradient>\n        <radialGradient id=\"gG\"><stop offset=\"0%\" stopColor=\"rgba(255,215,0,0.4)\" /><stop offset=\"100%\" stopColor=\"rgba(255,215,0,0)\" /></radialGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction SessionPortrait() {\n  const rings = [\n    { r: 100, color: \"#FF6B9D\", width: 4, dash: \"8 4\", speed: 60 },\n    { r: 78, color: \"#FFB86B\", width: 3, dash: \"12 8\", speed: 45 },\n    { r: 56, color: \"#6BFFB8\", width: 2.5, dash: \"4 12\", speed: 80 },\n    { r: 38, color: \"#B86BFF\", width: 2, dash: \"20 4\", speed: 35 },\n    { r: 22, color: \"#FFD700\", width: 6, dash: \"2 6\", speed: 50 },\n  ];\n  return (\n    <svg viewBox=\"0 0 260 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n      {rings.map((ring, i) => (\n        <circle key={i} cx=\"130\" cy=\"130\" r={ring.r} fill=\"none\"\n          stroke={ring.color} strokeWidth={ring.width}\n          strokeDasharray={ring.dash} strokeLinecap=\"round\" opacity=\"0.7\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\"\n            from={`0 130 130`} to={`${i%2===0?360:-360} 130 130`} dur={`${ring.speed}s`} repeatCount=\"indefinite\" />\n        </circle>\n      ))}\n      <circle cx=\"130\" cy=\"130\" r=\"6\" fill=\"white\" opacity=\"0.8\" />\n      <circle cx=\"130\" cy=\"130\" r=\"12\" fill=\"none\" stroke=\"white\" strokeWidth=\"0.5\" opacity=\"0.3\">\n        <animate attributeName=\"r\" values=\"12;18;12\" dur=\"3s\" repeatCount=\"indefinite\" />\n      </circle>\n    </svg>\n  );\n}\n\nfunction ThreadTimeline() {\n  const points = [\n    { s: 3, strength: 0.2 }, { s: 7, strength: 0.3 }, { s: 12, strength: 0.1 },\n    { s: 18, strength: 0.15 }, { s: 28, strength: 0.6 }, { s: 29, strength: 0.7 },\n    { s: 30, strength: 0.8 }, { s: 32, strength: 0.9 },\n  ];\n  const w = 300, h = 100;\n  return (\n    <svg viewBox={`0 0 ${w} ${h}`} style={{ width: \"100%\", maxWidth: 300 }}>\n      <line x1=\"0\" y1={h-10} x2={w} y2={h-10} stroke=\"rgba(255,255,255,0.06)\" strokeWidth=\"1\" />\n      <path d={points.map((p, i) => {\n        const x = (p.s / 32) * w; const y = h - 10 - (p.strength * (h - 20));\n        return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;\n      }).join(' ')} fill=\"none\" stroke=\"url(#threadG)\" strokeWidth=\"2.5\" strokeLinecap=\"round\" />\n      {points.map((p, i) => {\n        const x = (p.s / 32) * w; const y = h - 10 - (p.strength * (h - 20));\n        return <circle key={i} cx={x} cy={y} r={3 + p.strength * 4} fill=\"#FFB86B\" opacity={0.4 + p.strength * 0.6} />;\n      })}\n      <text x=\"0\" y={h} fontSize=\"10\" fill=\"rgba(255,255,255,0.3)\" fontFamily={FB}>1</text>\n      <text x={w-10} y={h} fontSize=\"10\" fill=\"#FFB86B\" fontFamily={FB}>32</text>\n      <defs>\n        <linearGradient id=\"threadG\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\">\n          <stop offset=\"0%\" stopColor=\"rgba(255,184,107,0.3)\" /><stop offset=\"100%\" stopColor=\"#FFB86B\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n}\n\nfunction SeedToTree({ morphed }) {\n  return (\n    <svg viewBox=\"0 0 280 300\" style={{ width: \"100%\", maxWidth: 260 }}>\n      <ellipse cx=\"140\" cy=\"260\" rx={morphed ? 100 : 40} ry=\"8\" fill=\"rgba(107,255,184,0.1)\" style={{ transition: \"all 1.2s ease\" }} />\n      {!morphed ? (\n        <g>\n          <ellipse cx=\"140\" cy=\"240\" rx=\"14\" ry=\"10\" fill=\"#8B7B5B\" />\n          <ellipse cx=\"140\" cy=\"238\" rx=\"10\" ry=\"6\" fill=\"#A09070\" opacity=\"0.5\" />\n          <path d=\"M 140 230 Q 140 222 142 218\" stroke=\"#6BFFB8\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n          <ellipse cx=\"140\" cy=\"240\" rx=\"24\" ry=\"18\" fill=\"none\" stroke=\"#6BFFB8\" strokeWidth=\"0.5\" opacity=\"0.2\">\n            <animate attributeName=\"rx\" values=\"24;30;24\" dur=\"3s\" repeatCount=\"indefinite\" />\n          </ellipse>\n        </g>\n      ) : (\n        <g style={{ animation: \"riseUp 1.2s ease\" }}>\n          <path d=\"M 140 258 Q 138 200 140 140\" stroke=\"#6B8B5B\" strokeWidth=\"5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 180 Q 110 160 90 150\" stroke=\"#6B8B5B\" strokeWidth=\"3\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 180 Q 170 155 195 148\" stroke=\"#6B8B5B\" strokeWidth=\"3\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 155 Q 120 135 100 128\" stroke=\"#6B8B5B\" strokeWidth=\"2.5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 155 Q 165 130 180 125\" stroke=\"#6B8B5B\" strokeWidth=\"2.5\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 140 Q 130 120 125 108\" stroke=\"#6B8B5B\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n          <path d=\"M 140 140 Q 155 118 162 108\" stroke=\"#6B8B5B\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n          {[[90,145,22],[195,143,20],[100,122,18],[180,120,18],[125,102,16],[162,102,16],[140,90,20]].map(([cx,cy,r],i) => (\n            <circle key={i} cx={cx} cy={cy} r={r} fill={`rgba(107,255,184,${0.12+i*0.02})`}>\n              <animate attributeName=\"r\" values={`${r};${r+2};${r}`} dur={`${2.5+i*0.3}s`} repeatCount=\"indefinite\" />\n            </circle>\n          ))}\n          {[[95,140],[188,138],[105,118],[175,116],[130,98],[155,98],[140,85]].map(([x,y],i) => (\n            <circle key={i} cx={x} cy={y} r=\"2\" fill=\"#6BFFB8\" opacity=\"0.6\">\n              <animate attributeName=\"opacity\" values=\"0.3;0.8;0.3\" dur={`${1.5+i*0.4}s`} repeatCount=\"indefinite\" />\n            </circle>\n          ))}\n          <path d=\"M 136 258 Q 120 268 105 272\" stroke=\"#5B7B4B\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n          <path d=\"M 144 258 Q 160 268 175 272\" stroke=\"#5B7B4B\" strokeWidth=\"2\" fill=\"none\" opacity=\"0.5\" />\n        </g>\n      )}\n    </svg>\n  );\n}\n\nfunction SunriseViz() {\n  return (\n    <svg viewBox=\"0 0 320 200\" style={{ width: \"100%\", maxWidth: 320 }}>\n      <rect x=\"0\" y=\"0\" width=\"320\" height=\"200\" fill=\"url(#sky)\" rx=\"8\" />\n      <circle cx=\"160\" cy=\"110\" r=\"35\" fill=\"url(#sun)\">\n        <animate attributeName=\"cy\" values=\"110;95;110\" dur=\"6s\" repeatCount=\"indefinite\" />\n      </circle>\n      {[0,30,60,90,120,150,180,210,240,270,300,330].map((angle, i) => {\n        const rad = (angle * Math.PI) / 180;\n        const x1 = 160 + 42 * Math.cos(rad), y1 = 105 + 42 * Math.sin(rad);\n        const x2 = 160 + (55 + i%3*8) * Math.cos(rad), y2 = 105 + (55 + i%3*8) * Math.sin(rad);\n        return <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke=\"#FFD700\" strokeWidth=\"1.5\" opacity=\"0.3\" strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values=\"0.15;0.4;0.15\" dur={`${2+i*0.2}s`} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <line x1=\"0\" y1=\"145\" x2=\"320\" y2=\"145\" stroke=\"rgba(255,215,0,0.2)\" strokeWidth=\"1\" />\n      <ellipse cx=\"160\" cy=\"170\" rx=\"60\" ry=\"8\" fill=\"rgba(255,215,0,0.08)\" />\n      <defs>\n        <linearGradient id=\"sky\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n          <stop offset=\"0%\" stopColor=\"rgba(30,20,60,0.8)\" /><stop offset=\"50%\" stopColor=\"rgba(80,40,20,0.4)\" /><stop offset=\"100%\" stopColor=\"rgba(255,180,80,0.15)\" />\n        </linearGradient>\n        <radialGradient id=\"sun\"><stop offset=\"0%\" stopColor=\"#FFE44D\" /><stop offset=\"60%\" stopColor=\"#FFB830\" /><stop offset=\"100%\" stopColor=\"#FF8800\" /></radialGradient>\n      </defs>\n    </svg>\n  );\n}\n\n// \u2500\u2500 Archetype SVG Illustrations (all with morphed before/after) \u2500\u2500\n\nfunction ArchSisyphus({ morphed, color }) {\n  var c = color || \"#FFB86B\";\n  return <svg viewBox=\"0 0 280 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs>\n      <radialGradient id=\"bld\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.5\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.15\" /></radialGradient>\n      <linearGradient id=\"hill\" x1=\"0\" y1=\"1\" x2=\"1\" y2=\"0\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.05\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.15\" /></linearGradient>\n    </defs>\n    <path d=\"M 20 240 Q 140 60 260 240\" fill=\"url(#hill)\" stroke={c} strokeWidth=\"1\" opacity=\"0.3\" />\n    {!morphed ? (<g>\n      <circle cx=\"100\" cy=\"195\" r=\"30\" fill=\"url(#bld)\" stroke={c} strokeWidth=\"2\" opacity=\"0.7\">\n        <animate attributeName=\"cx\" values=\"100;105;100\" dur=\"2s\" repeatCount=\"indefinite\" />\n      </circle>\n      <line x1=\"100\" y1=\"210\" x2=\"85\" y2=\"230\" stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.4\" />\n      <line x1=\"100\" y1=\"210\" x2=\"115\" y2=\"232\" stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.4\" />\n      <circle cx=\"100\" cy=\"200\" r=\"7\" fill={c} opacity=\"0.2\" />\n      {[0,1,2].map(function(i) { return <circle key={i} cx={100} cy={195} r={38+i*8} fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity={0.08}>\n        <animate attributeName=\"r\" values={(38+i*8)+\";\"+(42+i*8)+\";\"+(38+i*8)} dur={(3+i)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      <circle cx=\"140\" cy=\"80\" r=\"30\" fill=\"url(#bld)\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.9\">\n        <animate attributeName=\"cy\" values=\"80;75;80\" dur=\"3s\" repeatCount=\"indefinite\" />\n      </circle>\n      <circle cx=\"140\" cy=\"80\" r=\"12\" fill={c} opacity=\"0.15\"><animate attributeName=\"r\" values=\"12;18;12\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      {[0,1,2,3,4,5].map(function(i) {\n        var a = i * 60 * Math.PI / 180; var x = 140 + Math.cos(a) * 45; var y = 80 + Math.sin(a) * 45;\n        return <circle key={i} cx={x} cy={y} r=\"3\" fill={c} opacity=\"0.5\">\n          <animate attributeName=\"opacity\" values=\"0.2;0.7;0.2\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <text x=\"140\" y=\"250\" textAnchor=\"middle\" fontSize=\"11\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.5\" letterSpacing=\"0.15em\">IT REACHED THE TOP</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchMagician({ morphed, color }) {\n  var c = color || \"#B86BFF\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><radialGradient id=\"mglow\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.4\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient></defs>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"140\" r=\"40\" fill=\"url(#mglow)\" opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"5\" fill={c} opacity=\"0.4\"><animate attributeName=\"r\" values=\"4;7;4\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,72,144,216,288].map(function(a,i) {\n        var rad = a * Math.PI / 180; var x = 140 + Math.cos(rad) * 55; var y = 140 + Math.sin(rad) * 55;\n        return <circle key={i} cx={x} cy={y} r=\"3\" fill={c} opacity=\"0.25\">\n          <animate attributeName=\"opacity\" values=\"0.1;0.4;0.1\" dur={(2+i*0.4)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <circle cx=\"140\" cy=\"140\" r=\"55\" fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity=\"0.1\" strokeDasharray=\"4 8\" />\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <circle cx=\"140\" cy=\"130\" r=\"65\" fill=\"url(#mglow)\"><animate attributeName=\"r\" values=\"60;70;60\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,45,90,135,180,225,270,315].map(function(a,i) {\n        var rad = a * Math.PI / 180; var r1 = 30; var r2 = 70;\n        return <line key={i} x1={140+Math.cos(rad)*r1} y1={130+Math.sin(rad)*r1} x2={140+Math.cos(rad)*r2} y2={130+Math.sin(rad)*r2}\n          stroke={c} strokeWidth=\"2\" strokeLinecap=\"round\" opacity=\"0.6\">\n          <animate attributeName=\"opacity\" values=\"0.3;0.8;0.3\" dur={(1.2+i*0.2)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      {[0,60,120,180,240,300].map(function(a,i) {\n        var rad = a * Math.PI / 180; var x = 140 + Math.cos(rad) * 50; var y = 130 + Math.sin(rad) * 50;\n        return <circle key={\"o\"+i} cx={x} cy={y} r=\"6\" fill={c} opacity=\"0.6\">\n          <animate attributeName=\"r\" values=\"4;8;4\" dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n          <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 140 130\" to=\"360 140 130\" dur=\"20s\" repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <circle cx=\"140\" cy=\"130\" r=\"12\" fill={c} opacity=\"0.7\"><animate attributeName=\"r\" values=\"10;15;10\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchThreshold({ morphed, color }) {\n  var c = color || \"#FFD700\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      <rect x=\"90\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.2\" />\n      <rect x=\"178\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.2\" />\n      <path d=\"M 96 46 Q 140 22 184 46\" fill=\"none\" stroke={c} strokeWidth=\"1.5\" opacity=\"0.2\" />\n      <rect x=\"102\" y=\"46\" width=\"76\" height=\"184\" rx=\"2\" fill={c} opacity=\"0.03\" stroke={c} strokeWidth=\"0.5\" strokeOpacity=\"0.08\" />\n      <circle cx=\"170\" cy=\"140\" r=\"4\" fill={c} opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"3\" fill={c} opacity=\"0.15\"><animate attributeName=\"opacity\" values=\"0.1;0.3;0.1\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <rect x=\"70\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.3\" />\n      <rect x=\"198\" y=\"40\" width=\"12\" height=\"190\" rx=\"6\" fill={c} opacity=\"0.3\" />\n      <path d=\"M 76 46 Q 140 22 204 46\" fill=\"none\" stroke={c} strokeWidth=\"2\" opacity=\"0.4\" />\n      <rect x=\"82\" y=\"46\" width=\"116\" height=\"184\" rx=\"2\" fill={c} opacity=\"0.06\" />\n      {[0,1,2,3,4,5,6].map(function(i) {\n        return <line key={i} x1=\"140\" y1={60+i*22} x2={140+(i%2===0?-1:1)*((i+1)*6)} y2={55+i*22} stroke={c} strokeWidth=\"1.5\" opacity={0.15+i*0.06} strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values={(0.1+i*0.05)+\";\"+(0.4+i*0.05)+\";\"+(0.1+i*0.05)} dur={(1+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <circle cx=\"140\" cy=\"140\" r=\"20\" fill={c} opacity=\"0.08\"><animate attributeName=\"r\" values=\"18;25;18\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.6\"><animate attributeName=\"opacity\" values=\"0.4;0.9;0.4\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <text x=\"140\" y=\"260\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">THE DOOR IS OPEN</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchTower({ morphed, color }) {\n  var c = color || \"#E84393\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><linearGradient id=\"twr\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.3\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.05\" /></linearGradient></defs>\n    {!morphed ? (<g>\n      <rect x=\"115\" y=\"40\" width=\"50\" height=\"180\" rx=\"4\" fill=\"url(#twr)\" stroke={c} strokeWidth=\"1\" opacity=\"0.6\" />\n      {[0,1,2,3,4,5].map(function(i) { return <line key={i} x1=\"120\" y1={55+i*28} x2=\"160\" y2={55+i*28} stroke={c} strokeWidth=\"0.7\" opacity=\"0.15\" />; })}\n      <line x1=\"130\" y1=\"38\" x2=\"150\" y2=\"38\" stroke={c} strokeWidth=\"2\" opacity=\"0.3\" />\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.15\"><animate attributeName=\"opacity\" values=\"0.1;0.25;0.1\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 0.6s ease\" }}>\n      <rect x=\"115\" y=\"40\" width=\"50\" height=\"180\" rx=\"4\" fill=\"url(#twr)\" opacity=\"0.2\" />\n      {[0,1,2,3,4,5,6,7].map(function(i) {\n        var x = 110 + Math.random() * 60; var y = 50 + i * 22; var rot = -30 + Math.random() * 60; var dx = (Math.random()-0.5)*40;\n        return <rect key={\"f\"+i} x={x} y={y} width={6+Math.random()*8} height={4+Math.random()*6} rx=\"1\" fill={c} opacity=\"0.25\"\n          transform={\"rotate(\"+rot+\" \"+x+\" \"+y+\")\"}>\n          <animate attributeName=\"x\" values={x+\";\"+String(x+dx)+\";\"+(x+dx*1.5)} dur={(2+i*0.3)+\"s\"} fill=\"freeze\" />\n          <animate attributeName=\"opacity\" values=\"0.3;0.15;0.05\" dur={(2+i*0.3)+\"s\"} fill=\"freeze\" />\n        </rect>;\n      })}\n      {[0,1,2].map(function(i) { return <circle key={\"sp\"+i} cx={120+i*20} cy={230-i*10} r=\"3\" fill={c} opacity=\"0.4\">\n        <animate attributeName=\"cy\" values={(230-i*10)+\";\"+(240-i*10)+\";\"+(230-i*10)} dur={(2+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <line x1=\"115\" y1=\"220\" x2=\"165\" y2=\"220\" stroke={c} strokeWidth=\"1\" opacity=\"0.2\" />\n      <circle cx=\"140\" cy=\"240\" r=\"8\" fill={c} opacity=\"0.2\"><animate attributeName=\"r\" values=\"6;12;6\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"240\" r=\"3\" fill={c} opacity=\"0.6\"><animate attributeName=\"opacity\" values=\"0.4;0.8;0.4\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <text x=\"140\" y=\"270\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">WHAT REMAINS IS REAL</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchDescent({ morphed, color }) {\n  var c = color || \"#6BB8FF\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs><radialGradient id=\"cave\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.02\" /><stop offset=\"80%\" stopColor={c} stopOpacity=\"0.08\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient></defs>\n    <path d=\"M 60 80 Q 70 180 140 230 Q 210 180 220 80\" fill=\"url(#cave)\" stroke={c} strokeWidth=\"1\" opacity=\"0.15\" />\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"50\" r=\"6\" fill={c} opacity=\"0.5\" />\n      <circle cx=\"140\" cy=\"50\" r=\"12\" fill=\"none\" stroke={c} strokeWidth=\"0.5\" opacity=\"0.2\" />\n      {[0,1,2].map(function(i) { return <circle key={i} cx={140} cy={80+i*35} r=\"2\" fill={c} opacity={0.3-i*0.08}>\n        <animate attributeName=\"opacity\" values={(0.15-i*0.04)+\";\"+(0.35-i*0.04)+\";\"+(0.15-i*0.04)} dur={(2+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <text x=\"140\" y=\"270\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.25\" letterSpacing=\"0.15em\">GOING DOWN</text>\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      {[0,1,2,3,4].map(function(i) { return <circle key={i} cx={140} cy={60+i*35} r=\"2\" fill={c} opacity={0.1+i*0.05}>\n        <animate attributeName=\"opacity\" values={(0.05+i*0.03)+\";\"+(0.2+i*0.05)+\";\"+(0.05+i*0.03)} dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <circle cx=\"140\" cy=\"210\" r=\"25\" fill={c} opacity=\"0.06\"><animate attributeName=\"r\" values=\"22;30;22\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"210\" r=\"10\" fill={c} opacity=\"0.15\"><animate attributeName=\"r\" values=\"8;14;8\" dur=\"2.5s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"210\" r=\"4\" fill={c} opacity=\"0.7\"><animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.5s\" repeatCount=\"indefinite\" /></circle>\n      {[0,1,2,3,4,5].map(function(i) {\n        var a = i * 60 * Math.PI / 180; return <line key={\"r\"+i} x1={140+Math.cos(a)*15} y1={210+Math.sin(a)*15} x2={140+Math.cos(a)*35} y2={210+Math.sin(a)*35}\n          stroke={c} strokeWidth=\"1\" opacity=\"0.2\" strokeLinecap=\"round\">\n          <animate attributeName=\"opacity\" values=\"0.1;0.35;0.1\" dur={(1.8+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n        </line>;\n      })}\n      <text x=\"140\" y=\"268\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.5\" letterSpacing=\"0.15em\">FOUND SOMETHING</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchWeaver({ morphed, color }) {\n  var c = color || \"#7DB7AE\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      {[0,1,2,3,4,5].map(function(i) {\n        var y = 50 + i * 35;\n        return <path key={i} d={\"M 50 \"+y+\" Q \"+(100+(i%2===0?-20:20))+\" \"+(y+15)+\" 140 \"+y+\" Q \"+(180+(i%2===0?20:-20))+\" \"+(y+15)+\" 230 \"+y}\n          fill=\"none\" stroke={c} strokeWidth=\"1\" opacity=\"0.15\" strokeLinecap=\"round\" />;\n      })}\n      {[0,1,2].map(function(i) { return <circle key={i} cx={90+i*50} cy={100+i*25} r=\"2\" fill={c} opacity=\"0.2\" />; })}\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      {[0,1,2,3,4,5,6].map(function(i) {\n        var y = 40 + i * 30;\n        return <path key={i} d={\"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y}\n          fill=\"none\" stroke={c} strokeWidth={1.5+i*0.15} opacity={0.15+i*0.06} strokeLinecap=\"round\">\n          <animate attributeName=\"d\" values={\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y+\";\"+\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-20:20))+\" \"+(y+(i%2===0?-16:16))+\" 140 \"+(y+2)+\" Q \"+(185+(i%2===0?20:-20))+\" \"+(y+(i%2===0?16:-16))+\" 230 \"+y+\";\"+\n            \"M 50 \"+y+\" Q \"+(95+(i%2===0?-15:15))+\" \"+(y+(i%2===0?-12:12))+\" 140 \"+y+\" Q \"+(185+(i%2===0?15:-15))+\" \"+(y+(i%2===0?12:-12))+\" 230 \"+y\n          } dur={(4+i*0.5)+\"s\"} repeatCount=\"indefinite\" />\n        </path>;\n      })}\n      {[0,1,2,3,4].map(function(i) {\n        return <circle key={\"kn\"+i} cx={70+i*40} cy={60+i*35+(i%2===0?0:15)} r={3+i*0.5} fill={c} opacity={0.3+i*0.08}>\n          <animate attributeName=\"opacity\" values={(0.2+i*0.05)+\";\"+(0.6+i*0.05)+\";\"+(0.2+i*0.05)} dur={(1.5+i*0.4)+\"s\"} repeatCount=\"indefinite\" />\n        </circle>;\n      })}\n      <text x=\"140\" y=\"268\" textAnchor=\"middle\" fontSize=\"10\" fill={c} fontFamily=\"DM Sans\" opacity=\"0.4\" letterSpacing=\"0.15em\">THE PATTERN HOLDS</text>\n    </g>)}\n  </svg>;\n}\n\nfunction ArchPlanets({ morphed, color }) {\n  var c = color || \"#FFD700\";\n  var orbits = [{r:35,s:8,d:10,col:c},{r:60,s:5,d:16,col:\"#6BB8FF\"},{r:85,s:6,d:24,col:\"#FF6B9D\"},{r:110,s:4,d:35,col:\"#6BFFB8\"}];\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"140\" r=\"6\" fill={c} opacity=\"0.3\" />\n      {orbits.map(function(o,i) { return <g key={i}>\n        <circle cx=\"140\" cy=\"140\" r={o.r} fill=\"none\" stroke={o.col} strokeWidth=\"0.5\" opacity=\"0.08\" strokeDasharray=\"4 8\" />\n        <circle cx={140+o.r} cy=\"140\" r={o.s*0.6} fill={o.col} opacity=\"0.2\" />\n      </g>; })}\n    </g>) : (<g style={{ animation: \"riseUp 0.8s ease\" }}>\n      <circle cx=\"140\" cy=\"140\" r=\"10\" fill={c} opacity=\"0.6\"><animate attributeName=\"r\" values=\"8;12;8\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      <circle cx=\"140\" cy=\"140\" r=\"20\" fill={c} opacity=\"0.08\"><animate attributeName=\"r\" values=\"18;25;18\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n      {orbits.map(function(o,i) { return <g key={i}>\n        <circle cx=\"140\" cy=\"140\" r={o.r} fill=\"none\" stroke={o.col} strokeWidth=\"0.8\" opacity=\"0.15\" />\n        <circle cx={140+o.r} cy=\"140\" r={o.s} fill={o.col} opacity=\"0.6\">\n          <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 140 140\" to=\"360 140 140\" dur={o.d+\"s\"} repeatCount=\"indefinite\" />\n          <animate attributeName=\"r\" values={o.s+\";\"+(o.s+2)+\";\"+o.s} dur=\"2s\" repeatCount=\"indefinite\" />\n        </circle>\n      </g>; })}\n    </g>)}\n  </svg>;\n}\n\nfunction ArchPhoenix({ morphed, color }) {\n  var c = color || \"#E84393\";\n  return <svg viewBox=\"0 0 280 280\" style={{ width: \"100%\", maxWidth: 240 }}>\n    <defs>\n      <radialGradient id=\"pfire\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.4\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0\" /></radialGradient>\n      <linearGradient id=\"pfeath\" x1=\"0\" y1=\"1\" x2=\"0\" y2=\"0\"><stop offset=\"0%\" stopColor={c} stopOpacity=\"0.1\" /><stop offset=\"100%\" stopColor={c} stopOpacity=\"0.5\" /></linearGradient>\n    </defs>\n    {!morphed ? (<g>\n      <circle cx=\"140\" cy=\"210\" r=\"25\" fill=\"url(#pfire)\" opacity=\"0.3\" />\n      {[0,1,2,3,4].map(function(i) { var x = 120 + i * 10; return <line key={i} x1={x} y1=\"210\" x2={x} y2={200-i*2} stroke={c} strokeWidth=\"1\" opacity={0.1+i*0.03}>\n        <animate attributeName=\"y2\" values={(200-i*2)+\";\"+(195-i*3)+\";\"+(200-i*2)} dur={(1.5+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </line>; })}\n      <circle cx=\"140\" cy=\"210\" r=\"8\" fill={c} opacity=\"0.15\" />\n      <circle cx=\"140\" cy=\"210\" r=\"3\" fill={c} opacity=\"0.3\"><animate attributeName=\"opacity\" values=\"0.2;0.5;0.2\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n    </g>) : (<g style={{ animation: \"riseUp 1s ease\" }}>\n      <circle cx=\"140\" cy=\"180\" r=\"45\" fill=\"url(#pfire)\"><animate attributeName=\"r\" values=\"40;50;40\" dur=\"2s\" repeatCount=\"indefinite\" /></circle>\n      <path d=\"M 140 170 Q 80 120 60 80\" fill=\"none\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.6\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 140 170 Q 80 120 60 80;M 140 160 Q 75 105 50 60;M 140 170 Q 80 120 60 80\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      <path d=\"M 140 170 Q 200 120 220 80\" fill=\"none\" stroke={c} strokeWidth=\"2.5\" opacity=\"0.6\" strokeLinecap=\"round\">\n        <animate attributeName=\"d\" values=\"M 140 170 Q 200 120 220 80;M 140 160 Q 205 105 230 60;M 140 170 Q 200 120 220 80\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      <path d=\"M 110 130 Q 125 80 140 50 Q 155 80 170 130\" fill=\"url(#pfeath)\" stroke={c} strokeWidth=\"1.5\" opacity=\"0.7\">\n        <animate attributeName=\"d\" values=\"M 110 130 Q 125 80 140 50 Q 155 80 170 130;M 105 125 Q 122 70 140 40 Q 158 70 175 125;M 110 130 Q 125 80 140 50 Q 155 80 170 130\" dur=\"2.5s\" repeatCount=\"indefinite\" />\n      </path>\n      {[0,1,2,3].map(function(i) { var x = 125+i*10; return <circle key={i} cx={x} cy={100+i*15} r={2+i} fill={c} opacity={0.3+i*0.1}>\n        <animate attributeName=\"opacity\" values={(0.2+i*0.1)+\";\"+(0.6+i*0.1)+\";\"+(0.2+i*0.1)} dur={(1+i*0.3)+\"s\"} repeatCount=\"indefinite\" />\n      </circle>; })}\n      <circle cx=\"140\" cy=\"65\" r=\"6\" fill={c} opacity=\"0.8\"><animate attributeName=\"opacity\" values=\"0.5;1;0.5\" dur=\"1.2s\" repeatCount=\"indefinite\" /></circle>\n    </g>)}\n  </svg>;\n}\n\n// Archetype registry \u2014 Viz components all take { morphed, color }\nvar ARCH_REGISTRY = {\n  chrysalis: { name: \"Imaginal Cells\", icon: \"\ud83e\udd8b\", color: \"#4ae88a\", bg: \"linear-gradient(160deg, #0D1A12 0%, #1a3a2a 40%, #4ae88a44 100%)\",\n    phases: { consuming: \"Still building mass. The hunger is the work.\", dissolving: \"The old form can't hold. Dissolution IS the work.\", clustering: \"Imaginal cells found each other. Something coherent forming.\", emergence: \"Wings taking shape. The caterpillar wouldn't recognize what's coming.\" },\n    Viz: ChrysalisButterfly },\n  tower: { name: \"The Tower\", icon: \"\ud83d\uddfc\", color: \"#ff8a3a\", bg: \"linear-gradient(160deg, #1A0D06 0%, #3a1a08 40%, #ff8a3a44 100%)\",\n    phases: { trembling: \"Cracks showing. Something isn't as solid as you believed.\", falling: \"Coming down. Let it fall. Can't hold what wasn't real.\", rubble: \"Standing in the aftermath. Clearest view you've had.\", clearing: \"Ground is bare. Now you can build on what's real.\" },\n    Viz: ArchTower },\n  kintsugi: { name: \"Kintsugi\", icon: \"\u2726\", color: \"#e8b830\", bg: \"linear-gradient(160deg, #1A1408 0%, #2a2010 40%, #e8b83044 100%)\",\n    phases: { breaking: \"Something broke. The instinct is to hide the crack. Don't.\", holding: \"Looking at the pieces. Not fixing yet \u2014 just seeing.\", filling: \"Gold poured into the break. The repair is the art.\", whole: \"More beautiful than before it shattered. The scar shines.\" },\n    Viz: ArchMagician },\n  dark_night: { name: \"Dark Night\", icon: \"\ud83c\udf11\", color: \"#9070d0\", bg: \"linear-gradient(160deg, #0D0A18 0%, #14102a 40%, #9070d044 100%)\",\n    phases: { trigger: \"Old framework shattered. What made sense doesn't anymore.\", crisis: \"Everything questioned. Who are you if not what you believed?\", transformation: \"In the wreckage, a different way of seeing emerges.\", emergence: \"Old meaning gone. Something deeper replaced it.\" },\n    Viz: ArchMagician },\n  persephone: { name: \"Persephone\", icon: \"\ud83c\udf3a\", color: \"#c070f0\", bg: \"linear-gradient(160deg, #0D0618 0%, #2a1040 40%, #c070f044 100%)\",\n    phases: { descending: \"Something pulled you under. Not punishment \u2014 initiation.\", underworld: \"Learning the rules of a realm you didn't choose.\", pomegranate: \"Ate the seeds. Can't unknow it. The wound became wisdom.\", returning: \"Not the maiden anymore. The queen.\" },\n    Viz: ArchThreshold },\n  phoenix: { name: \"The Phoenix\", icon: \"\ud83d\udd25\", color: \"#ff5030\", bg: \"linear-gradient(160deg, #1A0606 0%, #3a0a08 40%, #ff503044 100%)\",\n    phases: { burning: \"Let it burn. Not everything survives this version of you.\", ash: \"What's left is what was always real.\", stirring: \"Movement in the ash. Not repetition \u2014 reinvention.\", rising: \"Airborne again. Same matter, utterly reconfigured.\" },\n    Viz: ArchTower },\n  hermit: { name: \"The Hermit\", icon: \"\ud83c\udfee\", color: \"#f0c860\", bg: \"linear-gradient(160deg, #0D0C10 0%, #1a1820 40%, #f0c86044 100%)\",\n    phases: { withdrawing: \"Stepped away. Something needs quiet.\", listening: \"A signal getting clearer.\", seeing: \"The lamp illuminates what was always there.\", returning: \"Carrying the light back.\" },\n    Viz: SeedToTree },\n  sisyphus: { name: \"Sisyphus\", icon: \"\ud83e\udea8\", color: \"#c0a078\", bg: \"linear-gradient(160deg, #0D0B08 0%, #201c18 40%, #c0a07844 100%)\",\n    phases: { pushing: \"Same weight. Same hill. Something in your grip changed.\", rolling_back: \"Came down again. What do you notice on the walk back?\", pausing: \"Stopped mid-slope. Choosing to feel it.\", meaning: \"Boulder didn't get lighter. You got stronger.\" },\n    Viz: ArchSisyphus },\n  magician: { name: \"The Magician\", icon: \"\u2727\", color: \"#a060ff\", bg: \"linear-gradient(160deg, #0D0818 0%, #1c1030 40%, #a060ff44 100%)\",\n    phases: { awakening: \"Realizing you have the tools. Always there.\", practicing: \"Testing what transforms.\", transforming: \"The transmutation is happening.\", mastery: \"Seeing what's possible in what already exists.\" },\n    Viz: ArchMagician },\n  lover: { name: \"The Lover\", icon: \"\ud83d\udc97\", color: \"#ff6090\", bg: \"linear-gradient(160deg, #1A0810 0%, #2a1020 40%, #ff609044 100%)\",\n    phases: { guarding: \"Walls keeping out more than danger.\", opening: \"A crack in the armor. The bravest thing.\", feeling: \"Letting it all in.\", merging: \"Connection isn't losing yourself.\" },\n    Viz: ChrysalisButterfly },\n  star: { name: \"The Star\", icon: \"\u2b50\", color: \"#50c0ff\", bg: \"linear-gradient(160deg, #060C18 0%, #0c1830 40%, #50c0ff44 100%)\",\n    phases: { darkness: \"Dark. But a point of light you haven't noticed.\", glimmer: \"Hope isn't optimism. It's stubbornness.\", pouring: \"Quietly tending what's left.\", shining: \"Effortless, steady, real.\" },\n    Viz: SeedToTree },\n  threshold: { name: \"The Threshold\", icon: \"\ud83d\udeaa\", color: \"#b8a880\", bg: \"linear-gradient(160deg, #0D0D0A 0%, #181814 40%, #b8a88044 100%)\",\n    phases: { approaching: \"Edge of something. The old room shrinking.\", standing: \"At the door. Not through yet.\", crossing: \"One foot on each side.\", arrived: \"Other side. The room is bigger.\" },\n    Viz: ArchThreshold },\n  weaver: { name: \"The Weaver\", icon: \"\ud83d\udd78\", color: \"#a080c0\", bg: \"linear-gradient(160deg, #0D0A10 0%, #1a1420 40%, #a080c044 100%)\",\n    phases: { gathering: \"Threads from different parts collecting.\", seeing: \"A pattern emerging.\", weaving: \"Actively connecting them.\", wearing: \"The pattern is complete enough to wear.\" },\n    Viz: ArchMagician },\n  tree: { name: \"The Tree\", icon: \"\ud83c\udf33\", color: \"#6BFFB8\", bg: \"linear-gradient(160deg, #0A1A12 0%, #0D2E1A 40%, #6BFFB844 100%)\",\n    phases: { seed: \"Something planted.\", roots: \"Going deep before going up.\", growing: \"Slow, steady expansion.\", canopy: \"The patience paid off.\" },\n    Viz: SeedToTree },\n  descent: { name: \"The Descent\", icon: \"\u2b07\", color: \"#6BB8FF\", bg: \"linear-gradient(160deg, #060C1A 0%, #0D1A2E 40%, #6BB8FF44 100%)\",\n    phases: { approaching: \"Edge of the underworld.\", entering: \"Going under.\", depths: \"In the deepest place.\", returning: \"Rising with what you found.\" },\n    Viz: ArchThreshold },\n  planets: { name: \"Forces in Orbit\", icon: \"\ud83e\ude90\", color: \"#FFB86B\", bg: \"linear-gradient(160deg, #1A120A 0%, #2E1A0D 40%, #FFB86B44 100%)\",\n    phases: { approaching: \"Forces circling.\", conjunction: \"Aligned.\", opposition: \"Pulling apart.\", integration: \"New orbit.\" },\n    Viz: ArchSisyphus },\n};\n\n// \u2500\u2500 Field Tiny Components \u2500\u2500\n\nfunction FC({ children }) {\n  return <div style={{ display:\"flex\", flexDirection:\"column\", justifyContent:\"center\", alignItems:\"center\", height:\"100%\", padding:\"60px 28px\", textAlign:\"center\", position:\"relative\" }}>{children}</div>;\n}\nfunction FLabel({ color, children }) {\n  return <div style={{ fontSize:12, letterSpacing:\"0.35em\", fontWeight:600, color, marginBottom:24, fontFamily:FB, zIndex:1 }}>{children}</div>;\n}\nfunction FHero({ size=42, color=\"white\", children }) {\n  return <h1 style={{ fontSize:size, fontWeight:400, lineHeight:1.15, margin:0, color, fontFamily:FD, fontStyle:\"italic\", zIndex:1 }}>{children}</h1>;\n}\nfunction FBody({ color, style={}, children }) {\n  return <p style={{ fontSize:20, margin:0, lineHeight:1.5, fontFamily:FD, fontStyle:\"italic\", color, zIndex:1, ...style }}>{children}</p>;\n}\nfunction FTap({ color, children }) {\n  return <div style={{ fontSize:15, marginTop:24, fontFamily:FB, color, opacity:0.7, zIndex:1 }}>{children}</div>;\n}\nfunction FOrb({ color, children }) {\n  return <div style={{ width:72, height:72, borderRadius:\"50%\", background:`${color}22`, border:`2px solid ${color}55`, display:\"flex\", alignItems:\"center\", justifyContent:\"center\", fontSize:14, color, fontFamily:FB, fontWeight:500 }}>{children}</div>;\n}\n\nfunction DataPortrait({ themes }) {\n  var rings = (themes || []).slice(0, 7).map(function(t, i) {\n    var base = 110 - i * 16;\n    return { r: Math.max(16, base), color: t.color || NC[i % NC.length], width: 2 + (t.weight || 1) * 0.8, dash: [8, 12, 4, 20, 6, 14][i % 6] + \" \" + [4, 8, 12, 4, 10, 6][i % 6], speed: 30 + i * 12 };\n  });\n  return <svg viewBox=\"0 0 260 260\" style={{ width: \"100%\", maxWidth: 240 }}>\n    {rings.map(function(ring, i) {\n      return <circle key={i} cx=\"130\" cy=\"130\" r={ring.r} fill=\"none\" stroke={ring.color} strokeWidth={ring.width} strokeDasharray={ring.dash} strokeLinecap=\"round\" opacity=\"0.7\">\n        <animateTransform attributeName=\"transform\" type=\"rotate\" from=\"0 130 130\" to={(i%2===0?\"360\":\"-360\")+\" 130 130\"} dur={ring.speed+\"s\"} repeatCount=\"indefinite\" />\n      </circle>;\n    })}\n    <circle cx=\"130\" cy=\"130\" r=\"6\" fill=\"white\" opacity=\"0.8\" />\n    <circle cx=\"130\" cy=\"130\" r=\"12\" fill=\"none\" stroke=\"white\" strokeWidth=\"0.5\" opacity=\"0.3\"><animate attributeName=\"r\" values=\"12;18;12\" dur=\"3s\" repeatCount=\"indefinite\" /></circle>\n  </svg>;\n}\n\n// \u2500\u2500 Session Storage (Enhanced for cross-session tracking) \u2500\u2500\nfunction saveSession(data) {\n  try {\n    var sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n    var themes = (data.themes || []).slice(0, 5).map(function(t) { return { label: t.label, weight: t.weight || 1 }; });\n    var avgWeight = themes.length > 0 ? themes.reduce(function(s, t) { return s + t.weight; }, 0) / themes.length : 0;\n    sessions.push({\n      date: new Date().toISOString(),\n      archetypes: (data.archetypes || []).map(function(a) { return { key: a.key, phase: a.phase || \"\", title: a.title || \"\" }; }),\n      themes: themes,\n      mapTitle: data.map_title || \"\",\n      synthesis: (data.synthesis || \"\").slice(0, 120),\n      tension: data.tension ? { a: data.tension.a, b: data.tension.b } : null,\n      intensity: Math.round(avgWeight * 20) / 10 // 0-10 scale\n    });\n    if (sessions.length > 50) sessions = sessions.slice(-50);\n    localStorage.setItem(\"saycrd-sessions\", JSON.stringify(sessions));\n    console.log(\"[SAYCRD] Session saved. Total sessions:\", sessions.length);\n  } catch (e) { console.error(\"[SAYCRD] Save error:\", e); }\n}\nfunction loadSessions() { try { return JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\"); } catch (e) { return []; } }\nfunction getArchetypeHistory() {\n  var sessions = loadSessions(); var counts = {};\n  sessions.forEach(function(s) {\n    (s.archetypes || []).forEach(function(a) {\n      var key = typeof a === \"string\" ? a : a.key;\n      counts[key] = (counts[key] || 0) + 1;\n    });\n  });\n  return counts;\n}\nfunction getThemeHistory() {\n  var sessions = loadSessions();\n  var themeMap = {};\n  sessions.forEach(function(s, si) {\n    (s.themes || []).forEach(function(t) {\n      var k = (t.label || \"\").toLowerCase().trim();\n      if (!k) return;\n      if (!themeMap[k]) themeMap[k] = { label: t.label, appearances: [] };\n      themeMap[k].appearances.push({ session: si, weight: t.weight || 1, date: s.date });\n    });\n  });\n  return themeMap;\n}\nfunction getSessionTimeline() {\n  var sessions = loadSessions();\n  return sessions.map(function(s, i) {\n    var archs = (s.archetypes || []).map(function(a) { return typeof a === \"string\" ? a : a.key; });\n    return { index: i, date: s.date, archetypes: archs, intensity: s.intensity || 0, mapTitle: s.mapTitle || \"\", themes: s.themes || [] };\n  });\n}\n\n// Archetype evolution messages \u2014 what to say on 1st, 2nd, 3rd+ visits\nvar ARCH_EVOLUTION = {\n  chrysalis: [\"Something is dissolving. You're in the space between.\", \"The chrysalis recognizes you. Deeper this time.\", \"You keep returning to transformation. The dissolving IS the work.\"],\n  tower: [\"Something is falling apart. Look at what's revealed.\", \"The tower visits again. What's built on false ground?\", \"You keep outgrowing structures. The collapse is graduation.\"],\n  kintsugi: [\"Something broke. The gold is coming.\", \"You've broken before. The repairs keep getting more beautiful.\", \"The cracks are your signature now.\"],\n  dark_night: [\"The old meaning dissolved. Stay in the dark.\", \"This darkness knows you. It's deeper this time.\", \"Each dark night strips another false floor.\"],\n  persephone: [\"Descending. Not punishment \u2014 initiation.\", \"The underworld recognizes you. You've been here.\", \"Queen of both worlds now. The descent is home.\"],\n  phoenix: [\"Burning. What survives is real.\", \"You've burned before. The rising gets faster.\", \"Fire is your element. Each version is truer.\"],\n  hermit: [\"Withdrew to hear something. Listen.\", \"The lamp is brighter. You've been here before.\", \"Solitude is your workshop now.\"],\n  sisyphus: [\"Same weight. Your grip is changing.\", \"The boulder knows your hands. What's different this time?\", \"You and the weight have an understanding now.\"],\n  magician: [\"Tools awakening. Watch what transforms.\", \"Your transmutation skills are growing.\", \"Lead into gold. You make it look easy now.\"],\n  lover: [\"The armor cracked. Let it.\", \"Opening wider. The terror and tenderness together.\", \"Vulnerability became your superpower.\"],\n  star: [\"Light in the dark. Notice it.\", \"You keep finding light. That's not luck.\", \"You ARE the light now. Steady, real.\"],\n  threshold: [\"Standing at the door.\", \"You've crossed thresholds before. This one's familiar.\", \"Doorways are your natural habitat.\"],\n  weaver: [\"Threads connecting.\", \"The pattern is getting clearer with each session.\", \"Master weaver. Seeing what others can't.\"],\n  tree: [\"Growth happening underground.\", \"Roots before branches \u2014 the tree grows in you.\", \"The patience IS the power.\"],\n  descent: [\"Going under. Treasure is down there.\", \"You've descended before. Faster each time.\", \"The underworld gives up its secrets to you.\"],\n  planets: [\"Forces in orbit around you.\", \"The cycles are getting familiar.\", \"You ride these forces now.\"],\n};\n\nvar FIELD_ALCHEMY = {\n  nigredo: { label: \"Nigredo\", sub: \"The Blackening\", season: \"Autumn\", color: \"#888\", bg: \"linear-gradient(160deg, #0D0A10 0%, #1a1018 40%, #44405030 100%)\" },\n  albedo: { label: \"Albedo\", sub: \"The Whitening\", season: \"Winter\", color: \"#e0e8f0\", bg: \"linear-gradient(160deg, #101418 0%, #1c2028 40%, #c0c8d030 100%)\" },\n  citrinitas: { label: \"Citrinitas\", sub: \"The Yellowing\", season: \"Spring\", color: \"#f0c840\", bg: \"linear-gradient(160deg, #141008 0%, #2a2010 40%, #d4a83030 100%)\" },\n  rubedo: { label: \"Rubedo\", sub: \"The Reddening\", season: \"Summer\", color: \"#ff5040\", bg: \"linear-gradient(160deg, #1A0608 0%, #2a0c10 40%, #cc303030 100%)\" },\n};\n\n\n// \u2500\u2500 Cross-Session Visualizations \u2500\u2500\n\nfunction JourneyRiver({ timeline, currentArchetypes }) {\n  // Shows archetype appearances across sessions as a flowing river\n  var sessions = timeline || [];\n  var totalSessions = sessions.length;\n  if (totalSessions < 2) return null;\n\n  var w = 300, h = 200, pad = 20;\n  var usable = w - pad * 2;\n  var maxShow = Math.min(totalSessions, 12);\n  var recent = sessions.slice(-maxShow);\n  var step = usable / Math.max(maxShow - 1, 1);\n\n  // Build river path from intensity\n  var points = recent.map(function(s, i) {\n    var x = pad + i * step;\n    var y = h * 0.5 - (s.intensity || 3) * 8;\n    return { x: x, y: Math.max(30, Math.min(h - 40, y)), archetypes: s.archetypes || [], intensity: s.intensity || 0 };\n  });\n\n  // Smooth curve path\n  var pathD = points.map(function(p, i) {\n    if (i === 0) return \"M \" + p.x + \" \" + p.y;\n    var prev = points[i - 1];\n    var cx = (prev.x + p.x) / 2;\n    return \"C \" + cx + \" \" + prev.y + \" \" + cx + \" \" + p.y + \" \" + p.x + \" \" + p.y;\n  }).join(\" \");\n\n  // Width river (thicker = more intense)\n  var pathD2 = points.map(function(p, i) {\n    var y2 = p.y + 12 + (p.intensity || 0) * 3;\n    if (i === 0) return \"M \" + p.x + \" \" + y2;\n    var prev = points[i - 1];\n    var prevY2 = prev.y + 12 + (prev.intensity || 0) * 3;\n    var cx = (prev.x + p.x) / 2;\n    return \"C \" + cx + \" \" + prevY2 + \" \" + cx + \" \" + y2 + \" \" + p.x + \" \" + y2;\n  }).join(\" \");\n\n  return React.createElement(\"svg\", { viewBox: \"0 0 \" + w + \" \" + h, style: { width: \"100%\", maxWidth: 300 } }, [\n    React.createElement(\"defs\", { key: \"defs\" }, [\n      React.createElement(\"linearGradient\", { key: \"rg\", id: \"riverGrad\", x1: \"0\", y1: \"0\", x2: \"1\", y2: \"0\" }, [\n        React.createElement(\"stop\", { key: \"s0\", offset: \"0%\", stopColor: \"rgba(107,255,184,0.1)\" }),\n        React.createElement(\"stop\", { key: \"s1\", offset: \"100%\", stopColor: \"#6BFFB8\" })\n      ])\n    ]),\n    // River body\n    React.createElement(\"path\", { key: \"river-top\", d: pathD, fill: \"none\", stroke: \"url(#riverGrad)\", strokeWidth: \"2.5\", strokeLinecap: \"round\", opacity: \"0.8\" }),\n    React.createElement(\"path\", { key: \"river-bot\", d: pathD2, fill: \"none\", stroke: \"url(#riverGrad)\", strokeWidth: \"1\", strokeLinecap: \"round\", opacity: \"0.3\" }),\n    // Fill between\n    React.createElement(\"path\", { key: \"river-fill\", d: pathD + \" \" + points.slice().reverse().map(function(p, i) {\n      var y2 = p.y + 12 + (p.intensity || 0) * 3;\n      return (i === 0 ? \"L \" : \"L \") + p.x + \" \" + y2;\n    }).join(\" \") + \" Z\", fill: \"rgba(107,255,184,0.04)\", stroke: \"none\" }),\n    // Session dots with archetype colors\n  ].concat(points.map(function(p, i) {\n    var archs = p.archetypes || [];\n    var isLast = i === points.length - 1;\n    var mainColor = \"#6BFFB8\";\n    if (archs.length > 0 && ARCH_REGISTRY[archs[0]]) mainColor = ARCH_REGISTRY[archs[0]].color;\n    return React.createElement(\"g\", { key: \"dot-\" + i }, [\n      React.createElement(\"circle\", { key: \"c\", cx: p.x, cy: p.y, r: isLast ? 6 : 3.5, fill: mainColor, opacity: isLast ? 0.9 : 0.4 + i * 0.04 }),\n      isLast ? React.createElement(\"circle\", { key: \"pulse\", cx: p.x, cy: p.y, r: \"10\", fill: \"none\", stroke: mainColor, strokeWidth: \"1\", opacity: \"0.3\", children: [\n        React.createElement(\"animate\", { key: \"a\", attributeName: \"r\", values: \"8;14;8\", dur: \"2s\", repeatCount: \"indefinite\" }),\n        React.createElement(\"animate\", { key: \"b\", attributeName: \"opacity\", values: \"0.3;0.1;0.3\", dur: \"2s\", repeatCount: \"indefinite\" })\n      ]}) : null,\n      archs.length > 1 && ARCH_REGISTRY[archs[1]] ? React.createElement(\"circle\", { key: \"c2\", cx: p.x + 6, cy: p.y - 5, r: 2.5, fill: ARCH_REGISTRY[archs[1]].color, opacity: 0.5 }) : null,\n    ]);\n  })).concat([\n    // Labels\n    React.createElement(\"text\", { key: \"lbl-start\", x: pad, y: h - 8, fontSize: \"9\", fill: \"rgba(255,255,255,0.2)\", fontFamily: FB }, totalSessions > maxShow ? \"...\" + (totalSessions - maxShow + 1) : \"1\"),\n    React.createElement(\"text\", { key: \"lbl-end\", x: w - pad, y: h - 8, fontSize: \"9\", fill: \"#6BFFB8\", fontFamily: FB, textAnchor: \"end\" }, \"now\"),\n    React.createElement(\"text\", { key: \"lbl-title\", x: w / 2, y: h - 8, fontSize: \"9\", fill: \"rgba(255,255,255,0.15)\", fontFamily: FB, textAnchor: \"middle\", letterSpacing: \"0.15em\" }, totalSessions + \" SESSIONS\")\n  ]));\n}\n\nfunction PatternWeave({ themeHistory, sessionCount }) {\n  // Shows recurring themes as horizontal threads with weight-based thickness\n  if (!themeHistory) return null;\n  var keys = Object.keys(themeHistory);\n  // Find themes that appeared in 2+ sessions\n  var recurring = keys.filter(function(k) { return themeHistory[k].appearances.length >= 2; })\n    .sort(function(a, b) { return themeHistory[b].appearances.length - themeHistory[a].appearances.length; })\n    .slice(0, 5);\n  if (recurring.length === 0) return null;\n\n  return React.createElement(\"div\", { style: { display: \"flex\", flexDirection: \"column\", gap: 12, width: \"100%\", maxWidth: 300 } },\n    recurring.map(function(key, i) {\n      var theme = themeHistory[key];\n      var apps = theme.appearances;\n      var latest = apps[apps.length - 1];\n      var first = apps[0];\n      var weightShift = latest.weight - first.weight;\n      var color = NC[i % NC.length];\n      var direction = weightShift > 0 ? \"\u2191\" : weightShift < 0 ? \"\u2193\" : \"\u2192\";\n      var dirColor = weightShift > 0 ? \"#FF6B9D\" : weightShift < 0 ? \"#6BFFB8\" : \"rgba(255,255,255,0.3)\";\n      return React.createElement(\"div\", { key: key, style: { display: \"flex\", alignItems: \"center\", gap: 12, animation: \"riseUp 0.5s ease \" + (i * 0.1) + \"s both\" } }, [\n        React.createElement(\"div\", { key: \"dot\", style: { width: 8, height: 8, borderRadius: \"50%\", background: color, opacity: 0.6, flexShrink: 0 } }),\n        React.createElement(\"div\", { key: \"info\", style: { flex: 1 } }, [\n          React.createElement(\"div\", { key: \"label\", style: { fontSize: 15, color: \"white\", fontFamily: FD, fontStyle: \"italic\" } }, theme.label),\n          React.createElement(\"div\", { key: \"meta\", style: { fontSize: 11, color: \"rgba(255,255,255,0.3)\", fontFamily: FB, marginTop: 2 } },\n            apps.length + \" sessions\" + (apps.length >= 3 ? \" \u2014 this keeps returning\" : \"\"))\n        ]),\n        React.createElement(\"div\", { key: \"shift\", style: { fontSize: 18, color: dirColor, fontFamily: FD, flexShrink: 0 } }, direction)\n      ]);\n    })\n  );\n}\n\n// \u2500\u2500 Field Phase \u2500\u2500\n\nfunction FieldPhase({ synthesisData, rawText }) {\n  var sd = synthesisData || {};\n  var themes = (sd.themes || []).map(function(t, i) { return { label: t.label, weight: t.weight || 1, color: t.color || NC[i % NC.length] }; });\n  var tension = sd.tension || null;\n  var synthesis = sd.synthesis || \"\";\n  var underneath = sd.underneath || [];\n  var opening = sd.opening || \"\";\n  var archetypes = sd.archetypes || [];\n  var arrival = sd.arrival || null;\n  var alchemyData = sd.alchemy || null;\n  var blindSpot = sd.blind_spot || null;\n  var conns = sd.connections || [];\n\n  // Smart fallback: pick ONE archetype if AI didn't return any\n  if (archetypes.length === 0 && themes.length > 0) {\n    var allText = (synthesis + \" \" + opening + \" \" + (underneath||[]).join(\" \") + \" \" + (tension ? tension.text : \"\") + \" \" + (rawText||\"\").slice(0,500)).toLowerCase();\n    var archScores = [\n      { key: \"chrysalis\", phase: \"dissolving\", words: [\"transform\",\"change\",\"becoming\",\"dissolving\",\"letting go\",\"shift\",\"shed\",\"release\"], title: \"Something is dissolving\", line: \"What you were is making room for what you're becoming.\" },\n      { key: \"sisyphus\", phase: \"pushing\", words: [\"again\",\"loop\",\"repeat\",\"cycle\",\"stuck\",\"same\",\"keep\",\"pattern\",\"tired\",\"push\"], title: \"The beautiful repetition\", line: \"What looks like going nowhere might be building the strength you need.\" },\n      { key: \"tower\", phase: \"trembling\", words: [\"fall\",\"break\",\"collapse\",\"end\",\"fail\",\"shatter\",\"crumble\",\"lose\",\"wrong\"], title: \"The necessary collapse\", line: \"What's falling apart was supposed to fall apart.\" },\n      { key: \"phoenix\", phase: \"stirring\", words: [\"fire\",\"burn\",\"rise\",\"rebirth\",\"ash\",\"new\",\"emerge\",\"born\",\"start over\"], title: \"Rising from the heat\", line: \"Something had to burn before this could exist.\" },\n      { key: \"hermit\", phase: \"listening\", words: [\"alone\",\"quiet\",\"silence\",\"solitude\",\"withdraw\",\"space\",\"retreat\",\"still\"], title: \"The lamp in the dark\", line: \"You stepped away to hear something.\" },\n      { key: \"threshold\", phase: \"standing\", words: [\"door\",\"choice\",\"decide\",\"leave\",\"enter\",\"between\",\"edge\",\"ready\",\"step\",\"next\"], title: \"Standing at the door\", line: \"You already know which side you belong on.\" },\n      { key: \"weaver\", phase: \"seeing\", words: [\"connect\",\"thread\",\"pattern\",\"link\",\"weave\",\"together\",\"relate\",\"between\",\"across\"], title: \"The threads are connecting\", line: \"What seemed separate is revealing itself as one pattern.\" },\n      { key: \"star\", phase: \"glimmer\", words: [\"hope\",\"light\",\"small\",\"gentle\",\"quiet\",\"tender\",\"soft\",\"okay\",\"fine\"], title: \"Light after collapse\", line: \"Something survived that wasn't supposed to.\" },\n    ];\n    archScores.forEach(function(arch) {\n      var score = 0;\n      arch.words.forEach(function(w) { if (allText.indexOf(w) >= 0) score++; });\n      arch.score = score;\n    });\n    archScores.sort(function(a, b) { return b.score - a.score; });\n    if (archScores[0].score > 1) {\n      archetypes = [archScores[0]];\n    }\n  }\n\n  // Take only the FIRST archetype \u2014 one offering per session\n  var primaryArch = archetypes[0] || null;\n  var archReg = primaryArch ? (ARCH_REGISTRY[primaryArch.key] || ARCH_REGISTRY.chrysalis) : null;\n\n  var savedRef = useRef(false);\n  useEffect(function() { if (!savedRef.current && sd.themes) { savedRef.current = true; saveSession(Object.assign({}, sd, { archetypes: archetypes })); } }, []);\n  var history = useMemo(function() { return getArchetypeHistory(); }, []);\n  var timeline = useMemo(function() { return getSessionTimeline(); }, []);\n  var sessionCount = timeline.length;\n\n  // \u2550\u2550\u2550 ARCHETYPE RESPONSE STATE \u2550\u2550\u2550\n  var [archResponse, setArchResponse] = useState(null); // \"recognized\" | \"glimpsed\" | \"rejected\" | null\n  var [current, setCurrent] = useState(0);\n  var [clicked, setClicked] = useState(false);\n  var containerRef = useRef(null);\n\n  // \u2550\u2550\u2550 BUILD CARDS DYNAMICALLY \u2550\u2550\u2550\n  var CARDS = useMemo(function() {\n    var c = [];\n\n    // ACT I: ARRIVING\n    c.push({ type: \"arrival\", bg: \"linear-gradient(160deg, #1A0A2E 0%, #3D1D6B 40%, #E84393 100%)\" });\n\n    // ACT II: WHAT EMERGED\n    c.push({ type: \"reading\", bg: \"linear-gradient(160deg, #2E1A0A 0%, #6B3D1D 40%, #D6B26D 100%)\" });\n    if (tension) c.push({ type: \"tension\", bg: \"linear-gradient(160deg, #0A1A2E 0%, #1D3D6B 40%, #6BB8FF 100%)\", interactive: true });\n    if (underneath.length > 0) c.push({ type: \"underneath\", bg: \"linear-gradient(160deg, #1A0A2E 0%, #2D1B4B 40%, #B86BFF 100%)\" });\n\n    // ACT III: THE OFFERING (archetype)\n    if (primaryArch) {\n      c.push({ type: \"offering\", bg: archReg ? archReg.bg : \"linear-gradient(160deg, #0D0D2B 0%, #1A1A4B 40%, #888 100%)\", interactive: true });\n      // The unfolding card gets inserted dynamically after response\n      if (archResponse === \"recognized\") {\n        c.push({ type: \"unfolding\", bg: archReg ? archReg.bg : \"linear-gradient(160deg, #0D0D2B 0%, #1A1A4B 40%, #888 100%)\" });\n      } else if (archResponse === \"glimpsed\") {\n        c.push({ type: \"glimpsed\", bg: archReg ? archReg.bg : \"linear-gradient(160deg, #0D0D2B 0%, #1A1A4B 40%, #888 60%)\" });\n      }\n    }\n\n    // ACT IV: THE DOOR\n    if (blindSpot) c.push({ type: \"blind_spot\", bg: \"linear-gradient(160deg, #0D0D18 0%, #141418 40%, #888890 15%)\" });\n    c.push({ type: \"opening\", bg: \"linear-gradient(160deg, #0A2E1A 0%, #1B4B3D 40%, #6BFFB8 100%)\" });\n    c.push({ type: \"close\", bg: \"linear-gradient(160deg, #0A2E1A 0%, #1B6B3D 40%, #6BFFB8 100%)\" });\n\n    return c;\n  }, [archResponse, tension, underneath.length, primaryArch, blindSpot]);\n\n  var card = CARDS[current];\n\n  // Save archetype response to localStorage\n  function handleArchResponse(response) {\n    setArchResponse(response);\n    setClicked(true); // allow advance past the interactive card\n    try {\n      var sessions = JSON.parse(localStorage.getItem(\"saycrd-sessions\") || \"[]\");\n      var lastSession = sessions[sessions.length - 1];\n      if (lastSession && primaryArch) {\n        lastSession.archetypeResponse = { key: primaryArch.key, phase: primaryArch.phase || \"\", response: response };\n        localStorage.setItem(\"saycrd-sessions\", JSON.stringify(sessions));\n      }\n    } catch(e) {}\n    console.log(\"[SAYCRD] Archetype response:\", response, \"for\", primaryArch ? primaryArch.key : \"none\");\n  }\n\n  var advance = function() {\n    if (card && card.interactive && !clicked) {\n      // For archetype offering, must use buttons \u2014 don't advance on tap\n      if (card.type === \"offering\") return;\n      // For tension and other interactive cards, first tap reveals content\n      setClicked(true);\n      return;\n    }\n    if (current < CARDS.length - 1) { setCurrent(function(c) { return c + 1; }); setClicked(false); }\n  };\n  var goBack = function() { if (current > 0) { setCurrent(function(c) { return c - 1; }); setClicked(false); } };\n  var handleClick = function(e) {\n    if (e.target.closest && (e.target.closest(\"button\") || e.target.closest(\".fj-response\"))) return;\n    var rect = containerRef.current ? containerRef.current.getBoundingClientRect() : null;\n    if (!rect) return;\n    var x = (e.clientX || (e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientX : 0)) - rect.left;\n    x < rect.width * 0.25 ? goBack() : advance();\n  };\n\n  useEffect(function() {\n    var handler = function(e) { if (e.key === \"ArrowRight\" || e.key === \" \") advance(); else if (e.key === \"ArrowLeft\") goBack(); };\n    window.addEventListener(\"keydown\", handler);\n    return function() { window.removeEventListener(\"keydown\", handler); };\n  }, [current, clicked, CARDS.length]);\n\n  var renderCard = function() {\n    if (!card) return null;\n    var timesAppeared = primaryArch ? (history[primaryArch.key] || 0) : 0;\n\n    switch (card.type) {\n\n      case \"arrival\": return (\n        <FC><FieldParticles color=\"#E84393\" count={20} />\n          <div style={{ fontSize: 11, color: \"rgba(255,255,255,0.15)\", fontFamily: FB, letterSpacing: \"0.3em\", marginBottom: 40, animation: \"riseUp 0.8s ease both\" }}>\n            {sessionCount > 1 ? \"SESSION \" + sessionCount : \"THIS SESSION\"}\n          </div>\n          <div style={{ fontFamily: FD, fontSize: 32, fontWeight: 300, color: \"rgba(255,255,255,0.9)\", textAlign: \"center\", maxWidth: 400, lineHeight: 1.4, animation: \"riseUp 1s ease 0.3s both\" }}>\n            {arrival ? arrival.line : \"Your Field\"}\n          </div>\n          {arrival && arrival.energy && <div style={{ marginTop: 32, display: \"flex\", alignItems: \"center\", gap: 10, animation: \"riseUp 1s ease 0.7s both\" }}>\n            <div style={{ width: 8, height: 8, borderRadius: \"50%\", background: \"#E84393\", boxShadow: \"0 0 12px rgba(232,67,147,.4)\" }} />\n            <span style={{ fontSize: 12, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.15em\", textTransform: \"uppercase\" }}>{arrival.energy}</span>\n          </div>}\n          <FBody color=\"rgba(255,255,255,0.12)\" style={{ marginTop: 50, fontSize: 12 }}>tap to begin</FBody>\n        </FC>\n      );\n\n      case \"reading\": return (\n        <FC><FieldParticles color=\"#D6B26D\" count={12} />\n          <div style={{ fontFamily: FD, fontSize: 22, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.75)\", textAlign: \"center\", maxWidth: 380, lineHeight: 1.8, animation: \"riseUp 1s ease 0.2s both\" }}>\n            {synthesis}\n          </div>\n        </FC>\n      );\n\n      case \"tension\": {\n        if (!clicked) {\n          return <FC><FieldParticles color=\"#6BB8FF\" count={12} />\n            <FLabel color=\"#6BB8FF80\">THE PULL</FLabel>\n            <div style={{ display: \"flex\", gap: 16, alignItems: \"center\", animation: \"riseUp 0.8s ease 0.2s both\" }}>\n              <div style={{ padding: \"14px 20px\", borderRadius: 14, background: \"rgba(107,184,255,0.06)\", border: \"1px solid rgba(107,184,255,0.15)\", fontFamily: FD, fontSize: 17, fontStyle: \"italic\", color: \"rgba(255,255,255,0.65)\", maxWidth: 140, textAlign: \"center\" }}>{tension.a}</div>\n              <div style={{ fontSize: 12, color: \"rgba(255,255,255,0.12)\", fontFamily: FB }}>vs</div>\n              <div style={{ padding: \"14px 20px\", borderRadius: 14, background: \"rgba(107,184,255,0.06)\", border: \"1px solid rgba(107,184,255,0.15)\", fontFamily: FD, fontSize: 17, fontStyle: \"italic\", color: \"rgba(255,255,255,0.65)\", maxWidth: 140, textAlign: \"center\" }}>{tension.b}</div>\n            </div>\n            <FTap color=\"#6BB8FF\">tap to see what lives here</FTap>\n          </FC>;\n        } else {\n          return <FC><FieldParticles color=\"#6BB8FF\" count={15} />\n            <FLabel color=\"#6BB8FF80\">THE PULL</FLabel>\n            <div style={{ fontFamily: FD, fontSize: 18, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.65)\", textAlign: \"center\", maxWidth: 360, lineHeight: 1.7, animation: \"riseUp 0.8s ease both\" }}>{tension.text}</div>\n          </FC>;\n        }\n      }\n\n      case \"underneath\": return (\n        <FC><FieldParticles color=\"#B86BFF\" count={10} />\n          <FLabel color=\"#B86BFF70\">UNDERNEATH</FLabel>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 20, maxWidth: 360 }}>\n            {underneath.slice(0, 2).map(function(u, i) {\n              var text = typeof u === \"string\" ? u : u.observation || \"\";\n              return <div key={i} style={{ fontFamily: FD, fontSize: 18, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.6)\", lineHeight: 1.7, animation: \"riseUp 0.8s ease \" + (0.2 + i * 0.3) + \"s both\" }}>{text}</div>;\n            })}\n          </div>\n        </FC>\n      );\n\n      case \"offering\": {\n        if (!primaryArch || !archReg) return null;\n        var Viz = archReg.Viz;\n        var c = archReg.color;\n        var vizEl = null;\n        try { vizEl = <Viz morphed={false} color={c} />; } catch(e) { vizEl = <div style={{fontSize:52,textAlign:\"center\"}}>{archReg.icon}</div>; }\n\n        return <FC><FieldParticles color={c} count={18} />\n          <div style={{ fontSize: 14, color: \"rgba(255,255,255,0.25)\", fontFamily: FD, fontStyle: \"italic\", marginBottom: 20, animation: \"riseUp 0.8s ease both\" }}>\n            Something in your words carries the shape of...\n          </div>\n          <div style={{ margin: \"10px 0 16px\" }}>{vizEl}</div>\n          <div style={{ fontFamily: FB, fontSize: 28, fontWeight: 700, letterSpacing: \"0.05em\", color: c, textTransform: \"uppercase\", animation: \"riseUp 0.8s ease 0.3s both\" }}>{archReg.name}</div>\n          <div style={{ fontSize: 13, color: c + \"88\", fontFamily: FB, letterSpacing: \"0.1em\", marginBottom: 28, animation: \"riseUp 0.8s ease 0.4s both\" }}>{archReg.icon}</div>\n          {primaryArch.phase && archReg.phases && archReg.phases[primaryArch.phase] && <div style={{ fontFamily: FD, fontSize: 15, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.35)\", maxWidth: 320, textAlign: \"center\", lineHeight: 1.6, marginBottom: 28, animation: \"riseUp 0.8s ease 0.5s both\" }}>\n            {archReg.phases[primaryArch.phase]}\n          </div>}\n          {!archResponse && <div className=\"fj-response\" style={{ display: \"flex\", flexDirection: \"column\", gap: 10, marginTop: 8, animation: \"riseUp 0.8s ease 0.7s both\" }}>\n            {[\n              { key: \"recognized\", label: \"I know this creature\", icon: \"\\u25C9\" },\n              { key: \"glimpsed\", label: \"I\\u2019ve glimpsed it\", icon: \"\\u25CE\" },\n              { key: \"rejected\", label: \"This belongs to someone else\", icon: \"\\u25CB\" },\n            ].map(function(opt) {\n              return <button key={opt.key} onClick={function(e) { e.stopPropagation(); handleArchResponse(opt.key); }} style={{\n                background: \"rgba(255,255,255,0.03)\", border: \"1px solid \" + c + \"22\", borderRadius: 14, padding: \"12px 24px\",\n                color: c + \"cc\", fontFamily: FD, fontSize: 15, fontStyle: \"italic\", cursor: \"pointer\", transition: \"all 0.2s\",\n                display: \"flex\", alignItems: \"center\", gap: 10\n              }}><span style={{ opacity: 0.4 }}>{opt.icon}</span> {opt.label}</button>;\n            })}\n          </div>}\n          {archResponse && <div style={{ marginTop: 16, fontSize: 13, color: c + \"60\", fontFamily: FB, letterSpacing: \"0.1em\", animation: \"riseUp 0.5s ease both\" }}>\n            {archResponse === \"recognized\" ? \"recognized\" : archResponse === \"glimpsed\" ? \"noted\" : \"released\"} {\" \\u2192\"}\n          </div>}\n        </FC>;\n      }\n\n      case \"unfolding\": {\n        if (!primaryArch || !archReg) return null;\n        var c = archReg.color;\n        var Viz = archReg.Viz;\n        var vizEl = null;\n        try { vizEl = <Viz morphed={true} color={c} />; } catch(e) { vizEl = <div style={{fontSize:52}}>{archReg.icon}</div>; }\n        var phase = primaryArch.phase || \"\";\n        var phaseText = (archReg.phases && phase) ? archReg.phases[phase] || \"\" : \"\";\n        var evoMessages = ARCH_EVOLUTION[primaryArch.key] || [];\n        var visits = history[primaryArch.key] || 0;\n        var reading = primaryArch.reading || primaryArch.line || \"\";\n\n        return <FC><FieldParticles color={c} count={25} />\n          <FLabel color={c}>{archReg.name.toUpperCase()}</FLabel>\n          {phase && <div style={{ fontSize: 11, color: c, opacity: 0.6, fontFamily: FB, letterSpacing: \"0.2em\", marginBottom: 12, textTransform: \"uppercase\", animation: \"riseUp 0.6s ease both\" }}>{phase.replace(/_/g, \" \")}</div>}\n          {visits > 1 && <div style={{ fontSize: 10, color: c, opacity: 0.35, fontFamily: FB, letterSpacing: \"0.2em\", marginBottom: 12, animation: \"riseUp 0.6s ease both\" }}>VISIT {visits}</div>}\n          <div style={{ margin: \"10px 0 16px\" }}>{vizEl}</div>\n          <div style={{ fontFamily: FD, fontSize: 17, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.6)\", maxWidth: 340, textAlign: \"center\", lineHeight: 1.7, animation: \"riseUp 0.8s ease 0.3s both\" }}>\n            {reading}\n          </div>\n          {alchemyData && alchemyData.stage && <div style={{ marginTop: 28, padding: \"14px 22px\", borderRadius: 14, background: \"rgba(255,255,255,0.02)\", border: \"1px solid rgba(255,255,255,0.06)\", animation: \"riseUp 0.8s ease 0.6s both\" }}>\n            <div style={{ fontSize: 10, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.2em\", marginBottom: 6 }}>{(FIELD_ALCHEMY[alchemyData.stage] || {}).label || alchemyData.stage}</div>\n            {alchemyData.evidence && <div style={{ fontSize: 13, color: \"rgba(255,255,255,0.35)\", fontFamily: FD, fontStyle: \"italic\", lineHeight: 1.6 }}>{alchemyData.evidence}</div>}\n          </div>}\n        </FC>;\n      }\n\n      case \"glimpsed\": {\n        if (!primaryArch || !archReg) return null;\n        var c = archReg.color;\n        return <FC><FieldParticles color={c} count={10} />\n          <div style={{ fontFamily: FB, fontSize: 15, fontWeight: 500, letterSpacing: \"0.05em\", color: c + \"88\", animation: \"riseUp 0.8s ease both\" }}>{archReg.icon} {archReg.name}</div>\n          <div style={{ fontFamily: FD, fontSize: 18, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.4)\", maxWidth: 320, textAlign: \"center\", lineHeight: 1.7, marginTop: 20, animation: \"riseUp 0.8s ease 0.3s both\" }}>\n            Noted. The {archReg.name.toLowerCase()} is near but not yet named.\n          </div>\n          {primaryArch.phase && archReg.phases && archReg.phases[primaryArch.phase] && <div style={{ fontFamily: FD, fontSize: 14, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.2)\", maxWidth: 300, textAlign: \"center\", lineHeight: 1.6, marginTop: 16, animation: \"riseUp 0.8s ease 0.5s both\" }}>\n            {archReg.phases[primaryArch.phase]}\n          </div>}\n        </FC>;\n      }\n\n      case \"blind_spot\": return (\n        <FC><FieldParticles color=\"#888890\" count={8} />\n          <div style={{ fontSize: 42, marginBottom: 20, opacity: 0.3, animation: \"riseUp 0.8s ease both\" }}>{\"\\u25D0\"}</div>\n          <div style={{ fontSize: 11, color: \"rgba(255,255,255,0.2)\", fontFamily: FB, letterSpacing: \"0.25em\", textTransform: \"uppercase\", marginBottom: 24, animation: \"riseUp 0.8s ease 0.2s both\" }}>what you might not see</div>\n          <div style={{ fontFamily: FD, fontSize: 19, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.6)\", maxWidth: 360, textAlign: \"center\", lineHeight: 1.8, animation: \"riseUp 1s ease 0.4s both\" }}>{blindSpot}</div>\n        </FC>\n      );\n\n      case \"opening\": {\n        var openText = typeof opening === \"string\" ? opening : (opening.text || \"\");\n        var openQ = typeof opening === \"object\" ? opening.question : null;\n        return <FC><FieldParticles color=\"#6BFFB8\" count={15} />\n          <div style={{ fontSize: 11, color: \"rgba(107,255,184,0.3)\", fontFamily: FB, letterSpacing: \"0.25em\", textTransform: \"uppercase\", marginBottom: 24, animation: \"riseUp 0.8s ease both\" }}>what{\"\\u2019\"}s opening</div>\n          <div style={{ fontFamily: FD, fontSize: 19, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(255,255,255,0.65)\", maxWidth: 380, textAlign: \"center\", lineHeight: 1.8, animation: \"riseUp 1s ease 0.3s both\" }}>{openText}</div>\n          {openQ && <><div style={{ width: 40, height: 1, background: \"linear-gradient(90deg,transparent,rgba(107,255,184,0.15),transparent)\", margin: \"28px auto\", animation: \"riseUp 0.8s ease 0.7s both\" }} />\n          <div style={{ fontFamily: FD, fontSize: 17, fontWeight: 300, fontStyle: \"italic\", color: \"rgba(214,178,109,0.5)\", maxWidth: 360, textAlign: \"center\", lineHeight: 1.7, animation: \"riseUp 1s ease 1s both\" }}>{openQ}</div></>}\n        </FC>;\n      }\n\n      case \"close\": {\n        return <FC><FieldParticles color=\"#6BFFB8\" count={30} />\n          <div style={{ display: \"flex\", gap: 12, marginBottom: 28, animation: \"riseUp 0.8s ease both\" }}>\n            {primaryArch && archReg && archResponse === \"recognized\" && <div style={{ padding: \"8px 16px\", borderRadius: 20, background: archReg.color + \"15\", border: \"1px solid \" + archReg.color + \"33\", fontSize: 13, color: archReg.color, fontFamily: FB, fontWeight: 500 }}>{archReg.icon} {archReg.name}</div>}\n            {alchemyData && alchemyData.stage && <div style={{ padding: \"8px 16px\", borderRadius: 20, background: \"rgba(255,255,255,0.04)\", border: \"1px solid rgba(255,255,255,0.08)\", fontSize: 12, color: \"rgba(255,255,255,0.35)\", fontFamily: FB }}>{(FIELD_ALCHEMY[alchemyData.stage] || {}).label || alchemyData.stage}</div>}\n          </div>\n          <div style={{ fontSize: 15, color: \"rgba(255,255,255,0.15)\", fontFamily: FB, letterSpacing: \"0.25em\", animation: \"riseUp 0.8s ease 0.2s both\" }}>THE FIELD HOLDS THIS</div>\n          <div style={{ marginTop: 32, fontSize: 12, color: \"rgba(255,255,255,0.08)\", fontFamily: FB }}>session complete</div>\n        </FC>;\n      }\n\n      default: return null;\n    }\n  };\n\n  // \u2550\u2550\u2550 PROGRESS + RENDER \u2550\u2550\u2550\n  var progress = CARDS.length > 1 ? current / (CARDS.length - 1) : 0;\n\n  return (\n    <div ref={containerRef} onClick={handleClick} style={{\n      position: \"relative\", width: \"100%\", height: \"100%\", overflow: \"hidden\", cursor: \"pointer\", userSelect: \"none\",\n      background: card ? card.bg : \"#000\", transition: \"background 0.6s ease\",\n    }}>\n      {/* Progress bar */}\n      <div style={{ position: \"absolute\", top: 0, left: 0, right: 0, height: 2, zIndex: 20, background: \"rgba(255,255,255,0.03)\" }}>\n        <div style={{ height: \"100%\", width: (progress * 100) + \"%\", background: \"rgba(255,255,255,0.15)\", transition: \"width 0.4s ease\" }} />\n      </div>\n      {/* Dots */}\n      <div style={{ position: \"absolute\", top: 12, left: \"50%\", transform: \"translateX(-50%)\", display: \"flex\", gap: 5, zIndex: 20 }}>\n        {CARDS.map(function(_, i) {\n          return <div key={i} style={{ width: 5, height: 5, borderRadius: \"50%\", background: i === current ? \"rgba(255,255,255,0.4)\" : i < current ? \"rgba(255,255,255,0.15)\" : \"rgba(255,255,255,0.05)\", transition: \"all 0.3s\", transform: i === current ? \"scale(1.3)\" : \"scale(1)\" }} />;\n        })}\n      </div>\n      {/* Card */}\n      <div key={current} style={{ animation: \"morphIn 0.5s ease both\" }}>{renderCard()}</div>\n    </div>\n  );\n}\n\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550 MAIN \u2550\u2550\u2550\u2550\u2550\u2550\u2550\nfunction SAYCRDFlow() {\n  const [phase, setPhase] = useState(0);\n  const [rawText, setRawText] = useState(\"\");\n  const [synthesisData, setSynthesisData] = useState(null);\n  const [fieldTransition, setFieldTransition] = useState(false);\n  const cp = PHASES[phase];\n\n  function enterField() {\n    setFieldTransition(true);\n    setTimeout(function() { setPhase(4); setFieldTransition(false); }, 1200);\n  }\n  return (\n    <div style={{width:\"100%\",height:\"100vh\",background:\"#000\",display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}}>\n      <link href=\"https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&display=swap\" rel=\"stylesheet\"/>\n      <div style={{width:\"100%\",maxWidth:420,height:\"100vh\",maxHeight:860,background:GRADIENTS[cp],position:\"relative\",overflow:\"hidden\",transition:\"background 0.8s ease\"}}>\n        {phase<4&&<PhaseIndicator current={phase} phases={PHASES.slice(0,4)}/>}\n        <div key={phase} style={{width:\"100%\",height:\"100%\",animation:\"slideIn 0.4s ease-out\"}}>\n          {cp===\"pour\"&&<PourPhase onComplete={(t)=>{setRawText(t);setPhase(1);}}/>}\n          {cp===\"synthesize\"&&<SynthesizePhase rawText={rawText} onComplete={()=>setPhase(2)} onSynthesis={setSynthesisData}/>}\n          {cp===\"map\"&&<MapPhase onComplete={()=>setPhase(3)} synthesisData={synthesisData} rawText={rawText}/>}\n          {cp===\"session\"&&<SessionPhase onComplete={enterField} synthesisData={synthesisData}/>}\n          {cp===\"field\"&&<FieldPhase synthesisData={synthesisData} rawText={rawText}/>}\n          {fieldTransition && <div style={{ position: \"fixed\", inset: 0, zIndex: 999, background: \"#000\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", animation: \"morphIn 0.4s ease both\" }}>\n            <div style={{ fontFamily: FB, fontSize: 11, letterSpacing: \"0.4em\", color: \"rgba(255,255,255,0.2)\", textTransform: \"uppercase\", animation: \"pulse 1.5s ease infinite\" }}>entering the field</div>\n          </div>}\n        </div>\n      </div>\n      <style>{`\n        @keyframes slideIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}\n        @keyframes morphIn{from{opacity:0;transform:scale(0.96)}to{opacity:1;transform:scale(1)}}\n        @keyframes riseUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}\n        @keyframes pulse{0%,100%{opacity:0.7}50%{opacity:1}}\n        @keyframes growWidth{from{width:0%}}\n        @keyframes floatParticle{0%,100%{transform:translateY(0) translateX(0)}33%{transform:translateY(-10px) translateX(5px)}66%{transform:translateY(5px) translateX(-7px)}}\n        @keyframes fieldFloat{0%,100%{transform:translateY(0) translateX(0)}33%{transform:translateY(-12px) translateX(6px)}66%{transform:translateY(6px) translateX(-8px)}}\n        @keyframes floatWord{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}\n        @keyframes connBlink{0%,100%{opacity:0.65;filter:brightness(1)}50%{opacity:1;filter:brightness(1.4)}}\n        @keyframes ringPulse{0%,100%{opacity:0.3;transform:scale(1)}50%{opacity:0.7;transform:scale(1.15)}}\n        @keyframes nodeBreathe{0%,100%{filter:brightness(1)}50%{filter:brightness(1.12)}}\n        @keyframes drawerIn{from{opacity:0;transform:translate(-50%,24px) scale(0.95)}to{opacity:1;transform:translate(-50%,0) scale(1)}}\n        @keyframes sweep{0%,100%{transform:translateX(-100%)}50%{transform:translateX(100%)}}\n        *{box-sizing:border-box;-webkit-font-smoothing:antialiased}\n        body{margin:0;background:#000;overflow:hidden}\n        textarea::placeholder{color:rgba(255,255,255,0.15)}\n        textarea{caret-color:#6BB8FF}\n        button:active{transform:scale(0.97)}\n        ::-webkit-scrollbar{width:3px}\n        ::-webkit-scrollbar-track{background:transparent}\n        ::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}\n      `}</style>\n      <div style={{ position: \"fixed\", bottom: 4, right: 8, fontSize: 9, color: \"rgba(255,255,255,0.08)\", fontFamily: FB, zIndex: 9999, pointerEvents: \"none\" }}>v5.2</div>\n    </div>\n  );\n}\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(React.createElement(SAYCRDFlow));\n";
try {
  var compiled = Babel.transform(jsxCode, { presets: ['react'] }).code;
  var s = document.createElement('script');
  s.textContent = compiled;
  document.body.appendChild(s);
} catch(e) {
  document.getElementById('root').innerHTML = '<pre style="color:#ff6b6b;padding:20px;font-size:13px;white-space:pre-wrap">BABEL ERROR:\n' + e.message + '</pre>';
}
</script>
</body>
</html>